<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- mapper >> interface 매핑 : id 값 중요 (interface 메소드) -->
<mapper namespace="com.dae.kdmes.Mapper.Appm.FPLANW010_Mapper">
    <select id="GetFPLANW010_ListOne" resultType="com.dae.kdmes.DTO.Appm.FPLANW010_VO">
        select top 1 * from TB_FPLAN_W010
    </select>
    <select id="GetFPLANW010_Blank" resultType="com.dae.kdmes.DTO.Appm.FPLANW010_VO">
        select '' as  custcd, '' as spjangcd, '' as plan_no, '' as wseq, '' as wflag, '' as wfrdt, ''  as wtrdt, '' as wrmc, '' as machname, 0 as winqt, 0 as wotqt, 0 as wqcqt,
               0 as wbdqt, 0 as wscnt, 0 as winps, 0 as wsyul, '' as wrps, '' as wremark, '' as decision,'' as indate, '' as inperid, 0 as wokqt,
               '' as wono, '' as cltcd, '' as cltnm, '' as pname, '' as psize, '' as wrpsnm
               from dual
    </select>
    <select id="GetFPLAN_Blank" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        select '' as  custcd, '' as spjangcd, '' AS wodv, '' AS wono, '' AS lotno, '' as plan_no,  '' as cltcd, '' as cltnm, '' as pcode, '' as pname, '' AS psize, '' AS punit,
               '' as line, '' as opcod, '' as prod_sdate, '' AS prod_edate, 0 AS prod_qty , 0 AS end_qty , '' AS orddate, '' AS ordnum, '' AS ordseq, 0 AS ordqty,
               '' AS ord_edate, '' AS close_date, '' AS decision, '' AS cls_flag, '' AS work_flag, '' AS dem_flag, '' AS qc_flag, '' AS close_flag, '' AS end_flag,
               '' as istore, '' as ostore, '' as rwflag, '' as perid, '' as wrps, '' as remark, '' as workdv,'' as wflag, '' as wseq, 0 AS winqt, 0 AS tordqty, getdate() as wfrdt
        from dual
    </select>

    <select id="GetFPLAN_List"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
        SELECT A.custcd,
               A.spjangcd,
               A.wodv,
               A.wono,
               A.lotno,
               A.plan_no,
               A.cltcd,
               B.acorp as cltnm,
               A.pcode,
               C.jpum AS pname,
               C.jgugek AS psize,
               C.jdanwy AS punit,
               C.jchajong AS jchajong,
               A.line,
               A.opcod,
               A.prod_sdate as prod_sdate,
               A.prod_edate,
               A.prod_qty,
               ISNULL(CAST(DBO.DF_NM_RTN('TB_FPLAN_PLAN_W010_SUM', A.plan_no, '00010', '', '') as DECIMAL(18,0)),0) AS  end_qty,
               A.orddate,
               A.ordnum,
               A.ordseq,
               A.ordqty,
               A.ord_edate,
               A.close_date,
               isnull(A.decision,'') as  decision,
               A.cls_flag,
               A.work_flag,
               A.dem_flag,
               A.qc_flag,
               A.close_flag,
               A.end_flag,
               A.istore,
               A.ostore,
               A.rwflag,
               A.perid,
               A.remark,
               A.workdv,
               A.inmonth,
               A.inweeks,
               A.wflag wflag,
               A.wseq  wseq,
               CAST(DBO.DF_NM_RTN('TB_FPLAN_WORK_WOTQT', A.plan_no, '00010', '', '') as DECIMAL(18,3)) winqt,
               A.tordqty,
               C.w_b_gubn,
               F.wrmc as wrmc,
               F.wrmcnm as wrmcnm
        FROM TB_FPLAN A WITH(NOLOCK)
                LEFT join TB_FPLAN_WRMC F WITH (NOLOCK) ON A.wrmc = F.wrmc and F.wflag = '00010',
            JCODE C WITH(NOLOCK),
            CIF B WITH(NOLOCK)
        WHERE (A.pcode              = C.JKEY)
          AND (A.cltcd              =  B.acorp1 + CAST(B.acorp2 as varchar) )
          AND (ISNULL(A.cltcd,'')   lIKE  concat('%',#{cltcd},'%') )
          AND (ISNULL(A.pcode,'')   lIKE  concat('%',#{pcode},'%') )
           AND (ISNULL(A.inmonth,'')   lIKE  concat('%',#{inmonth},'%') )
           AND (ISNULL(A.inweeks,'')   lIKE  concat('%',#{inweeks},'%') )
           AND (ISNULL(A.wrmc,'')   lIKE  concat('%',#{wrmc},'%') )
          ORDER BY A.wrmc, A.prod_sdate , A.plan_no desc, A.wono
        ]]>
    </select>
    <!--
        AND ( ISNULL(A.line,'')  = '00' )
        AND (A.line               = #{line})
        AND (A.prod_sdate         BETWEEN #{fdate} AND #{tdate})
        AND (A.cls_flag          IN ('1', '2' ))
        AND (A.decision1 in ('0', '1', '2', '3'))
        AND (DBO.DF_NM_RTN('TB_FPLAN_WORK_WSEQ', A.plan_no, '00010', '', '') <> '00' OR ISNULL(A.wflag, '00010') <= '00010')
    -->

    <select id="GetFPLAN_SachulList"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
        SELECT A.custcd,
               A.spjangcd,
               A.wodv,
               A.wono,
               D.lotno AS lotno,
               A.plan_no,
               A.cltcd,
               B.acorp as cltnm,
               A.pcode,
               C.jpum AS pname,
               C.jgugek AS psize,
               C.jdanwy AS punit,
               C.jchajong AS jchajong,
               A.line,
               A.opcod,
               D.indate as prod_sdate,
               A.prod_edate,
               A.prod_qty,
               ISNULL(CAST(DBO.DF_NM_RTN('TB_FPLAN_PLAN_W010', D.lotno, '00010', '', '') as DECIMAL(18,0)),0) AS  end_qty,
               A.orddate,
               A.ordnum,
               A.ordseq,
               A.ordqty,
               A.ord_edate,
               A.close_date,
               isnull(D.decision,'') as  decision,
               A.cls_flag,
               A.work_flag,
               A.dem_flag,
               A.qc_flag,
               A.close_flag,
               A.end_flag,
               A.istore,
               A.ostore,
               A.rwflag,
               A.perid,
               A.remark,
               A.workdv,
               A.inmonth,
               A.inweeks,
               D.wflag wflag,
               A.wseq  wseq,
               CAST(DBO.DF_NM_RTN('TB_FPLAN_WORK_WOTQT', A.plan_no, '00010', '', '') as DECIMAL(18,3)) winqt,
               A.tordqty,
               isnull(D.wotqt,0) as owqty,
               (select isnull(sum(wbqty),0) as wbqty from TB_FPLAN_WBAD where plan_no=A.plan_no  and wflag= '00010' group by plan_no,wseq,wflag ) as obqty,
               isnull(D.wotqt,0) - isnull(D.wbdqt,0) as otqty,
               D.partcode  as partcode,
               D.partnm  as partnm,
               D.winps as winps,
               D.wrmc as wrmc,
               E.wrmcnm as wrmcnm,
               C.w_b_gubn,
               D.wrps as wrps,
               (CASE WHEN D.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', D.custcd, D.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', D.custcd, D.wrps, '', '') END ) wrpsnm
        FROM TB_FPLAN A WITH(NOLOCK)
             LEFT OUTER JOIN  TB_FPLAN_W010 D ON A.plan_no = D.plan_no AND D.wflag = '00010'
             Left OUTER JOIN  TB_FPLAN_WRMC E ON A.wflag = E.wflag and D.wrmc = E.wrmc ,
            JCODE C WITH(NOLOCK),
            CIF B WITH(NOLOCK)
        WHERE (A.pcode              = C.JKEY)
          AND (A.cltcd              =  B.acorp1 + CAST(B.acorp2 as varchar) )
          AND (ISNULL(A.cltcd,'')   lIKE  concat('%',#{cltcd},'%') )
          AND (ISNULL(A.pcode,'')   lIKE  concat('%',#{pcode},'%') )
           AND (ISNULL(A.lotno,'')   lIKE  concat('%',#{lotno},'%') )
           AND (ISNULL(A.inmonth,'')   lIKE  concat('%',#{inmonth},'%') )
           AND (ISNULL(A.inweeks,'')   lIKE  concat('%',#{inweeks},'%') )
           AND ( ISNULL(A.line,'')  = '00' )
           AND (A.line               = #{line})
           and  LEN(isnull(D.lotno,'')) > 0
           AND (DBO.DF_NM_RTN('TB_FPLAN_WORK_WSEQ', A.plan_no, '00010', '', '') <> '00' OR ISNULL(A.wflag, '00010') <= '00010')
          ORDER BY A.plan_no desc, A.wono
        ]]>
    </select>
<!--    AND (A.prod_sdate         BETWEEN #{fdate} AND #{tdate})-->
<!--    AND (D.cls_flag          IN ('1', '2' ))-->
<!--    AND (D.decision in ('0', '1'))-->

    <select id="GetFPLAN_List02"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
    SELECT	F.wono,
              F.lotno,
              F.plan_no,
              F.cltcd,
              F.pcode,
              F.pname,
              F.psize,
              F.punit,
              F.prod_sdate,
              F.prod_edate,
              F.prod_qty,
              F.otqty,
              F.wflag,
              F.wseq,
              F.jboxsu1,
              F.prod_qty - F.otqty as obqty
        FROM (
                 SELECT	A.wono,
                       E.lotno AS lotno,
                       A.plan_no,
                       A.cltcd,
                       A.pcode,
                       C.jpum AS pname,
                       C.jgugek AS psize,
                       C.jdanwy AS punit,
                       A.prod_sdate as prod_sdate,
                       A.prod_edate,
                       (E.wotqt)  - (E.wbdqt) as prod_qty,
                       ISNULL(E.gqty01,0)  as otqty,
                       A.wflag wflag,
                       A.wseq  wseq,
                       C.jboxsu1
                 FROM TB_FPLAN A WITH(NOLOCK)
                         LEFT OUTER JOIN  TB_FPLAN_W010 E ON A.plan_no   = E.plan_no AND E.wflag = '00010'
                         LEFT OUTER JOIN  TB_FPLAN_W020 D ON E.glotnono = D.lotno AND D.wflag = '00020' ,
                     JCODE C WITH(NOLOCK)
                 WHERE (A.pcode              = C.JKEY)
                   AND (E.decision          IN ('3' ))
                   AND ( ISNULL(A.line,'')  = '00' )
                   AND (ISNULL(E.lotno,'')   lIKE  concat('%',#{lotno},'%') )
                   AND (ISNULL(A.pcode,'')   lIKE  concat('%',#{pcode},'%') )
                   AND (DBO.DF_NM_RTN('TB_FPLAN_WORK_WSEQ', A.plan_no, '00020', '', '') <> '00' OR ISNULL(A.wflag, '00020') = '00020')
                   AND ( Len( ISNULL(A.wflag,'') ) > 0  )
                   AND C.w_b_gubn NOT IN ('H')
             ) F
        WHERE F.prod_qty - F.otqty > 0
        ORDER BY F.prod_sdate desc, F.wono
         ]]>
    </select>
<!--    AND (A.prod_sdate         BETWEEN #{fdate} AND #{tdate})-->

    <select id="GetFPLAN_List02_salist"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
    SELECT	F.wono,
              F.lotno,
              F.plan_no,
              F.cltcd,
              F.pcode,
              F.pname,
              F.psize,
              F.punit,
              F.prod_sdate,
              F.prod_edate,
              F.prod_qty,
              F.otqty,
              F.wbdqt,
              F.wqcqt,
              F.wflag,
              F.wseq,
              F.jboxsu1,
              F.prod_qty - F.otqty as obqty
        FROM (
                 SELECT	A.wono,
                       E.lotno AS lotno,
                       A.plan_no,
                       A.cltcd,
                       A.pcode,
                       C.jpum AS pname,
                       C.jgugek AS psize,
                       C.jdanwy AS punit,
                       A.prod_sdate as prod_sdate,
                       A.prod_edate,
                       (E.qty)  - (E.bqty) as prod_qty,
                       ISNULL(E.qty,0)  as otqty,
                       ISNULL(E.bqty,0)  as wbdqt,
                       ISNULL(E.sqty,0)  as wqcqt,
                       A.wflag wflag,
                       A.wseq  wseq,
                       C.jboxsu1
                 FROM TB_FPLAN A WITH(NOLOCK)
                         LEFT OUTER JOIN  TB_FPLAN_IWORK E ON A.plan_no   = E.plan_no AND E.wflag = '00010' AND E.glotno = #{lotno}
                          LEFT OUTER JOIN  TB_FPLAN_W020 D ON E.glotno = D.lotno AND D.wflag = '00020' ,
                     JCODE C WITH(NOLOCK)
                 WHERE (A.pcode              = C.JKEY)
                   AND (A.cls_flag          IN ('1', '2', '3' ))
                   AND ( ISNULL(A.line,'')  = '00' )
                   AND (DBO.DF_NM_RTN('TB_FPLAN_WORK_WSEQ', A.plan_no, '00020', '', '') <> '00' OR ISNULL(A.wflag, '00020') = '00020')
                   AND ( Len( ISNULL(A.wflag,'') ) > 0  )
             ) F
        WHERE isnull(F.otqty,0) > 0
        ORDER BY F.prod_sdate desc, F.wono
         ]]>
    </select>

    <select id="GetFPLAN_List02_JO"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
    SELECT	F.wono,
              F.lotno,
              F.plan_no,
              F.cltcd,
              F.pcode,
              F.pname,
              F.psize,
              F.punit,
              F.prod_sdate,
              F.prod_edate,
              F.prod_qty,
              F.otqty,
              F.wflag,
              F.wseq,
              F.jboxsu1,
              F.prod_qty - F.otqty as obqty
        FROM (
                 SELECT	A.wono,
                       A.lotno AS lotno,
                       A.plan_no,
                       A.cltcd,
                       A.pcode,
                       C.jpum AS pname,
                       C.jgugek AS psize,
                       C.jdanwy AS punit,
                       A.prod_sdate as prod_sdate,
                       A.prod_edate,
                       (E.wotqt)  - (E.wbdqt) as prod_qty,
                       ISNULL(E.jqty01,0)  as otqty,
                       A.wflag wflag,
                       A.wseq  wseq,
                       C.jboxsu1
                 FROM TB_FPLAN A WITH(NOLOCK)
                         LEFT OUTER JOIN  TB_FPLAN_W010 E ON A.plan_no   = E.plan_no AND E.wflag = '00010'
                          LEFT OUTER JOIN  TB_FPLAN_W030 D ON E.jlotnono = D.lotno AND D.wflag = '00030' ,
                     JCODE C WITH(NOLOCK)
                 WHERE (A.pcode              = C.JKEY)
                   AND (A.cls_flag          IN ('1', '2', '3' ))
                   AND ( ISNULL(A.line,'')  = '00' )
                   AND (A.prod_sdate         BETWEEN #{fdate} AND #{tdate})
                   AND (ISNULL(A.lotno,'')   lIKE  concat('%',#{lotno},'%') )
                   AND (ISNULL(A.pcode,'')   lIKE  concat('%',#{pcode},'%') )
                   AND (DBO.DF_NM_RTN('TB_FPLAN_WORK_WSEQ', A.plan_no, '00020', '', '') <> '00' OR ISNULL(A.wflag, '00030') = '00030')
                   AND ( Len( ISNULL(A.wflag,'') ) > 0  )
                   AND C.w_b_gubn IN ('H')
             ) F
        WHERE F.prod_qty - F.otqty > 0
        ORDER BY F.prod_sdate desc, F.wono
         ]]>
    </select>

    <select id="GetFPLAN_List02Arr"  parameterType="hashmap" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">

        SELECT A.custcd,
               A.spjangcd,
               A.wodv,
               A.wono,
               D.lotno,
               A.plan_no,
               A.cltcd,
               B.acorp as cltnm,
               A.pcode,
               C.jpum AS pname,
               C.jgugek AS psize,
               C.jdanwy AS punit,
               A.line,
               A.opcod,
               A.prod_sdate as prod_sdate,
               A.prod_edate,
               A.end_qty,
               A.orddate,
               A.ordnum,
               A.ordseq,
               A.ordqty,
               A.ord_edate,
               A.close_date,
               isnull(A.decision,'') as  decision,
               A.cls_flag,
               A.work_flag,
               A.dem_flag,
               A.qc_flag,
               A.close_flag,
               A.end_flag,
               A.istore,
               A.ostore,
               A.rwflag,
               A.perid,
               A.remark,
               A.workdv,
               A.wflag AS wflag,
               A.wseq AS wseq,
               CAST(DBO.DF_NM_RTN('TB_FPLAN_WORK_WOTQT', A.plan_no, A.wflag, '', '') as DECIMAL(18,3)) winqt,
               A.tordqty,
               isnull(D.wotqt,0) as owqty,
               (select isnull(sum(wbqty),0) as wbqty from TB_FPLAN_WBAD where plan_no=A.plan_no and wseq=A.wseq and wflag= '00010' group by plan_no,wseq,wflag ) as obqty,
               isnull(D.wotqt,0) - isnull(D.wbdqt,0) as prod_qty,
               ISNULL(D.gqty01,0)  as otqty,
               D.winps as winps,
               D.wrps as wrps,
               C.jboxsu1,
               (CASE WHEN D.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', D.custcd, D.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', D.custcd, D.wrps, '', '') END ) wrpsnm
        FROM TB_FPLAN A WITH(NOLOCK)
             LEFT OUTER JOIN  TB_FPLAN_W010 D ON A.plan_no   = D.plan_no AND D.wflag = '00010'
             LEFT OUTER JOIN  TB_FPLAN_W020 E ON A.plan_no = D.plan_no AND D.wflag = '00020' ,
            JCODE C WITH(NOLOCK),
            CIF B WITH(NOLOCK)
        WHERE (A.pcode              = C.JKEY)
          AND (A.cltcd              =  B.acorp1 + CAST(B.acorp2 as varchar) )
          AND (D.decision          IN (  '3' ))
          AND D.lotno in
                <foreach collection="itemcdArr" item="itemcd" open="(" close=")" separator=",">
                  #{itemcd}
                </foreach>
          AND   ISNULL(A.wflag, '00020') = '00020'
          AND ( Len( ISNULL(A.wflag,'') ) > 0  )
          AND C.w_b_gubn NOT IN ('H')
          ORDER BY A.prod_sdate desc, A.wono

    </select>


    <select id="GetFPLAN_List02Arr_JO"  parameterType="hashmap" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">

        SELECT A.custcd,
        A.spjangcd,
        A.wodv,
        A.wono,
        A.lotno,
        A.plan_no,
        A.cltcd,
        B.acorp as cltnm,
        A.pcode,
        C.jpum AS pname,
        C.jgugek AS psize,
        C.jdanwy AS punit,
        A.line,
        A.opcod,
        A.prod_sdate as prod_sdate,
        A.prod_edate,
        A.prod_qty,
        A.end_qty,
        A.orddate,
        A.ordnum,
        A.ordseq,
        A.ordqty,
        A.ord_edate,
        A.close_date,
        isnull(A.decision,'') as  decision,
        A.cls_flag,
        A.work_flag,
        A.dem_flag,
        A.qc_flag,
        A.close_flag,
        A.end_flag,
        A.istore,
        A.ostore,
        A.rwflag,
        A.perid,
        A.remark,
        A.workdv,
        D.wflag wflag,
        A.wseq  wseq,
        CAST(DBO.DF_NM_RTN('TB_FPLAN_WORK_WOTQT', A.plan_no, A.wflag, '', '') as DECIMAL(18,3)) winqt,
        A.tordqty,
        isnull(D.wotqt,0) as owqty,
        (select isnull(sum(wbqty),0) as wbqty from TB_FPLAN_WBAD where plan_no=A.plan_no and wseq=A.wseq and wflag= '00010' group by plan_no,wseq,wflag ) as obqty,
        isnull(D.wotqt,0) - isnull(D.wbdqt,0) as otqty,
        D.winps as winps,
        D.wrps as wrps,
        (CASE WHEN D.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', D.custcd, D.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', D.custcd, D.wrps, '', '') END ) wrpsnm
        FROM TB_FPLAN A WITH(NOLOCK)
        LEFT OUTER JOIN  TB_FPLAN_W010 D ON A.plan_no = D.plan_no AND D.wflag = '00020' ,
        JCODE C WITH(NOLOCK),
        CIF B WITH(NOLOCK)
        WHERE (A.pcode              = C.JKEY)
        AND (A.cltcd              =  B.acorp1 + CAST(B.acorp2 as varchar) )
        AND (A.cls_flag          IN ('1', '2', '3' ))
        AND A.lotno in
        <foreach collection="itemcdArr" item="itemcd" open="(" close=")" separator=",">
            #{itemcd}
        </foreach>
        AND   ISNULL(A.wflag, '00020') = '00020'
        AND ( Len( ISNULL(A.wflag,'') ) > 0  )
        AND C.w_b_gubn IN ('H')
        ORDER BY A.prod_sdate desc, A.wono

    </select>

    <select id="GetFPLAN_List02_REG"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
        SELECT A.custcd,
               A.spjangcd,
               D.lotno AS lotno,
               MAX(A.plan_no) AS plan_no,
               MAX(A.cltcd) cltcd ,
               ''  as cltnm,
               MAX(A.pcode) as pcode,
               MAX(C.jpum) AS pname,
               MAX(C.jgugek) AS psize,
               MAX(C.jdanwy) AS punit,
               MAX(C.jchajong) AS jchajong,
               MAX(A.prod_sdate) as prod_sdate,
               MAX(A.prod_edate) AS prod_edate,
               MAX(D.wboxsu) AS wboxsu,
               D.wqcqt ,
               D.wsumqt ,
               D.wotqt  - D.wbdqt as prod_qty,
               D.wotqt   as otqty,
               D.wbdqt,
               MAX(D.wcode) as wcode,
               ( select com_rem1 from TB_CA510 where com_cls = '005' and com_code   != '00' and com_REM2  = '00020' and com_code = MAX(D.wcode)) as wcodenm,
               isnull(D.wotqt,0) as owqty,
               0 as obqty,
               isnull(D.wotqt,0) - isnull(D.wbdqt,0) as otqty,
               '' AS partcode ,
               D.winps as winps,
               D.wrps as wrps,
               D.indate as qcdate,
               D.wremark as wremark,
               D.demflag as demflag,
               (CASE WHEN D.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', A.custcd, D.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', A.custcd, D.wrps, '', '') END ) wrpsnm

        FROM  TB_FPLAN_W020 D  WITH(NOLOCK)
            LEFT OUTER JOIN  TB_FPLAN_W010 E ON D.lotno   = E.glotnono
			LEFT OUTER JOIN  TB_FPLAN      A ON A.plan_no   = D.plan_no AND Len( ISNULL(A.wflag,'') ) > 0  AND   ( ISNULL(A.lotno,'')   lIKE  concat('%',#{lotno},'%') ) ,
            JCODE C WITH(NOLOCK)
        WHERE (A.pcode              = C.JKEY)
          AND ( Len( ISNULL(A.wflag,'') ) > 0  )
          AND D.indate between #{frdate} and #{todate}
          AND C.w_b_gubn NOT IN ('H')
        GROUP BY A.custcd, A.spjangcd, D.lotno,  D.wotqt, D.wbdqt, D.winps, D.wrps, D.indate, D.wremark, D.wsumqt, D.demflag, D.wqcqt
        ORDER BY D.lotno desc


        ]]>
    </select>

    <select id="GetFPLAN_List02_REG_JO"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
        SELECT A.custcd,
               A.spjangcd,
               D.lotno AS lotno,
               MAX(A.plan_no) AS plan_no,
               MAX(A.cltcd) cltcd ,
               ''  as cltnm,
               MAX(A.pcode) as pcode,
               MAX(C.jpum) AS pname,
               MAX(C.jgugek) AS psize,
               MAX(C.jdanwy) AS punit,
               MAX(C.jchajong) AS jchajong,
               MAX(A.prod_sdate) as prod_sdate,
               MAX(A.prod_edate) AS prod_edate,
               MAX(D.wboxsu) AS wboxsu,
               D.wsumqt ,
               D.wotqt  - D.wbdqt as prod_qty,
               D.wotqt   as otqty,
               isnull(D.wotqt,0) as owqty,
               isnull(D.wbdqt,0) as wbdqt,
               isnull(D.wqcqt,0) as wqcqt,
               0 as obqty,
               isnull(D.wotqt,0) - isnull(D.wbdqt,0) as otqty,
               '' AS partcode ,
               D.wrps as winps,
               D.wrps as wrps,
               D.indate as qcdate,
               D.wremark as wremark,
               D.demflag as demflag,
               F.wcode as wcode,
               (select com_rem1 from TB_CA510 where com_cls = '005' and com_code<>'00' and com_code=F.wcode and com_rem2='00030') as wcodenm,
               (CASE WHEN D.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', A.custcd, D.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', A.custcd, D.wrps, '', '') END ) wrpsnm

        FROM  TB_FPLAN_W030 D  WITH(NOLOCK)
            LEFT OUTER JOIN  TB_FPLAN_W010 E ON D.lotno   = E.jlotnono
            LEFT OUTER JOIN  TB_FPLAN_WBAD F ON D.lotno   = F.plan_no AND F.wseq = '01' AND F.wflag = '00030' AND LEN(ISNULL(WCODE,'')) > 0
			LEFT OUTER JOIN  TB_FPLAN      A ON A.plan_no   = D.plan_no AND Len( ISNULL(A.wflag,'') ) > 0 ,
            JCODE C WITH(NOLOCK)
        WHERE (A.pcode              = C.JKEY)
          AND ( ISNULL(D.lotno,'')   lIKE  concat('%',#{lotno},'%') )
          AND ( Len( ISNULL(A.wflag,'') ) > 0  )
          AND D.indate between #{frdate} and #{todate}
          AND C.w_b_gubn IN ('H')
        GROUP BY A.custcd, A.spjangcd, D.lotno,  D.wotqt, D.wbdqt,D.wqcqt, D.winps, D.wrps, D.indate, D.wremark, D.wsumqt, D.demflag, F.wcode
        ORDER BY D.lotno desc


        ]]>
    </select>

    <select id="GetFPLAN_List02_HIS"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
        SELECT A.custcd,
               A.spjangcd,
               (A.plan_no) AS plan_no,
               A.cltcd,
               B.acorp as cltnm,
               A.pcode,
               C.jpum AS pname,
               C.jgugek AS psize,
               C.jchajong AS jchajong,
               C.jdanwy AS punit,
               E.lotno as lotno,
               (A.prod_sdate) as prod_sdate,
               (A.prod_edate) AS prod_edate,
               E.wfrdt as wfrdt,
               E.wtrdt as wtrdt,
               E.wotqt - E.wbdqt as prod_qty,
               E.gqty01 as end_qty,
               D.lotno AS glotnono,
               substring(D.indate, 3,2)+ '-' + substring(D.indate, 5,2)+ '- ' + substring(D.indate, 7,2)  as qcdate,
               D.wqcqt as wqcqt,
               isnull(D.wotqt,0) as owqty,
               isnull(D.wbdqt,0) as wbdqt,
               isnull(D.wotqt,0) - isnull(D.wbdqt,0) as otqty,
               D.winps as winps,
               D.wrps as wrps,
                isnull(D.demflag,'0') as demflag,
               D.wremark as wremark,
               (CASE WHEN E.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', A.custcd, E.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', A.custcd, E.wrps, '', '') END ) wrpsnm01,
               (CASE WHEN D.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', A.custcd, D.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', A.custcd, D.wrps, '', '') END ) wrpsnm02
        FROM  TB_FPLAN_W020 D  WITH(NOLOCK)
			LEFT OUTER JOIN  TB_FPLAN_IWORK F ON D.lotno   = F.glotno
			LEFT OUTER JOIN  TB_FPLAN      A ON A.plan_no   = F.plan_no AND Len( ISNULL(A.wflag,'') ) > 0 AND ( ISNULL(A.lotno,'')   lIKE  concat('%',#{lotno},'%') )
            LEFT OUTER JOIN  TB_FPLAN_W010  E ON A.plan_no   = E.plan_no AND Len( ISNULL(A.wflag,'') ) > 0 ,
            JCODE C WITH(NOLOCK),
            CIF B WITH(NOLOCK)
        WHERE (A.pcode              = C.JKEY)
          AND (A.cltcd              =  B.acorp1 + CAST(B.acorp2 as varchar) )
          AND C.w_b_gubn NOT IN ('H')
          AND D.indate between #{fdate} and #{tdate}
          AND isnull(D.wrps, '')   lIKE  concat('%',#{wrps},'%')
        ORDER BY D.lotno, A.LOTNO
        ]]>
    </select>


    <select id="GetFPLAN_List02_HISMON"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
        SELECT D.custcd,
               D.spjangcd,
               substring(LEFT(D.indate,6), 3,2)+ '/' + substring(LEFT(D.indate,6), 5,2)  as qcdate,
               SUM(isnull(D.wotqt,0))  - SUM(isnull(D.wbdqt,0))   as prod_qty,
               SUM(isnull(D.wqcqt,0))  as end_qty,
               SUM(isnull(D.wqcqt,0)) as wqcqt,
               SUM(isnull(D.wotqt,0)) as owqty,
               SUM(isnull(D.wbdqt,0)) as wbdqt,
               SUM(isnull(D.wotqt,0)) - SUM(isnull(D.wbdqt,0)) as otqty,
			   ISNULL(DBO.DF_NM_RTN('TB_JA001', D.custcd, D.wrps, '', ''),'')  wrpsnm02,
               D.wrps as wrps
        FROM  TB_FPLAN_W020 D  WITH(NOLOCK)
        WHERE   LEFT(D.indate,6) between #{fdate} and #{tdate}
          AND isnull(D.wrps, '')   lIKE  concat('%',#{wrps},'%')
		GROUP BY LEFT(D.indate,6), D.wrps, D.custcd,        D.spjangcd
        ORDER BY D.wrps
        ]]>
    </select>

    <select id="GetFPLAN_List02_HISPER"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
        SELECT A.custcd,
               A.spjangcd,
               (A.plan_no) AS plan_no,
               A.cltcd,
               B.acorp as cltnm,
               A.pcode,
               C.jpum AS pname,
               C.jgugek AS psize,
               C.jchajong AS jchajong,
               C.jdanwy AS punit,
               E.lotno as lotno,
               (A.prod_sdate) as prod_sdate,
               (A.prod_edate) AS prod_edate,
               E.wfrdt as wfrdt,
               E.wtrdt as wtrdt,
               E.wotqt - E.wbdqt as prod_qty,
               E.gqty01 as end_qty,
               D.lotno AS glotnono,
               substring(D.indate, 3,2)+ '-' + substring(D.indate, 5,2)+ '- ' + substring(D.indate, 7,2)  as qcdate,
               D.wqcqt as wqcqt,
               isnull(D.wotqt,0) as owqty,
               isnull(D.wbdqt,0) as wbdqt,
               isnull(D.wotqt,0) - isnull(D.wbdqt,0) as otqty,
               D.winps as winps,
               D.wrps as wrps,
                isnull(D.demflag,'0') as demflag,
               D.wremark as wremark,
               (CASE WHEN E.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', A.custcd, E.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', A.custcd, E.wrps, '', '') END ) wrpsnm01,
               (CASE WHEN D.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', A.custcd, D.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', A.custcd, D.wrps, '', '') END ) wrpsnm02
        FROM  TB_FPLAN_W020 D  WITH(NOLOCK)
			LEFT OUTER JOIN  TB_FPLAN_IWORK F ON D.lotno   = F.glotno
			LEFT OUTER JOIN  TB_FPLAN      A ON A.plan_no   = F.plan_no AND Len( ISNULL(A.wflag,'') ) > 0 AND ( ISNULL(A.lotno,'')   lIKE  concat('%',#{lotno},'%') )
            LEFT OUTER JOIN  TB_FPLAN_W010  E ON A.plan_no   = E.plan_no AND Len( ISNULL(A.wflag,'') ) > 0 ,
            JCODE C WITH(NOLOCK),
            CIF B WITH(NOLOCK)
        WHERE (A.pcode              = C.JKEY)
          AND (A.cltcd              =  B.acorp1 + CAST(B.acorp2 as varchar) )
          AND C.w_b_gubn NOT IN ('H')
          AND D.indate between #{fdate} and #{tdate}
          AND isnull(D.wrps, '')   lIKE  concat('%',#{wrps},'%')
        ORDER BY D.wrps, D.indate
        ]]>
    </select>


    <select id="GetFPLAN_List02_GSUM"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
        SELECT SUM(D.jqty) AS wotqt,
               D.lotno as lotno
        FROM  TB_FPLAN_IWORK D  WITH(NOLOCK)
        WHERE (D.plan_no  = #{plan_no})
        Group by D.plan_no, D.lotno
        union
        SELECT 0 AS wotqt,
               '' as lotno
        ]]>
    </select>
<!--    SELECT SUM(D.wotqt) AS wotqt,-->
<!--    MAX(D.lotno) as lotno-->
<!--    FROM  TB_FPLAN_W020 D  WITH(NOLOCK)-->
<!--    WHERE (D.plan_no  = #{plan_no})-->
<!--    Group by D.plan_no-->
    <select id="GetFPLAN_List02_HIS_JO"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
        SELECT A.custcd,
               A.spjangcd,
               (A.plan_no) AS plan_no,
               A.cltcd,
               B.acorp as cltnm,
               A.pcode,
               C.jpum AS pname,
               C.jgugek AS psize,
               C.jdanwy AS punit,
               A.lotno as lotno,
               (A.prod_sdate) as prod_sdate,
               (A.prod_edate) AS prod_edate,
               E.wfrdt as wfrdt,
               E.wtrdt as wtrdt,
               E.wotqt - E.wbdqt as prod_qty,
               E.gqty01 as end_qty,
               D.lotno AS glotnono,
               D.indate as qcdate,
               isnull(D.wotqt,0) as owqty,
               isnull(D.wotqt,0) - isnull(D.wbdqt,0) as otqty,
               D.winps as winps,
               D.wrps as wrps,
               D.wremark as wremark,
               (CASE WHEN E.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', A.custcd, E.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', A.custcd, E.wrps, '', '') END ) wrpsnm01,
               (CASE WHEN D.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', A.custcd, D.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', A.custcd, D.wrps, '', '') END ) wrpsnm02
        FROM  TB_FPLAN_W030 D  WITH(NOLOCK)
			LEFT OUTER JOIN  TB_FPLAN_IWORK F ON D.lotno   = F.glotno
			LEFT OUTER JOIN  TB_FPLAN      A ON A.plan_no   = F.plan_no AND Len( ISNULL(A.wflag,'') ) > 0
            LEFT OUTER JOIN  TB_FPLAN_W010  E ON A.plan_no   = E.plan_no AND Len( ISNULL(A.wflag,'') ) > 0 ,
            JCODE C WITH(NOLOCK),
            CIF B WITH(NOLOCK)
        WHERE (A.pcode              = C.JKEY)
          AND (A.cltcd              =  B.acorp1 + CAST(B.acorp2 as varchar) )
          AND ( ISNULL(D.lotno,'')   lIKE  concat('%',#{lotno},'%') )
          AND C.w_b_gubn IN ('H')
        ORDER BY D.lotno, A.LOTNO
        ]]>
    </select>

    <select id="GetFPLAN_List03"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
    SELECT	F.wono,
              F.lotno,
              F.plan_no,
              F.cltcd,
              F.pcode,
              F.pname,
              F.psize,
              F.punit,
              F.prod_sdate,
              F.prod_edate,
              F.prod_qty,
              F.otqty,
              F.wflag,
              F.wseq,
              F.jboxsu1,
              F.prod_qty - F.otqty as obqty
        FROM (
                 SELECT	A.wono,
                       D.lotno AS lotno,
                       A.plan_no,
                       A.cltcd,
                       A.pcode,
                       C.jpum AS pname,
                       C.jgugek AS psize,
                       C.jdanwy AS punit,
                       A.prod_sdate as prod_sdate,
                       A.prod_edate,
                       (E.wotqt)  - (E.wbdqt) as prod_qty,
                       ISNULL(E.gqty01,0)  as otqty,
                       A.wflag wflag,
                       A.wseq  wseq,
                       C.jboxsu1
                 FROM TB_FPLAN A WITH(NOLOCK)
                         LEFT OUTER JOIN  TB_FPLAN_W010 E ON A.plan_no   = E.plan_no AND E.wflag = '00010'
                          LEFT OUTER JOIN  TB_FPLAN_W030 D ON E.jlotnono = D.lotno AND D.wflag = '00030' ,
                     JCODE C WITH(NOLOCK)
                 WHERE (A.pcode              = C.JKEY)
                   AND (A.cls_flag          IN ('1', '2', '3' ))
                   AND ( ISNULL(A.line,'')  = '00' )
                   AND (A.prod_sdate         BETWEEN #{frdate} AND #{todate})
                   AND (ISNULL(A.lotno,'')   lIKE  concat('%',#{lotno},'%') )
                   AND (ISNULL(A.pcode,'')   lIKE  concat('%',#{pcode},'%') )
                   AND (DBO.DF_NM_RTN('TB_FPLAN_WORK_WSEQ', A.plan_no, '00030', '', '') <> '00' OR ISNULL(A.wflag, '00030') = '00030')
                   AND ( Len( ISNULL(A.wflag,'') ) > 0  )
             ) F
        WHERE F.prod_qty - F.otqty > 0
        ORDER BY F.prod_sdate desc, F.wono
         ]]>
    </select>
    <select id="GetFPLAN_List03Arr"  parameterType="hashmap" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">

        SELECT A.custcd,
        A.spjangcd,
        A.wodv,
        A.wono,
        A.lotno,
        A.plan_no,
        A.cltcd,
        B.acorp as cltnm,
        A.pcode,
        C.jpum AS pname,
        C.jgugek AS psize,
        C.jdanwy AS punit,
        A.line,
        A.opcod,
        A.prod_sdate as prod_sdate,
        A.prod_edate,
        A.prod_qty,
        A.end_qty,
        A.orddate,
        A.ordnum,
        A.ordseq,
        A.ordqty,
        A.ord_edate,
        A.close_date,
        isnull(A.decision,'') as  decision,
        A.cls_flag,
        A.work_flag,
        A.dem_flag,
        A.qc_flag,
        A.close_flag,
        A.end_flag,
        A.istore,
        A.ostore,
        A.rwflag,
        A.perid,
        A.remark,
        A.workdv,
        D.wflag wflag,
        A.wseq  wseq,
        CAST(DBO.DF_NM_RTN('TB_FPLAN_WORK_WOTQT', A.plan_no, A.wflag, '', '') as DECIMAL(18,3)) winqt,
        A.tordqty,
        isnull(D.wotqt,0) as owqty,
        (select isnull(sum(wbqty),0) as wbqty from TB_FPLAN_WBAD where plan_no=A.plan_no and wseq=A.wseq and wflag= '00010' group by plan_no,wseq,wflag ) as obqty,
        isnull(D.wotqt,0) - isnull(D.wbdqt,0) as otqty,
        D.winps as winps,
        D.wrps as wrps,
        (CASE WHEN D.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', D.custcd, D.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', D.custcd, D.wrps, '', '') END ) wrpsnm
        FROM TB_FPLAN A WITH(NOLOCK)
        LEFT OUTER JOIN  TB_FPLAN_W010 D ON A.plan_no = D.plan_no AND D.wflag = '00030' ,
        JCODE C WITH(NOLOCK),
        CIF B WITH(NOLOCK)
        WHERE (A.pcode              = C.JKEY)
        AND (A.cltcd              =  B.acorp1 + CAST(B.acorp2 as varchar) )
        AND (A.cls_flag          IN ('1', '2', '3' ))
        AND A.lotno in
        <foreach collection="itemcdArr" item="itemcd" open="(" close=")" separator=",">
            #{itemcd}
        </foreach>
        AND   ISNULL(A.wflag, '00030') = '00030'
        AND ( Len( ISNULL(A.wflag,'') ) > 0  )
        ORDER BY A.prod_sdate desc, A.wono

    </select>
    <select id="GetFPLAN_List03_REG"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
        SELECT A.custcd,
               A.spjangcd,
               D.lotno AS lotno,
               MAX(A.plan_no) AS plan_no,
               MAX(A.cltcd) cltcd ,
               ''  as cltnm,
               MAX(A.pcode) as pcode,
               MAX(C.jpum) AS pname,
               MAX(C.jgugek) AS psize,
               MAX(C.jdanwy) AS punit,
               MAX(A.prod_sdate) as prod_sdate,
               MAX(A.prod_edate) AS prod_edate,
               MAX(D.wboxsu) AS wboxsu,
               D.wsumqt ,
               D.wotqt  - D.wbdqt as prod_qty,
               D.wotqt   as otqty,
               isnull(D.wotqt,0) as owqty,
               0 as obqty,
               isnull(D.wotqt,0) - isnull(D.wbdqt,0) as otqty,
               '' AS partcode ,
               D.winps as winps,
               D.wrps as wrps,
               D.indate as qcdate,
               D.wremark as wremark,
               D.demflag as demflag,
               (CASE WHEN D.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', A.custcd, D.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', A.custcd, D.wrps, '', '') END ) wrpsnm

        FROM  TB_FPLAN_W030 D  WITH(NOLOCK)
            LEFT OUTER JOIN  TB_FPLAN_W010 E ON D.lotno   = E.glotnono
			LEFT OUTER JOIN  TB_FPLAN      A ON A.plan_no   = D.plan_no AND Len( ISNULL(A.wflag,'') ) > 0 ,
            JCODE C WITH(NOLOCK)
        WHERE (A.pcode              = C.JKEY)
          AND ( ISNULL(D.lotno,'')   lIKE  concat('%',#{lotno},'%') )
          AND ( Len( ISNULL(A.wflag,'') ) > 0  )
          AND D.indate between #{frdate} and #{todate}
        GROUP BY A.custcd, A.spjangcd, D.lotno,  D.wotqt, D.wbdqt, D.winps, D.wrps, D.indate, D.wremark, D.wsumqt, D.demflag
        ORDER BY D.lotno desc


        ]]>
    </select>

    <select id="GetFPLAN_List03_HIS"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
        SELECT A.custcd,
               A.spjangcd,
               (A.plan_no) AS plan_no,
               A.cltcd,
               B.acorp as cltnm,
               A.pcode,
               C.jpum AS pname,
               C.jgugek AS psize,
               C.jdanwy AS punit,
               A.lotno as lotno,
               (A.prod_sdate) as prod_sdate,
               (A.prod_edate) AS prod_edate,
               E.wfrdt as wfrdt,
               E.wtrdt as wtrdt,
               E.wotqt - E.wbdqt as prod_qty,
               E.gqty01 as end_qty,
               D.lotno AS glotnono,
               D.indate as qcdate,
               isnull(D.wotqt,0) as owqty,
               isnull(D.wotqt,0) - isnull(D.wbdqt,0) as otqty,
               D.winps as winps,
               D.wrps as wrps,
               D.wremark as wremark,
               (CASE WHEN E.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', A.custcd, E.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', A.custcd, E.wrps, '', '') END ) wrpsnm01,
               (CASE WHEN D.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', A.custcd, D.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', A.custcd, D.wrps, '', '') END ) wrpsnm02
        FROM  TB_FPLAN_W020 D  WITH(NOLOCK)
			LEFT OUTER JOIN  TB_FPLAN_IWORK F ON D.lotno   = F.glotno
			LEFT OUTER JOIN  TB_FPLAN      A ON A.plan_no   = F.plan_no AND Len( ISNULL(A.wflag,'') ) > 0
            LEFT OUTER JOIN  TB_FPLAN_W010  E ON A.plan_no   = E.plan_no AND Len( ISNULL(A.wflag,'') ) > 0 ,
            JCODE C WITH(NOLOCK),
            CIF B WITH(NOLOCK)
        WHERE (A.pcode              = C.JKEY)
          AND (A.cltcd              =  B.acorp1 + CAST(B.acorp2 as varchar) )
          AND ( ISNULL(D.lotno,'')   lIKE  concat('%',#{lotno},'%') )
        ORDER BY D.lotno, A.LOTNO
        ]]>
    </select>



    <select id="GetFPLAN_List03_old"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
        SELECT A.custcd,
               A.spjangcd,
               A.wodv,
               A.wono,
               D.lotno AS lotno,
               A.plan_no,
               A.cltcd,
               B.acorp as cltnm,
               A.pcode,
               C.jpum AS pname,
               C.jgugek AS psize,
               C.jdanwy AS punit,
               A.line,
               A.opcod,
               A.prod_sdate as prod_sdate,
               A.prod_edate,
               A.end_qty as prod_qty,
               A.end_qty,
               A.orddate,
               A.ordnum,
               A.ordseq,
               A.ordqty,
               A.ord_edate,
               A.close_date,
               isnull(A.decision,'') as  decision,
               A.cls_flag,
               A.work_flag,
               A.dem_flag,
               A.qc_flag,
               A.close_flag,
               A.end_flag,
               A.istore,
               A.ostore,
               A.rwflag,
               A.perid,
               A.remark,
               A.workdv,
               D.wflag wflag,
               A.wseq  wseq,
               CAST(DBO.DF_NM_RTN('TB_FPLAN_WORK_WOTQT', A.plan_no, A.wflag, '', '') as DECIMAL(18,3)) winqt,
               A.tordqty,
               isnull(D.wotqt,0) as owqty,
               (select isnull(sum(wbqty),0) as wbqty from TB_FPLAN_WBAD where plan_no=A.plan_no and wseq=A.wseq and wflag= '00020' group by plan_no,wseq,wflag ) as obqty,
               (select sum(qty) from tb_fplan_iwork where plan_no = A.plan_no and wflag = '00020' ) as otqty,
               D.winps as winps,
               D.wrps as wrps,
               Left(D.indate,4) + '-' + substring(D.indate, 5,2)+ '-' + substring(D.indate, 7,2) as   qcdate,
               (CASE WHEN D.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', D.custcd, D.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', D.custcd, D.wrps, '', '') END ) wrpsnm
        FROM TB_FPLAN A WITH(NOLOCK),
             TB_FPLAN_W020 D WITH(NOLOCK) ,
            JCODE C WITH(NOLOCK),
            CIF B WITH(NOLOCK)
        WHERE (A.pcode              = C.JKEY)
          AND (A.cltcd              =  B.acorp1 + CAST(B.acorp2 as varchar) )
          AND (A.line               = #{line})
          AND (A.cls_flag          IN ('1', '2', '3' ))
          AND A.plan_no = D.plan_no
          AND D.wflag = '00020'
          AND (A.prod_sdate         BETWEEN #{fdate} AND #{tdate})
          AND (ISNULL(A.cltcd,'')   lIKE  concat('%',#{cltcd},'%') )
          AND (ISNULL(A.pcode,'')   lIKE  concat('%',#{pcode},'%') )
          AND ( ISNULL(A.line,'')  = '00' )
          AND (DBO.DF_NM_RTN('TB_FPLAN_WORK_WSEQ', A.plan_no, '00020', '', '') <> '00' OR ISNULL(A.wflag, '00020') <= '00020')
          AND ( Len( ISNULL(A.wflag,'') ) > 0  )
        ORDER BY A.prod_sdate desc, A.wono
        ]]>
    </select>


    <select id="GetFPLAN_List03_xx"  parameterType="com.dae.kdmes.DTO.Appm.FPLAN_VO" resultType="com.dae.kdmes.DTO.Appm.FPLAN_VO">
        <![CDATA[
        SELECT A.custcd,
               A.spjangcd,
               A.wodv,
               A.wono,
               A.lotno,
               A.plan_no,
               A.cltcd,
               B.acorp as cltnm,
               A.pcode,
               C.jpum AS pname,
               C.jgugek AS psize,
               C.jdanwy AS punit,
               A.line,
               A.opcod,
               A.prod_sdate as prod_sdate,
               A.prod_edate,
               E.wotqt  - E.wbdqt as prod_qty,
               D.wotqt  - D.wbdqt as end_qty,
               A.orddate,
               A.ordnum,
               A.ordseq,
               A.ordqty,
               A.ord_edate,
               A.close_date,
               isnull(A.decision,'') as  decision,
               A.cls_flag,
               A.work_flag,
               A.dem_flag,
               A.qc_flag,
               A.close_flag,
               A.end_flag,
               A.istore,
               A.ostore,
               A.rwflag,
               A.perid,
               A.remark,
               A.workdv,
               A.wflag wflag,
               A.wseq  wseq,
               CAST(DBO.DF_NM_RTN('TB_FPLAN_WORK_WOTQT', A.plan_no, A.wflag, '', '') as DECIMAL(18,3)) winqt,
               A.tordqty,
               isnull(D.wotqt,0) as owqty,
               (select isnull(sum(wbqty),0) as wbqty from TB_FPLAN_WBAD where plan_no=A.plan_no and wseq=A.wseq and wflag= '00020' group by plan_no,wseq,wflag ) as obqty,
               isnull(D.wotqt,0) - isnull(D.wbdqt,0) as otqty,
               '' AS partcode ,
               D.winps as winps,
               D.wrps as wrps,
               (CASE WHEN D.winps > 1 THEN DBO.DF_NM_RTN('TB_JA001', D.custcd, D.wrps, '', '')  + '외 ' + CAST(D.winps - 1 AS VARCHAR(2)) + '명' ELSE  DBO.DF_NM_RTN('TB_JA001', D.custcd, D.wrps, '', '') END ) wrpsnm,
               isnull(CONVERT(CHAR(8), D.wfrdt,12), '') as   qcdate
        FROM TB_FPLAN A WITH(NOLOCK)
            LEFT OUTER JOIN  TB_FPLAN_W030 D ON A.plan_no = D.plan_no AND D.wflag = '00030'
            LEFT OUTER JOIN  TB_FPLAN_WTIME F ON A.plan_no = F.plan_no AND F.wflag = '00030' AND F.WSEQ = '03' AND F.SEQ = '001'
            LEFT OUTER JOIN  TB_FPLAN_W010 E ON A.plan_no   = E.plan_no AND E.wflag = '00010' ,
            JCODE C WITH(NOLOCK),
            CIF B WITH(NOLOCK)
        WHERE (A.pcode              = C.JKEY)
          AND (A.cltcd              =  B.acorp1 + CAST(B.acorp2 as varchar) )
          AND (A.line               = #{line})
          AND (A.cls_flag          IN ('1', '2', '3' ))
          AND (A.prod_sdate         BETWEEN #{fdate} AND #{tdate})
          AND (ISNULL(C.jpum,'')   lIKE  concat('%',#{pcode},'%')  or ISNULL(A.lotno,'')   lIKE  concat('%',#{pcode},'%')   )
          AND ( ISNULL(A.line,'')  = '00' )
          AND (DBO.DF_NM_RTN('TB_FPLAN_WORK_WSEQ', A.plan_no, '00020', '', '') <> '00' OR ISNULL(A.wflag, '00020') = '00020' OR ISNULL(A.wflag, '00030') = '00030')           AND (A.plan_no not in (SELECT plan_no from TB_FPLAN_W020 WITH (NOLOCK)  ) )
          AND ( Len( ISNULL(A.wflag,'') ) > 0  )
        ORDER BY A.prod_sdate desc, A.wono
        ]]>
    </select>



    <select id="GetFPLANW010_Detail" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO" resultType="com.dae.kdmes.DTO.Appm.FPLANW010_VO">
        select A.custcd, A.spjangcd, A.plan_no, A.lotno, A.wflag, A.wfrdt, A.wtrdt, A.wrmc as wrmc,  F.wrmcnm as machname,
               A.winqt, A.wotqt, A.wqcqt, A.wbdqt, A.wscnt, A.winps, A.wsyul, A.wrps, A.wremark, A.decision,B.decision1, A.indate, A.inperid, B.wono, C.acorp as cltnm , D.jkey AS pcode, D.jpum AS pname,
               D.jgugek AS psize, D.jdanwy AS punit, D.w_b_gubn,
               (CASE WHEN A.winps > 1 THEN E.inname  + '외 ' + CAST(A.winps - 1 AS VARCHAR(2)) + '명' ELSE  E.inname END ) wrpsnm
        from TB_FPLAN_W010 A WITH (NOLOCK)
		     LEFT OUTER JOIN  INSA E ON A.wrps = E.insano
             Left OUTER JOIN  TB_FPLAN_WRMC F ON A.wflag = F.wflag and A.wrmc = F.wrmc ,
            TB_FPLAN B WITH(NOLOCK),
            CIF C WITH(NOLOCK),
            JCODE D WITH(NOLOCK)
        where A.spjangcd = B.spjangcd
          AND   A.plan_no = B.plan_no
          AND   B.cltcd =  C.acorp1 + CAST(C.acorp2 as varchar)
          AND   B.pcode = D.jkey
          AND   A.plan_no=#{plan_no}
          AND   A.lotno =#{lotno}

    </select>

    <select id="GetFPLANW020_Detail" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO" resultType="com.dae.kdmes.DTO.Appm.FPLANW010_VO">
        select A.custcd, A.spjangcd, A.plan_no, A.wseq, A.wflag, A.wfrdt, A.wtrdt, A.wrmc as wrmc,  F.wrmcnm as machname,
        A.winqt, A.wotqt, A.wqcqt, A.wbdqt, A.wscnt, A.winps, A.wsyul, A.wrps, A.wremark, A.decision, A.indate, A.inperid, B.wono, C.acorp as cltnm  , D.jkey AS pcode, D.jpum AS pname,
        D.jgugek AS psize, D.jdanwy AS punit,
        (CASE WHEN A.winps > 1 THEN E.inname  + '외 ' + CAST(A.winps - 1 AS VARCHAR(2)) + '명' ELSE  E.inname END ) wrpsnm
        from TB_FPLAN_W020 A WITH (NOLOCK)
            LEFT OUTER JOIN  INSA E ON A.wrps = E.insano
            Left OUTER JOIN  TB_FPLAN_WRMC F ON A.wflag = F.wflag and A.wrmc = F.wrmc ,
            TB_FPLAN B WITH(NOLOCK), cif C WITH(NOLOCK),  JCODE D WITH(NOLOCK)
        where A.spjangcd = B.spjangcd
        AND   A.plan_no = B.plan_no
        AND   B.cltcd = C.acorp1 + CAST(C.acorp2 as varchar)
        AND   B.pcode = D.JKEY
        AND   A.lotno=#{lotno} and A.wseq in (#{wseq}, '02')
    </select>

    <select id="GetFPLANW020_LIST" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO" resultType="com.dae.kdmes.DTO.Appm.FPLANW010_VO">
        select A.custcd, A.spjangcd, A.plan_no, A.wseq, A.wflag, A.wfrdt, A.wtrdt, A.wrmc as wrmc,  F.wrmcnm as machname,
               A.winqt, A.wotqt, A.wqcqt, A.wbdqt, A.wscnt, A.winps, A.wsyul, A.wrps, A.wremark, A.decision, A.indate, A.inperid, B.wono, C.acorp as cltnm  , D.jkey AS pcode, D.jpum AS pname,
               D.jgugek AS psize, D.jdanwy AS punit,
               (CASE WHEN A.winps > 1 THEN E.inname  + '외 ' + CAST(A.winps - 1 AS VARCHAR(2)) + '명' ELSE  E.inname END ) wrpsnm
        from TB_FPLAN_W020 A WITH (NOLOCK)
            LEFT OUTER JOIN  INSA E ON A.wrps = E.insano
            Left OUTER JOIN  TB_FPLAN_WRMC F ON A.wflag = F.wflag and A.wrmc = F.wrmc ,
            TB_FPLAN B WITH(NOLOCK), cif C WITH(NOLOCK),  JCODE D WITH(NOLOCK)
        where A.spjangcd = B.spjangcd
          AND   A.plan_no = B.plan_no
          AND   B.cltcd = C.acorp1 + CAST(C.acorp2 as varchar)
          AND   B.pcode = D.JKEY
          AND   A.lotno=#{lotno} and A.wseq in (#{wseq}, '02')
    </select>


    <select id="GetFPLANW030_Detail" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO" resultType="com.dae.kdmes.DTO.Appm.FPLANW010_VO">
        select A.custcd, A.spjangcd, A.plan_no, A.wseq, A.wflag, A.wfrdt, A.wtrdt, A.wrmc as wrmc,  (select machname from TB_PC110 where machnum=A.wrmc) as machname,
        A.winqt, A.wotqt, A.wqcqt, A.wbdqt, A.wscnt, A.winps, A.wsyul, A.wrps, A.wremark, A.decision, A.indate, A.inperid, B.wono, C.acorp as cltnm , D.jkey AS pcode, D.jpum AS pname,
        D.jgugek AS psize, D.jdanwy AS punit,
        (CASE WHEN A.winps > 1 THEN E.inname  + '외 ' + CAST(A.winps - 1 AS VARCHAR(2)) + '명' ELSE  E.inname END ) wrpsnm
        from TB_FPLAN_W030 A WITH (NOLOCK)
            LEFT OUTER JOIN  INSA E ON A.wrps = E.insano   ,
            TB_FPLAN B WITH(NOLOCK), cif C WITH(NOLOCK),  JCODE D WITH(NOLOCK)
        where A.spjangcd = B.spjangcd
        AND   A.plan_no = B.plan_no
        AND   B.cltcd = C.acorp1 + CAST(C.acorp2 as varchar)
        AND   B.pcode = D.JKEY
        AND   A.plan_no=#{plan_no}  and A.wseq in (#{wseq}, '03')
    </select>



    <insert id="FPLANW010_Insert" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO" keyProperty="plan_no">
        INSERT INTO TB_FPLAN_W010(custcd, spjangcd, plan_no, lotno,  wflag, wfrdt, wtrdt, wrmc, winqt, wotqt, wqcqt,
                             wbdqt,   winps, wsyul, wrps, wremark, decision,indate, inperid, partcode, partnm )
        VALUES (#{custcd},#{spjangcd}, #{plan_no}, #{lotno}, #{wflag}, #{wfrdt}, #{wtrdt}, #{wrmc}, #{winqt}, #{wotqt}, #{wqcqt},
                 #{wbdqt},   #{winps}, #{wsyul}, #{wrps}, #{wremark}, #{decision}, #{indate}, #{inperid}, #{partcode}, #{partnm})
    </insert>

    <insert id="FPLANW020_Insert" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO" keyProperty="plan_no">
        INSERT INTO TB_FPLAN_W020(custcd, spjangcd, plan_no, wseq, wflag, wfrdt, wtrdt, wrmc, winqt, wotqt, wqcqt,
        wbdqt, wscnt, winps, wsyul, wrps, wremark, decision,indate, inperid , lotno, wboxsu, demflag, wsumqt, wcode)
        VALUES (#{custcd},#{spjangcd}, #{plan_no}, #{wseq}, #{wflag}, #{wfrdt}, #{wtrdt}, #{wrmc}, #{winqt}, #{wotqt}, #{wqcqt},
        #{wbdqt}, #{wscnt}, #{winps}, #{wsyul}, #{wrps}, #{wremark}, #{decision}, #{indate}, #{inperid}, #{glotnono}, #{wboxsu}, #{demflag}, #{wsumqt}, #{wcode})
    </insert>

    <insert id="FPLANW030_Insert" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO" keyProperty="plan_no">
        INSERT INTO TB_FPLAN_W030(custcd, spjangcd, plan_no, wseq, wflag, wfrdt, wtrdt, wrmc, winqt, wotqt, wqcqt,
        wbdqt, wscnt, winps, wsyul, wrps, wremark, decision,indate, inperid , lotno, wboxsu, demflag, wsumqt)
        VALUES (#{custcd},#{spjangcd}, #{plan_no}, #{wseq}, #{wflag}, #{wfrdt}, #{wtrdt}, #{wrmc}, #{winqt}, #{wotqt}, #{wqcqt},
        #{wbdqt}, #{wscnt}, #{winps}, #{wsyul}, #{wrps}, #{wremark}, #{decision}, #{indate}, #{inperid}, #{glotnono}, #{wboxsu}, #{demflag}, #{wsumqt})
    </insert>

    <update id="FPLANW010_Update" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        UPDATE TB_FPLAN_W010 SET
        wflag=#{wflag},
        wtrdt=#{wtrdt}
        <if test="wfrdt != null ">,</if>
        <if test="wfrdt != null">wfrdt=#{wfrdt}</if>
        <if test="partcode != null ">,</if>
        <if test="partcode != null">partcode=#{partcode}</if>
        <if test="partnm != null ">,</if>
        <if test="partnm != null">partnm=#{partnm}</if>
        <if test="winqt != null ">,</if>
        <if test="winqt != null">winqt=#{winqt}</if>
        <if test="wotqt != null ">,</if>
        <if test="wotqt != null">wotqt=#{wotqt}</if>
        <if test="wqcqt != null ">,</if>
        <if test="wqcqt != null">wqcqt=#{wqcqt}</if>
        <if test="wbdqt != null ">,</if>
        <if test="wbdqt != null">wbdqt=#{wbdqt}</if>
        <if test="wsyul != null ">,</if>
        <if test="wsyul != null">wsyul=#{wsyul}</if>
        <if test="wremark != null ">,</if>
        <if test="wremark != null">wremark=#{wremark}</if>
        <if test="decision != null ">,</if>
        <if test="decision != null">decision=#{decision}</if>
        <if test="winps != null ">,</if>
        <if test="winps != null">winps=#{winps}</if>
        <if test="wrps != null ">,</if>
        <if test="wrps != null">wrps=#{wrps}</if>
        <if test="wrmc != null ">,</if>
        <if test="wrmc != null">wrmc=#{wrmc}</if>
        <if test="indate != null ">,</if>
        <if test="indate != null">indate=#{indate}</if>
        <if test="inperid != null ">,</if>
        <if test="inperid != null">inperid=#{inperid}</if>
        where plan_no=#{plan_no} and lotno =#{lotno}  and wflag=#{wflag}
    </update>


    <update id="FPLANW010_Update_GQTY" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        UPDATE TB_FPLAN_W010 SET
         glotnono=#{glotnono},
         gqty01= isnull(gqty01,0) + #{gqty01}
        where plan_no=#{plan_no} and lotno =#{lotno}  and wflag=#{wflag}
    </update>


    <update id="FPLANW010_Update_JQTY" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        UPDATE TB_FPLAN_W010 SET
        jlotnono=#{glotnono},
        jqty01= isnull(jqty01,0) + #{gqty01}
        where plan_no=#{plan_no} and lotno =#{lotno}   and wflag=#{wflag}
    </update>

    <update id="FPLANW010_Update_GDEL" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        UPDATE TB_FPLAN_W010 SET
               gqty01 = subquery.total_qty,
               glotnono = subquery.glotno
        FROM(
            SELECT D.plan_no, D.lotno, max(D.glotno) as glotno,  SUM(D.jqty) as total_qty
            FROM TB_FPLAN_IWORK D WITH(NOLOCK)
            WHERE D.plan_no =#{plan_no}
            Group by D.plan_no, D.lotno
        ) AS subquery
        where TB_FPLAN_W010.plan_no = subquery.plan_no
        and TB_FPLAN_W010.lotno = subquery.lotno
        and TB_FPLAN_W010.plan_no = #{plan_no}
    </update>
<!--    UPDATE TB_FPLAN_W010 SET-->
<!--    gqty01 = #{gqty01}-->
<!--    where plan_no=#{plan_no} and lotno =#{lotno}-->


    <update id="FPLANW010_Update_JDEL" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        UPDATE TB_FPLAN_W010 SET
        jlotnono='',
        jqty01= 0
        where lotno IN (SELECT lotno FROM  TB_FPLAN_W010 WITH (NOLOCK) WHERE jlotnono = #{glotnono} )
    </update>

    <update id="FPLANW020_Update" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        UPDATE TB_FPLAN_W020 SET
        wflag=#{wflag},
        spjangcd=#{spjangcd}
        <if test="wremark != null ">,</if>
        <if test="wremark != null">wremark=#{wremark}</if>
        <if test="winqt != null ">,</if>
        <if test="winqt != null">winqt=#{winqt}</if>
        <if test="wsumqt != null ">,</if>
        <if test="wsumqt != null">wsumqt=#{wsumqt}</if>
        <if test="wbdqt != null ">,</if>
        <if test="wbdqt != null">wbdqt=#{wbdqt}</if>
        <if test="wcode != null ">,</if>
        <if test="wcode != null">wcode=#{wcode}</if>
        <if test="wotqt != null ">,</if>
        <if test="wotqt != null">wotqt=#{wotqt}</if>
        <if test="wqcqt != null ">,</if>
        <if test="wqcqt != null">wqcqt=#{wqcqt}</if>
        <if test="winps != null ">,</if>
        <if test="winps != null">winps=#{winps}</if>
        <if test="wrps != null ">,</if>
        <if test="wrps != null">wrps=#{wrps}</if>
        <if test="demflag != null ">,</if>
        <if test="demflag != null">demflag=#{demflag}</if>
        <if test="wboxsu != null ">,</if>
        <if test="wboxsu != null">wboxsu=#{wboxsu}</if>
        <if test="indate != null ">,</if>
        <if test="indate != null">indate=#{indate}</if>
        <if test="inperid != null ">,</if>
        <if test="inperid != null">inperid=#{inperid}</if>
        where lotno=#{glotnono}   and wflag=#{wflag}
    </update>

    <update id="FPLANW030_Update" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        UPDATE TB_FPLAN_W030 SET
        wflag=#{wflag},
        spjangcd=#{spjangcd}
        <if test="wremark != null ">,</if>
        <if test="wremark != null">wremark=#{wremark}</if>
        <if test="winqt != null ">,</if>
        <if test="winqt != null">winqt=#{winqt}</if>
        <if test="wsumqt != null ">,</if>
        <if test="wsumqt != null">wsumqt=#{wsumqt}</if>
        <if test="wbdqt != null ">,</if>
        <if test="wbdqt != null">wbdqt=#{wbdqt}</if>
        <if test="wqcqt != null ">,</if>
        <if test="wqcqt != null">wqcqt=#{wqcqt}</if>
        <if test="wotqt != null ">,</if>
        <if test="wotqt != null">wotqt=#{wotqt}</if>
        <if test="winps != null ">,</if>
        <if test="winps != null">winps=#{winps}</if>
        <if test="wrps != null ">,</if>
        <if test="wrps != null">wrps=#{wrps}</if>
        <if test="demflag != null ">,</if>
        <if test="demflag != null">demflag=#{demflag}</if>
        <if test="wboxsu != null ">,</if>
        <if test="wboxsu != null">wboxsu=#{wboxsu}</if>
        <if test="indate != null ">,</if>
        <if test="indate != null">indate=#{indate}</if>
        <if test="inperid != null ">,</if>
        <if test="inperid != null">inperid=#{inperid}</if>
        where lotno=#{glotnono}   and wflag=#{wflag}
    </update>



    <update id="FPLANW010_WrmcUpdate" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        UPDATE TB_FPLAN_W010 SET
        wrmc=#{wrmc}
        where plan_no=#{plan_no} and lotno=#{lotno} and  wflag=#{wflag}
    </update>

    <update id="FPLAN_Update" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        UPDATE TB_FPLAN SET
        SPJANGCD = 'ZZ'
        <if test="wflag != null ">,</if>
        <if test="wflag != null">wflag=#{wflag}</if>
        <if test="bqty != null ">,</if>
        <if test="bqty != null">prod_dqty=#{bqty}</if>
        <if test="end_qty != null ">,</if>
        <if test="end_qty != null">end_qty=#{end_qty}</if>
        <if test="clsflag != null ">,</if>
        <if test="clsflag != null">cls_flag=#{clsflag}</if>
        <if test="workdv != null ">,</if>
        <if test="workdv != null">workdv=#{workdv}</if>
        <if test="qcdate != null ">,</if>
        <if test="qcdate != null">qcdate=#{qcdate}</if>
        <if test="qcqty != null ">,</if>
        <if test="qcqty != null">qcqty=#{qcqty}</if>
        <if test="decision != null ">,</if>
        <if test="decision != null">decision=#{decision}</if>
        <if test="decision1 != null ">,</if>
        <if test="decision1 != null">decision1=#{decision1}</if>
        <if test="decision2 != null ">,</if>
        <if test="decision2 != null">decision2=#{decision2}</if>
        <if test="decision3 != null ">,</if>
        <if test="decision3 != null">decision3=#{decision3}</if>
        <if test="decision4 != null ">,</if>
        <if test="decision4 != null">decision4=#{decision4}</if>
        where plan_no=#{plan_no}
    </update>


    <update id="FPLAN_Update_GDEL" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        UPDATE TB_FPLAN SET
        SPJANGCD = 'ZZ'
        <if test="wflag != null ">,</if>
        <if test="wflag != null">wflag=#{wflag}</if>
        <if test="bqty != null ">,</if>
        <if test="bqty != null">prod_dqty=#{bqty}</if>
        <if test="end_qty != null ">,</if>
        <if test="end_qty != null">end_qty=#{end_qty}</if>
        <if test="clsflag != null ">,</if>
        <if test="clsflag != null">cls_flag=#{clsflag}</if>
        <if test="workdv != null ">,</if>
        <if test="workdv != null">workdv=#{workdv}</if>
        <if test="qcdate != null ">,</if>
        <if test="qcdate != null">qcdate=#{qcdate}</if>
        <if test="qcqty != null ">,</if>
        <if test="qcqty != null">qcqty=#{qcqty}</if>
        <if test="decision != null ">,</if>
        <if test="decision != null">decision=#{decision}</if>
        <if test="decision1 != null ">,</if>
        <if test="decision1 != null">decision1=#{decision1}</if>
        <if test="decision2 != null ">,</if>
        <if test="decision2 != null">decision2=#{decision2}</if>
        <if test="decision3 != null ">,</if>
        <if test="decision3 != null">decision3=#{decision3}</if>
        <if test="decision4 != null ">,</if>
        <if test="decision4 != null">decision4=#{decision4}</if>
        where plan_no IN (select plan_no from TB_FPLAN_W010 where glotnono =#{glotnono})
    </update>

    <select id="GetWtimeWseq" parameterType="com.dae.kdmes.DTO.Appm.TBPopupVO" resultType="String">
        SELECT wseq as seq
        FROM TB_FPLAN_WORK WITH(NOLOCK) WHERE plan_no =#{plan_no}
    </select>

    <insert id="FPLANWORK_Insert" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO" keyProperty="plan_no">
        INSERT INTO TB_FPLAN_WORK(custcd, spjangcd, plan_no, lotno, wono, wseq, wflag, wrmc, winqt, wotqt, wqcqt,wstdt, wfrdt,
                                  wbdqt,  winps, wsyul, wrps, wremark, decision, indate, inperid )
        VALUES (#{custcd},#{spjangcd}, #{plan_no}, #{lotno}, #{wono}, #{wseq}, #{wflag},  #{wrmc}, #{winqt}, #{wotqt}, #{wqcqt}, #{wstdt},#{wfrdt},
                #{wbdqt},   #{winps}, #{wsyul}, #{wrps}, #{wremark}, #{decision}, #{indate}, #{inperid})
    </insert>

    <insert id="FPLAN_OWORK_Insert" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO" keyProperty="plan_no">
        INSERT INTO TB_FPLAN_OWORK(custcd, spjangcd, plan_no,  wseq, wflag, seq, pcode, store, wotdt, wqty, lotno,
                                   bqty, qty, styn, indate, inperid )
        VALUES (#{custcd},#{spjangcd}, #{plan_no},  #{wseq}, #{wflag}, #{seq},  #{pcode}, #{store}, #{wotdt}, #{wqty}, #{lotno},
                #{bqty},   #{qty},  '0', #{indate}, #{inperid})
    </insert>


    <update id="FPLAN_OWORK_Update" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        UPDATE TB_FPLAN_OWORK SET
        SPJANGCD = 'ZZ'
        <if test="wotdt != null ">,</if>
        <if test="wotdt != null">wotdt=#{wotdt}</if>
        <if test="wqty != null ">,</if>
        <if test="wqty != null">wqty=#{wqty}</if>
        <if test="bqty != null ">,</if>
        <if test="bqty != null">bqty=#{bqty}</if>
        <if test="qty != null ">,</if>
        <if test="qty != null">qty=#{qty}</if>
        where plan_no=#{plan_no} and wotdt=#{wotdt} and lotno=#{lotno} and wflag=#{wflag} and wseq=#{wseq} and seq=#{seq}
    </update>

    <delete id="FPLAN_OWORK_PERDELETE" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        DELETE  from TB_FPLAN_OWORK
        where plan_no=#{plan_no} and lotno=#{lotno} and wseq=#{wseq} AND wflag =#{wflag} AND seq =#{seq}
    </delete>

    <select id="FPLAN_OWORK_MAXWSEQ" parameterType="com.dae.kdmes.DTO.Appm.FPLANWBAD_VO" resultType="String">
        SELECT MAX(seq) FROM  TB_FPLAN_OWORK
        WHERE custcd=#{custcd} and spjangcd = #{spjangcd}
          and plan_no = #{plan_no} and lotno=#{lotno} and wflag = #{wflag} and wseq = #{wseq}
    </select>


    <select id="FPLAN_OWORK_SUMQTY" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO" resultType="com.dae.kdmes.DTO.Appm.FPLANW010_VO">
        select sum(wqty) as wotqt, sum(qty) as qty,
               (select isnull(sum(wbqty),0) as wbqty from TB_FPLAN_WBAD where plan_no=A.plan_no and lotno=A.lotno and wseq=A.wseq and wflag=A.wflag group by plan_no,lotno, wseq,wflag) as wbdqt
        from TB_FPLAN_OWORK A WITH (NOLOCK)
        WHERE  A.plan_no =#{plan_no} and lotno=#{lotno} and A.wflag =#{wflag} and A.wseq =#{wseq}
        group by A.plan_no, A.lotno, A.wflag, A.wseq
    </select>



    <delete id="FPLANW010_Delete" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        DELETE  from TB_FPLAN_W010
        where plan_no=#{plan_no} and lotno=#{lotno}   AND wflag =#{wflag}
    </delete>

    <delete id="FPLANW020_Delete" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        DELETE  from TB_FPLAN_W020
        where lotno=#{lotno}
    </delete>

    <delete id="FPLANW030_Delete" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        DELETE  from TB_FPLAN_W030
        where lotno=#{lotno}
    </delete>

    <delete id="FPLAN_OWORK_Delete" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO" >
        DELETE  from TB_FPLAN_OWORK
        where plan_no=#{plan_no} and lotno=#{lotno}  AND wflag =#{wflag}
    </delete>

    <delete id="FPLAN_IWORK_Delete" parameterType="com.dae.kdmes.DTO.Appm.FPLANIWORK_VO" >
        DELETE  from TB_FPLAN_IWORK
        where   glotno = #{glotno}
    </delete>

    <delete id="FPLAN_WORK_Delete" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO" >
        DELETE  from TB_FPLAN_WORK
        where plan_no=#{plan_no}  and lotno=#{lotno} AND wflag =#{wflag}
    </delete>
    <update id="FPLANWORK_update" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        UPDATE TB_FPLAN_WORK SET
        wflag=#{wflag},
        wendt=#{wendt},
        wtrdt=#{wtrdt}
        <if test="wfrdt != null ">,</if>
        <if test="wfrdt != null">wfrdt=#{wfrdt}</if>
        <if test="winqt != null ">,</if>
        <if test="winqt != null">winqt=#{winqt}</if>
        <if test="wotqt != null ">,</if>
        <if test="wotqt != null">wotqt=#{wotqt}</if>
        <if test="wqcqt != null ">,</if>
        <if test="wqcqt != null">wqcqt=#{wqcqt}</if>
        <if test="wbdqt != null ">,</if>
        <if test="wbdqt != null">wbdqt=#{wbdqt}</if>
        <if test="winps != null ">,</if>
        <if test="winps != null">winps=#{winps}</if>
        <if test="wsyul != null ">,</if>
        <if test="wsyul != null">wsyul=#{wsyul}</if>
        <if test="wrps != null ">,</if>
        <if test="wrps != null">wrps=#{wrps}</if>
        <if test="wremark != null ">,</if>
        <if test="wremark != null">wremark=#{wremark}</if>
        <if test="decision != null ">,</if>
        <if test="decision != null">decision=#{decision}</if>
        <if test="indate != null ">,</if>
        <if test="indate != null">indate=#{indate}</if>
        <if test="inperid != null ">,</if>
        <if test="inperid != null">inperid=#{inperid}</if>
        <if test="wstdt != null ">,</if>
        <if test="wstdt != null">wstdt=#{wstdt}</if>
        <if test="wtable != null ">,</if>
        <if test="wtable != null">wtable=#{wtable}</if>
        <if test="wrmc != null ">,</if>
        <if test="wrmc != null">wrmc=#{wrmc}</if>
        where plan_no=#{plan_no} and lotno=#{lotno}  and wseq=#{wseq} and wflag=#{wflag}
    </update>

    <select id="GetWIworkDetail" parameterType="com.dae.kdmes.DTO.Appm.TBPopupVO" resultType="com.dae.kdmes.DTO.Appm.FPLANW010_VO">
        SELECT   A.custcd, A.spjangcd, A.plan_no,  A.wseq, '' as aseq, A.wflag, A.seq, A.pcode, A.lotno,
                 A.store, Isnull(A.jqty, 0) as jqty, Isnull(A.sqty, 0) as sqty, Isnull(A.qty, 0) as qty, 0 as bqty, D.jpum AS pname,
                 D.jgugek AS psize, D.jdanwy AS punit
        FROM TB_FPLAN_IWORK A WITH(NOLOCK) ,  JCODE D WITH(NOLOCK)
        where A.pcode = D.jkey
          AND A.plan_no =#{plan_no} and lotno=#{lotno} and A.wflag = #{wflag}
    </select>

    <select id="GetWIworkDetail_blank" parameterType="com.dae.kdmes.DTO.Appm.TBPopupVO" resultType="com.dae.kdmes.DTO.Appm.FPLANW010_VO">
        SELECT   '' as custcd, '' as spjangcd, '' as plan_no,  '' as wseq, '' as aseq, '' as wflag, '' as seq, '' as pcode, '' as lotno,
                 '' as store, 0 as jqty, 0 as sqty, 0 as qty, 0 as bqty, '' as  pname, '' as  psize, '' as  punit
        FROM dual
    </select>

    <select id="GetWIworkWseq" parameterType="com.dae.kdmes.DTO.Appm.FPLANIWORK_VO" resultType="String">
        SELECT wseq
        FROM TB_FPLAN_IWORK WITH(NOLOCK) WHERE plan_no =#{plan_no} and lotno=#{lotno} and wflag=#{wflag}
    </select>

    <insert id="FPLANI_IWORK_Insert" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO" keyProperty="plan_no">
        INSERT INTO TB_FPLAN_IWORK(custcd, spjangcd, plan_no,  wseq,  wflag, seq, pcode, lotno, glotno,
                                     store, jqty, sqty, qty, bqty, indate, styn, inperid )
        VALUES (#{custcd},#{spjangcd}, #{plan_no},   #{wseq},  #{wflag},  #{seq}, #{pcode}, #{lotno}, #{glotno},
                  #{store}, #{jqty},  #{sqty}, #{qty}, #{bqty}, #{indate}, '0', #{inperid})
    </insert>


    <update id="FPLANI_IWORK_update" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  >
        UPDATE TB_FPLAN_IWORK SET
        wflag=#{wflag}
        <if test="pcode != null ">,</if>
        <if test="pcode != null">pcode=#{pcode}</if>
        <if test="jqty != null ">,</if>
        <if test="jqty != null">jqty=#{jqty}</if>
        <if test="qty != null  ">,</if>
        <if test="qty != null">qty=#{qty}</if>
        <if test="bqty != null   ">,</if>
        <if test="bqty != null">bqty=#{bqty}</if>
        <if test="indate != null ">,</if>
        <if test="indate != null">indate=#{indate}</if>
        where plan_no=#{plan_no}  and lotno=#{lotno} and wseq=#{wseq} and wflag=#{wflag}
    </update>


    <select id="FPLAN_WPERID_SELECT" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"   resultType="com.dae.kdmes.DTO.Appm.FPLANWPERID_VO">
        SELECT  custcd, spjangcd, plan_no,  wseq, wflag, seq, perid, indate, inperid
        from TB_FPLAN_WPERID
        where plan_no=#{plan_no} and lotno=#{lotno} AND wflag = #{wflag}
    </select>

    <insert id="FPLAN_WPERID_Insert" parameterType="com.dae.kdmes.DTO.Appm.FPLANWPERID_VO" keyProperty="plan_no">
        INSERT INTO TB_FPLAN_WPERID(custcd, spjangcd, plan_no, lotno,  wseq, wflag, seq, perid, indate, inperid )
        VALUES (#{custcd},#{spjangcd}, #{plan_no},  #{lotno}, #{wseq}, '00010',  #{seq}, #{perid},   #{indate}, #{inperid})
    </insert>

    <delete id="FPLAN_WPERID_Delete" parameterType="com.dae.kdmes.DTO.Appm.FPLANWPERID_VO" >
        DELETE  from TB_FPLAN_WPERID
        where plan_no=#{plan_no} and lotno=#{lotno} and wseq=#{wseq} and wflag=#{wflag}
    </delete>


    <select id="FPLAN_WBAD_SELECT_Blank" parameterType="com.dae.kdmes.DTO.Appm.FPLANWBAD_VO" resultType="com.dae.kdmes.DTO.Appm.FPLANWBAD_VO">
        SELECT '' as custcd, '' as spjangcd, '' as plan_no,  '' as wseq, '' as wflag, '' as wcode, '' as  wname,  0 as wbqty, '' as indate, '' as inperid
        FROM daul
    </select>

    <select id="FPLAN_WBAD_SELECT" parameterType="com.dae.kdmes.DTO.Appm.FPLANWBAD_VO" resultType="String">
        SELECT top 1 A.wseq
        FROM TB_FPLAN_WBAD  A WITH(NOLOCK)
        where   A.plan_no=#{plan_no} and lotno=#{lotno} and A.wflag=#{wflag} and A.wcode=#{wcode}
    </select>
    <select id="FPLAN_WBAD_SELECT_SUM" parameterType="com.dae.kdmes.DTO.Appm.FPLANWBAD_VO" resultType="Integer">
        SELECT sum(wbqty) as wbqty
        FROM TB_FPLAN_WBAD  A WITH(NOLOCK)
        where   A.plan_no=#{plan_no} and lotno=#{lotno} and A.wflag=#{wflag}
    </select>

    <select id="FPLAN_WBAD_MAXWSEQ" parameterType="com.dae.kdmes.DTO.Appm.FPLANWBAD_VO" resultType="com.dae.kdmes.DTO.Appm.FPLANWBAD_VO">
        SELECT MAX(wseq) FROM  TB_FPLAN_WBAD
        WHERE custcd=#{custcd} and spjangcd = #{spjangcd}
          and plan_no = #{plan_no} and lotno=#{lotno} and wflag = #{wflag}
    </select>

    <update id="FPLAN_WBAD_Update" parameterType="com.dae.kdmes.DTO.Appm.FPLANWBAD_VO" keyProperty="plan_no">
        UPDATE  TB_FPLAN_WBAD SET wbqty = wbqty + #{wbqty}
        WHERE custcd=#{custcd} and spjangcd = #{spjangcd}
          and plan_no = #{plan_no} and lotno=#{lotno} and wflag = #{wflag} and wcode = #{wcode}
    </update>


    <insert id="FPLAN_WBAD_Insert" parameterType="com.dae.kdmes.DTO.Appm.FPLANWBAD_VO" keyProperty="plan_no">
        INSERT INTO TB_FPLAN_WBAD(custcd, spjangcd, plan_no, lotno, wseq, wflag,   wcode, wbqty, indate, inperid)
        VALUES (#{custcd},#{spjangcd}, #{plan_no}, #{lotno},  #{wseq}, #{wflag},  #{wcode},  #{wbqty}, #{indate},  #{inperid})
    </insert>

    <delete id="FPLAN_WBAD_Delete" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO" >
        DELETE  from TB_FPLAN_WBAD
        where plan_no=#{plan_no}  and lotno=#{lotno} and wflag=#{wflag}
    </delete>

    <insert id="FPLAN_WTIME_Insert" parameterType="com.dae.kdmes.DTO.Appm.FPLANWTIME_VO" keyProperty="plan_no">
        INSERT INTO TB_FPLAN_WTIME(custcd, spjangcd, plan_no, lotno, wseq, seq, wflag, wfrdt, wtrdt, wopdv, wdtcd, wrerm )
        VALUES (#{custcd},#{spjangcd}, #{plan_no}, #{lotno},  #{wseq}, #{seq},  #{wflag},  #{wfrdt}, #{wtrdt},  #{wopdv},   #{wdtcd}, #{wrerm})
    </insert>

    <delete id="FPLAN_WTIME_Delete" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO" >
        DELETE  from TB_FPLAN_WTIME
        where plan_no=#{plan_no} and lotno=#{lotno} and wflag=#{wflag}
    </delete>

    <select id="FPLAN_WTIME_MAXSEQ" parameterType="com.dae.kdmes.DTO.Appm.FPLANWTIME_VO" resultType="String">
        SELECT MAX(seq) FROM  TB_FPLAN_WTIME WITH (NOLOCK)
        WHERE custcd=#{custcd} and spjangcd = #{spjangcd}
          and plan_no = #{plan_no} and lotno=#{lotno} and wflag = #{wflag} and wseq=#{wseq}
    </select>

    <update id="FPLAN_WTIME_Update" parameterType="com.dae.kdmes.DTO.Appm.FPLANWTIME_VO" keyProperty="plan_no">
        UPDATE  TB_FPLAN_WTIME SET wtrdt = #{wtrdt}, wdtcd = #{wdtcd}, wrerm = #{wrerm}
        WHERE custcd=#{custcd} and spjangcd = #{spjangcd}
          and plan_no = #{plan_no} and lotno=#{lotno} and wflag = #{wflag} and wseq=#{wseq} AND wtrdt IS NULL
    </update>


    <select id="FPLAN_IWORK_MAXWSEQ" parameterType="com.dae.kdmes.DTO.Appm.FPLANIWORK_VO" resultType="String">
        SELECT MAX(seq) FROM  TB_FPLAN_IWORK
        WHERE   plan_no = #{plan_no} and lotno=#{lotno}
    </select>


    <insert id="FPLAN_IWORK_Insert" parameterType="com.dae.kdmes.DTO.Appm.FPLANIWORK_VO" keyProperty="plan_no">
        INSERT INTO TB_FPLAN_IWORK(custcd, spjangcd, plan_no, lotno,  wseq, seq, wflag, pcode, lotno, store, qty, bqty,  indate, inperid )
        VALUES (#{custcd},#{spjangcd}, #{plan_no}, #{lotno},  #{wseq}, #{seq},  #{wflag},  #{pcode}, #{lotno},  #{store},   #{qty}, #{bqty},  #{indate}, #{inperid})
    </insert>


    <select id="GetPlanSearch" parameterType="com.dae.kdmes.DTO.Appm.FPLANIWORK_VO" resultType="com.dae.kdmes.DTO.Appm.FPLANIWORK_VO">
        <![CDATA[
        SELECT A.plan_no,
            A.wseq,
            A.seq,
            A.lotno,
            A.qty ,
            B.jpum as pname,
            B.jgugek as psize ,
            A.indate,
            C.lotno as glotno,
           (select isnull(WOTQT,0)  from TB_FPLAN where plan_no=C.plan_no   and wflag= '00020'   ) as woqty
        FROM TB_FPLAN_IWORK A WITH(NOLOCK),
             JCODE B WITH(NOLOCK) ,
             TB_FPLAN_W020 C
        WHERE (A.pcode     = B.jkey)
            AND (A.plan_no      = C.plan_no)
            AND (ISNULL(C.lotno,'')   lIKE  concat('%',#{lotno},'%') )
        ]]>
    </select>


    <select id="GetPlanViewnow" parameterType="com.dae.kdmes.DTO.Appm.TBFplanNowVO"  resultType="com.dae.kdmes.DTO.Appm.TBFplanNowVO">
        {
        call  SP_TB_FPLAN_NOW_VIEW(#{custcd} , #{spjangcd},   #{fdate}, #{tdate} )
        }
    </select>


    <select id="FPLAN_W020_MAXLOT" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  resultType="String">
        SELECT MAX(Left(lotno,10)) FROM  TB_FPLAN_W020
        WHERE   Left(indate,6) = Left( #{indate} ,6)
    </select>
    <select id="FPLAN_W030_MAXLOT" parameterType="com.dae.kdmes.DTO.Appm.FPLANW010_VO"  resultType="String">
        SELECT MAX(Left(lotno,10)) FROM  TB_FPLAN_W030
        WHERE   Left(indate,6) = Left( #{indate} ,6)
    </select>
</mapper>
