<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<header th:fragment="headerFragment">
    <!-- py-md-2 px-1 py-1 -->
    <div class="card-body d-flex align-items-center py-md-2 px-auto py-auto ">
        <main class="main" id="top">
            <!-- Fluid Layout:  Replace class .container to .container-fluid inside the main tag, and the page will be switched to fluid layout. -->
            <div class="container-fluid">
                <!-- <div class="container" data-layout="container"> -->
                <script>
                    var isFluid = JSON.parse(localStorage.getItem('isFluid'));
                    if (isFluid) {
                        var container = document.querySelector('[data-layout]');
                        container.classList.remove('container');
                        container.classList.add('container-fluid');
                    }
                </script>
                <nav class="navbar navbar-light navbar-vertical navbar-expand-xl">
                    <script>
                        var navbarStyle = localStorage.getItem("navbarStyle");
                        if (navbarStyle && navbarStyle !== 'transparent') {
                            document.querySelector('.navbar-vertical').classList.add(`navbar-${navbarStyle}`);
                        }
                    </script>
                    <!-- <div class="d-flex align-items-center">
                        <div class="toggle-icon-wrapper">

                            <button class="btn navbar-toggler-humburger-icon navbar-vertical-toggle"
                                data-bs-toggle="tooltip" data-bs-placement="left" title="Toggle Navigation"><span
                                    class="navbar-toggle-icon"><span class="toggle-line"></span></span></button>

                        </div>
                            <a class="navbar-brand" th:href="@{/members/user}">
                            <div class="d-flex align-items-center py-3"><img class="me-2"
                                    th:src="@{/assets/img/icons/spot-illustrations/falcon.png}" alt="" width="40" />
                                    <span
                                    class="font-sans-serif">ActasErp</span>
                            </div>
                        </a>
                    </div> -->
                    <!------navbar vertical------>
                    <div th:replace="layouts/layout01/navbarMem :: navbar"></div>
                </nav>
                <div class="content" id="fw010">
                    <!------nav ------>
                    <div th:replace="layouts/layout01/headerNav :: headerNav"></div>

                    <body layout:fragment="fw010">
                        <div class="card mb-10">
                            <div class="bg-holder d-none d-lg-block bg-card"
                                style="background-image:url(../../assets/img/icons/spot-illustrations/corner-4.png);">
                            </div>
                            <div class="card border h-100 border-primary">
                                <!--/.bg-holder-->
                                <div class="card-body position-relative">
                                    <div class="row">
                                        <form class="row gy-2 gx-4 align-items-center" role="form"  method="post" enctype="multipart/form-data">
                                            <div class="row mb-3  row-cols-lg-2 align-items-center">
                                                <!-- <div class="col-auto">  
                                                        <div class="card text-white bg-secondary">
                                                        <div class="card-body">
                                                            <div class="card-title"  ><h3 th:text="${CommDto.MenuTitle}" style="color:white; text-align: center; ">검사공정</h3> </div> 
                                                        </div>
                                                        </div> 
                                                </div>                                -->                                
                                                <div class="col-auto"> 
                                                    <button  class="btn btn-outline-primary me-1 mb-1" type="button" data-bs-toggle="modal" data-bs-target="#staticBackdrop" style=" height:50px;  ">검사진행리스트 </button>
                                                </div>   
                                                <div class="col-auto"> 
                                                    <button  class="btn btn-outline-warning me-1 mb-1" type="button" data-bs-toggle="modal" data-bs-target="#staticBackdrop" style=" height:50px;  ">사출완료리스트 </button>
                                                </div>             
                                                <div class="col-auto">  
                                                        <div class="col-auto">
                                                            <div id="statusdis01"></div>
                                                        </div>   
                                                </div> 
                                            </div>
                                            <!------content ---------------------------------------------------------------------------------->
                                            <div class="row mb-3 row-cols-sm-3 align-items-center">
                                                 
                                                <div class="col-sm">
                                                    <div class="input-group">
                                                        <div class="input-group-text">거래처</div>
                                                        <input class="form-control form-control-sm" id="incltnm" type="text" disabled
                                                            size="15" placeholder="거래처"     />
                                                        <input class="form-control form-control-sm"  type="hidden"  id="incltcd"    />  
                                                        <input class="form-control form-control-sm" id="inwono"
                                                            type="hidden" placeholder="작지번호"    disabled />
                                                        <input class="form-control form-control-sm"  type="hidden"  id="inspjangcd"
                                                            />   
                                                        <input class="form-control form-control-sm"  type="hidden"  id="incustcd"
                                                                />        
                                                        <input class="form-control form-control-sm"  type="hidden"  id="inwseq"    
                                                                />         
                                                        <input class="form-control form-control-sm"  type="hidden"  id="inwflag"   
                                                                />   
                                                        <input class="form-control form-control-sm"  type="hidden"  id="inwscnt"     
                                                            value=0   />  
                                                        <input class="form-control form-control-sm"  type="hidden"  id="edwscnt"     
                                                            value=0   />  
                                                        <input class="form-control form-control-sm"  type="hidden"  id="inwsyul"       
                                                            value=0   />   
                                                        <input class="form-control form-control-sm"  type="hidden"  id="inostore"         
                                                            value=0   />   
                                                        <div id='inwonobdg'></div>      
                                                    </div>
                                                </div>  
                                                <div class="col-sm">
                                                    <div class="input-group">
                                                        <div class="input-group-text">품목명</div> 
                                                        <input class="form-control form-control-sm" id="inpname" type="text" disabled
                                                            size="15"  /> 
                                                        <input class="form-control form-control-sm" id="inpcode" type="hidden" disabled
                                                        size="15"  />    
                                                    </div>
                                                </div>   
                                                <div class="col-sm">
                                                    <div class="input-group"> 
                                                        <div class="input-group-text">작업지시번호</div> 
                                                        <input class="form-control form-control-sm" id="inplan_no" type="text"    disabled
                                                            placeholder=""   /> 
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mb-3 row-cols-lg-3 align-items-center"> 
                                                <div class="col-sm">
                                                    <div class="input-group">
                                                        <div class="input-group-text">LOTNO</div> 
                                                        <input class="form-control form-control-sm" id="inlotno" type="text" disabled
                                                            size="15"  /> 
                                                    </div>
                                                </div> 
                                                <div class="col-auto">
                                                    <div class="input-group">
                                                        <!-- <div class="input-group-text">작업자</div> -->
                                                        <button   class="btn btn-primary btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#wperidmodal" style=" height:40px;  " id="wperidBtn">작업자 </button>
                                                        <input class="form-control form-control-sm" id="inwrpsnm" type="text"  disabled
                                                            placeholder=""  />
                                                            <input class="form-control form-control-sm" id="inwrps" type="hidden"
                                                                placeholder=""   />
                                                            <input class="form-control form-control-sm" id="inwinps" type="hidden"
                                                                placeholder=""   />
                                                    </div> 
                                                </div> 
                                                <div class="col-sm">
                                                    <div class="input-group"> 
                                                        <button   class="btn btn-primary btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#wrmcmodal" style=" height:40px;  " id="wrmcBtn" >작업설비 </button>
                                                        <input class="form-control form-control-sm" id="inmachname" type="text"    disabled
                                                            placeholder=""   />
                                                        <input class="form-control form-control-sm" id="inwrmc" type="hidden"
                                                            placeholder=""   />
                                                        <div id='inwrmcbdg'></div>
                                                    </div>
                                                </div>
                                            </div> 
                                            <div class="row mb-3 row-cols-lg-3 align-items-center">
                                                <div class="col-auto">
                                                    <div class="input-group"> 
                                                        <button   class="btn btn-primary btn-sm" type="button" id="wfrdt"  style=" height:40px;  "  >공정시작 </button>
                                                        <input type="text"  class="form-control datetimepicker" id="startDate" autocomplete="off"  placeholder="Y-m-d H:i"   disabled> 
                                                    </div>
                                                    
                                                </div>
                                                <div class="col-auto">
                                                    <div class="input-group"> 
                                                        <button   class="btn btn-primary btn-sm" type="button"  id="wtrdt"  style=" height:40px;  "  >공정종료 </button>
                                                        <input type="text"  class="form-control datetimepicker" id="endDate" autocomplete="off"  placeholder="Y-m-d H:i"   disabled > 
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row mb-3 row-cols-lg-3 align-items-center">
                                                <div class="col-auto">
                                                    <div class="input-group">
                                                        <div class="input-group-text">투입량</div>  <!-- data-bs-toggle="modal" data-bs-target="#wiworkmodal"  -->
                                                        <input class="form-control form-control-sm" id="inwinqt" type="number"  
                                                            placeholder=""   />
                                                        <div id='inwinqtbdg'></div>      
                                                    </div>
                                                </div>  
                                                <div class="col-4">
                                                    <div class="input-group">
                                                        <button   class="btn btn-primary btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#wotqtymodal" style=" height:40px;  " id="wotqtyBtn">검사량 </button>
                                                        <input class="form-control form-control-sm"  type="number" id="inwotqt"
                                                            placeholder=""    onchange="fnc_calvalue(this)"  disabled/>
                                                        <input class="form-control form-control-sm" id="inwinqt" type="hidden" data-bs-toggle="modal" data-bs-target="#wiworkmodal"    placeholder=""   />
                                                         <div id='inwinqtbdg'></div>     
                                                    </div>
                                                </div>
                                                <div  class="col-3">
                                                    <div class="input-group">
                                                        <!-- <div class="input-group-text">불량내역</div> --> 
                                                        <button   class="btn btn-primary btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#wbadqtymodal" style=" height:40px;  " id="wbadqtyBtn">불량내역 </button>
                                                        <input class="form-control form-control-sm"  type="text" id="inwbdqt"  disabled
                                                            placeholder=""  />
                                                    </div>
                                                </div> 
                                            </div>
                                            <div class="row mb-3  row-cols-lg-3 align-items-center">  
                                                <div  class="col-3">
                                                    <div class="input-group">
                                                        <div class="input-group-text">완료량</div>
                                                        <input class="form-control form-control-sm" id="inwokqt" type="number" disabled
                                                            placeholder=""  />
                                                    </div>
                                                </div>
                                                
                                                <div class="col-3">
                                                    <div class="input-group">
                                                        <div class="input-group-text">비고</div>
                                                        <input class="form-control form-control-sm" id="inwremark" type="text"
                                                            placeholder=""  />
                                                    </div>
                                                </div> 
                                            </div>  
                                            <div class="row mb-3 row-cols-lg-3 align-items-center"> 
                                                <div class="col-auto">
                                                    <div id="wscntdis01"></div>
                                                </div>
                                                <div class="col-auto">
                                                    <div id="wscntdis02"></div>
                                                </div>
                                            </div> 
                                            
                                            <div  class="col-auto" > 
                                                <div class="row g-2" >
                                                    <div class="col-auto">
                                                        <button  class="btn btn-warning me-1 mb-1" type="button" style=" height:50px;  " onclick='save_btn("2")' id="workstBtn"  >작업시작</button>
                                                    </div> 
                                                    <div class="col-auto">
                                                        <button  class="btn btn-danger me-1 mb-1" type="button" style=" height:50px;  " onclick='save_btn("3")' id="workedBtn"  >작업중단</button>
                                                    </div>   
                                                    <div class="col-auto">
                                                        <button  class="btn btn-outline-dark me-1 mb-1" type="button" style=" height:50px;  " onclick='save_btn("4")' id="worksaveBtn">저&nbsp;&nbsp;&nbsp;장</button>
                                                    </div>                                                   
                                                    <div class="col-auto">
                                                        <button  class="btn btn-outline-primary me-1 mb-1" type="button" style=" height:50px;  " onclick='del_btn()' >삭&nbsp;&nbsp;&nbsp;제 </button>
                                                    </div> 
                                                    <div class="col-auto">
                                                        <div id="statusdis01"></div><input class="form-control form-control-sm"  type="hidden"  id="indecision"  />  
                                                    </div> 


                                                    <!-- <div class="col-auto">
                                                        <button  class="btn btn-outline-primary me-1 mb-1" type="button" style=" height:50px;  ">공정생성 </button>
                                                    </div>  -->
                                                    <!-- <div class="col-auto"> 
                                                        <button class="badge-soft-primary dropdown-item rounded-1" type="submit"  >저장</button>
                                                    </div>
                                                    <div class="col-auto"> 
                                                        <button class="badge-soft-danger dropdown-item rounded-1" type="button"  onclick='del_btn()' >삭제 </button>
                                                    </div> -->
                                                </div>      
                                            </div>                
                                        </form> 
                                            <div class="modal fade" id="staticBackdrop" data-bs-keyboard="false"
                                                data-bs-backdrop="static" tabindex="-1" aria-labelledby="staticBackdropLabel"
                                                aria-hidden="true">
                                                <div class="modal-dialog modal-lg mt-6" role="document" id = "modalForm01"
                                                    style="max-width: 1000px">
                                                    <div class="modal-content border-0">
                                                        <div class="modal-body p-0" >  
                                                            <div class="bg-light rounded-top-lg py-3 ps-4 pe-6">
                                                                <h4 class="mb-1" id="staticBackdropLabel">사출완료리스트</h4> 
                                                            </div>
                                                            <div class="container-fluid">
                                                                <div id="theGrid_div" style="overflow:scroll;   height:300px;    margin:0 auto; "></div>
                                                                <!-- <div id="thePager01"></div> -->
                                                            </div>     
                                                        </div>  
                                                        <div class="modal-footer">
                                                            <div class="row g-1">
                                                                <div class="col-auto">
                                                                    <input type="text"  class="form-control datetimepicker"  onkeypress="barcode_enter(event)" id="searchOrdDate" autocomplete="off"  placeholder="Lot No"   >
                                                                </div>
                                                                <div class="col-auto">
                                                                    <button class="btn btn-primary" type="button"  id="searchBtn"  >조회 </button>
                                                                </div>
                                                                <div class="col-auto">
                                                                    <button class="btn btn-primary" type="button"  id="newBtn"  >초기화 </button>
                                                                </div>
                                                                <div class="col-auto">
                                                                    <button class="btn btn-secondary me-1 mb-1" id="wlistBtn" type="button" data-bs-dismiss="modal">Close
                                                                    </button>
                                                                </div>
                                                                <!-- <div class="col-auto">
                                                                    <button class="badge-soft-info dropdown-item rounded-1"
                                                                        type="submit">저장 </button>
                                                                </div> -->
                                                            </div>
                                                        </div>   

                                                    </div>
                                                </div> 
                                            </div>   
                                        <!--------------------------------------------------------------------------------------->
                                        <!--------------------------------------------------------------------------------------->  
                                        <form    role="form"   th:object="${wrmcDto}" th:action="@{/popup/wrmc}" method="post" enctype="multipart/form-data" >
                                            <div class="modal fade" id="wrmcmodal" data-bs-keyboard="false"
                                            data-bs-backdrop="static" tabindex="-1" aria-labelledby="staticBackdropLabel"
                                            aria-hidden="true">
                                                <div class="modal-dialog modal-lg mt-6" role="document" id = "modalForm02"
                                                    style="max-width: 500px">
                                                    <div class="modal-content border-0">
                                                        <div class="modal-body p-0" > 
                                                            <div class="rounded-top-lg py-3 ps-4 pe-6 bg-light"  >
                                                                <h4 class="mb-1" id="modalExampleDemoLabel">작업설비</h4>
                                                            </div>
                                                            <!-- <div class="row mb-3 row-cols-lg-2 align-items-center"> 
                                                                <div class="col-auto">
                                                                    <div class="input-group">
                                                                        <div class="input-group-text">설비검색</div>
                                                                        <input class="form-control form-control-sm" id="searchCode" type="text"  
                                                                            placeholder="설비코드 / 설비명"     /> 
                                                                    </div>
                                                                </div>
                                                                <div class="col-auto">
                                                                    <button class="btn btn-falcon-warning me-1 mb-1" id="wrmcBtn" type="button" onclick="searchwrmc_fnc()">검색
                                                                    </button>
                                                                </div> 
                                                            </div>   -->

                                                            <div class="container-fluid"> 
                                                                <div class="col-auto">
                                                                    <div class="input-group">
                                                                        <div class="input-group-text">설비검색</div>
                                                                        <input class="form-control form-control-sm" id="searchCode" type="text"  
                                                                            placeholder="설비코드 / 설비명"     /> 
                                                                        <button class="btn btn-falcon-warning me-1 mb-1" id="wrmcBtn" type="button" >검색
                                                                        </button>
                                                                    </div>
                                                                </div> 
                                                            </div>                             
                                                            <div class="container-fluid"> 
                                                                <div id="wrmcGrid_div" ></div>
                                                                <div id="thePager02"></div>
                                                            </div>                                                                 
    
                                                        </div>  
                                                        <div class="modal-footer">
                                                            <div class="row g-1">
                                                                <div class="col-auto">
                                                                    <button class="badge-soft-primary dropdown-item rounded-1"
                                                                        type="button" id="wrmcmodal_btn" data-bs-dismiss="modal">Close</button>
                                                                </div>
                                                                <!-- <div class="col-auto">
                                                                    <button class="badge-soft-info dropdown-item rounded-1"
                                                                        type="submit">저장 </button>
                                                                </div> -->
                                                            </div>
                                                        </div>   

                                                    </div>
                                                </div> 
                                            </div>           
                                        </form>
                                        <!---------------------------------------------------------------------------------------> 
                                        <!--------------------------------------------------------------------------------------->    
                                        <form    role="form"   th:object="${wperidDto}" th:action="@{/popup/wperid}" method="post" enctype="multipart/form-data" >
                                            <div class="modal fade" id="wperidmodal" data-bs-keyboard="false"
                                            data-bs-backdrop="static" tabindex="-1" aria-labelledby="staticBackdropLabel"
                                            aria-hidden="true">
                                                <div class="modal-dialog modal-lg mt-6" role="document" id = "modalForm03"
                                                    style="max-width: 500px">
                                                    <div class="modal-content border-0">
                                                        <div class="modal-body p-0" > 
                                                            <div class="rounded-top-lg py-3 ps-4 pe-6 bg-light">
                                                                <h4 class="mb-1" id="modalExampleDemoLabel">작업자</h4>
                                                            </div> 
                                                            <div  class="container-fluid"> 
                                                                <div class="col-auto">
                                                                        <p> 현재 <b><span id="checked-count">0</span></b> 명이 선택되었습니다. </p>
                                                                    <!-- <div class="input-group">
                                                                        <div class="input-group-text">작업자검색</div>
                                                                        <input class="form-control form-control-sm" id="searchCode" type="text"  
                                                                            placeholder="작업자명"     /> 
                                                                        <button class="btn btn-falcon-warning me-1 mb-1" type="button" onclick="searchwperid_fnc()">검색
                                                                        </button> 
                                                                    </div>  -->
                                                                </div> 
                                                            </div>     

                                                            <div class="container-fluid"> 
                                                                <div id="wperidGrid_div" ></div>
                                                                <!-- <div id="thePager03"></div> -->
                                                            </div>                                                                 
    
                                                        </div>  
                                                        <div class="modal-footer">
                                                            <div class="row g-1">
                                                                <div class="col-auto">
                                                                    <button class="badge-soft-primary dropdown-item rounded-1"
                                                                        type="button" id="wperidmodal_btn" data-bs-dismiss="modal">Close</button>
                                                                </div> 
                                                            </div>
                                                        </div>   

                                                    </div>
                                                </div> 
                                            </div>         
                                        </form>    
                                        <!--------------------------------------------------------------------------------------->    
                                        <div class="modal fade" id="wbadqtymodal" data-bs-keyboard="false"
                                            data-bs-backdrop="static" tabindex="-1" aria-labelledby="staticBackdropLabel"
                                            aria-hidden="true">
                                            <div class="modal-dialog modal-lg mt-6" role="document" id = "modalForm05"
                                                style="max-width: 500px">
                                                <div class="modal-content border-0">
                                                    <div class="modal-body p-0" > 
                                                        <div class="rounded-top-lg py-3 ps-4 pe-6 bg-light">
                                                            <h4 class="mb-1" id="modalExampleDemoLabel">불량구분</h4>
                                                        </div>    

                                                        <div class="container-fluid"> 
                                                            <div id="wbadGrid_div" ></div>
                                                            <div id="thePager05"></div>
                                                        </div>    
                                                    </div>  
                                                    <div class="modal-footer">
                                                        <div class="row g-1">
                                                            <div class="col-auto">
                                                                <button class="badge-soft-primary dropdown-item rounded-1"
                                                                    type="button" data-bs-dismiss="modal">Close</button>
                                                            </div>
                                                            <!-- <div class="col-auto">
                                                                <button class="badge-soft-info dropdown-item rounded-1"
                                                                    type="submit">저장 </button>
                                                            </div> -->
                                                        </div>
                                                    </div>   

                                                </div>
                                            </div> 
                                        </div>          
                                        <!--------------------------------------------------------------------------------------->          
                                        <!--------------------------------------------------------------------------------------->    
                                        <div class="modal fade" id="wotqtymodal" data-bs-keyboard="false"
                                            data-bs-backdrop="static" tabindex="-1" aria-labelledby="staticBackdropLabel"
                                            aria-hidden="true">
                                            <div class="modal-dialog modal-lg mt-6" role="document" id = "modalForm05"
                                                style="max-width: 850px">
                                                <div class="modal-content border-0">
                                                    <div class="modal-body p-0" > 
                                                        <div class="rounded-top-lg py-3 ps-4 pe-6 bg-light">
                                                            <h4 class="mb-1" id="modalExampleDemoLabel"> 검사량등록</h4>
                                                        </div>     
                                                        <div  class="container-fluid"> 
                                                            <div class="col-auto">
                                                                    <!-- <p> 현재 <b><span id="checked-count">0</span></b> 명이 선택되었습니다. </p> -->
                                                                <div class="input-group">
                                                                    <div class="input-group-text">작업일자</div>
                                                                    <input type="text"  class="form-control datetimepicker" id="popwkotDate" autocomplete="off" placeholder="Y-m-d" >
                                                                    <div class="input-group-text">검사량</div>
                                                                    <input class="form-control form-control-sm"  type="number" id="popwotqt"  placeholder=""      />
                                                                    <!-- <div class="input-group-text">불량수량</div>
                                                                    <input class="form-control form-control-sm"  type="number" id="popwbdqt"  placeholder=""      />  -->
                                                                    <button class="btn btn-falcon-warning me-1 mb-1" type="button" onclick="save_fnc()">등록
                                                                    </button> 
                                                                    <button class="btn btn-falcon-warning me-1 mb-1" type="button" id="popsearch01" >조회
                                                                    </button> 
                                                                    <input class="form-control form-control-sm" id="popseq" type="hidden"  /> 
                                                                    <input class="form-control form-control-sm" id="popwseq" type="hidden"  /> 
                                                                </div> 
                                                            </div> 
                                                        </div>  
                                                        <div class="container-fluid"> 
                                                            <div id="wotqtGrid_div" ></div>
                                                            <div id="thePager06"></div>
                                                        </div>    
                                                    </div>  
                                                    <div class="modal-footer">
                                                        <div class="row g-1">
                                                            <div class="col-auto">
                                                                <button class="badge-soft-primary dropdown-item rounded-1"
                                                                    type="button" data-bs-dismiss="modal">Close</button>
                                                            </div>
                                                            <!-- <div class="col-auto">
                                                                <button class="badge-soft-info dropdown-item rounded-1"
                                                                    type="submit">저장 </button>
                                                            </div> -->
                                                        </div>
                                                    </div>   

                                                </div>
                                            </div> 
                                        </div>          
                                    <!--------------------------------------------------------------------------------------->                                                         
                                    </div>
                                </div>
                            </div>
                        </div>
                    </body> 

                    <!------footer ------>
                    <!-- <footer th:replace="layouts/XDashBoard/XDashBoard_footer :: XDashBoard_footer"></footer> -->
                    <!---------------------> 



                    
    <script  type="text/javascript" th:inline="javascript"> 
        var wperidGrid_Data ;
        var wperidGrid ;
        var wiworkGrid ; 
        var wtab01Grid;
        var wbadGrid ;
        var wbomGrid ;
        var view_flistpage;
        var view_wotqtpage;
        var plan_no = new Array();
        var lotno = new Array();
        var prod_qty = new Array();
        var linenm = new Array();
        var cltnm = new Array();
        var pname = new Array();
        var pcode = new Array();
        var addlotno = new Array(); 
        
        var ll_sumotqty = 0; 


        function barcode_enter(e){ 
           if(e.keyCode == 13){
            var ls_searchOrdDate = document.getElementById('searchOrdDate').value;  
            searchList_rtn(ls_searchOrdDate);
              return ;
           }
        }

        window.onload = function() {  
                    //작업지시 list
                    var ll_bomchkrow = 0; 
                    //일자별예약현황 popup list
                    view_flistpage = new wijmo.collections.CollectionView(getData_flist(), {
                            // pageSize: 100
                        });   
                    wtab01Grid = new wijmo.grid.FlexGrid('#theGrid_div', {
                        autoGenerateColumns: false,
                        isReadOnly: true, 
                        selectionMode: 'RowRange',
                        alternatingRowStep: 0,
                        columns: [
                            // { binding: 'index', header: 'seq', width: '*' },
                            { binding: 'prod_sdate', header: '일자',  width: 130, align:"center", format: 'yyyy-MM-dd' },
                            {
                                binding: 'lotno',
                                width: 150,
                                header: 'LotNo', 
                                align:"center",
                                cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                                    text: '<b>${item.lotno}</b>',
                                    click: (e, ctx) => {
                                        selectChk(ctx.item.custcd, ctx.item.spjangcd, ctx.item.wono, ctx.item.cltnm, ctx.item.pname, ctx.item.ostore, ctx.item.plan_no, ctx.item.cltcd, ctx.item.pcode, ctx.item.wseq, ctx.item.wflag, ctx.item.phmmdoc, ctx.item.otqty, ctx.item.wrpsnm, ctx.item.owqty ,ctx.item.obqty,ctx.item.winps,ctx.item.wrps,ctx.item.lotno );
                                    }
                                })
                            }, 
                            { binding: 'plan_no', header: '작지번호',   align:"center", width: 150  },
                            // { binding: 'cltnm', header: '거래처',   align:"center",  width: 100 },
                            { binding: 'pname', header: '품목명',   align:"center",  width: 150 }, 
                            { binding: 'psize', header: '규격',     align:"center",  width: 130 },
                            { binding: 'prod_qty', header: '계획량',align:"center",  width: 100 },
                            // { binding: 'plan_no', header: '투입량',   align:"center",width: '*' }, 
                            // { binding: 'winqt', header: '투입량',   align:"center",width: '*' }, 
                            // { binding: 'wotqt', header: '완료량',   align:"center",width: '*' } ,
                            // { binding: 'decision', header: '임시여부', align:"center", width: '*' }

                        ],
                        itemsSource: view_flistpage
                    }); 
                        //작업지시서 데이타 
                    function getData_flist(){ 
                        var ListDto = [[${itemDtoList}]]; 
                        // console.log("ListDto : ", ListDto);
                        var data = [];
                        var cnt = 1;
                        // var today = new Date()
                        // console.log("today->" + today);
                        for (var i = 0; i < ListDto.length; i++) {
                            var psdate = ListDto[i]["prod_sdate"];
                            psdate = psdate.substr(0,4) + '-' + psdate.substr(4,2)+ '-' + psdate.substr(6,2);
                            var date_format = new Date(psdate);
                            data.push({
                                id: i, 
                                index: cnt,                                                                
                                prod_sdate: wijmo.DateTime.addDays(date_format, 0),
                                wono: ListDto[i]["wono"], 
                                cltnm: ListDto[i]["cltnm"], 
                                pname: ListDto[i]["pname"], 
                                psize: ListDto[i]["psize"], 
                                prod_qty: ListDto[i]["prod_qty"],
                                winqt: ListDto[i]["winqt"] , 
                                wotqt: ListDto[i]["wotqt"] ,     
                                decision: ListDto[i]["decision"] ,    
                                plan_no: ListDto[i]["plan_no"] ,
                                ostore: ListDto[i]["ostore"] ,
                                custcd: ListDto[i]["custcd"] ,
                                spjangcd: ListDto[i]["spjangcd"] ,
                                cltcd: ListDto[i]["cltcd"] ,
                                wseq: ListDto[i]["wseq"]  ,
                                pcode: ListDto[i]["pcode"] ,
                                wflag: ListDto[i]["wflag"] ,
                                wremark: ListDto[i]["wremark"] ,
                                phmmdoc: ListDto[i]["phmmdoc"]  ,
                                winps: ListDto[i]["winps"]  ,
                                wrps: ListDto[i]["wrps"]  ,
                                lotno: ListDto[i]["lotno"]  ,
                                wrpsnm: ListDto[i]["wrpsnm"],
                                obqty: ListDto[i]["obqty"]
                                
                                
                            });
                            cnt++;
                        }   
                        return data                                          
                    }       
                    // 선택기 생성
                    let selector01 = new wijmo.grid.selector.Selector(wtab01Grid, {
                        itemChecked: () => {
                            showCheckedCount02();
                        }
                    });   
                    function showCheckedCount02() {
                        let cnt = document.getElementById('checked-count'), sel = wtab01Grid.rows.filter(r => r.isSelected);  
                        ll_sumotqty = 0
                        for (var i = 0; i < sel.length; i++) { 
                            //  console.log(sel[i]._data);
                            plan_no [i]   = sel[i]._data.plan_no;
                            lotno   [i]   = sel[i]._data.lotno; 
                            cltnm[i]      = sel[i]._data.cltnm;
                            pname[i]      = sel[i]._data.pname; 
                            prod_qty[i]      = sel[i]._data.prod_qty; 
                            pcode[i]      = sel[i]._data.pcode; 
                            ll_sumotqty = ll_sumotqty + parseFloat(prod_qty[i]);  
                        }  
                        // plan_no =  document.getElementById('inplan_no').value; 
                        if(sel.length > 0){
                            if(sel.length == 1){ 
                                document.getElementById('inpname').value  = pname [0]; 
                            }else{                                                 
                                document.getElementById('inpname').value  = pname [0] + ' 외 '; 
                            }  
                            document.getElementById('incltnm').value  = cltnm [0];
                            document.getElementById('inwinqt').value = ll_sumotqty;     
                        }else{
                            plan_no = [];
                            lotno = []; 
                            cltnm = [];
                            pname = []; 
                            pcode = [];
                            prod_qty = []; 
                            document.getElementById('inpname').value  = ''; 
                            document.getElementById('incltnm').value  = '';
                            document.getElementById('inwinqt').value = 0;    
                            return ;
                        }
                        
                        if(!plan_no && sel.length > 0 ){
                            alert("작지번호를 선택하세요");
                            return 
                        } 
                        if(!plan_no ){
                            return 
                        }

                        // $.ajax({
                        //     url: '/input/w010perid',  
                        //     type:"post",
                        //     data: {"custcd" : custcd,
                        //            "spjangcd": spjangcd,
                        //            "linecd" : linecd,
                        //            "linenm" : linenm,
                        //            "wflagcd" : wflagcd,
                        //            "wflagnm" : wflagnm,
                        //            "wperid" : wperid,
                        //            "wpernm" : wpernm,
                        //            "plan_no" : plan_no
                        //           },
                        //     contentType: "application/x-www-form-urlencoded; charset=UTF-8;",
                        //     success:function(data){
                        //         var result  = data;   
                        //         // console.log("result", result);
                        //     },error:function(e){
                        //         alert(data.code);
                        //         alert(data.message);
                        //     }
                        // }).done(function(fragment){           

                        // }) 



                        //투입인원        
                        // cnt.textContent = sel.length.toString();
                        // document.getElementById('inwinps').value = parseInt(sel.length.toString()); 
                    }



                    //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
                    //작업설비 popup list
                    var view_wrmcpage = new wijmo.collections.CollectionView(getData_wlist(), {
                        pageSize: 6
                    });
                    // 작업설비 페이지 이동
                    new wijmo.input.CollectionViewNavigator('#thePager02', {
                        byPage: true,
                        headerFormat: 'Page {currentPage:n0} of {pageCount:n0}',
                        cv: view_wrmcpage
                    });     
                        wrmcGrid = new wijmo.grid.FlexGrid('#wrmcGrid_div', {  
                        autoGenerateColumns: false,
                        isReadOnly: true, 
                        selectionMode: 'RowRange',
                        alternatingRowStep: 0,
                        columns: [   

                            { binding: 'wrmc',
                                header: '코드', 
                                cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                                    text: '<b>${item.wrmc}</b>',
                                    click: (e, ctx) => {
                                        wrmcChk(ctx.item.wrmc, ctx.item.machname);
                                    }
                                }),  
                            }, 
                            {
                                binding: 'machname',
                                header: '설비명', 
                                align:"center",
                                cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                                    text: '<b>${item.machname}</b>',
                                    click: (e, ctx) => {
                                        wrmcChk(ctx.item.wrmc, ctx.item.machname);
                                    }
                                })
                            },

                            { binding: 'wpernm', header: '작업자', width: '*', format: 'n1' } 

                        ], 
                        itemsSource: view_wrmcpage
                    });  
                    // 작업설비 데이터 수집
                    function getData_wlist(){

                        var WrmcDto = [[${wrmcDto}]];  
                        var data02 = [];
                        var cnt = 1;
                        for (var i = 0; i < WrmcDto.length; i++) {
                            data02.push({
                                id: i, 
                                index: cnt,
                                wrmc:WrmcDto[i]["wrmc"],
                                machname: WrmcDto[i]["machname"], 
                                wpernm: WrmcDto[i]["wpernm"]                                                    
                            });
                            cnt++;
                        }   
                        return data02                                          
                    }    



                    //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
                    //검사량등록 popup list
                    view_wotqtpage = new wijmo.collections.CollectionView(getData_wlist(), {
                        pageSize: 6
                    });
                    // 검사량등록 페이지 이동
                    new wijmo.input.CollectionViewNavigator('#thePager06', {
                        byPage: true,
                        headerFormat: 'Page {currentPage:n0} of {pageCount:n0}',
                        cv: view_wotqtpage
                    });     
                        wotqtGrid = new wijmo.grid.FlexGrid('#wotqtGrid_div', {  
                        autoGenerateColumns: false,
                        isReadOnly: true, 
                        selectionMode: 'RowRange',
                        alternatingRowStep: 0,
                        columns: [   

                            { binding: 'pcode', header: '품목코드', width: '*'  } ,
                            { binding: 'pname', header: '품명', width: '*' } ,
                            { binding: 'psize', header: '규격', width: '*' } ,
                            { binding: 'wotdt',
                                header: '검사일자', 
                                cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                                    text: '<b>${item.wotdt}</b>',
                                    click: (e, ctx) => {
                                        woworkDel(ctx.item.plan_no, ctx.item.wseq, ctx.item.seq, ctx.item.pcode, ctx.item.lotno);
                                    }
                                }),  
                            }, 
                            {
                                binding: 'wqty',
                                header: '검사량', 
                                align:"center",
                                cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                                    text: '<b>${item.wqty}</b>',
                                    click: (e, ctx) => {
                                        woworkDel(ctx.item.plan_no, ctx.item.wseq, ctx.item.seq, ctx.item.pcode, ctx.item.lotno);
                                    }
                                })
                            },

                            // { binding: 'bqty', header: '불량', width: '*', format: 'n1' } ,
                            // { binding: 'qty', header: '완료량', width: '*', format: 'n1' } 

                        ], 
                        itemsSource: view_wotqtpage
                    });  
                    // 작업설비 데이터 수집
                    function getData_wlist(){

                        // var WrmcDto = [[${wrmcDto}]];  
                        var data02 = [];
                        var cnt = 1;
                        for (var i = 0; i < 10; i++) {
                            data02.push({
                                id: i, 
                                index: cnt,
                                pcode:WrmcDto[i]["pcode"],
                                pname: WrmcDto[i]["pname"], 
                                pgugek: WrmcDto[i]["pgugek"],
                                wotdt: WrmcDto[i]["wotdt"],
                                wqty: WrmcDto[i]["wqty"],
                                bqty: WrmcDto[i]["bqty"],
                                qty: WrmcDto[i]["qty"],
                            });
                            cnt++;
                        }  
                        return data02                                          
                    }    


                    //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
                    //작업자 popup list 
                    let view_wperidpage = new wijmo.collections.CollectionView(getData_wperid()); 
                    setGroups(true);
                        wperidGrid = new wijmo.grid.FlexGrid('#wperidGrid_div', {
                        deferResizing: true,
                        showMarquee: true, 
                        alternatingRowStep: 0,
                        autoGenerateColumns: false, 
                        columns: [   
                            // { binding: 'custcd',width: '*', header: 'custcd', width: '*', align:"center", format: '*' }, 
                            // { binding: 'spjangcd',width: '*', header: 'spjangcd', width: '*', align:"center", format: '*' }, 
                            { binding: 'linenm',width: '*', header: '라인', width: '*', align:"center", format: '*' ,
                                cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                                    text: '<b>${item.linenm}</b>',
                                    click: (e, ctx) => {
                                        wperidChk(ctx.item.wperid, ctx.item.wpernm );
                                    }
                                })
                            }, 
                            { binding: 'wflagnm', width: '1*', header: '공정', width: '*', align:"center", format: '*' ,
                                cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                                    text: '<b>${item.wflagnm}</b>',
                                    click: (e, ctx) => {
                                        wperidChk(ctx.item.wperid, ctx.item.wpernm );
                                    }
                                })
                                }, 
                            { binding: 'wperid', width: '1*', header: '코드', width: '*', align:"center", format: '*' ,
                                cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                                    text: '<b>${item.wperid}</b>',
                                    click: (e, ctx) => {
                                        wperidChk(ctx.item.wperid, ctx.item.wpernm );
                                    }
                                })
                            }, 
                            {
                                binding: 'wpernm',
                                width: '1*',
                                header: '작업자', 
                                align:"center",
                                cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                                    text: '<b>${item.wpernm}</b>',
                                    click: (e, ctx) => {
                                        wperidChk(ctx.item.wperid, ctx.item.wpernm );
                                    }
                                })
                            } 

                        ], 
                        itemsSource: view_wperidpage
                    });  
                    // 선택기 생성
                    let selector = new wijmo.grid.selector.Selector(wperidGrid, {
                        itemChecked: () => {
                            showCheckedCount();
                        }
                    }); 
                    
                    // 그룹 전환
                    setGroups(true);
                    // document.getElementById('groups').addEventListener('click', e => {
                    //     setGroups(e.target.checked);
                    // });
                    function setGroups(groupsOn) {
                        let groups = view_wperidpage.groupDescriptions;
                        groups.clear();
                        if (groupsOn) {
                        groups.push(new wijmo.collections.PropertyGroupDescription('linenm'), new wijmo.collections.PropertyGroupDescription('wflagnm'));
                        }
                    }
                    // 헤더 열 전환
                    setHeaderColumn(true);
                    // document.getElementById('header').addEventListener('click', e => {
                    //     setHeaderColumn(e.target.checked);
                    // });
                    function setHeaderColumn(headerOn) {
                        wperidGrid.headersVisibility = headerOn
                        ? wijmo.grid.HeadersVisibility.All
                        : wijmo.grid.HeadersVisibility.Column;
                        selector.column = headerOn
                        ? wperidGrid.rowHeaders.columns[0]
                        : wperidGrid.columns[0];
                    }
                    // 체크된 항목 표시
                    // showCheckedCount();
                    function showCheckedCount() {
                        let cnt = document.getElementById('checked-count'), sel = wperidGrid.rows.filter(r => r.isSelected);                                        
                        // console.log("sel", sel) ;
                        var custcd = new Array();
                        var spjangcd = new Array();
                        var linecd = new Array();
                        var linenm = new Array();
                        var wflagcd = new Array();
                        var wflagnm = new Array();
                        var wperid = new Array();
                        var wpernm = new Array();
                        // e._p._rows[i]._data.qty
                        for (var i = 0; i < sel.length; i++) {
                            custcd [i]   = sel[i]._data.custcd;
                            spjangcd[i] = sel[i]._data.spjangcd;
                            linecd[i]   = sel[i]._data.linecd;
                            linenm[i]   = sel[i]._data.linenm;
                            wflagcd[i]  = sel[i]._data.wflagcd;
                            wflagnm[i]  = sel[i]._data.wflagnm;
                            wperid[i]   = sel[i]._data.wperid;
                            wpernm [i]  = sel[i]._data.wpernm; 
                            // console.log('sel[i]._data.wflagcd', sel[i]._data.wflagcd);
                        }  
                        plan_no =  document.getElementById('inplan_no').value;
                        if(sel.length > 0){
                            if(sel.length == 1){
                                document.getElementById('inwrpsnm').value = wpernm [0];
                            }else{                                                
                                document.getElementById('inwrpsnm').value = wpernm [0] + ' 외 '; // + sel.length - 1  + '명';
                            } 
                            document.getElementById('inwrps').value = wperid [0]; 
                        }
                        
                        if(!plan_no && sel.length > 0 ){
                            alert("작지번호를 선택하세요");
                            return 
                        }
                        // console.log("wpernm", wpernm);
                        // console.log("plan_no", plan_no);
                        if(!plan_no ){
                            return 
                        }

                        $.ajax({
                            url: '/input/w010perid',  
                            type:"post",
                            data: {"custcd" : custcd,
                                    "spjangcd": spjangcd,
                                    "linecd" : linecd,
                                    "linenm" : linenm,
                                    "wflagcd" : wflagcd,
                                    "wflagnm" : wflagnm,
                                    "wperid" : wperid,
                                    "wpernm" : wpernm,
                                    "plan_no" : plan_no
                                    },
                            contentType: "application/x-www-form-urlencoded; charset=UTF-8;",
                            success:function(data){
                                var result  = data;   
                                // console.log("result", result);
                            },error:function(e){
                                alert(data.code);
                                alert(data.message);
                            }
                        }).done(function(fragment){           

                        }) 



                        //투입인원        
                        cnt.textContent = sel.length.toString();
                        document.getElementById('inwinps').value = parseInt(sel.length.toString()); 
                    }
                    
                    //지정된 레벨까지 collapse  특정 그룹에 대해서만 expand 
                    wperidGrid.collapseGroupsToLevel(1);
                    var count = 0;
                    for (var j =0; j <  wperidGrid.rows.length - 1; j++) {
                        if (wperidGrid.rows[j].hasChildren) { // 자식 행이 있는 경우
                            if(wperidGrid.rows[j].level=== 1 ){ //계층 수준이 1이고 computer이면
                                wperidGrid.rows[j].isCollapsed = false;
                            } 
                        }
                    }

                    // 작업자 데이터 수집
                    function getData_wperid(){

                        var WperidDto = [[${wperidDto}]];  
                        var data03 = [];
                        var cnt = 1;
                        for (var i = 0; i < WperidDto.length; i++) {
                            data03.push({
                                id: i, 
                                index: cnt,
                                custcd:WperidDto[i]["custcd"], 
                                spjangcd:WperidDto[i]["spjangcd"], 
                                linenm:WperidDto[i]["linenm"], 
                                linecd:WperidDto[i]["linecd"], 
                                wflagcd:WperidDto[i]["wflagcd"],
                                wflagnm:WperidDto[i]["wflagnm"], 
                                wperid:WperidDto[i]["wperid"],  
                                wpernm: WperidDto[i]["wpernm"]                                                    
                            });
                            cnt++;
                        }  
                        console.log('data03');
                        console.log(data03);
                        return data03                                          
                    } 

                    function pickOne(items) {
                            return items[randBetween(0, items.length - 1)];
                    }
                    function randBetween(min, max) {
                        return Math.floor(Math.random() * (max - min + 1) + min);
                    }
 
                    //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
                    //불량구분 popup list
                    var view_wbadpage = new wijmo.collections.CollectionView(getData_wlist(), {
                        pageSize: 6
                    });
                    // // 작업설비 페이지 이동
                    // new wijmo.input.CollectionViewNavigator('#thePager02', {
                    //     byPage: true,
                    //     headerFormat: 'Page {currentPage:n0} of {pageCount:n0}',
                    //     cv: view_wbadpage
                    // });     
                    wbadGrid = new wijmo.grid.FlexGrid('#wbadGrid_div', {  
                    autoGenerateColumns: false, 
                    selectionMode: 'RowRange',
                    alternatingRowStep: 0,
                    columns: [   

                        { binding: 'wcode', header: '코드', width: '*', format: '*' , isReadOnly: true}, 
                        { binding: 'wcdnm', header: '불량구분', width: '*', format: '*', isReadOnly: true },   
                        { binding: 'wbqty', header: '불량수량', width: '*', format: 'n1', isReadOnly: false } ,  
                        { binding: 'wseq', header: '순번', width: '*', format: 'n1', isReadOnly: false } 

                    ],       

                        cellEditEnding: function (s, e) {
                            // row : 0  col : 1  => pname
                            // s => event
                            var col = s.columns[e.col];   
                            var jatodata = [];
                            var pcode = ''; 
                                if (col.binding == 'wbqty') {
                                    var ll_qty = 0;
                                    var ll_tqty = 0;
                                    var ll_inputqty = s.activeEditor.value;
                                    var ll_row = e.row;
                                    var ll_wotqt = document.getElementById('inwotqt').value
                                    if(!ll_wotqt){ll_wotqt = 0}  //검사량
                                    if(ll_wotqt == 0){
                                        alert("검사량이 없습니다.")
                                        return 
                                    } 
                                    // console.log('qty',s.activeEditor.value);  
                                    var rows = e._p._rows.length - 1;  
                                    for (var i = 0; i < rows ; i++) {  
                                        if (ll_row == i){
                                            ll_qty = parseFloat(ll_inputqty);   //parseFloat(값) 
                                            ls_wcode = e._p._rows[i]._data.wcode ;
                                            ls_wseq  = e._p._rows[i]._data.wseq ;
                                        }else{
                                            
                                            ll_qty = parseFloat(e._p._rows[i]._data.wbqty);  
                                        }  
                                            
                                        if(!isNaN(ll_qty)){ 
                                            ll_tqty = ll_tqty + ll_qty;
                                        } 
                                    }  
                                    // tqty = Number(wbomGrid.getCellData(ll_bomchkrow, 5, false));  
                                    if(!ll_tqty){ll_tqty = 0 }; 
                                    if (ll_wotqt < ll_tqty){
                                        alert("불량수량이 검사수량을 초과합니다.")
                                        return
                                    }else{ 
                                        document.getElementById('inwbdqt').value= ll_tqty; 
                                        document.getElementById('inwokqt').value = ll_wotqt - ll_tqty       //완료량 
                                        wbadqty_int(ll_tqty, ls_wcode, ls_wseq);   //불량구분 등록
                                    }
                                    
                                }
                        },
                        itemsSource: view_wbadpage
                    });  
                    // 불량구분 데이터 수집
                    function getData_wlist(){

                        var WbadDto = [[${wbadDto}]];  
                        var data05 = [];
                        var cnt = 1;
                        for (var i = 0; i < WbadDto.length; i++) {
                            data05.push({
                                id: i, 
                                index: cnt,
                                wcode:WbadDto[i]["wcode"],
                                wcdnm: WbadDto[i]["wcdnm"], 
                                wbqty: WbadDto[i]["wbqty"],
                                wseq : WbadDto[i]["wseq"] ,
                                plan_no : WbadDto[i]["plan_no"]          
                            });
                            cnt++;
                        }   
                        return data05                                          
                    }         
                    
                    //불량구분 등록 
                    function wbadqty_int(arg1, arg2, arg3){
                        // TB_FPLAN_WBAD 불량구분등록
                        var wflag = document.getElementById('inwflag').value;
                        var ls_custcd   = document.getElementById('incustcd').value; 
                        var ls_spjangcd = document.getElementById('inspjangcd').value;  
                        var ls_inplan_no = document.getElementById('inplan_no').value;  
                        var ls_pcode     = document.getElementById('inpcode').value;  
                        if(!wflag){wflag = "00020"} ;
                        if(!arg3) {arg3 = ""} ;
                        $.ajax({
                            url: '/input/w010wbad',  
                            type:"POST",
                            data: {
                                "custcd"     : ls_custcd,
                                "spjangcd"   : ls_spjangcd,
                                "plan_no"    : ls_inplan_no,
                                "wflag"      : wflag,
                                "wbqty"      : arg1,
                                "wcode"      : arg2, 
                                "wseq"       : arg3,
                                "pcode"      : ls_pcode
                            },
                            async:true,
                            success:function(data){
                                var wrmcDto  = data;  
                                var wrmc_data = [];
                                var cnt = 1;
                                for (var i = 0; i < wrmcDto.length; i++) {
                                    wrmc_data.push({
                                        id: i, 
                                        index: cnt,
                                        wrmc:wrmcDto[i]["wrmc"],
                                        machname: wrmcDto[i]["machname"], 
                                        wpernm: wrmcDto[i]["wpernm"]                                                  
                                    });
                                    cnt++;
                                }   
                                // console.log("wrmc_data",wrmc_data) 
                                wrmcGrid.columns.clear();   
                                wrmcGrid.autoGenerateColumns = false; 
                                view_wrmcpage.sourceCollection  = wrmc_data;
                                var cols = new wijmo.grid.Column(); 
                                cols.binding = 'wrmc';
                                cols.header = '코드';
                                cols.width = '*';
                                wrmcGrid.columns.push(cols);    
                                // console.log("cols", cols);  
                                cols = new wijmo.grid.Column(); 
                                cols.binding = 'machname';
                                cols.header = '설비명';
                                cols.width = '*';
                                cols.cellTemplate = wijmo.grid.cellmaker.CellMaker.makeLink({ 
                                    text: '<b>${item.machname}</b>',
                                    click: (e, ctx) => {
                                        wrmcChk(ctx.item.wrmc, ctx.item.machname);
                                    }
                                });
                                wrmcGrid.columns.push(cols);  
                                cols = new wijmo.grid.Column(); 
                                cols.binding = 'wpernm';
                                cols.header = '작업자';
                                cols.width = '*';
                                wrmcGrid.columns.push(cols);  
                            },error:function(e){
                                alert(data.code);
                                alert(data.message);
                            }
                        }).done(function(fragment){           

                        }) 
                    }
                    //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
                    //작업설비 검색   
                    document.getElementById("wrmcBtn").addEventListener("click",function(){
                        let searchText = '';  
                        searchText = document.getElementById('searchCode').value; 
                        $.ajax({
                            url: '/popup/wrmc',  
                            type:"GET",
                            data: {
                                "machname" : searchText,
                                "wflag" : '00020'
                            },
                            success:function(data){
                                var wrmcDto  = data;  
                                var wrmc_data = [];
                                var cnt = 1;
                                for (var i = 0; i < wrmcDto.length; i++) {
                                    wrmc_data.push({
                                        id: i, 
                                        index: cnt,
                                        wrmc:wrmcDto[i]["wrmc"],
                                        machname: wrmcDto[i]["machname"], 
                                        wpernm: wrmcDto[i]["wpernm"]                                                  
                                    });
                                    cnt++;
                                }   
                                // console.log("wrmc_data",wrmc_data) 
                                wrmcGrid.columns.clear();   
                                wrmcGrid.autoGenerateColumns = false; 
                                view_wrmcpage.sourceCollection  = wrmc_data;
                                var cols = new wijmo.grid.Column(); 
                                cols.binding = 'wrmc';
                                cols.header = '코드';
                                cols.width = '*';
                                cols.cellTemplate = wijmo.grid.cellmaker.CellMaker.makeLink({ 
                                    text: '<b>${item.wrmc}</b>',
                                    click: (e, ctx) => {
                                        wrmcChk(ctx.item.wrmc, ctx.item.machname);
                                    }
                                });
                                wrmcGrid.columns.push(cols);    
                                // console.log("cols", cols);  
                                cols = new wijmo.grid.Column(); 
                                cols.binding = 'machname';
                                cols.header = '설비명';
                                cols.width = '*';
                                cols.cellTemplate = wijmo.grid.cellmaker.CellMaker.makeLink({ 
                                    text: '<b>${item.machname}</b>',
                                    click: (e, ctx) => {
                                        wrmcChk(ctx.item.wrmc, ctx.item.machname);
                                    }
                                });
                                wrmcGrid.columns.push(cols);  
                                cols = new wijmo.grid.Column(); 
                                cols.binding = 'wpernm';
                                cols.header = '작업자';
                                cols.width = '*';
                                wrmcGrid.columns.push(cols);  
                            },error:function(e){
                                alert(data.code);
                                alert(data.message);
                            }
                        }).done(function(fragment){           

                        }) 
                    })    

                    //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$     
                    //BOM 검색   
                    // document.getElementById("plannoBtn").addEventListener("click",function(){
                    //     let searchText = '';   
                    //     searchText = document.getElementById('searchPlanno').value; 
                    //     if(!searchText){
                    //         alert("작업지시서를 먼저 선택하세요");
                    //         return 
                    //     } 
                    //     wbadqty_list(searchText);     //TB_FPLAN_IWORK  list

                    // })    

                    //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$                                    
                    // TB_FPLAN_BOM LIST
                    function wbom_list(arg){
                        $.ajax({
                            url: '/popup/wbom',  
                            type:"GET",
                            data: {"plan_no" : arg},
                            success:function(data){
                                var wbomDto  = data;  
                                var wbom_data = [];
                                var cnt = 1;
                                // console.log('_wbom'  , data); 
                                for (var i = 0; i < wbomDto.length; i++) {
                                    wbom_data.push({
                                        id: i, 
                                        index: cnt,
                                        seq:wbomDto[i]["seq"],
                                        pcode: wbomDto[i]["pcode"], 
                                        pname: wbomDto[i]["pname"],
                                        psize: wbomDto[i]["psize"],
                                        punit: wbomDto[i]["punit"],
                                        lotnodv: wbomDto[i]["lotnodv"],
                                        qty: wbomDto[i]["qty"],
                                        gqty: wbomDto[i]["gqty"],
                                        tqty: wbomDto[i]["tqty"],
                                        pcode: wbomDto[i]["pcode"],
                                    });                                                    
                                    if (cnt == 1) {document.getElementById('searchPcode').value= wbom_data[0].pcode;}                                                      
                                    cnt++;
                                }   
                                //  console.log(wbom_data);

                                wbomGrid.columns.clear();   
                                wbomGrid.autoGenerateColumns = false; 
                                view_wbompage.sourceCollection  = wbom_data;
                                var cols = new wijmo.grid.Column(); 
                                cols.binding = 'seq';
                                cols.header = 'NO';
                                cols.width = '*';
                                cols.align = 'center';
                                wbomGrid.columns.push(cols);    
                                // console.log("cols", cols);  
                                cols = new wijmo.grid.Column(); 
                                cols.binding = 'pname';
                                cols.header = '투입품목';
                                cols.width = '*';
                                cols.align = 'center'; 
                                wbomGrid.columns.push(cols);  
                                cols = new wijmo.grid.Column(); 
                                cols.binding = 'psize';
                                cols.header = '규격';
                                cols.width = '*';
                                cols.align = 'center';
                                wbomGrid.columns.push(cols);  
                                cols = new wijmo.grid.Column(); 
                                cols.binding = 'qty';
                                cols.header = '소요량';
                                cols.width = '*';
                                cols.align = 'center';
                                cols.format = 'n3' ;
                                wbomGrid.columns.push(cols);  
                                cols = new wijmo.grid.Column(); 
                                cols.binding = 'gqty';
                                cols.header = '계산량';
                                cols.width = '*';
                                cols.align = 'center';
                                cols.format = 'n3' ;
                                wbomGrid.columns.push(cols);  
                                cols = new wijmo.grid.Column(); 
                                cols.binding = 'tqty';
                                cols.header = '투입량';
                                cols.width = '*';  
                                cols.align = 'center';
                                cols.format = 'n3' ;
                                wbomGrid.columns.push(cols);  
                                cols = new wijmo.grid.Column(); 
                                cols.binding = 'pcode';
                                cols.header = '품목코드';
                                cols.width = '*';  
                                cols.align = 'center';
                                wbomGrid.columns.push(cols); 
                            },error:function(e){
                                alert(data.code);
                                alert(data.message);
                            }
                        }).done(function(fragment){           

                        })     
                    }

                    //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
                    //TB_FPLAN_IWORK List 
            
                    //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$                                    
                    // TB_FPLAN_WBAD LIST
                    function wbadqty_list(arg){
                        var wflag = document.getElementById('inwflag').value;
                        var ls_custcd   = document.getElementById('incustcd').value; 
                        var ls_spjangcd = document.getElementById('inspjangcd').value;  
                        if(!wflag){wflag = "00020";}  
                        $.ajax({
                            url: '/input/SELWBAD',  
                            type:"POST",
                            data: {
                                "custcd"     : ls_custcd,
                                "spjangcd"   : ls_spjangcd,
                                "plan_no"    : arg,
                                "wflag"      : wflag
                            },
                            async:true,
                            success:function(data){
                                wbadGrid.columns.clear();   
                                wbadGrid.autoGenerateColumns = false;   
                                var colsa = new wijmo.grid.Column(); 
                                //console.log("_SELWBAD data", data);
                                if(!data.length){ 
                                    view_wiworkpage.sourceCollection  = data;
                                    colsa.binding = 'wcode';
                                    colsa.header = '코드';
                                    colsa.width = '*';
                                    colsa.align = 'center';
                                    wbadGrid.columns.push(colsa);  
                                    colsa = new wijmo.grid.Column(); 
                                    colsa.binding = 'wcdnm';
                                    colsa.header = '불량구분';
                                    colsa.width = '*';
                                    colsa.align = 'center'; 
                                    wbadGrid.columns.push(colsa);  
                                    colsa = new wijmo.grid.Column(); 
                                    colsa.binding = 'wbqty';
                                    colsa.header = '불량수량';
                                    colsa.width = '*';
                                    colsa.align = 'center';
                                    wbadGrid.columns.push(colsa);                                                   
                                    return 
                                }  
                                var wbadDto  = data;  
                                var wbad_data = []; 
                                var cnt = 0; 
                                for (var i = 0; i < wbadDto.length; i++) {
                                    wbad_data.push({
                                        id: i, 
                                        index: cnt,
                                        wcode: wbadDto[i]["wcode"],
                                        wcdnm: wbadDto[i]["wcdnm"], 
                                        wbqty: wbadDto[i]["wbqty"], 
                                    });                             
                                    cnt++;                        
                                }   
                                    

                                // console.log('wbad_data', wbad_data); 
                                view_wbadpage.sourceCollection  = wbad_data;
                                colsa.binding = 'wcode';
                                colsa.header = '코드';
                                colsa.width = '*';
                                colsa.align = 'center';
                                wbadGrid.columns.push(colsa);  
                                colsa = new wijmo.grid.Column(); 
                                colsa.binding = 'wcdnm';
                                colsa.header = '불량구분';
                                colsa.width = '*';
                                colsa.align = 'center'; 
                                wbadGrid.columns.push(colsa);  
                                colsa = new wijmo.grid.Column(); 
                                colsa.binding = 'wbqty';
                                colsa.header = '불량수량';
                                colsa.width = '*';
                                colsa.align = 'center';
                                wbadGrid.columns.push(colsa);        
                                
                            },error:function(e){
                                alert(data.code);
                                alert(data.message);
                            }
                        }).done(function(fragment){           

                        })                                         
                    }
 
                //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
                //작업시작
                var button_wfrdt = document.getElementById('wfrdt');
                var button_wtrdt = document.getElementById('wtrdt');
                document.getElementById("wfrdt").addEventListener("click",function(){ 
                        const TIME_ZONE = 3240 * 10000;  
                        const d =  new Date();
                        const date = new Date(+d + TIME_ZONE).toISOString().split('T')[0];
                        const time = d.toTimeString().split(' ')[0];    
                        document.getElementById('startDate').value = date + ' ' + time; 
                        save_btn("1")
                        button_wfrdt.disabled = true;
                        button_wtrdt.disabled = false;
                })

                //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
                //작업종료
                document.getElementById("wtrdt").addEventListener("click",function(){    
                        const TIME_ZONE = 3240 * 10000;  
                        const d =  new Date(); 
                        const date = new Date(+d + TIME_ZONE).toISOString().split('T')[0];
                        const time = d.toTimeString().split(' ')[0]; 
                        document.getElementById('endDate').value = date + ' ' + time;
                        save_btn("0")
                        button_wfrdt.disabled = true;
                        button_wtrdt.disabled = true;
                    })


        }  


        document.getElementById("searchBtn").addEventListener("click",function(){ 
            var ls_searchOrdDate = document.getElementById('searchOrdDate').value;  
            searchList_rtn(ls_searchOrdDate);
        })  
        document.getElementById("newBtn").addEventListener("click",function(){  
            wtab01Grid.columns.clear();  
            wtab01Grid.autoGenerateColumns = false;   
            addlotno = []; 
            lotno = []; 
            prod_qty = []; 
            pname = []; 
            linenm = []; 
            cltnm = [];   
            searchList_rtn("");
        })   
        

        function fnc_calvalue(obj){                            
            ll_inwotqt =  obj.value;                                    //수정 검사량
            if(!ll_inwotqt){
                ll_inwotqt = 0;
            }
            var ll_inwbdqt   = document.getElementById('inwbdqt').value;   //불량수량
            if(!ll_inwbdqt){
                ll_inwbdqt = 0;
            }
            var ll_inwotqt   = ll_inwotqt - ll_inwbdqt ;
            document.getElementById('inwokqt').value = ll_inwotqt;   //완료량
            
        }
        function save_btn(arg1){ 
            //TB_FPLAN_WORK TB_FPLAN_W010  SAVE    
            if(arg1 == "0"){ 
                const TIME_ZONE = 3240 * 10000;  
                const d =  new Date(); 
                const date = new Date(+d + TIME_ZONE).toISOString().split('T')[0];
                const time = d.toTimeString().split(' ')[0]; 
                document.getElementById('endDate').value = date + ' ' + time;
            }
            var ls_custcd   = document.getElementById('incustcd').value; 
            var ls_spjangcd = document.getElementById('inspjangcd').value; 
            var startDate   = document.getElementById('startDate').value; 
            var endDate   = document.getElementById('endDate').value;
            var ls_plan_no   = document.getElementById('inplan_no').value; 
                ls_plan_no = ls_plan_no.trim();
            var ls_inwrmc   = document.getElementById('inwrmc').value;
            var ll_inwinqt  = document.getElementById('inwinqt').value;         //투입
            var ll_inwbdqt  = document.getElementById('inwbdqt').value;         //불량
            var ll_inwotqt = document.getElementById('inwotqt').value;          //검사     
            var ll_inwokqt = document.getElementById('inwokqt').value;          //완료
            var ls_inwflag  = '00020';   
            var ls_inwremark  = document.getElementById('inwremark').value;  
            var ls_inwseq  = document.getElementById('inwseq').value; 
            var ls_inwinps  = document.getElementById('inwinps').value; 
            var ls_inwrps   = document.getElementById('inwrps').value; 
            var ls_inpcode   = document.getElementById('inpcode').value; 
            var ls_inwono   = document.getElementById('inwono').value; 
            
            var button_workstBtn = document.getElementById('workstBtn');
            var button_workedBtn = document.getElementById('workedBtn');
            var button_wfrdt = document.getElementById('wfrdt');
            var button_wtrdt = document.getElementById('wtrdt');
            var button_wrmcBtn = document.getElementById('wrmcBtn');
            var button_wperidBtn = document.getElementById('wperidBtn');
            var button_wotqtyBtn = document.getElementById('wotqtyBtn');
            var button_wbadqtyBtn = document.getElementById('wbadqtyBtn');
            var button_winqtBtn = document.getElementById('winqtBtn');




            if(arg1 == "1" || arg1 == "4"){  //공정시작 작업시작
                button_workstBtn.disabled = true;
                button_workedBtn.disabled = false;
                button_wfrdt.disabled = true;
                button_wtrdt.disabled = false;   
                endDate = "";
                document.getElementById('endDate').value = null;
            }else if(arg1 == "0"){  //공정종료 작업중단
                button_workstBtn.disabled = true;
                button_workedBtn.disabled = true;   
            }else if(arg1 == "2"){  //  작업시작
                button_workstBtn.disabled = true;
                button_workedBtn.disabled = false; 
                endDate = "";
                document.getElementById('endDate').value = null;
            }else{ // 작업중단
                button_workstBtn.disabled = false;
                button_workedBtn.disabled = true; 
                endDate = "";
                document.getElementById('endDate').value = null;
            }   
            if(!ll_inwinqt){
                ll_inwinqt = 0;
            }else{ 
                if(isNaN(ll_inwinqt)){
                    ll_inwinqt = 0;
                }else{
                    ll_inwinqt = Number(ll_inwinqt);
                } 
            } 
            if(!ll_inwbdqt){
                ll_inwbdqt = 0;
            }else{
                if(isNaN(ll_inwbdqt)){
                    ll_inwbdqt = 0;                                                              
                }else{
                    ll_inwbdqt = Number(ll_inwbdqt); 
                
                } 
            }
            if(!ll_inwotqt){
                ll_inwotqt = 0;
            }else{ 
                if(isNaN(ll_inwotqt)){
                    ll_inwotqt = 0;
                }else{
                    ll_inwotqt = Number(ll_inwotqt);
                } 
            }
            if(!ll_inwokqt){
                ll_inwokqt = 0;
            }else{ 
                if(isNaN(ll_inwokqt)){
                    ll_inwokqt = 0;
                }else{
                    ll_inwokqt = Number(ll_inwokqt);
                } 
            }
            if (ll_inwinqt > 0 && ll_inwotqt > 0) {
                ll_wsyul = Math.round( ll_inwotqt / ll_inwinqt )
            }else{
                ll_wsyul = 0;
            } 
            if(!ls_inwinps){
                ls_inwinps = 0;
            }else{ 
                if(isNaN(ls_inwinps)){
                    ls_inwinps = 0;
                }else{
                    ls_inwinps = Number(ls_inwinps);
                } 
            }
            var ls_decision = arg1; 

            if(!endDate)  {endDate = "  "}
            //   console.log(endDate);
            //   공정시작  공정종료 작업중단
            if(arg1 == "0" || arg1 == "1" || arg1 == "4"){
                $.ajax({
                    url: '/input/w020upd',   
                    type:"POST", 
                    data: {
                        "custcd"    : ls_custcd ,
                        "spjangcd"  : ls_spjangcd,
                        "wseq"      : ls_inwseq ,
                        "startDate" : startDate ,
                        "endDate"   : endDate   ,
                        "plan_no"   : ls_plan_no,
                        "wrmc"      : ls_inwrmc      ,
                        "winqt"     : ll_inwinqt     ,
                        "wbdqt"     : ll_inwbdqt     ,
                        "wotqt"     : ll_inwotqt     , 
                        "wsyul"     : ll_wsyul       ,
                        "wflag"     : ls_inwflag     ,
                        "wremark"   : ls_inwremark   ,
                        "wrps"      : ls_inwrps     ,
                        "winps"     : ls_inwinps     ,
                        "decision"  : ls_decision    ,
                        "pcode"     : ls_inpcode     ,
                        "wono"      : ls_inwono     ,
                        "arrplanno"   : plan_no,
                    },
                    async:false,
                    success:function(data){
                         console.log("등록OK", data); 
                        // console.log("wperidGrid_Data", wperidGrid.rows.length ); 
                        const statusdis_div = document.getElementById('statusdis01'); 
                        if(arg1 == "0"){
                            // alert("완료 처리 되었습니다.");
                            button_workstBtn.disabled = true;
                            button_workedBtn.disabled = true;
                            button_wfrdt.disabled = true;
                            button_wtrdt.disabled = true;   
                            button_wrmcBtn.disabled = true;
                            button_wperidBtn.disabled = true;
                            button_wotqtyBtn.disabled = true;
                            button_wbadqtyBtn.disabled = true;
                            var ls_text = "<div style='color:red'><span class='badge badge-soft-danger'>공정 완료</span></div>";                                        
                        }else{
                            // alert("저장되었습니다.");
                            button_workstBtn.disabled = false;
                            button_workedBtn.disabled = false;
                            button_wfrdt.disabled = true;
                            button_wtrdt.disabled = false; 
                            button_wrmcBtn.disabled = false;
                            button_wperidBtn.disabled = false;
                            button_wotqtyBtn.disabled = false;
                            button_wbadqtyBtn.disabled = false; 
                            var ls_text = "<div style='color:red'><span class='badge badge-soft-info'>공정 진행중</span></div>";         
                             
                            $.ajax({
                                    url: '/input/w020iwkupd',   
                                    type:"POST", 
                                    data: {  
                                        "startDate" : startDate , 
                                        "keyplan"     : ls_plan_no     ,  
                                        "plan_no"   : plan_no,
                                        "lotno"      : lotno      ,
                                        "pcode"     : pcode     ,
                                        "prodqty"     : prod_qty     ,
                                        "wflag"     : ls_inwflag     , 
                                    },
                                    async:false,
                                    success:function(data){
                                        console.log("등록OK", data);  
                                },error:function(e){
                                    console.log('error',e);
                                }
                                }).done(function(fragment){           

                                })                              




                        } 
                        statusdis_div.innerHTML  = ls_text;  
                
                },error:function(e){
                    console.log('error',e);
                }
                }).done(function(fragment){           

                })     

            }else{
                $.ajax({
                    url: '/input/wtimeupd',   
                    type:"POST", 
                    data: {
                        "custcd"    : ls_custcd ,
                        "spjangcd"  : ls_spjangcd, 
                        "plan_no"   : ls_plan_no, 
                        "wflag"     : ls_inwflag     , 
                        "decision"  : ls_decision    
                    },
                    async:false,
                    success:function(data){
                        // console.log("등록OK", data); 
                        // console.log("wperidGrid_Data", wperidGrid.rows.length ); 
                        const statusdis_div = document.getElementById('statusdis01'); 
                        if(arg1 == "2"){
                            // alert("완료 처리 되었습니다.");
                            var ls_text = "<div style='color:red'><span class='badge badge-soft-danger'>작업시작</span></div>";                                        
                        }else{
                            // alert("저장되었습니다.");
                            var ls_text = "<div style='color:red'><span class='badge badge-soft-info'>작업중단</span></div>";                                        
                        } 
                        statusdis_div.innerHTML  = ls_text; 
                },error:function(e){
                    console.log('error',e);
                }
                }).done(function(fragment){           

                })     

            }


        }

        function save_fnc(){
            var ls_custcd   = document.getElementById('incustcd').value; 
            var ls_spjangcd = document.getElementById('inspjangcd').value; 
            var ls_plan_no   = document.getElementById('inplan_no').value; 
            var ls_inpcode   = document.getElementById('inpcode').value; 
            var ls_inwono   = document.getElementById('inwono').value; 
            var ls_popwotqt   = document.getElementById('popwotqt').value; 
            var ls_popwbdqt   = 0 ; //document.getElementById('popwbdqt').value;  
            var ls_popwkotDate   = document.getElementById('popwkotDate').value; 
            var ls_popseq   = document.getElementById('popseq').value; 
            var ls_popwseq   = document.getElementById('popwseq').value; 
            var ls_wflag = '00020' 
            if(!ls_popwotqt){
                ls_popwotqt = 0;
            }else{ 
                if(isNaN(ls_popwotqt)){
                    ls_popwotqt = 0;
                }else{
                    ls_popwotqt = Number(ls_popwotqt);
                } 
            } 
            if(ls_popwotqt == 0) {
                alert("검사수량을 입력하세요")
                return 
            }
            if(!ls_popwbdqt){
                ls_popwbdqt = 0;
            }else{ 
                if(isNaN(ls_popwbdqt)){
                    ls_popwbdqt = 0;
                }else{
                    ls_popwbdqt = Number(ls_popwbdqt);
                } 
            } 
            $.ajax({
                url: '/input/oworkupd',   
                type:"POST", 
                data: {
                    "custcd"        : ls_custcd ,
                    "spjangcd"      : ls_spjangcd,
                    "inplan_no"     : ls_plan_no ,
                    "inpcode"       : ls_inpcode ,
                    "inwono"        : ls_inwono   ,
                    "popwotqt"      : ls_popwotqt , 
                    "popwbdqt"      : ls_popwbdqt , 
                    "popwkotDate"   : ls_popwkotDate , 
                    "wflag"         : ls_wflag , 
                    "wseq"          : ls_popwseq,
                    "seq"           : ls_popseq
                },
                async:false,
                success:function(data){
                    // console.log("등록OK", data); 
                    // console.log("wperidGrid_Data", wperidGrid.rows.length ); 
                    const statusdis_div = document.getElementById('statusdis01'); 
                    if(data == "success"){
                        // alert("완료 처리 되었습니다.");
                        searchotqty_fnc();
                    }else{
                        alert("저장중 오류발생");
                        return 
                    }  
                },error:function(e){
                    console.log('error',e);
                }
            }).done(function(fragment){           

            })     


        }   
        
        
        function getCheckboxValue(event)  {
            let result = '';
            if(event.target.checked)  {
                result = event.target.value;  
            }else {
                result = ''; 
            } 
                document.getElementById('delcode').value= result; 
        } 
        function del_fnc()  {
            let result = '';
            result = document.getElementById('delcode').value;
            // alert(result);
            if (!confirm("삭제하시겠습니까?")) {
                return ; 
                } else { 
                    window.location.href = '/appcom01/delete?spcode=' + result; 
            } 
        }       
        function del_btn()  {
            let result = '';
            // result = document.getElementById('spcode').value;
            //  alert(result);
            if (!confirm("삭제하시겠습니까?")) {
                return ; 
                // } else { 
                //     window.location.href = '/appcom01/delete?spcode=' + result; 
            } 
            var ls_plan_no   = document.getElementById('inplan_no').value; 

            if(ls_plan_no == null || ls_plan_no.length == 0 || ls_plan_no == ""){ 
                    alert("삭제할 데이타를 선택하세요") 
                    return ;               
            }     
            $.ajax({
                url: '/appcom01/delete',   
                type:"POST", 
                data: {
                    "plan_no"    : ls_plan_no  
                },
                async:false,
                success:function(data){
                    // console.log("등록OK", data); 
                    
                },error:function(e){
                    console.log('error',e);
                }
            }).done(function(fragment){           

            })  
        }     
        function woworkChk(arg1, arg2, arg3, arg4, arg5  ){ 
            document.getElementById('popwkotDate').value= arg1; 
            document.getElementById('popwotqt').value= arg2; 
            document.getElementById('popwbdqt').value= arg3; 
            document.getElementById('popwseq').value= arg4;  
            document.getElementById('popseq').value= arg5;  
        }
        function selectChk(arg1, arg2, arg3, arg4, arg5 , arg6, arg7, arg8, arg9, arg10, arg11, arg12, arg13, arg14, arg15, arg16 , arg17, arg18, arg19 ){ 
            // /, ctx.item.owqty ,ctx.item.obqty
                //selectChk(custcd, spjangcd, wono, cltnm, pname, 
                //          ostore, plan_no, cltcd, pcode, wseq,
                //            wflag, phmmdoc, otqty, wrpsnm, owqty ,
                //              obqty,winps,wrps,lotno );
            var button_workstBtn = document.getElementById('workstBtn');
            var button_workedBtn = document.getElementById('workedBtn'); 
                button_workstBtn.disabled = false;
                button_workedBtn.disabled = false; 

            document.getElementById('incustcd').value= arg1; 
            document.getElementById('inspjangcd').value= arg2; 
            document.getElementById('inwono').value= arg3; 
            document.getElementById('incltnm').value= arg4;  
            document.getElementById('inpname').value= arg5; 
            document.getElementById('inostore').value= arg6; 
            document.getElementById('inplan_no').value= arg7;
            // document.getElementById('searchPlanno').value= arg7; 
            document.getElementById('incltcd').value= arg8;  
            document.getElementById('inpcode').value= arg9;   
            document.getElementById('inwseq').value= arg10;  
            document.getElementById('inwflag').value= arg11;  
            // document.getElementById('inlotno').value= arg19;  
            
        // document.getElementById('inphmmdoc').value= arg12;  
            wflag = arg11; //document.getElementById('inwflag').value;
            if(!wflag){wflag = "00020";} 
            wrmc = document.getElementById('inwrmc').value; 

            $("#wlistBtn").trigger("click"); 
            // $("#plannoBtn").trigger("click"); 
            
            // 초기화
            var gridrow = wperidGrid.rows.length; 
            for( i=0; i < gridrow; i++){ 
                wperidGrid.rows[i].isSelected = false;
            }

            document.getElementById('inwrmc').value = ""; 
            document.getElementById('inmachname').value = ""; 
            // document.getElementById('inwinqt').value = 0;         //투입량
            document.getElementById('inwotqt').value = 0;         //검사수량   arg15
            document.getElementById('inwbdqt').value = 0;         //불량수량   arg16
            document.getElementById('inwokqt').value = 0;         //완료량     arg13
            document.getElementById('inwremark').value = "";     //비고
            document.getElementById('startDate').value = "";     //
            document.getElementById('endDate').value = "";     //
            // document.getElementById('inwrpsnm').value = arg14;     //  작업자명
            // document.getElementById('inwinps').value = arg17;     //   작업자코드
            // document.getElementById('inwrps').value = arg18;     //     설비코드 
            const wono_div    = document.getElementById('inwonobdg');  
            const wrmc_div       = document.getElementById('inwrmcbdg');
            const wscntdis02_div = document.getElementById('wscntdis02');   
            const wscntdis_div   = document.getElementById('wscntdis01'); 
            wono_div.innerHTML     = "";    
            wrmc_div.innerHTML     = "";    
            wscntdis02_div.innerHTML  = "";    
            wscntdis_div.innerHTML = "";    
            $.ajax({
                url: '/input/w020',   
                type:"POST", 
                data: {
                    "custcd"    : arg1,
                    "spjangcd"  : arg2,
                    "wono"      : arg3,
                    "cltnm"     : arg4,
                    "pname"     : arg5,
                    "ostore"    : arg6,
                    "plan_no"   : arg7,
                    "wflag"     : wflag,
                    "wrmc"      : wrmc
                },
                async:false,
                success:function(data){
                    //  console.log("등록OK", data); 
                    // console.log("wperidGrid_Data", wperidGrid.rows.length );
                    gridrow = wperidGrid.rows.length;                                    
                    for( i=0; i < gridrow; i++){
                            ls_wperid =  wperidGrid.rows[i]._data.wperid; 
                            if(!ls_wperid ){continue;}  
                            for(h = 0; h < data.length; h++){
                                chk_wperid = data[h].perid;   
                                if(ls_wperid == chk_wperid){
                                // console.log("chk_wperid", chk_wperid); 
                                wperidGrid.rows[i].isSelected = true;
                                }
                            } 
                    }

                },error:function(e){
                    console.log('error',e);
                }
            }).done(function(fragment){           

            })                           
                
            // 사출완료 상단 리스트
            $.ajax({
                url: '/input/SELW020',   
                type:"POST", 
                data: {
                    "custcd"    : arg1,
                    "spjangcd"  : arg2, 
                    "plan_no"   : arg7,
                    "wflag"     : wflag 
                },
                async:false,
                success:function(data){ 
                    if(data.length == 0){ 
                        return 
                    }
                    inwrmc      =  data.wrmc;   
                    inmachname  =  data.machname;   
                    inwinqt     =  data.winqt;   
                    inwotqt     =  data.wotqt;   
                    inwbdqt     =  data.wbdqt;   
                    inwokqt     =  data.wotqt - data.wbdqt;    
                    inwremark   =  data.wremark;                                      
                    decision    =  data.decision;  
                    startDate   =  data.wfrdt;  
                    endDate     =  data.wtrdt;  
                    wrpsnm      =  data.wrpsnm;
                    document.getElementById('inwrmc').value = inwrmc; 
                    document.getElementById('inmachname').value = inmachname; 
                    document.getElementById('inwinqt').value = inwinqt;         //투입량
                    // document.getElementById('inwotqt').value = inwotqt;         //완료량
                    // document.getElementById('inwbdqt').value = inwbdqt;         //불량수량
                    // document.getElementById('inwokqt').value = inwokqt;         //검사수량
                    document.getElementById('inwremark').value = inwremark;     //비고
                    document.getElementById('startDate').value = startDate;     //
                    document.getElementById('endDate').value = endDate;     //
                    document.getElementById('inwrpsnm').value = wrpsnm;     //
                    var button_workstBtn = document.getElementById('workstBtn');
                    var button_workedBtn = document.getElementById('workedBtn');
                    var button_wfrdt = document.getElementById('wfrdt');
                    var button_wtrdt = document.getElementById('wtrdt');
                    var button_wrmcBtn = document.getElementById('wrmcBtn');
                    var button_wperidBtn = document.getElementById('wperidBtn');
                    var button_wotqtyBtn = document.getElementById('wotqtyBtn');
                    var button_wbadqtyBtn = document.getElementById('wbadqtyBtn'); 

                    const statusdis_div = document.getElementById('statusdis01');  
                    if (decision == "1"){  
                            button_workstBtn.disabled = false;
                            button_workedBtn.disabled = false;
                            button_wfrdt.disabled = true;
                            button_wtrdt.disabled = false; 
                            button_wrmcBtn.disabled = false;
                            button_wperidBtn.disabled = false;
                            button_wotqtyBtn.disabled = false;
                            button_wbadqtyBtn.disabled = false; 
                        var ls_text = "<div style='color:red'><span class='badge badge-soft-info'>공정 진행중</span></div>";
                    }else if(decision == "0"){
                            button_workstBtn.disabled = true;
                            button_workedBtn.disabled = true;
                            button_wfrdt.disabled = true;
                            button_wtrdt.disabled = true;   
                            button_wrmcBtn.disabled = true;
                            button_wperidBtn.disabled = true;
                            button_wotqtyBtn.disabled = true;
                            button_wbadqtyBtn.disabled = true; 
                        var ls_text = "<div style='color:red'><span class='badge badge-soft-danger'>공정 완료</span></div>";
                    }else{
                            button_workstBtn.disabled = false;
                            button_workedBtn.disabled = false;
                            button_wfrdt.disabled = false;
                            button_wtrdt.disabled = false;  
                            button_wrmcBtn.disabled = false;
                            button_wperidBtn.disabled = false;
                            button_wotqtyBtn.disabled = false;
                            button_wbadqtyBtn.disabled = false; 
                        var ls_text = "<div style='color:red'><span class='badge badge-soft-primary'>작업지시리스트 선택</span></div>";
                    }
                    statusdis_div.innerHTML  = ls_text;   
                    return  false  
                    // console.log("wperidGrid_Data", wperidGrid.rows.length ); 

                },error:function(e){
                    console.log('error',e);
                }
            }).done(function(fragment){           

            })  
            //검사량 조회
            searchotqty_fnc()

        }  

        function wrmcChk(arg1, arg2  ){   
            document.getElementById('inwrmc').value= arg1; 
            document.getElementById('inmachname').value= arg2; 

            arg3 = document.getElementById('incustcd').value; 
            arg4 = document.getElementById('inspjangcd').value;  
            wflag = document.getElementById('inwflag').value;
            plan_no = document.getElementById('inplan_no').value;
            if(!wflag){ wflag = "00020"; } 
            $("#wlistBtn").trigger("click"); 
            // $("#plannoBtn").trigger("click"); 
            // console.log("WRMC UPDATE");
            
            $.ajax({
                url: '/input/w010wrmc',   
                type:"POST", 
                data: {
                    "custcd"    : arg3,
                    "spjangcd"  : arg4, 
                    "plan_no"   : plan_no,
                    "wflag"     : wflag,
                    "wrmc"      : arg1
                },
                async:false,
                success:function(data){
                    //  console.log("작업설비등록", data); 
                },error:function(e){
                    console.log('error',e);
                }
            }).done(function(fragment){           

            })  

            // var wrmcmodal_btn = document.getElementById('wrmcmodal_btn');

            $("#wrmcmodal_btn").trigger("click"); 
        }
        function wperidChk(arg1, arg2  ){   
                document.getElementById('inwrps').value= arg1; 
                document.getElementById('inwrpsnm').value= arg2;   
                $("#wperidmodal_btn").trigger("click"); 
        }
        function searchList_rtn(arg){ 
            var ls_searchdate = arg;   
            if(addlotno.length > 0){
                addlotno = addlotno + ',' + ls_searchdate;
            }else{
                addlotno =  ls_searchdate ;
            }
 
            if(ls_searchdate == null || ls_searchdate.length == 0 || ls_searchdate == ""){ 
                $.ajax({
                url: '/input/w020ordlist',  
                type:"POST",
                data: { 
                    "lotno"      : ls_searchdate,  
                }, 
                async:false,
                success:function(data){ 
                        var ListDto = data;  
                        var dataArr = [];
                        var cnt = 1; 
                        for (var i = 0; i < ListDto.length; i++) {
                            var psdate = ListDto[i]["prod_sdate"];
                            psdate = psdate.substr(0,4) + '-' + psdate.substr(4,2)+ '-' + psdate.substr(6,2);
                            var date_format = new Date(psdate);  //wijmo.DateTime.addDays(date_format, 0),
                            dataArr.push({
                                id: i, 
                                index: cnt,                                                                
                                prod_sdate: psdate, 
                                wono: ListDto[i]["wono"], 
                                cltnm: ListDto[i]["cltnm"], 
                                pname: ListDto[i]["pname"], 
                                psize: ListDto[i]["psize"], 
                                prod_qty: ListDto[i]["prod_qty"],
                                winqt: ListDto[i]["winqt"] , 
                                wotqt: ListDto[i]["wotqt"] ,     
                                decision: ListDto[i]["decision"] ,    
                                plan_no: ListDto[i]["plan_no"] ,
                                ostore: ListDto[i]["ostore"] ,
                                custcd: ListDto[i]["custcd"] ,
                                spjangcd: ListDto[i]["spjangcd"] ,
                                cltcd: ListDto[i]["cltcd"] ,
                                wseq: ListDto[i]["wseq"]  ,
                                pcode: ListDto[i]["pcode"] ,
                                wflag: ListDto[i]["wflag"] ,
                                wremark: ListDto[i]["wremark"] ,
                                phmmdoc: ListDto[i]["phmmdoc"]  ,
                                owqty: ListDto[i]["owqty"] ,
                                obqty: ListDto[i]["obqty"] ,
                                otqty: ListDto[i]["otqty"] ,
                                wrpsnm: ListDto[i]["wrpsnm"]  ,
                                winps: ListDto[i]["winps"]  ,
                                wrps: ListDto[i]["wrps"]  ,
                                lotno: ListDto[i]["lotno"] 
                            });
                            cnt++;
                        }  
                        
                        sachul_list(dataArr)

                    },error:function(e){
                        console.log("error");
                        // alert(data.code);
                        // alert(data.message);
                    }
                }).done(function(fragment){           

                })                                  
            }else{
                $.ajax({
                url: '/input/w020ordlist',  
                type:"POST",
                data: { 
                    "lotno"      : addlotno,  
                }, 
                async:false,
                success:function(data){ 
                        var ListDto = data; 
                        // console.log("ListDto : ", ListDto);
                        var dataArr = [];
                        var cnt = 1; 
                        for (var i = 0; i < ListDto.length; i++) {
                            var psdate = ListDto[i]["prod_sdate"];
                            psdate = psdate.substr(0,4) + '-' + psdate.substr(4,2)+ '-' + psdate.substr(6,2);
                            var date_format = new Date(psdate);  //wijmo.DateTime.addDays(date_format, 0),
                            dataArr.push({
                                id: i, 
                                index: cnt,                                                                
                                prod_sdate: psdate, 
                                wono: ListDto[i]["wono"], 
                                cltnm: ListDto[i]["cltnm"], 
                                pname: ListDto[i]["pname"], 
                                psize: ListDto[i]["psize"], 
                                prod_qty: ListDto[i]["prod_qty"],
                                winqt: ListDto[i]["winqt"] , 
                                wotqt: ListDto[i]["wotqt"] ,     
                                decision: ListDto[i]["decision"] ,    
                                plan_no: ListDto[i]["plan_no"] ,
                                ostore: ListDto[i]["ostore"] ,
                                custcd: ListDto[i]["custcd"] ,
                                spjangcd: ListDto[i]["spjangcd"] ,
                                cltcd: ListDto[i]["cltcd"] ,
                                wseq: ListDto[i]["wseq"]  ,
                                pcode: ListDto[i]["pcode"] ,
                                wflag: ListDto[i]["wflag"] ,
                                wremark: ListDto[i]["wremark"] ,
                                phmmdoc: ListDto[i]["phmmdoc"]  ,
                                owqty: ListDto[i]["owqty"] ,
                                obqty: ListDto[i]["obqty"] ,
                                otqty: ListDto[i]["otqty"] ,
                                wrpsnm: ListDto[i]["wrpsnm"]  ,
                                winps: ListDto[i]["winps"]  ,
                                wrps: ListDto[i]["wrps"]  ,
                                lotno: ListDto[i]["lotno"] 
                            });
                            cnt++;
                        }  
                        
                        sachul_list(dataArr)

                    },error:function(e){
                        console.log("error");
                        // alert(data.code);
                        // alert(data.message);
                    }
                }).done(function(fragment){           

                })                   
            }    

        }        

        function sachul_list(dataArr){

                    // wtab01Grid.columns.clear();  
                    wtab01Grid.autoGenerateColumns = false; 
                    view_flistpage.sourceCollection  = dataArr;
                    var cols = new wijmo.grid.Column(); 
                    cols.binding = 'prod_sdate';
                    cols.header = '일자';
                    cols.align = "center";
                    cols.width = 120 ; 
                    wtab01Grid.columns.push(cols);   
                    cols = new wijmo.grid.Column(); 
                    cols.binding = 'lotno';
                    cols.header = 'LotNo';
                    cols.align = "center";
                    cols.cellTemplate = wijmo.grid.cellmaker.CellMaker.makeLink({ 
                        text: '<b>${item.lotno}</b>',
                        click: (e, ctx) => {
                            selectChk(ctx.item.custcd, ctx.item.spjangcd, ctx.item.wono, ctx.item.cltnm, ctx.item.pname, ctx.item.ostore, ctx.item.plan_no, ctx.item.cltcd, ctx.item.pcode, ctx.item.wseq, ctx.item.wflag, ctx.item.phmmdoc , ctx.item.otqty , ctx.item.wrpsnm, ctx.item.owqty ,ctx.item.obqty,ctx.item.winps,ctx.item.wrps,ctx.item.lotno );
                        }
                    });
                    cols.width = 150 ; 
                    wtab01Grid.columns.push(cols);  
                    cols = new wijmo.grid.Column(); 
                    cols.binding = 'wono';
                    cols.header = '작지번호';
                    cols.align = "center";
                    cols.width = 150 ; 
                    wtab01Grid.columns.push(cols);  
                    // cols = new wijmo.grid.Column(); 
                    // cols.binding = 'cltnm';
                    // cols.header = '거래처';
                    // cols.align = "center";
                    // cols.width = 100 ; 
                    // wtab01Grid.columns.push(cols);  
                    // cols = new wijmo.grid.Column(); 
                    // cols.binding = 'pcode';
                    // cols.header = '품목코드';
                    // cols.align = "center";
                    // cols.width = '2*' ;  
                    // wtab01Grid.columns.push(cols);  
                    cols = new wijmo.grid.Column(); 
                    cols.binding = 'pname';
                    cols.header = '품목명';
                    cols.align = "center";
                    cols.width = 130 ; 
                    wtab01Grid.columns.push(cols);  
                    // cols = new wijmo.grid.Column(); 
                    // cols.binding = 'phmmdoc';
                    // cols.header = '도면번호';
                    // cols.align = "center";
                    // cols.width = '2*' ;  
                    // wtab01Grid.columns.push(cols);  
                    cols = new wijmo.grid.Column(); 
                    cols.binding = 'psize';
                    cols.header = '규격';
                    cols.align = "center";
                    cols.width = 100 ; 
                    wtab01Grid.columns.push(cols);  
                    cols = new wijmo.grid.Column(); 
                    cols.binding = 'prod_qty';
                    cols.header = '계획량';
                    cols.align = "center";
                    cols.width = 100 ; 
                    wtab01Grid.columns.push(cols);  

            
        }

        //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
        //검사량 조회 

        document.getElementById("popsearch01").addEventListener("click",function(){
            searchotqty_fnc()
        })    

        function searchotqty_fnc(){
            var ls_plan_no   = document.getElementById('inplan_no').value; 
            var ls_inpcode   = document.getElementById('inpcode').value; 
            var ls_inwono   = document.getElementById('inwono').value; 
            var ls_wflag = '00020' 


            if(ls_plan_no == null || ls_plan_no.length == 0 || ls_plan_no == ""){ 
                    alert("작업지시서를 선택 하세요")  
                    return ;               
            }     

            $.ajax({
                url: '/popup/oworklist',  
                type:"POST",
                data: {
                    "plan_no" : ls_plan_no,
                    "inpcode" : ls_inpcode ,
                    "inwono" : ls_inwono ,
                    "wflag" : ls_wflag ,
                },
                success:function(data){
                    var wrmcDto  = data;  
                    var wrmc_data = [];
                    var cnt = 1;
                    var ll_totwqty = 0;
                    var ll_totbqty = 0;
                    var ll_totqty = 0;
                    var rowcnt = wrmcDto.length; 
                    if(rowcnt  == null || rowcnt == 0){ 
                        for (var i = 0; i < 10; i++) {
                            wrmc_data.push({
                                id: i, 
                                index: cnt,
                                plan_no: "",
                                wseq: "",
                                seq: "",
                                pcode: "",
                                pname:  "",
                                pgugek: "",
                                wotdt: 0,
                                wqty: 0,
                                bqty: 0,
                                qty: 0  
                            });
                            cnt++;
                        }  

                    }else{
                        for (var i = 0; i < wrmcDto.length; i++) {
                            wrmc_data.push({
                                id: i, 
                                index: cnt,
                                plan_no:wrmcDto[i]["plan_no"],
                                wseq:wrmcDto[i]["wseq"],
                                seq:wrmcDto[i]["seq"],
                                pcode:wrmcDto[i]["pcode"],
                                pname: wrmcDto[i]["pname"], 
                                pgugek: wrmcDto[i]["psize"],
                                wotdt: wrmcDto[i]["wotdt"],
                                wqty: wrmcDto[i]["wqty"],
                                bqty: wrmcDto[i]["bqty"],
                                qty: wrmcDto[i]["qty"],                                          
                            });
                            cnt++;
                            if(!isNaN(wrmcDto[i]["wqty"])){ 
                                ll_totwqty = ll_totwqty + wrmcDto[i]["wqty"];
                            }
                            if(!isNaN(wrmcDto[i]["bqty"])){ 
                                ll_totbqty = ll_totbqty + wrmcDto[i]["bqty"];
                            }
                            if(!isNaN(wrmcDto[i]["qty"])){ 
                                ll_totqty = ll_totqty + wrmcDto[i]["qty"];
                            }  
                        //    console.log('bqty->' + wrmcDto[i]["bqty"]) ;
                        }  
                    }    
                    document.getElementById('inwotqt').value = ll_totwqty; 
                    ll_totbqty = document.getElementById('inwbdqt').value; 
                    document.getElementById('inwokqt').value = ll_totwqty - ll_totbqty; 

                    wotqtGrid.columns.clear();   
                    wotqtGrid.autoGenerateColumns = false; 
                    view_wotqtpage.sourceCollection  = wrmc_data; 
                    // var cols = new wijmo.grid.Column(); 
                    // cols.binding = 'pcode';
                    // cols.header = '품목코드';
                    // cols.width = 150;
                    // wotqtGrid.columns.push(cols);  
                    var cols = new wijmo.grid.Column(); 
                    cols.binding = 'pname';
                    cols.header = '품명';
                    cols.width = 150;
                    wotqtGrid.columns.push(cols);  
                    cols = new wijmo.grid.Column(); 
                    cols.binding = 'pgugek';
                    cols.header = '규격';
                    cols.width = 150;
                    wotqtGrid.columns.push(cols);  
                    cols = new wijmo.grid.Column(); 
                    cols.binding = 'wotdt';
                    cols.header = '검사일자';
                    cols.width = 120;
                    cols.cellTemplate = wijmo.grid.cellmaker.CellMaker.makeLink({ 
                        text: '<b>${item.wotdt}</b>',
                        click: (e, ctx) => {
                            woworkChk(ctx.item.wotdt, ctx.item.wqty, ctx.item.bqty, ctx.item.wseq, ctx.item.seq);
                        }
                    });
                    wotqtGrid.columns.push(cols);    
                    // console.log("cols", cols);  
                    cols = new wijmo.grid.Column(); 
                    cols.binding = 'wqty';
                    cols.header = '검사량';
                    cols.width = 80;
                    cols.align = "right";
                    cols.cellTemplate = wijmo.grid.cellmaker.CellMaker.makeLink({ 
                        text: '<b>${item.wqty}</b>',
                        click: (e, ctx) => {
                            woworkChk(ctx.item.wotdt, ctx.item.wqty, ctx.item.bqty, ctx.item.wseq, ctx.item.seq);
                        }
                    });
                    wotqtGrid.columns.push(cols);  
                    // cols = new wijmo.grid.Column(); 
                    // cols.binding = 'bqty';
                    // cols.header = '불량';
                    // cols.width = 80;
                    // cols.align = "right";
                    // wotqtGrid.columns.push(cols);  
                    cols = new wijmo.grid.Column(); 
                    cols.binding = 'qty';
                    cols.header = '제품량';
                    cols.width = 80;
                    cols.align = "right";
                    wotqtGrid.columns.push(cols);  

                    
                    // document.getElementById('popwkotDate').value= ""; 
                    document.getElementById('popwotqt').value= ""; 
                    // document.getElementById('popwbdqt').value= ""; 
                    document.getElementById('popwseq').value= "";  
                    document.getElementById('popseq').value= "";  
                },error:function(e){
                    alert(data.code); 
                }
            }).done(function(fragment){           

            }) 
        }



        $(document).ready(function() {
            //fn_egov_init_date()
            getToday()
            // $('datetimepicker').datetimepicker({
                
            // }); 

            // $("#startDate").change(function(e){ 
            //     console.log("달력클릭");
            //     console.log(convert_time(e.timestamp));
            // })

        })

        function convert_time(timestamp){ 
            //현재시간
            var date = new Date(timestamp); 
            var year = date.getFullYear();
            var month = ("0" + (1 + date.getMonth())).slice(-2);
            var day = ("0" + date.getDate()).slice(-2); 
            var hh = date.getHours();  
            var min = ('0' + date.getMinutes()).slice(-2) 
            // console.log('year',year); 
            // console.log('month',month); 
            // console.log('day',day); 
            // console.log('hh',hh); 
            // console.log('min',min); 
            time = year +  month +  day + ' ' + hh + ':' + min ;
            return time;  
        }
        
        function getToday(){
            let today = new Date();

            let year = today.getFullYear(); // 년도
            let month = today.getMonth() + 1;  // 월
            let date = today.getDate();  // 날짜
            let day = today.getDay();  // 요일
            if(date > 0 && date < 10) {date = "0" + date};
            if(month > 0 && month < 10) {month = "0" + month};
            let ls_frday = year + '-' + month + '-01'
            let ls_today = year + '-' + month + '-' + date
            console.log(ls_today); 
            document.getElementById('popwkotDate').value = ls_today;
            // document.getElementById('searchOrdDate').value = ls_today; 
        }


        function fn_egov_init_date(){ 
            var $startDate = $('#startDate');
            var $endDate = $('#endDate');
            // var $searchOrdDate = $('#searchOrdDate');
            var $popwkotDate = $('#popwkotDate');
            
            $startDate.datetimepicker({
                timepicker: true,
                lang: 'ko',
                format: 'Y-m-d H:i',
                scrollMonth: false,
                scrollInput: false,
                onShow: function (ct) {                                    
                    this.setOptions({
                        maxDate: $endDate.val() ? $endDate.val() : false
                    })
                },
            });

            $endDate.datetimepicker({
                timepicker: true,
                lang: 'ko',
                format: 'Y-m-d H:i',
                scrollMonth: false,
                scrollInput: false,
                onShow: function (ct) {
                    this.setOptions({
                        minDate: $startDate.val() ? $startDate.val() : false
                    })
                }
            });

            // $searchOrdDate.datetimepicker({
            //     timepicker: false,
            //     lang: 'ko',
            //     format: 'Y-m-d',
            //     scrollMonth: false,
            //     scrollInput: false,
            //     onShow: function (ct) {
            //         this.setOptions({
            //             // minDate: $searchOrdDate.val() ? $searchOrdDate.val() : false
            //         })
            //     }
            // });

            $popwkotDate.datetimepicker({
                timepicker: false,
                lang: 'ko',
                format: 'Y-m-d',
                scrollMonth: false,
                scrollInput: false,
                onShow: function (ct) {
                    this.setOptions({
                        // minDate: $searchOrdDate.val() ? $searchOrdDate.val() : false
                    })
                }
            });

            
            

        }
    </script>                    
                </div>
            </div>
        </main>
    </div>
</header>