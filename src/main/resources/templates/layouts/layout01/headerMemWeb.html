<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">  
<header th:fragment="headerFragment">
   <!-- <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>   -->
    <!-- 차트  -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <div class="card-body d-flex align-items-center py-md-2 px-2 py-1">      
    <main class="main" id="top">
        <!-- Fluid Layout:  Replace class .container to .container-fluid inside the main tag, and the page will be switched to fluid layout. -->
        <div class="container-fluid"> 
            <!-- <div class="container" data-layout="container"> -->
                <script>
                    var isFluid = JSON.parse(localStorage.getItem('isFluid'));
                    if (isFluid) {
                        var container = document.querySelector('[data-layout]');
                        container.classList.remove('container');
                        container.classList.add('container-fluid');
                    }
                </script>
                <nav class="navbar navbar-light navbar-vertical navbar-expand-xl">
                    <script>
                        var navbarStyle = localStorage.getItem("navbarStyle");
                        if (navbarStyle && navbarStyle !== 'transparent') {
                            document.querySelector('.navbar-vertical').classList.add(`navbar-${navbarStyle}`);
                        }
                    </script>
                    <div class="d-flex align-items-center">
                        <div class="toggle-icon-wrapper">

                            <button class="btn navbar-toggler-humburger-icon navbar-vertical-toggle"
                                data-bs-toggle="tooltip" data-bs-placement="left" title="Toggle Navigation"><span
                                    class="navbar-toggle-icon"><span class="toggle-line"></span></span></button>

                        </div><a class="navbar-brand" href="@{/user}">
                            <!-- <div class="d-flex align-items-center py-3"><img class="me-2"
                                    th:src="@{assets/img/icons/spot-illustrations/falcon.png}" alt="" width="40" /><span
                                    class="font-sans-serif">ActasErp</span>
                            </div> -->
                        </a>
                    </div>  
                    <!------navbar vertical------>     
                    <div th:replace="layouts/layout01/navbarMemWeb :: navbar"></div>  
                </nav>
                <div class="content">  
                    <!------nav ------>     
                    <!-- <div th:replace="layouts/layout01/headerNavWeb :: headerNav"></div>    -->
                    <!------contents ------>    
                    <!-- <div class="container">contents display</div> -->
                    <!-- <div th:replace="layouts/XDashBoard/dashboard001 :: dashboard001"></div>   -->
                    <!-- 
                        content fragment 사용 
                        현재 layout을 사용하는 content fragment의 내용을 삽입한다.
                    -->
                    <body layout:fragment="content">
                      <div class="card-body bg-light">
                        <ul class="nav nav-tabs">
                            <li class="nav-item">
                                <a class="nav-link active" data-toggle="tab" href="#step01" onclick="tabchk_rtn('A')">실시간현황</a>
                            </li>
                            <!-- <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#step02"  onclick="tabchk_rtn('B')">검사공정</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#step03"  onclick="tabchk_rtn('C')">검사이력현황</a>
                            </li> -->
                            <input type="hidden" id="tabvalue" value="A">
                        </ul>
                          <div class="tab-content">
                            <div class="tab-pane fade show active" id="step01">     
                                <div class="row gx-3" style="  margin: 10px 10px 10px;">    
                                    <div class="col-auto">
                                        <div class="input-group input-group-sm mb-3">
                                            <input type="text"  class="form-control datetimepicker" id="frdate" autocomplete="off"  placeholder="Y-m-d"     >
                                        </div> 
                                    </div>   
                                    <div class="col-auto"> 
                                        <div class="input-group input-group-sm mb-3"> 
                                            <input type="text"  class="form-control datetimepicker" id="todate" autocomplete="off"  placeholder="Y-m-d"     >
                                        </div>
                                    </div> 
                                    <div class="col-2 col-sm-2">
                                        <div class="input-group input-group-sm mb-3"><span class="input-group-text" id="inputGroup-sizing-sm">기계이름</span>  
                                            <input class="form-control form-control-sm" id="pname" type="text"    autocomplete="off"  placeholder=""> 
                                            <input class="form-control form-control-sm" id="pcode" type="hidden"    autocomplete="off"  placeholder=""> 
                                        </div>
                                    </div> 
                                    <div class="col-2 col-sm-2">
                                        <div class="input-group input-group-sm mb-3"><span class="input-group-text" id="inputGroup-sizing-sm">금형자료</span>  
                                            <input class="form-control form-control-sm" id="ecltnm" type="text"    autocomplete="off"  placeholder="">
                                            <input class="form-control form-control-sm" id="acorp1" type="hidden"  />
                                            <input class="form-control form-control-sm" id="acorp2" type="hidden"  />
                                            <input class="form-control form-control-sm" id="acorp3" type="hidden"  />
                                            <input class="form-control form-control-sm" id="acode" type="hidden"  />  
                                        </div>
                                    </div> 
                                    <div class="col-auto">  
                                        <button class="btn btn-falcon-danger me-1 mb-1 btn-sm" type="button"  id="retrieveBtn" >조회
                                        </button> 
                                    </div>   
                                </div> 
                                <div class="container-fluid">   
                                    <div id="wtab01Grid_div" style="overflow:scroll;   height:300px; width: 90%;    margin:0 auto; "></div> 
                                    <!-- <div id="tab01Pager"></div> -->
                                </div>  
                                <!-- 스타일로 캔버스 크기를 조정 -->
                                <div style="width: 100%; margin: 0 auto;">
                                  <canvas id="temperatureChart" style="width: 100%; height: 400px;"></canvas>
                                </div>
                                <!-- <div class="container-fluid">
                                  <div id="chart"></div>
                                </div>   -->
                            </div> 
        
                          </div>
                    </div> 

                    </body>

                    <!------footer ------>    
                    <!-- <footer th:replace="layouts/layout01/XDashBoard_footer :: XDashBoard_footer"></footer>     -->
                    <!--------------------->
                </div> 
        </div>
    </main>
    <script> 

    window.onload = function() {   
        var view_p01tab01page;
        var view_p01tab02page;
        var view_p01tab03page; 
        var view_p01tab04page; 
        var wtab01Grid;
        var wtab02Grid;
        var wtab03Grid; 
        var wtab04Grid;   
       //실시간현황
       view_p01tab01page = new wijmo.collections.CollectionView(getData_tab01(), { 
        }); 
        wtab01Grid = new wijmo.grid.FlexGrid('#wtab01Grid_div', {  
            autoGenerateColumns: false,
            showMarquee: true,
            isReadOnly: true,  
            allowSorting: 'MultiColumn',
            alternatingRowStep: 0,
            columns: [     
                { binding: 'shottime', header: '시간', align: "center" ,  width: 120 },           
                { binding: 'machine_name', header: '기계', align: "center",  width: 50  }, 
                { binding: 'Additional_Info_1', header: '금형', align: "left",  width: 200  }, 
                { binding: 'Shot_Number', header: '공정횟수', align: "right",  width: 80  },  
                { binding: 'Injection_Time', header: '사출시간', align: "right", format: 'n1',  width: 80  },   
                { binding: 'Filling_Time', header: '출진시간', align: "center", width: 80 },
                { binding: 'Plasticizing_Time', header: '계량시간', align: "right", format: 'n1',  width: 80  },  
                { binding: 'Cycle_Time', header: '공정시간', align: "center", width: 80 },
                { binding: 'Barrel_Temperature_1', header: '연장노즐', align: "right", format: 'n1',  width: 80  },  
                { binding: 'Barrel_Temperature_2', header: '노즐', align: "right", format: 'n1',  width: 80  },  
                { binding: 'Mold_Temperature_1', header: '금형온도(1)', align: "right", format: 'n1',  width: 110  },   
                { binding: 'Mold_Temperature_2', header: '금형온도(2)', align: "right", format: 'n1',  width: 110  }, 
                { binding: 'Mold_Temperature_3', header: '금형온도(3)', align: "right", format: 'n1',  width: 110  }, 
                { binding: 'Mold_Temperature_4', header: '금형온도(4)', align: "right", format: 'n1' ,  width: 110 }, 
                { binding: 'Mold_Temperature_5', header: '금형온도(5)', align: "right", format: 'n1',  width: 110  }, 
                { binding: 'Mold_Temperature_6', header: '금형온도(6)', align: "right", format: 'n1',  width: 110  },   
            ], 
            itemsSource: view_p01tab01page
        });   
        
        new FlexGridContextMenu(wtab01Grid);  
        setHeaderColumn(false);
        function setHeaderColumn(headerOn) {
            wtab01Grid.headersVisibility = headerOn
            ? wijmo.grid.HeadersVisibility.All
            : wijmo.grid.HeadersVisibility.Column; 
        } 
         // tab01검색 데이터 수집
       function getData_tab01(){  
            var ls_frdate = "";
            var ls_todate = "";
            var ls_machnm = "";
            var ls_addinfo = "";   
            var wactnm_data = [];          
            var cnt = 1;    
            $.ajax({
                    url: '/appcms/reallist',   
                    type:"POST", 
                    data: {
                        "frdate" : ls_frdate , 
                        "todate" : ls_todate , 
                        "machnm" : ls_machnm , 
                        "addinfo" : ls_addinfo
                    },
                    async:false,
                    success:function(data){   
                            var wtab01Dto = data; 
                            rowCount = data.length;   
                          console.log(data) 
                            for (var i = 0; i < rowCount; i++) {
                                    wactnm_data.push({ 
                                        index: cnt,
                                        machine_name: wtab01Dto[i]["machine_name"], 
                                        Additional_Info_1: wtab01Dto[i]["additional_Info_1"], 
                                        Shot_Number: wtab01Dto[i]["shot_Number"], 
                                        Injection_Time: wtab01Dto[i]["injection_Time"], 
                                        Filling_Time: wtab01Dto[i]["filling_Time"], 
                                        Plasticizing_Time: wtab01Dto[i]["plasticizing_Time"], 
                                        Cycle_Time: wtab01Dto[i]["cycle_Time"], 
                                        Barrel_Temperature_1: wtab01Dto[i]["barrel_Temperature_1"], 
                                        Barrel_Temperature_2: wtab01Dto[i]["barrel_Temperature_2"], 
                                        Mold_Temperature_1: wtab01Dto[i]["mold_Temperature_1"], 
                                        Mold_Temperature_2: wtab01Dto[i]["mold_Temperature_2"], 
                                        Mold_Temperature_3: wtab01Dto[i]["mold_Temperature_3"], 
                                        Mold_Temperature_4: wtab01Dto[i]["mold_Temperature_4"], 
                                        Mold_Temperature_5: wtab01Dto[i]["mold_Temperature_5"], 
                                        Mold_Temperature_6: wtab01Dto[i]["mold_Temperature_6"],
                                        Cavity: wtab01Dto[i]["cavity"],  
                                        TimeStamp: wtab01Dto[i]["timeStamp"], 
                                        shottime: wtab01Dto[i]["shottime"], 
                                        shotdate: wtab01Dto[i]["shotdate"],      
                                        
                                    });
                                    cnt++;
                              }  
                    },error:function(e){
                        console.log('error',e);
                    }
                }).done(function(fragment){           
                })      
                return wactnm_data;                                     
       } 
 
      //  let linechart = new wijmo.chart.FlexChart('#chart', {
      //       header: '기계: 1 금형자료 : GN7_B_RH',
      //       legend: {
      //         position: wijmo.chart.Position.Bottom
      //       },
      //       chartType: wijmo.chart.ChartType.Line,
      //       bindingX: 'month',
      //       series: [{
      //         binding: 'mt01',
      //         name: 'Mold_T_1'
      //       }, {
      //         binding: 'mt02',
      //         name: 'Mold_T_2'
      //       }, {
      //         binding: 'mt03',
      //         name: 'Mold_T_3'
      //       }, {
      //         binding: 'mt04',
      //         name: 'Mold_T_4'
      //       }, {
      //         binding: 'mt05',
      //         name: 'Mold_T_5'
      //       }, {
      //         binding: 'mt06',
      //         name: 'Mold_T_6'
      //       }],
      //       axisY: {
      //         title: '금형온도(°C)'
      //       },
      //       itemsSource: getData(),
      //       palette: ['#F3722C', '#577590', '#F8961E', '#F94144', '#90BE6D', '#F9C74F', '#43AA8B', ]
      //     });
      //     //
      //     let ani = new wijmo.chart.animation.ChartAnimation(linechart);
      //     ani.animationMode = wijmo.chart.animation.AnimationMode.Point;
     

      //   function getData() {
      //     return [
      //       { month: '21:23:54', mt01: 28.2, mt02: 28, mt03: 30.3, mt04: 30.5, mt05: 62.8, mt06: 0 },
      //       { month: '21:23:16', mt01: 28.1, mt02: 28, mt03: 30.2, mt04: 30.4, mt05: 62.6, mt06: 0  },
      //       { month: '21:22:38', mt01: 28, mt02: 28, mt03: 30.3, mt04:30.5, mt05: 62.6, mt06: 0  },
      //       { month: '21:22:01', mt01: 28.1, mt02: 28.1, mt03: 30.4, mt04: 30.5, mt05: 62.6, mt06: 0  },
      //       { month: '21:20:45', mt01: 28.1, mt02: 28.1, mt03: 30.5, mt04: 30.5, mt05:62.2, mt06: 0  },
      //       { month: '21:20:08', mt01: 28.1, mt02: 28.1, mt03: 30.5, mt04: 30.6, mt05: 62.2, mt06: 0  },
      //       { month: '21:19:30', mt01: 28, mt02: 28.1, mt03: 30.4 , mt04: 30.6, mt05: 62.7, mt06: 0 },
      //       { month: '21:18:52', mt01: 21.2, mt02: 28.1, mt03: 30.4, mt04: 30.6, mt05:63, mt06: 0  },
      //       { month: '21:18:15', mt01: 28.1, mt02: 28.1, mt03: 30.3 , mt04: 30.5, mt05: 63.1, mt06: 0 },
      //       { month: '21:17:37', mt01: 28.1, mt02: 28, mt03: 30.3, mt04: 30.5, mt05: 63.4, mt06: 0  },
      //       { month: '21:17:00', mt01: 28.1, mt02: 28, mt03: 30.3, mt04: 30.4, mt05: 63.1, mt06: 0  },
      //       { month: '21:16:22', mt01: 28.1, mt02: 28, mt03: 30.3 , mt04: 30.4, mt05: 62.2, mt06: 0 }
      //     ];
      //   }

 

      const data = [
            { month: '21:23:54', MT01: 28.2, MT02: 28, MT03: 30.3, MT04: 30.5, MT05: 62.8, MT06: 0 },
            { month: '21:23:16', MT01: 28.1, MT02: 28, MT03: 30.2, MT04: 30.4, MT05: 62.6, MT06: 0 },
            { month: '21:22:38', MT01: 28, MT02: 28, MT03: 30.3, MT04: 30.5, MT05: 62.6, MT06: 0 },
            { month: '21:22:01', MT01: 28.1, MT02: 28.1, MT03: 30.4, MT04: 30.5, MT05: 62.6, MT06: 0 },
            { month: '21:20:45', MT01: 28.1, MT02: 28.1, MT03: 30.5, MT04: 30.5, MT05: 62.2, MT06: 0 },
            { month: '21:20:08', MT01: 28.1, MT02: 28.1, MT03: 30.5, MT04: 30.6, MT05: 62.2, MT06: 0 },
            { month: '21:19:30', MT01: 28, MT02: 28.1, MT03: 30.4, MT04: 30.6, MT05: 62.7, MT06: 0 },
            { month: '21:18:52', MT01: 21.2, MT02: 28.1, MT03: 30.4, MT04: 30.6, MT05: 63, MT06: 0 },
            { month: '21:18:15', MT01: 28.1, MT02: 28.1, MT03: 30.3, MT04: 30.5, MT05: 63.1, MT06: 0 },
            { month: '21:17:37', MT01: 28.1, MT02: 28, MT03: 30.3, MT04: 30.5, MT05: 63.4, MT06: 0 },
            { month: '21:17:00', MT01: 28.1, MT02: 28, MT03: 30.3, MT04: 30.4, MT05: 63.1, MT06: 0 },
            { month: '21:16:22', MT01: 28.1, MT02: 28, MT03: 30.3, MT04: 30.4, MT05: 62.2, MT06: 0 }
        ];

        const labels = data.map(entry => entry.month);
        const dataset = [
            { label: 'MT01', data: data.map(entry => entry.MT01) },
            { label: 'MT02', data: data.map(entry => entry.MT02) },
            { label: 'MT03', data: data.map(entry => entry.MT03) },
            { label: 'MT04', data: data.map(entry => entry.MT04) },
            { label: 'MT05', data: data.map(entry => entry.MT05) },
            { label: 'MT06', data: data.map(entry => entry.MT06) }
        ];

        const ctx = document.getElementById('temperatureChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: dataset.map((set, index) => ({
                    label: set.label,
                    data: set.data,
                    borderColor: `hsl(${index * 60}, 70%, 50%)`,
                    backgroundColor: `hsl(${index * 60}, 70%, 70%, 0.4)`,
                    fill: false,
                    tension: 0.1
                }))
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: '기계:1 (금형:GN7_B_RH) 온도변화'
                    },
                    legend: {
                        display: true,
                        position: 'top'
                    }
                },
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: '시간'
                        }
                    },
                    y: {
                        title: {
                            display: true,
                            text: '온도 (°C)'
                        },
                        beginAtZero: true
                    }
                }
            }
        });

    }
       
//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$


$(document).ready(function() {   
        init()          
        getToday() 
        // $('datetimepicker').datetimepicker({
            
        // }); 

        // $("#frdate").change(function(e){ 
        //     // console.log("달력클릭");
        //     // console.log(convert_time(e.timestamp));
        // })
        // $("#todate").change(function(e){ 
        //     // console.log("달력클릭");
        //     // console.log(convert_time(e.timestamp));
        // })
   })   
    function init(){ 
            
            wfrdate = new wijmo.input.InputDate('#frdate', {
                isRequired: false,
                value: null,
                placeholder: '',
                format: 'yyyy-MM-dd', 
            });
            wtodate = new wijmo.input.InputDate('#todate', {
                isRequired: false,
                value: null,
                placeholder: '',
                format: 'yyyy-MM-dd', 
            }); 

            var result = new Date();
            result.setHours(result.getHours() + 9); 
            var ls_date = result.toISOString().substring(0,10);                                 
            wfrdate.value = ls_date;   
            wtodate.value = ls_date;  
            
    } 
    


    function getToday(){
        let today = new Date();   

        let year = today.getFullYear(); // 년도
        let month = today.getMonth() + 1;  // 월
        let date = today.getDate();  // 날짜
        let day = today.getDay();  // 요일
        if(month > 0 && month < 10) {month = "0" + month};
        if(date > 0 && date < 10) {date = "0" + date};
        let ls_frday = year + '-' + month + '-01'  
        let ls_today = year + '-' + month + '-' + date 
        document.getElementById('frdate').value = ls_frday;  
        document.getElementById('todate').value = ls_today;
        
        // document.getElementById('todate').value = ls_today;
    }

    function convert_time(timestamp){ 
        //현재시간
        var date = new Date(timestamp); 
        var year = date.getFullYear();
        var month = ("0" + (1 + date.getMonth())).slice(-2);
        var day = ("0" + date.getDate()).slice(-2); 
        var hh = date.getHours();  
        var min = ('0' + date.getMinutes()).slice(-2) 
        time = year +  month +  day   ;
        return time;  
    } 
 
 
    function logout(){   
      var ip_addr = "" ;
      if (!confirm("로그아웃하시겠습니까?") ){
          return    
      } 
      var ls_loginid   = localStorage.getItem("userid"); 
          ip_addr = document.getElementById('ipaddr').value; 
      $.ajax({
          url: '/authcrud/logoutlog',
          type:"POST",
          data: {
              "loginid" : ls_loginid ,
              "ipaddr" : ip_addr ,
          },
          async:false,
          success:function(){
                  console.log('success');
          }
      });
      localStorage.removeItem("perid");
      localStorage.removeItem("pernm");
      localStorage.removeItem("userid");
      localStorage.removeItem("flag");
      localStorage.removeItem("custnm") ;
      location.href = "/" ;
  }   




        class FlexGridContextMenu {
                        constructor(grid) {
                            let host = grid.hostElement, menu = this._buildMenu(grid);
                            host.addEventListener('contextmenu', (e) => {
                                // 클릭된 셀/열 선택
                                let sel = grid.selection, ht = grid.hitTest(e), row = ht.getRow();
                
                                switch (ht.panel) {
                                    case grid.cells:
                                    let colIndex = ht.col;
                                    // 만약 그룹 헤더이면, 그룹 열 선택
                                    if (row instanceof wijmo.grid.GroupRow && row.dataItem instanceof wijmo.collections.CollectionViewGroup) {
                                        let gd = row.dataItem.groupDescription;
                                        if (gd instanceof wijmo.collections.PropertyGroupDescription) {
                                        let col = grid.getColumn(gd.propertyName);
                                        if (col && col.index > -1) {
                                            colIndex = col.index;
                                        }
                                        }
                                    }
                                    grid.select(ht.row, colIndex);
                                    break;
                                    case grid.columnHeaders:
                                    grid.select(sel.row, ht.col);
                                    break;
                                    case grid.rowHeaders:
                                    grid.select(ht.row, sel.col);
                                    break;
                                    default:
                                    return; // 유효하지 않는 패널
                                }
                                // 현재 열에 대한 메뉴 표시
                                if (grid.selection.col > -1) {
                                    e.preventDefault(); // 브라우저의 기본 메뉴 취소
                                    menu.show(e); // Wijmo 메뉴 표시
                                }
                            }, true);
                        }
                        _buildMenu(grid) {
                            let menu = new wijmo.input.Menu(document.createElement('div'), {
                            owner: grid.hostElement,
                            displayMemberPath: 'header',
                            subItemsPath: 'items',
                            commandParameterPath: 'cmd',
                            dropDownCssClass: 'ctx-menu',
                            openOnHover: true,
                            closeOnLeave: true,
                            itemsSource: [
                                {
                                header: '정렬', items: [
                                    { header: 'Ascending', cmd: 'SRT_ASC' },
                                    { header: 'Descending', cmd: 'SRT_DESC' },
                                    { header: 'No Sort', cmd: 'SRT_NONE' },
                                    { header: '-' },
                                    { header: 'Clear All Sorts', cmd: 'SRT_CLR' }
                                ]
                                },
                                { header: '-' },
                                { header: 'Pin/Unpin', cmd: 'PIN' },
                                { header: '-' },
                                { header: 'AutoSize', cmd: 'ASZ' },
                                { header: 'AutoSize All', cmd: 'ASZ_ALL' },
                                { header: '-' },
                                { header: 'Group/Ungroup', cmd: 'GRP' },
                                { header: 'Clear All Groups', cmd: 'GRP_CLR' },
                                { header: '-' },
                                {
                                header: '내려받기', items: [
                                    { header: 'CSV', cmd: 'X_CSV' },
                                    { header: 'XLSX', cmd: 'X_XLSX' },
                                    { header: 'PDF', cmd: 'X_PDF' },
                                ]
                                }
                            ],
                            command: {
                                // 메뉴 명령 활성화/비활성화
                                canExecuteCommand: (cmd) => {
                                let view = grid.collectionView, col = grid.columns[grid.selection.col];
                                switch (cmd) {
                                    case 'SRT_ASC':
                                    return col.currentSort != '+';
                                    case 'SRT_DESC':
                                    return col.currentSort != '-';
                                    case 'SRT_NONE':
                                    return col.currentSort != null;
                                    case 'SRT_CLR':
                                    return view.sortDescriptions.length > 0;
                                    case 'PIN':
                                    return true; // toggle pin
                                    case 'ASZ':
                                    case 'ASZ_ALL':
                                    return true;
                                    case 'GRP':
                                    return col.dataType != wijmo.DataType.Number; // don't group numbers
                                    case 'GRP_CLR':
                                    return view.groupDescriptions.length > 0;
                                }
                                return true;
                                },
                                // 메뉴 명령 실행
                                executeCommand: (cmd) => {
                                    let view = grid.collectionView, cols = grid.columns, col = cols[grid.selection.col], sd = view.sortDescriptions, gd = view.groupDescriptions;
                                    switch (cmd) {
                                        case 'SRT_ASC':
                                        case 'SRT_DESC':
                                        case 'SRT_NONE':
                                        if (grid.allowSorting != wijmo.grid.AllowSorting.MultiColumn) {
                                            sd.clear();
                                        }
                                        else {
                                            for (let i = 0; i < sd.length; i++) {
                                            if (sd[i].property == col.binding) {
                                                sd.removeAt(i);
                                                break;
                                            }
                                            }
                                        }
                                        if (cmd != 'SRT_NONE') {
                                            sd.push(new wijmo.collections.SortDescription(col.binding, cmd == 'SRT_ASC'));
                                        }
                                            break;
                                        case 'SRT_CLR':
                                            sd.clear();
                                            break;
                                        case 'PIN':
                                            let fCols = grid.frozenColumns;
                                            if (col.index >= fCols) { // pinning
                                                cols.moveElement(col.index, fCols, false);
                                                cols.frozen++;
                                            }
                                            else { // unpinning
                                                cols.moveElement(col.index, fCols - 1, false);
                                                cols.frozen--;
                                            }
                                            break;
                                        case 'ASZ':
                                            grid.autoSizeColumn(col.index);
                                            break;
                                        case 'ASZ_ALL':
                                            grid.autoSizeColumns(0, grid.columns.length - 1);
                                            break;
                                        case 'GRP':
                                        // 그룹 삭제
                                            for (let i = 0; i < gd.length; i++) {
                                                if (gd[i].propertyName == col.binding) {
                                                gd.removeAt(i);
                                                return; // we're done
                                                }
                                            }
                                            // 그룹 추가
                                            gd.push(new wijmo.collections.PropertyGroupDescription(col.binding));
                                            break;
                                        case 'GRP_CLR':
                                            gd.clear();
                                            break;
                                        // 내보내기
                                        case 'X_CSV':
                                            let rng = new wijmo.grid.CellRange(0, 0, grid.rows.length - 1, grid.columns.length - 1), csv = grid.getClipString(rng, wijmo.grid.ClipStringOptions.CSV, true, false);
                                            wijmo.saveFile(csv, '재고등록.csv');
                                            break;
                                        case 'X_XLSX':
                                            const gridView = grid.collectionView;
                                            let oldPgSize = gridView.pageSize, oldPgIndex = gridView.pageIndex;
                
                                            grid.beginUpdate();
                                            gridView.pageSize = 0;
                
                                            wijmo.grid.xlsx.FlexGridXlsxConverter.saveAsync(grid, {includeCellStyles: true, includeColumnHeaders: true}, '재고등록.xlsx',
                                            saved => {
                                            gridView.pageSize = oldPgSize;
                                            gridView.moveToPage(oldPgIndex);
                                            grid.endUpdate();
                                            }, null
                                            ); 
                                            break;
                                        case 'X_PDF':
                                            wijmo.grid.pdf.FlexGridPdfConverter.export(grid, '재고등록.pdf', {
                                                maxPages: 10,
                                                scaleMode: wijmo.grid.pdf.ScaleMode.PageWidth,
                                                documentOptions: {
                                                compress: true,
                                                header: { declarative: { text: '\t&[Page] of &[Pages]' } },
                                                footer: { declarative: { text: '\t&[Page] of &[Pages]' } },
                                                info: { author: 'GrapeCity', title: '재고등록' }
                                                },
                                                //내장된 폰트 정보
                                                embeddedFonts: [
                                                    {
                                                    source: "https://assets.codepen.io/975719/BMHANNAPro.ttf",
                                                    name: "BMHANNAPro",
                                                    style: "normal",
                                                    weight: "normal",
                                                    sansSerif: true
                                                    }
                                                ],
                                                styles: {
                                                    cellStyle: { backgroundColor: '#ffffff', borderColor: '#c6c6c6', font: {family: "BMHANNAPro"} },
                                                    altCellStyle: { backgroundColor: '#f9f9f9' },
                                                    groupCellStyle: { backgroundColor: '#dddddd' },
                                                    headerCellStyle: { backgroundColor: '#eaeaea' }
                                                }
                                            });
                                            break;
                                    }
                                    // 활성화 그리드 셀에 포커스 복원
                                    grid.refresh();
                                    let sel = grid.selection, cell = grid.cells.getCellElement(sel.row, sel.col);
                                    if (cell) {
                                        cell.focus();
                                    }
                                }
                            }
                            });
                            // 완료
                            return menu;
                        }
                    }        
                
                


    </script>
</header>