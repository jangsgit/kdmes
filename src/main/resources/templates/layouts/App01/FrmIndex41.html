<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<header th:fragment="headerFragment"> 
    <!-- py-md-2 px-1 py-1 -->
    <div class="card-body d-flex align-items-center py-md-2 px-auto py-auto ">
        <main class="main" id="top"> 
            <div class="container-fluid"> 
                <script>
                    var isFluid = JSON.parse(localStorage.getItem('isFluid'));
                    if (isFluid) {
                        var container = document.querySelector('[data-layout]');
                        container.classList.remove('container');
                        container.classList.add('container-fluid');
                    }
                </script>

                <nav class="navbar navbar-light navbar-vertical navbar-expand-xl">
                    <script>
                        var navbarStyle = localStorage.getItem("navbarStyle");
                        if (navbarStyle && navbarStyle !== 'transparent') {
                            document.querySelector('.navbar-vertical').classList.add(`navbar-${navbarStyle}`);
                        }

                        
                    </script>
                    <div class="d-flex align-items-center">
                        <div class="toggle-icon-wrapper">

                            <button class="btn navbar-toggler-humburger-icon navbar-vertical-toggle"
                                data-bs-toggle="tooltip" data-bs-placement="left" title="Toggle Navigation"><span
                                    class="navbar-toggle-icon"><span class="toggle-line"></span></span></button>

                        </div><a class="navbar-brand" href="@{/user}">
                            <!-- <div class="d-flex align-items-center py-3"><img class="me-2"
                                    th:src="@{assets/img/icons/spot-illustrations/falcon.png}" alt="" width="40" /><span
                                    class="font-sans-serif">ActasErp</span>
                            </div> -->
                        </a> 
                    </div> 
                    <!------navbar vertical------>     
                    <div th:replace="layouts/layout01/navbarMemWeb :: navbar"></div>  
                </nav>
                <div class="content" id="index02"> 
                    <!------nav ------>
                    <!-- <div th:replace="layouts/layout01/headerNavWeb :: headerNav"></div>   -->

                     
                    <!-- ######################### ######################### ######################### ######################### ######################### ######################### -->

 <!-- contents body 시작--> 
<!-- form 또는 action 으로 받아오기  -->
<div class="con">
    <!-- contents header -->
    <th:block th:include="layouts/APPHeader/appheadTop"/>
 
    <!-- <div class="infor_bar type2">                                
        <div class="left">검사등록</div> 
    </div>   -->

    <!-- contents body 시작--> 
    <!-- form 또는 action 으로 받아오기  -->
        <div class="section regist">  

            <div class="card-body bg-light">
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#step01" onclick="tabchk_rtn('A')">검사공정등록</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#step02"  onclick="tabchk_rtn('B')">검사공정현황</a>
                    </li>
                    <!-- <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#step03"  onclick="tabchk_rtn('C')">기초코드3</a>
                    </li> --> 
                    <input type="hidden" id="tabvalue" value="A">
                    </ul>
                    <div class="tab-content">
                    <div class="tab-pane fade show active" id="step01">   
                        <div class="row gx-3" style="  margin: 10px 10px 10px;">  
                            <div class="table-responsive">

                                <div class="section regist">
                                    <div class="sec_con" style="width: 55%; ">
                                        <div class="box_wrap">
                                            <!-- <div class="box_input" > -->
                                                <table>
                                                    <tr> 
                                                        <th>검사일자</th>
                                                        <td>
                                                            <div class="col-auto"> 
                                                                <div class="input_wrap" style="max-width: 250px;"> 
                                                                    <input type="text"  class="form-control datetimepicker" id="frdate" disabled autocomplete="off"  placeholder="Y-m-d"     >
                                                                </div> 
                                                            </div>   
                                                        </td>     
                                                        <td>
                                                            <div class="col-auto"> 
                                                                <div class="input_wrap" style="max-width: 250px;"> 
                                                                    <input type="text"  class="form-control datetimepicker" id="todate" disabled autocomplete="off"  placeholder="Y-m-d"     >
                                                                </div>
                                                            </div>  
                                                        </td>   
                                                        <td>
                                                            <div class="date_wrap">
                                                                <div class="col-auto">  
                                                                    <button type="button" id="searchTabABtn" >검색</button>       
                                                                </div>  
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </table>                      
                                                <!-- //여기서부터 그래프 -->
                                                <!-- <div class="table table_style2"> -->
                                                    <div class="card-body bg-light">   
                                                          <div class="tab-content" >                                        
                                                            <div class="tab-pane fade show active"  >  
                                                                <div class="container-fluid" id="op1" >
                                                                <div id="wtab01Grid_div" style="height: 500px; width: 700px; " ></div>
                                                                <!-- <div style="display: flex; margin: 0 auto; " id="tab01Pager"></div> -->
                                                                </div>   
                                                                <div class="container-fluid"> 
                                                                    <div id="wtab05Grid_div" style="overflow:scroll; width: 700px;  height:150px;    margin:0 auto; "></div> 
                                                                </div>                                              
                                                            </div>                                        
                                                          </div>
                                                    </div>
                                                <!-- </div>                        -->
                                                                            
                                            <!-- </div> -->
                                        </div>
                                    </div>
                                     
                                    <div class="sec_con" style="width: 45%;">
                                        <div class="box_wrap" style="padding-bottom: 100px;"> 
                                            <!-- <div class="date_wrap">
                                                <input type="text"  class="form-control datetimepicker"  onkeypress="barcode_enter(event)" id="insalotno01" autocomplete="off"  placeholder="사출 Lot No">
                                                <input class="form-control form-control-sm" id="insaplan_no01" type="hidden"    disabled  placeholder=""   />  
                                                <button type="button" id="retrieveBtn" data-bs-toggle="modal" data-bs-target="#staticBackdrop">사출내역</button>      
                                            </div>    -->
                                            
                                                <div class="table table_style1" >
                                                    <table>
                                                        <tbody>  
                                                            <tr> 
                                                                <th>검사일자</th>
                                                                <td colspan="2">
                                                                    <div class="input_wrap" style="max-width: 230px;"> 
                                                                        <input type="text"  class="form-control datetimepicker" id="inputdate" autocomplete="off"  placeholder="Y-m-d"     >   
                                                                    </div>                                           
                                                                </td>  
                                                                <th>검사코드</th>
                                                                <td colspan="2">
                                                                    <div class="input_wrap" style="max-width: 230px;"> 
                                                                        <input class="form-control form-control-sm" id="inlotno" type="text"  size="15" disabled /> 
                                                                        <input class="form-control form-control-sm" id="inplan_no" type="hidden"    disabled  placeholder=""   />  
                                                                    </div>                                           
                                                                </td>                                  
                                                            </tr>  
                                                            <tr>   
                                                            <tr> 
                                                                <th>품목명</th>
                                                                <td colspan="2">
                                                                    <div class="input_wrap" style="max-width: 230px;">  
                                                                        <input class="form-control form-control-sm" id="inpname" type="text" disabled  size="15"  /> 
                                                                        <input class="form-control form-control-sm" id="inpcode" type="hidden" disabled size="15"  /> 
                                                                        <input class="form-control form-control-sm" id="incltnm" type="hidden" disabled   size="15" placeholder="거래처"     />
                                                                        <input class="form-control form-control-sm"  type="hidden"  id="incltcd"    />  
                                                                        <input class="form-control form-control-sm" id="inwono" type="hidden" placeholder="작지번호"    disabled />
                                                                        <input class="form-control form-control-sm"  type="hidden"  id="inspjangcd"  />   
                                                                        <input class="form-control form-control-sm"  type="hidden"  id="incustcd"  />        
                                                                        <input class="form-control form-control-sm"  type="hidden"  id="inwseq"  />         
                                                                        <input class="form-control form-control-sm"  type="hidden"  id="inwflag" />    
                                                                        <input class="form-control form-control-sm"  type="hidden"  id="inostore"     value=0   />  
                                                                    </div>                                            
                                                                </td>   
                                                                <th>규격</th>
                                                                <td colspan="2">
                                                                    <div class="input_wrap" style="max-width: 230px;">  
                                                                        <input class="form-control form-control-sm" id="inpsize" type="text" disabled size="15"  />     
                                                                        <div id='inwonobdg'></div>              
                                                                    </div>                                            
                                                                </td>                                  
                                                            </tr>       
                                                            <tr>  
                                                                <th>검사수량</th>
                                                                <td colspan="2">
                                                                    <div class="input_wrap" style="max-width: 230px;"> 
                                                                        <input class="form-control form-control-sm"  type="number" id="inwotqt" placeholder=""  disabled  />
                                                                        <input class="form-control form-control-sm" id="inwinqt" type="hidden" placeholder=""   />
                                                                        <input class="form-control form-control-sm" id="inwokqt" type="hidden" placeholder=""   />
                                                                        <div id='inwinqtbdg'></div>                                             
                                                                    </div>                                            
                                                                </td> 
                                                                <th>박스수량</th>
                                                                <td colspan="2">
                                                                    <div class="input_wrap" style="max-width: 230px;"> 
                                                                        <input class="form-control form-control-sm"  type="number" id="inboxsu1" placeholder=""     /> 
                                                                        <div id='inwinqtbdg'></div>                                             
                                                                    </div>                                            
                                                                </td>                                   
                                                            </tr>  
                                                            <tr> 
                                                                <th>불량구분</th>
                                                                <td colspan="2">                                                                    
                                                                    <div class="input_wrap" style="max-width: 230px;">  
                                                                        <input class="form-control form-control-sm" id="inwcodenm" type="text"    autocomplete="off"  placeholder=""     > 
                                                                        <input class="form-control form-control-sm" id="inwcode" type="hidden"
                                                                            placeholder=""   />                                                                               
                                                                    </div>                                            
                                                                </td>  
                                                                <th>불량수량</th>
                                                                <td colspan="2">
                                                                    <div class="input_wrap" style="max-width: 230px;"> 
                                                                        <input class="form-control form-control-sm"  type="number" id="inwbdqt" placeholder=""    />  
                                                                    </div>                                            
                                                                </td>                                 
                                                            </tr>  
                                                            <tr> 
                                                                <th>누적수량</th>
                                                                <td colspan="2">
                                                                    <div class="input_wrap" style="max-width: 230px;"> 
                                                                        <input class="form-control form-control-sm"  type="number" id="insumqt" placeholder=""  disabled  /> 
                                                                        <div id='inwinqtbdg'></div>                                             
                                                                    </div>                                            
                                                                </td>  
                                                                <th>완료수량</th>
                                                                <td colspan="2">
                                                                    <div class="input_wrap" style="max-width: 230px;"> 
                                                                        <input class="form-control form-control-sm"  type="number" id="inwqcqt" placeholder=""  disabled  />  
                                                                    </div>                                            
                                                                </td>                                   
                                                            </tr>   
                                                            <tr> 
                                                                <th>작업자</th>
                                                                <td colspan="2">                                                                   
                                                                    <div class="input_wrap" style="max-width: 230px;">  
                                                                        <input class="form-control form-control-sm" id="inwrpsnm" type="text" size="15"  /> 
                                                                        <input class="form-control form-control-sm" id="inwinps" type="hidden" disabled size="15"  />                                         
                                                                    </div>                                            
                                                                </td>   
                                                                <th>검사완료</th>
                                                                <td colspan="2">     
                                                                    <div class="form-check form-check-inline">
                                                                        <input class="form-check-input"  type="checkbox" id="demflag" value="demflag"  />                                                                       
                                                                    </div>
                                                                </td>                                
                                                            </tr>  
                                                            <tr> 
                                                                <th>비고</th>
                                                                <td colspan="4">
                                                                    <div class="input_wrap" style="max-width: 230px;"> 
                                                                        <input class="form-control form-control-sm" id="inwremark" type="text" placeholder=""  />                                    
                                                                    </div>                                            
                                                                </td>                                  
                                                            </tr>   
                                                            <tr> 
                                                                <th> 
                                                                   <button class="btn btn-outline-info me-1 mb-1"  type="button" style="color: #27bcfd;"  id="retrieveBtn" data-bs-toggle="modal" data-bs-target="#staticBackdrop"><span style="color: #084661;">사출<br>내역</span></button>                                            
                                                                </th>
                                                                <td colspan="2">  
                                                                    <input type="text"  class="form-control datetimepicker"  onkeypress="barcode_enter(event)" id="insalotno01" autocomplete="off"  placeholder="사출 Lot No">
                                                                    <input class="form-control form-control-sm" id="insaplan_no01" type="hidden"    disabled  placeholder=""   /> 
                                                                </td>     
                                                                <th>
                                                                    <button class="btn btn-outline-info me-1 mb-1"  type="button" style="color: #dc3545;"  id="deleteRow" ><span style="color: #084661;">행삭제</span></button> 
                                                                </th>                     
                                                            </tr>  
                                                        </tbody>
                                                    </table> 
                                                    
                                                    <div class="container-fluid"> 
                                                        <div id="wtab04Grid_div" style="overflow:scroll; width: 650px;  height:200px;    margin:0 auto; "></div> 
                                                    </div>  
                                                    <div class="btn_wrap" style="float: right; margin-bottom: 10px;">
                                                        <div class="btns" >                                                        
                                                            <button class="btn btn-outline-danger me-1 mb-1"  style="display:inline; color:#dc3545; " type="button" id="delete" onclick="delete_btn()"><span class="fas fa-trash ms-1" data-fa-transform="shrink-3"></span><span style="color: #084661;">삭제</span></button>
                                                            <button class="btn btn-outline-info me-1 mb-1"  type="button" style="color: #27bcfd;" onclick="clear_rtn()"><span class="fas fa-plus me-1" data-fa-transform="shrink-3"></span><span style="color: #084661;">신규</span></button>                                                                                                
                                                            <button class="btn btn-outline-warning me-1 mb-1 " type="button" style="color: #f5803e;" id="save" onclick="save_btn('A')"><span style="color: #084661;">저장</span></button>                                    
                                                        </div> 
                                                    </div>   
                                                </div> 
                                            
                                        </div>                           
                                    </div>
                                </div>
 
                            </div> 



                        </div>
                    </div>
                    <div class="tab-pane fade" id="step02">  
                        <div class="row gx-3" style="  margin: 10px 10px 10px;">   
                            <div class="col-2 col-sm-2">
                                <div class="input-group input-group-sm mb-3"><span class="input-group-text" id="inputGroup-sizing-sm">바코드</span> 
                                    <input class="form-control form-control-sm" id="jpumname" type="text"    autocomplete="off"  placeholder=""     > 
                                </div>
                            </div>
                            <div class="col-1 col-sm-1">  
                                <button class="btn btn-falcon-danger me-1 mb-1 btn-sm" id="searchTabBBtn"  type="button" onclick="searchList_rtn()">조회
                                </button>
                            </div>  
                        </div> 
                        <div class="table-responsive">
                            <table class="table table-borderless" style="height: 100px;" >
                                <tbody>
                                <tr>  
                                    <td class="align-top">                                                         
                                    <div class="container-fluid"  >                                                         
                                        <div id="wtab02Grid_div"  style="overflow:scroll;   height:600px;  width:1500px;   margin:0 auto; "></div> 
                                        </div>  
                                    </td> 
                                </tr>
                                </tbody>
                            </table>
                        </div>  
                    </div> 
                </div>
            </div>             
            

        </div>            <!-- section regist -->
    

        <div class="modal fade" id="staticBackdrop" data-bs-keyboard="false"
            data-bs-backdrop="static" tabindex="-1" aria-labelledby="staticBackdropLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-lg mt-6" role="document" id = "modalForm01"
                style="max-width: 1000px">
                <div class="modal-content border-0">
                    <div class="modal-body p-0" >
                        <div class="bg-light rounded-top-lg py-3 ps-4 pe-6">
                            <h4 class="mb-1" id="staticBackdropLabel">사출완료리스트</h4> 
                        </div>
                        <div class="container-fluid"> 
                            <div id="wtab03Grid_div" style="overflow:scroll; width: 950px;  height:300px;    margin:0 auto; "></div> 
                        </div>     
                    </div>  
                    <div class="modal-footer">
                        <div class="row g-1">
                            <div class="col-auto"> 
                                <p>
                                    선택된 총 검사량 : <b><span id="checked-count">0</span></b>  
                                </p>
                            </div>
                            <div class="col-auto">
                                <input type="text"    onkeypress="barcode_enter(event)" id="searchOrdDate01" autocomplete="off"  placeholder="Lot No"   >
                            </div>
                            <div class="col-auto">
                                <button class="btn btn-primary" type="button"  id="searchBtn"  >조회 </button>
                            </div>
                            <div class="col-auto">
                                <button class="btn btn-secondary me-1 mb-1" id="wlistBtn" type="button" data-bs-dismiss="modal">Close
                                </button>
                            </div>
                            <!-- <div class="col-auto">
                                <button class="badge-soft-info dropdown-item rounded-1"
                                    type="submit">저장 </button>
                            </div> -->
                        </div>
                    </div>   

                </div>
            </div> 
        </div>     

    <!--------------------------------------------------------------------------------------->    
    <input class="form-control form-control-sm"  type="hidden" id="innamebtn" data-bs-toggle="modal" data-bs-target="#insamodal"  /> 
    <!--------------------------------------------------------------------------------------->    
    <div class="modal fade" id="insamodal" data-bs-keyboard="false"
        data-bs-backdrop="static" tabindex="-1" aria-labelledby="staticBackdropLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg mt-6" role="document" id = "modalForm01"
            style="max-width: 600px">
            <div class="modal-content border-0">
                <div class="modal-body p-0" > 
                    <div class="rounded-top-lg py-3 ps-4 pe-6 bg-light">                            
                        <div class="search">
                            <div class="input_wrap">  
                                <input class="form-control form-control-sm" id="searchCode" type="text"   onkeyup="if(window.event.keyCode==13){insaList_rtn('M')}"
                                placeholder="사원명 "     />                                      
                            </div>
                            <button id="winnameBtn">
                                <img th:src="@{/assets/images/i_search.png}" alt=""> 
                            </button>
                        </div>                             
                    </div>   
                    <div class="container-fluid"> 
                        <div id="winnameGrid_div" ></div> 
                    </div>   
                </div>  

                <div class="modal-footer">
                    <div class="row g-1">
                        <div class="col-auto">
                            <button class="badge-soft-primary dropdown-item rounded-1"
                                type="button"  id="winnamemodal_btn" data-bs-dismiss="modal">Close</button>
                        </div> 
                    </div>
                </div>   

            </div>
        </div> 
    </div>
    <!--------------------------------------------------------------------------------------->    
    <input class="form-control form-control-sm"  type="hidden" id="inbdnamebtn" data-bs-toggle="modal" data-bs-target="#wbadqtymodal"  /> 
    <!--------------------------------------------------------------------------------------->   
    <div class="modal fade" id="wbadqtymodal" data-bs-keyboard="false"
        data-bs-backdrop="static" tabindex="-1" aria-labelledby="staticBackdropLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg mt-6" role="document" id = "modalForm05"
            style="max-width: 500px">
            <div class="modal-content border-0">
                <div class="modal-body p-0" > 
                    <div class="rounded-top-lg py-3 ps-4 pe-6 bg-light">
                        <h4 class="mb-1" id="modalExampleDemoLabel">불량구분</h4>
                    </div>    

                    <div class="container-fluid"> 
                        <div id="wbadGrid_div" ></div>
                        <!-- <div id="thePager05"></div>  -->
                    </div>    
                </div>  
                <div class="modal-footer">
                    <div class="row g-1">
                        <div class="col-auto">
                            <button class="badge-soft-primary dropdown-item rounded-1"
                                type="button"  id="wbadqtymodal_btn" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>   

            </div>
        </div> 
    </div>      





        <!--########################################자바 스크립트 시작-->
        <script type="text/javascript" th:inline="javascript">
            var view_p01tab01page;
            var view_p01tab02page;
            var view_p01tab03page; 
            var view_p01tab04page; 
            var view_p01tab05page; 
            var view_wbadpage;
            var wtab01Grid;
            var wtab02Grid;
            var wtab03Grid; 
            var wtab04Grid; 
            var wtab05Grid;
            var wbadGrid; 
            var chkTabA;  
            var chkTabBar;  
            var treemap;
            let barchart;
            let wfrdate;
            let wtodate;  
            let winputdate;
            let chkTabA_row = 0;
            let chkTabBar_row = 0;
            let ani;
            var ll_delgetrow = 0
            var ls_delgetlot = "";
           var wseries_data = [0]; 
           var addlotno = []; 
           
           var lotnoArr = []; 
           var activeArr = []; 
           var prod_qtyArr = []; 
           var otqtyArr = []; 
           var obqtyArr = []; 
           var gqtyArr = []; 
           var planArr = [];  

           const inwotqtInput = document.getElementById('inwotqt');
           const inwbdqtInput = document.getElementById('inwbdqt');
            // 변경된 값을 저장할 변수를 선언합니다.
            let currentValue01 = inwotqtInput.value;
            let currentValue02 = inwbdqtInput.value;
            var ll_insumqt = 0;    
            // input 요소에 'input' 이벤트 리스너를 추가합니다.
            inwotqtInput.addEventListener('input', (event) => { 
                currentValue01 = event.target.value;
                var ll_wbdqt = document.getElementById('inwbdqt').value; 
                var ll_inboxsu1 = document.getElementById('inboxsu1').value;
                var ll_inqcqt =  currentValue01 - ll_wbdqt ; 
                if(ll_wbdqt == null ){
                    ll_wbdqt = 0;
                }
                if(ll_inqcqt < 0 ){ 
                    alert("불량수량이 검사수량을 초과했습니다. 확인하세요");
                    return ;
                }  
                //ll_insumqt = parseInt(ll_insumqt) + parseInt(ll_inqcqt); 
                //if(ll_insumqt < 0 ){ ll_insumqt =0 ;}
                // if(ll_inboxsu1 == ll_insumqt ){ 
                //     alert("검사 완료를 체크하고 저장하세요");
                //     return ;
                // }                
                document.getElementById('inwqcqt').value  = ll_inqcqt; //완료수량                
                //document.getElementById('insumqt').value = ll_insumqt;
                //console.log(`현재 값: ${currentValue01}`);
            });
             
            inwbdqtInput.addEventListener('input', (event) => { 
                currentValue02 = event.target.value;
                var ll_inwotqt = document.getElementById('inwotqt').value; 
                var ll_inboxsu1 = document.getElementById('inboxsu1').value;
                var ll_inqcqt =  ll_inwotqt - currentValue02  ; 
                if(ll_inwotqt == null ){
                    ll_inwotqt = 0;
                }
                if(ll_inqcqt < 0 ){ 
                    alert("불량수량이 검사수량을 초과했습니다. 확인하세요");
                    return ;
                }else{
                    document.getElementById('inwqcqt').value  = ll_inqcqt; //완료수량
                } 
                // if(ll_inboxsu1 == ll_insumqt ){ 
                //     alert("검사 완료를 체크하고 저장하세요");
                //     return ;
                // }                 
                //console.log(`현재 값: ${currentValue02}`);
            });

            window.onload = function() {  
               localStorage.setItem("setpage", "app03p001");
               view_p01tab01page = new wijmo.collections.CollectionView(getData_tab01(), {
                //   pageSize: 12
               });    
               wtab01Grid = new wijmo.grid.FlexGrid('#wtab01Grid_div', {  
                   autoGenerateColumns: false,
                   isReadOnly: true,  
                   alternatingRowStep: 0,
                   columns: [
                       // { binding: 'index', header: 'seq', width: '*' }, 
                       { binding: 'demflag', header: '완료',   align:"center", width: 80 , cssClass :'switch' } ,
                       { binding: 'qcdate', header: '검사일',align:"center",  width: 120, format: 'yyyy-MM-dd' },
                       // { binding: 'prod_sdate', header: '생산시작일',  width: 130, align:"center", format: 'yyyy-MM-dd' },
                       {
                           binding: 'lotno',
                           width: 150,
                           header: '검사코드', 
                           align:"center",
                           cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                               text: '<b>${item.lotno}</b>',
                               click: (e, ctx) => {
                                   selectChk( "A", ctx.item.custcd, ctx.item.spjangcd, ctx.item.wono, ctx.item.cltnm, ctx.item.pname, ctx.item.ostore, ctx.item.plan_no, ctx.item.cltcd, ctx.item.pcode, ctx.item.wseq, ctx.item.wflag, ctx.item.lotno, ctx.item.prod_qty, ctx.item.otqty, ctx.item.otqty , ctx.item.qcdate , ctx.item.winps , ctx.item.wrpsnm, ctx.item.wremark, ctx.item.psize, ctx.item.wboxsu, ctx.item.wqcqt, ctx.item.demflag , ctx.item.wbdqt, ctx.item.wcode, ctx.item.wcodenm , ctx.item.wqcqt );
                               }
                           })
                       },       
                       { binding: 'pname', header: '품목명',     align:"center",  width: 150 },                       
                       { binding: 'psize', header: '규격',     align:"center",  width: 130 }, 
                       { binding: 'wrpsnm', header: '검사자',     align:"center",  width: 130 }, 
                       { binding: 'otqty', header: '검사량',align:"center",  width: 90 },
                       { binding: 'plan_no', header: '작지번호',   align:"center", width: 150 , cssClass :'switch' } 
                   ],
                   itemsSource: view_p01tab01page
               });   
   
               new FlexGridContextMenu(wtab01Grid);  
               setHeaderColumn01(false);
               function setHeaderColumn01(headerOn) {
                   wtab01Grid.headersVisibility = headerOn
                   ? wijmo.grid.HeadersVisibility.All
                   : wijmo.grid.HeadersVisibility.Column; 
               }  
   
               // tab01검색 데이터 수집
               function getData_tab01(){    
                   var ListDto = [[${itemDtoList02}]]; 
                   // console.log("ListDto : ", ListDto);
                   var data = [];
                   var cnt = 1;
                   // var today = new Date()
                   // console.log("today->" + today);
                   for (var i = 0; i < ListDto.length; i++) {
                       var psdate = ListDto[i]["prod_sdate"];
                       psdate = psdate.substr(0,4) + '-' + psdate.substr(4,2)+ '-' + psdate.substr(6,2);
                       var ls_qcdate = ListDto[i]["qcdate"];
                       if(ls_qcdate.length > 0){
                           ls_qcdate = ls_qcdate.substr(0,4) + '-' + ls_qcdate.substr(4,2)+ '-' + ls_qcdate.substr(6,2);
                       }else{
                           ls_qcdate = "";
                       } 
                        if(ListDto[i]["demflag"] == "1"){
                            bdemflag = true;
                        }else{
                            bdemflag = false;
                        }
                       
                       var date_format = new Date(psdate);
                       data.push({
                           id: i, 
                           index: cnt,                                                                
                           prod_sdate: wijmo.DateTime.addDays(date_format, 0),
                           wono: ListDto[i]["wono"], 
                           cltnm: ListDto[i]["cltnm"], 
                           pname: ListDto[i]["pname"], 
                           psize: ListDto[i]["psize"], 
                           prod_qty: ListDto[i]["prod_qty"],
                           winqt: ListDto[i]["winqt"] , 
                           owqty: ListDto[i]["owqty"] ,  
                           otqty: ListDto[i]["otqty"] ,     
                           decision: ListDto[i]["decision"] ,    
                           plan_no: ListDto[i]["plan_no"] ,
                           ostore: ListDto[i]["ostore"] ,
                           custcd: ListDto[i]["custcd"] ,
                           spjangcd: ListDto[i]["spjangcd"] ,
                           cltcd: ListDto[i]["cltcd"] ,
                           wseq: ListDto[i]["wseq"]  ,
                           pcode: ListDto[i]["pcode"] ,
                           wflag: ListDto[i]["wflag"] ,
                           wremark: ListDto[i]["wremark"] ,
                           phmmdoc: ListDto[i]["phmmdoc"]  ,
                           winps: ListDto[i]["winps"]  ,
                           wrps: ListDto[i]["wrps"]  ,
                           lotno: ListDto[i]["lotno"]  ,
                           wrpsnm: ListDto[i]["wrpsnm"],
                           obqty: ListDto[i]["obqty"], 
                           end_qty: ListDto[i]["end_qty"], 
                           wboxsu: ListDto[i]["wboxsu"], 
                           wsumqt: ListDto[i]["wsumqt"], 
                           wbdqt: wtab01Dto[i]["wbdqt"] , 
                           wcode: wtab01Dto[i]["wcode"] , 
                           wcodenm: wtab01Dto[i]["wcodenm"] , 
                           wqcqt: wtab01Dto[i]["wqcqt"] , 
                           demflag: bdemflag, 
                           qcdate: ls_qcdate
                           
                           
                       });
                       cnt++;
                   }   
                   return data                                                         
               } 
               
               
   
               //====================================================================================================================================     
               //====================================================================================================================================
               //현황  list
               view_p01tab02page = new wijmo.collections.CollectionView(getData_wlist(), { 
               }); 
               wtab02Grid = new wijmo.grid.FlexGrid('#wtab02Grid_div', {  
                       autoGenerateColumns: false,
                       showMarquee: true,
                       isReadOnly: false, 
                       // selectionMode: 'RowRange',
                       allowSorting: 'MultiColumn',
                       alternatingRowStep: 0,
                       columns: [      
                           { binding: 'qcdate', header: '검사일', align: "center", width: 100 }, 
                           { binding: 'glotnono', header: '검사코드', align: "left", width: 250 },
                           { binding: 'otqty', header: '검사수량', align: "center", width: 100 },
                           { binding: 'wrpsnm02', header: '검사담당자', align: "center", width: 100 },   
                           { binding: 'pcode', header: '품목', align: "center", width: 150 },  
                           { binding: 'jgugek', header: '규격', align: "left", width: 150 },    
                           { binding: 'wfrdt', header: '사출시작일', align: "right", width: 100 }, 
                           { binding: 'wtrdt', header: '사출종료일', align: "right", width: 100 }, 
                           { binding: 'prod_qty', header: '사출수량', align: "right", width: 100 },  
                           { binding: 'wrpsnm01', header: '사출담당자', align: "center", width: 150 },
                           { binding: 'lotno', header: '사출바코드', align: "left", width: 150 },    
                       ], 
                       itemsSource: view_p01tab02page
                   });   
   
   
               new FlexGridContextMenu(wtab02Grid);  
               // 헤더 열 전환
               setHeaderColumn2(false);
               function setHeaderColumn2(headerOn) {
                   wtab02Grid.headersVisibility = headerOn
                   ? wijmo.grid.HeadersVisibility.All
                   : wijmo.grid.HeadersVisibility.Column; 
               } 
               wtab02Grid.showMarquee = true;
               wtab02Grid.focus();
               wijmo.toggleClass(wtab02Grid.hostElement, 'highlightActive', true);
               wtab02Grid.focus();
   
   
               //====================================================================================================================================     
               //====================================================================================================================================
   
               view_p01tab03page = new wijmo.collections.CollectionView(getData_tab03(), {
                //   pageSize: 12
               });    
               wtab03Grid = new wijmo.grid.FlexGrid('#wtab03Grid_div', {  
                   autoGenerateColumns: false,
                   isReadOnly: false,  
                   alternatingRowStep: 0,
                   columns: [
                       // { binding: 'index', header: 'seq', width: '*' },
                       // { binding: 'qcdate', header: '검사시작일',align:"center",  width: 120 },
                       { binding: 'prod_sdate', header: '생산시작일',  width: 130, align:"center", format: 'yyyy-MM-dd', isReadOnly: true  }, 
                       { binding: 'lotno', header: 'LotNo',     align:"left",  width: 200, isReadOnly: false  },
                       { binding: 'pname', header: '품목명',     align:"left",  width: 130, isReadOnly: true  },
                       { binding: 'psize', header: '규격',     align:"center",  width: 130, isReadOnly: true  },
                       { binding: 'prod_qty', header: '사출완료량',align:"center",  width: 130, isReadOnly: true  },
                       { binding: 'otqty', header: '기검사량',align:"center",  width: 90, isReadOnly: true },
                       { binding: 'obqty', header: '잔여량',align:"center",  width: 90, isReadOnly: true },
                       { binding: 'jboxsu1', header: '박스수량',align:"center",  width: 130, isReadOnly: true  },
                       { binding: 'plan_no', header: '작지번호',   align:"center", width: 150  } 
   
                   ],
                   itemsSource: view_p01tab03page
               });  
   
   
               // tab01검색 데이터 수집
               function getData_tab03(){  
                   var ListDto = [[${itemDtoList}]];  
                   var data = [];
                   var cnt = 1; 
                   var ll_obqty = 0
                   for (var i = 0; i < ListDto.length; i++) {
                       var psdate = ListDto[i]["prod_sdate"];
                       psdate = psdate.substr(0,4) + '-' + psdate.substr(4,2)+ '-' + psdate.substr(6,2);
                       // var ls_qcdate = ListDto[i]["qcdate"];
                       // if(ls_qcdate.length > 0){
                       //     ls_qcdate = ls_qcdate.substr(0,2) + '-' + ls_qcdate.substr(2,2)+ '-' + ls_qcdate.substr(4,2);
                       // }else{
                       //     ls_qcdate = "";
                       // }
   
                       ll_obqty = 0;
                       ll_obqty = ListDto[i]["prod_qty"] - ListDto[i]["otqty"];   //잔여수량
                       var date_format = new Date(psdate);
                       data.push({
                           id: i, 
                           index: cnt,                                                                
                           prod_sdate: wijmo.DateTime.addDays(date_format, 0),
                           wono: ListDto[i]["wono"], 
                           lotno: ListDto[i]["lotno"]  ,       
                           plan_no: ListDto[i]["plan_no"] ,   
                           cltcd: ListDto[i]["cltcd"] , 
                           cltnm: ListDto[i]["cltnm"], 
                           pcode: ListDto[i]["pcode"] , 
                           pname: ListDto[i]["pname"], 
                           psize: ListDto[i]["psize"], 
                           prod_qty: ListDto[i]["prod_qty"], 
                           otqty: ListDto[i]["otqty"] ,   
                           jboxsu1: ListDto[i]["jboxsu1"] ,   
                           obqty: ll_obqty 
                           
                       });
                       cnt++;
                   }   
                   //console.log(data)
                   return data                                                         
               } 
   
   
               new FlexGridContextMenu(wtab03Grid);  
               setHeaderColumn02(true);
               function setHeaderColumn02(headerOn) {
                   wtab03Grid.headersVisibility = headerOn
                   ? wijmo.grid.HeadersVisibility.All
                   : wijmo.grid.HeadersVisibility.Column; 
               } 
               // 선택기 생성
               let selector = new wijmo.grid.selector.Selector(wtab03Grid, {                
                   itemChecked: () => { 
                        showCheckedCount();
                   }                
               }); 
               function showCheckedCount() {
                   let cnt = document.getElementById('checked-count'), sel = wtab03Grid.rows.filter(r => r.isSelected);
                   //cnt.textContent = sel.length.toString();  
                   chkTabA = sel;   
                   //console.log(chkTabA);   
                   var _ls_qty = 0;   
                   var _ls_owqty = 0; 
                   var _ls_prod_qty = 0 
                   var _ls_jboxsu_qty = 0 
                   var _ls_pname = "";
                   var _ls_psize = "";
                   var _ls_cltnm = "";
                   var _ls_cltcd = "";
                   var _ls_lotno = "";
                   var _ls_plan_no = "";
                   for (var i = 0; i < sel.length; i++) { 
                       _ls_prod_qty = 0
                       _ls_prod_qty=  sel[i]._data.prod_qty; //사출완료량
                       _ls_owqty   =  sel[i]._data.owqty; //기검사량
                       _ls_pname   =  sel[i]._data.pname; //품목
                       _ls_psize   =  sel[i]._data.psize; //품목
                       _ls_cltnm   =  sel[i]._data.cltnm; //거래처
                       _ls_cltcd   =  sel[i]._data.cltcd; //거래처 
                       _ls_lotno   =  sel[i]._data.lotno; //거래처 
                       _ls_jboxsu_qty  =  sel[i]._data.jboxsu1; //거래처 
                       _ls_plan_no  =  sel[i]._data.plan_no; //거래처 
                       _ls_prod_qty = _ls_prod_qty - _ls_owqty     //검사가능수량 완료량-기검사량
                       
                       if(_ls_prod_qty < sel[i]._data.obqty){      //검사량이 가능수량보다 클경우 
                           _ls_qty   = _ls_qty + _ls_prod_qty; 
                       }else{
                           _ls_qty   = _ls_qty + sel[i]._data.obqty; 
                       } 
                   }     
                   cnt.textContent = _ls_qty.toString();
                   document.getElementById('inwotqt').value= Number(_ls_qty); 
                   document.getElementById('incltnm').value= _ls_cltnm;  
                   document.getElementById('incltcd').value= _ls_cltcd;   
                   document.getElementById('inboxsu1').value= _ls_jboxsu_qty; 
                   document.getElementById('inpsize').value= _ls_psize; 
                   document.getElementById('insalotno01').value= _ls_lotno;  
                   document.getElementById('inplan_no').value= _ls_plan_no; 
                   document.getElementById('inwqcqt').value= Number(_ls_qty);
                   chkTabA_row = sel.length;
                   if(sel.length > 1 ){
                       document.getElementById('inpname').value= _ls_pname; 
                   }else{
                       document.getElementById('inpname').value= _ls_pname + Number(sel.length - 1).toString(); 
                   }  
                   document.getElementById("wlistBtn").click();
               }  
                                 
           // // ################################################################ 
           view_p01tab04page = new wijmo.collections.CollectionView(getBadData_wlist(), {
                //   pageSize: 12
               });    
               wtab04Grid = new wijmo.grid.FlexGrid('#wtab04Grid_div', {  
                   autoGenerateColumns: false,
                   isReadOnly: false,  
                   allowAddNew: false,
                   allowDelete: true,
                   deletingRow:function(s,e){
                    console.log("deletingRow !!",s,e)
                   },
                   alternatingRowStep: 0,
                   columns: [
                       // { binding: 'index', header: 'seq', width: '*' },
                       // { binding: 'qcdate', header: '검사시작일',align:"center",  width: 120 }, 
                       { binding: 'lotno', header: 'LotNo',     align:"left",  width: 150, isReadOnly: true  }, 
                    //    { binding: 'active', header: '완료',align:"center",  width: 130, isReadOnly: true  },
                       { binding: 'prod_qty', header: '사출완료량',align:"center",  width: 130, isReadOnly: true  },
                       { binding: 'otqty', header: '기검사량',align:"center",  width: 90, isReadOnly: true },
                       { binding: 'obqty', header: '잔여량',align:"center",  width: 90, isReadOnly: true },
                       { binding: 'gqty', header: '검사수량',align:"center",  width: 90, isReadOnly:  false },  
                       { binding: 'jboxsu1', header: '박스수량',align:"center",  width: 90, isReadOnly:  false },  
                       { binding: 'plan_no', header: '작지번호',align:"center",  width: 90, isReadOnly:  true }, 
                   ],
                   itemsSource: view_p01tab04page
               });   
   
               new FlexGridContextMenu(wtab04Grid);  
               setHeaderColumn05(true);
               function setHeaderColumn05(headerOn) {
                   wtab04Grid.headersVisibility = headerOn
                   ? wijmo.grid.HeadersVisibility.All
                   : wijmo.grid.HeadersVisibility.Column; 
               } 
               // 선택기 생성
               let selector04 = new wijmo.grid.selector.Selector(wtab04Grid, {                
                   itemChecked: () => { 
                        showCheckedCount04();
                   }                
               }); 
               function showCheckedCount04() {
                   let cnt = document.getElementById('checked-count'), sel = wtab04Grid.rows.filter(r => r.isSelected);
                   //cnt.textContent = sel.length.toString();  
                   chkTabBar = sel;    
                   //console.log(chkTabA);   
                   var _ls_qty = 0;   
                   var _ls_otqty = 0; 
                   var _ls_sumotqty = 0; 
                   var _ls_insumqt = 0; 
                   var _ls_prod_qty = 0 
                   var _ls_jboxsu_qty = 0 
                   var _ls_gqty = 0  
                   _ls_insumqt = Number(document.getElementById('insumqt').value);
                   if(!_ls_insumqt){ _ls_insumqt = 0}
                   for (var i = 0; i < sel.length; i++) {  
                       _ls_prod_qty=  sel[i]._data.prod_qty; //사출완료량
                       _ls_otqty   =  sel[i]._data.otqty;   //기검사량
                       _ls_gqty   =  sel[i]._data.gqty;     //검사량 
                       _ls_jboxsu_qty  =  sel[i]._data.jboxsu1; //박스수량  
                       //_ls_prod_qty = _ls_prod_qty - _ls_owqty     //검사가능수량 완료량-기검사량
                       _ls_sumotqty = _ls_sumotqty + _ls_otqty
                       if(_ls_prod_qty < _ls_gqty ){      //검사량이 가능수량보다 클경우 
                           _ls_qty   = _ls_qty + _ls_prod_qty; 
                       }else{
                           _ls_qty   = _ls_qty + _ls_gqty; 
                       }  
                   }  
                   if(Number(_ls_qty) >   Number(_ls_jboxsu_qty )){
                     alert("검사수량이 박스수량을 초과했습니다. 박스수량을 확인하세요")
                     //return 
                   }
                   cnt.textContent = _ls_qty.toString();
                   document.getElementById('inwotqt').value = Number(_ls_qty);  //검사수량
                   document.getElementById('inboxsu1').value= _ls_jboxsu_qty;   //박스수량  
                   document.getElementById('inwqcqt').value = Number(_ls_qty) + Number(_ls_insumqt);  //완료수량   
                   //document.getElementById('insumqt').value = 0;  //누적수량   박스수량을 채우지 못하고 남은 검사수량
                  
               }  
                                   
           // // ################################################################ 
           view_p01tab05page = new wijmo.collections.CollectionView(getBadData_wlist(), {
                //   pageSize: 12
               });    
               wtab05Grid = new wijmo.grid.FlexGrid('#wtab05Grid_div', {  
                   autoGenerateColumns: false,
                   isReadOnly: false,  
                   allowAddNew: false,
                   allowDelete: true, 
                   alternatingRowStep: 0,
                   columns: [ 
                       { binding: 'lotno', header: 'LotNo',     align:"left",  width: 150, isReadOnly: true  },  
                       { binding: 'otqty', header: '검사투입양',align:"center",  width: 90, isReadOnly: true  },
                       { binding: 'wbdqt', header: '불량수량',align:"center",  width: 90, isReadOnly: true },
                       { binding: 'wqcqt', header: '총검사량',align:"center",  width: 90, isReadOnly: true },
                   ],
                   itemsSource: view_p01tab05page
               });   
   
               new FlexGridContextMenu(wtab05Grid);  
            //    setHeaderColumn05(false);
            //    function setHeaderColumn05(headerOn) {
            //        wtab05Grid.headersVisibility = headerOn
            //        ? wijmo.grid.HeadersVisibility.All
            //        : wijmo.grid.HeadersVisibility.Column; 
            //    }   
                      
           // // ################################################################
   
           //사원현황 Modalㅁ
           view_innamepage = new wijmo.collections.CollectionView(getData_wlist(), {
               //pageSize: 12
           });  
           winnameGrid = new wijmo.grid.FlexGrid('#winnameGrid_div', {  
               autoGenerateColumns: false,
               isReadOnly: false, 
               allowSorting: 'MultiColumn',
               selectionMode: 'RowRange',
               alternatingRowStep: 0,
               columns: [    
                   { binding: 'linenm',width: '*', header: '라인', width: '*', align:"center", format: '*' ,
                       cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                           text: '<b>${item.linenm}</b>',
                           click: (e, ctx) => {
                               wperidChk(ctx.item.wperid, ctx.item.wpernm );
                           }
                       })
                   }, 
                   { binding: 'wflagnm', width: '1*', header: '공정', width: '*', align:"center", format: '*' ,
                       cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                           text: '<b>${item.wflagnm}</b>',
                           click: (e, ctx) => {
                               wperidChk(ctx.item.wperid, ctx.item.wpernm );
                           }
                       })
                       }, 
                   { binding: 'wperid', width: '1*', header: '코드', width: '*', align:"center", format: '*' ,
                       cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                           text: '<b>${item.wperid}</b>',
                           click: (e, ctx) => {
                               wperidChk(ctx.item.wperid, ctx.item.wpernm );
                           }
                       })
                   }, 
                   {
                       binding: 'wpernm',
                       width: '1*',
                       header: '작업자', 
                       align:"center",
                       cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                           text: '<b>${item.wpernm}</b>',
                           click: (e, ctx) => {
                               wperidChk(ctx.item.wperid, ctx.item.wpernm );
                           }
                       })
                   } 
   
               ], 
               itemsSource: view_innamepage
           });  
           
           winnameGrid.showMarquee = true;
           winnameGrid.focus();
           wijmo.toggleClass(winnameGrid.hostElement, 'highlightActive', true);
           winnameGrid.focus();
           setHeaderColumn03(false);
           function setHeaderColumn03(headerOn) {
               winnameGrid.headersVisibility = headerOn
               ? wijmo.grid.HeadersVisibility.All
               : wijmo.grid.HeadersVisibility.Column; 
           }  
           function getData_wlist(){    
               var WperidDto = [[${wperidDto}]];  
               var data03 = [];
               var cnt = 1; 
               for (var i = 0; i < WperidDto.length; i++) {
                   data03.push({
                       id: i, 
                       index: cnt,
                       custcd:WperidDto[i]["custcd"], 
                       spjangcd:WperidDto[i]["spjangcd"], 
                       linenm:WperidDto[i]["linenm"], 
                       linecd:WperidDto[i]["linecd"], 
                       wflagcd:WperidDto[i]["wflagcd"],
                       wflagnm:WperidDto[i]["wflagnm"], 
                       wperid:WperidDto[i]["wperid"],  
                       wpernm: WperidDto[i]["wpernm"]                                                    
                   });
                   cnt++;
               }   
               return data03                                              
           }   
           function wperidChk(arg1, arg2  ){   
                   document.getElementById('inwinps').value= arg1; 
                   document.getElementById('inwrpsnm').value= arg2;   
                   $("#winnamemodal_btn").trigger("click"); 
           }   
   
          
           //불량구분 popup list
           view_wbadpage = new wijmo.collections.CollectionView(getBadData_wlist(), {
               // pageSize: 6
           });
           // // 작업설비 페이지 이동
           // new wijmo.input.CollectionViewNavigator('#thePager02', {
           //     byPage: true,
           //     headerFormat: 'Page {currentPage:n0} of {pageCount:n0}',
           //     cv: view_wbadpage
           // });     
           wbadGrid = new wijmo.grid.FlexGrid('#wbadGrid_div', {  
               autoGenerateColumns: false, 
               selectionMode: 'RowRange',
               alternatingRowStep: 0,
               columns: [  
                   { binding: 'wcode', header: '코드', align: 'center', width: '*', format: '*' , isReadOnly: true},  
                   {
                       binding: 'wcdnm',
                       width: '1*',
                       header: '불량구분', 
                       align:"left",
                       cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                           text: '<b>${item.wcdnm}</b>',
                           click: (e, ctx) => {
                               wbdgubunChk(ctx.item.wcode, ctx.item.wcdnm );
                           }
                       })
                   } 
   
               ],       
                itemsSource: view_wbadpage
           });  
           // 불량구분 데이터 수집
           function getBadData_wlist(){
   
               var WbadDto = [[${wbadDto}]];  
               var data05 = [];
               var cnt = 1;
               //console.log(WbadDto)
               for (var i = 0; i < WbadDto.length; i++) {
                   data05.push({
                       id: i, 
                       index: cnt,
                       wcode:WbadDto[i]["wcode"],
                       wcdnm: WbadDto[i]["wcdnm"],        
                   });
                   cnt++;
               }   
               return data05                                          
           }         
           
           // 헤더 열 전환
           setHeaderColumn04(false); 
           function setHeaderColumn04(headerOn) {
               wbadGrid.headersVisibility = headerOn
               ? wijmo.grid.HeadersVisibility.All
               : wijmo.grid.HeadersVisibility.Column; 
           }
           //불량구분 등록  
           function wbdgubunChk(arg1, arg2  ){   
               var ls_tab = document.getElementById('tabvalue').value;   
                   document.getElementById('inwcode').value= arg1; 
                   document.getElementById('inwcodenm').value= arg2;   
               $("#wbadqtymodal_btn").trigger("click"); 
           }   
   
   
       } 
   
   
   
   
   
            
           //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ 
           document.getElementById("inwrpsnm").addEventListener("keyup", (e)=>{ 
               if(e.keyCode === 13){  
                   document.getElementById("innamebtn").click();
                   insaflag = "A"; 
                   //insaSearchList_rtn("A"); 
               }
           });   
           document.getElementById("inwrpsnm").addEventListener("click", (e)=>{  
                   document.getElementById("innamebtn").click();
                   insaflag = "A"; 
                   //insaSearchList_rtn("A");  
           });   
   

           //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ 
           document.getElementById("inwcodenm").addEventListener("keyup", (e)=>{ 
               if(e.keyCode === 13){  
                   document.getElementById("inbdnamebtn").click();
                   insaflag = "A"; 
                   //insaSearchList_rtn("A"); 
               }
           });   
           document.getElementById("inwcodenm").addEventListener("click", (e)=>{  
                   document.getElementById("inbdnamebtn").click();
                   insaflag = "A"; 
                   //insaSearchList_rtn("A");  
           }); 
           //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$    
           document.getElementById("deleteRow").addEventListener("click",function(){ 
                if (!confirm(ls_delgetlot + " : 삭제하시겠습니까?")) {
                    return ; 
                }    
                var index = addlotno.indexOf(ls_delgetlot); 
                // 인덱스가 -1이 아니라면 (즉, 요소가 배열에 존재한다면)
                if (index !== -1) {
                    // 해당 인덱스에서 1개의 요소를 제거합니다.
                    addlotno.splice(index, 1);
                }
                view_p01tab04page.removeAt(ll_delgetrow);
                //wtab04Grid.select(0,0)
                let e = new wijmo.grid.CellEditEndingEventArgs(wtab04Grid.cells, wtab04Grid.selection); //cellEditEndingEventArgs 생성

                wtab04Grid.onDeletingRow(e)
            })

 
 

           //선택한 탭 체크 
            function tabchk_rtn(arg){
               document.getElementById('tabvalue').value = arg; 
           } 
           
           function selectdelrow(arg){
                if (!confirm(arg + " : 삭제하시겠습니까?")) {
                    return ; 
                }  
                wtab03Grid.newRowAtTop = false;
           }
           function selectChk(arg0, arg1, arg2, arg3, arg4, arg5 , arg6, arg7, arg8, arg9, arg10, arg11, arg12, arg13, arg14, arg15, arg16, arg17, arg18, arg19, arg20, arg21, arg22, arg23, arg24, arg25, arg26, arg27){ 
               //console.log(arg14)
               //custcd, spjangcd, wono, cltnm, pname, ostore, plan_no, 1-7
               //cltcd, pcode, wseq, wflag, lotno, prod_qty  otqty otqty 8-15
               //qcdate, winps , wrpsnm, wremark psize, wboxsu, wsumqt demflag 16-23  
               // wbdqt, wcode, wcodenm, wqcqt ); 24-27
               const ls_demflagEle   = document.getElementById('demflag');             //완료여부
               if(arg23){
                ls_demflagEle.checked = true;
               }else{
                ls_demflagEle.checked = false;
               }
               document.getElementById('incustcd').value= arg1; 
               document.getElementById('inspjangcd').value= arg2; 
               document.getElementById('inwono').value= arg3; 
               document.getElementById('incltnm').value= arg4;  
               document.getElementById('inpname').value= arg5; 
               document.getElementById('inostore').value= arg6; 
               document.getElementById('inplan_no').value= arg7;
               // document.getElementById('searchPlanno').value= arg7; 
               document.getElementById('incltcd').value= arg8;  
               document.getElementById('inpcode').value= arg9;   
               document.getElementById('inwseq').value= arg10;  
               document.getElementById('inwflag').value= arg11;  
               document.getElementById('inlotno').value= arg12;  
               if(arg23){
                document.getElementById('inwinqt').value = arg13;         //투입량
                document.getElementById('inwotqt').value = arg14;         //검사수량   arg15 
                document.getElementById('inwokqt').value = arg15;         //완료량     arg13 
                document.getElementById('inwqcqt').value = arg27;          //완료량     arg13 
                //document.getElementById('inputdate').value= arg16;         //검사일자  
                winputdate.value = arg16;
                document.getElementById('inwinps').value= arg17;  
                document.getElementById('inwrpsnm').value= arg18;
                document.getElementById('inwremark').value= arg19; 
                document.getElementById('insumqt').value = arg22; 
                document.getElementById('inwcode').value= arg25;  
                document.getElementById('inwcodenm').value= arg26;
                document.getElementById('inwbdqt').value = arg24; 
               }else{
                document.getElementById('insumqt').value = arg22;         //검사수량   arg15 
                // document.getElementById('inwinqt').value = arg13;         //투입량
                document.getElementById('inwotqt').value = 0;         //검사수량   arg15 
                // document.getElementById('inwokqt').value = arg15;         //완료량     arg13 
                //document.getElementById('inputdate').value= arg16; 
               }      
               document.getElementById('inpsize').value= arg20;    
               document.getElementById('inboxsu1').value= arg21; 
               
               searchList_sachul (arg12) 
           } 
            function savechk_rtn(){
                if(chkTabBar.length == 0){
                    alert("검사정보 자료를 선택하세요")
                    return false
                }

                while (lotnoArr.length > 0) {
                    lotnoArr.pop();
                    // activeArr.pop();
                    prod_qtyArr.pop();
                    otqtyArr.pop();
                    obqtyArr.pop();
                    gqtyArr.pop();
                    planArr.pop(); 
                }  
                for (var i = 0; i < chkTabBar.length; i++) { 
                    lotnoArr[i]   = chkTabBar[i]._data.lotno;
                    // activeArr[i]   = chkTabBar[i]._data.active;
                    prod_qtyArr[i]  = chkTabBar[i]._data.prod_qty; 
                    otqtyArr[i]  = chkTabBar[i]._data.otqty; 
                    obqtyArr[i]  = chkTabBar[i]._data.obqty; 
                    gqtyArr[i]  = chkTabBar[i]._data.gqty; 
                    planArr[i]  = chkTabBar[i]._data.plan_no;  
                    if(gqtyArr[i] > prod_qtyArr[i]){ 
                        alert("검사수량이 생산수량을 초과했습니다. 생산수량을 확인하세요")
                        return  false
                    }  
                }        
                return true        
            }
           function save_btn(arg){
               if(!savechk_rtn()){
                    return 
               }
               var ls_tab = document.getElementById('tabvalue').value;
               var ls_inputdate     =  convert_date(winputdate.value);  
               var ls_custcd   = 'KDMES'; 
               var ls_spjangcd = 'ZZ';  
               var ll_inwinqt  = document.getElementById('inwotqt').value;         //투입 
               var ll_inwotqt = document.getElementById('inwotqt').value;          //검사 
               var ll_inwbdqt   = document.getElementById('inwbdqt').value;             //불량수량
               var ll_inwqcqt   = document.getElementById('inwqcqt').value;             //완료수량 
               var ll_insumqt = document.getElementById('insumqt').value;          //누적수량               
               var ll_inboxsu1 = document.getElementById('inboxsu1').value;          //박스수량 
               
               var ls_inwflag  = '00020';   
               var ls_inwremark  = document.getElementById('inwremark').value;     //비고
               var ls_inwinps   = document.getElementById('inwinps').value;        //검사자코드
               var ls_inwrpsnm   = document.getElementById('inwrpsnm').value;      //검사자명
               var ls_inlotno   = document.getElementById('inlotno').value;        //검사 lotno
               var ls_insalotno   = document.getElementById('insalotno01').value;        //사출 lotno
               var ls_wono      = document.getElementById('inwono').value;               // 작지번호 
               var ls_plan_no   = document.getElementById('inplan_no').value; 
               var ls_inwcode   = document.getElementById('inwcode').value;             //불량코드
               var ls_inwbdqt   = document.getElementById('inwbdqt').value;             //불량수량
               var ls_inpcode   = document.getElementById('inpcode').value;              //제품코드 
               const ls_demflagEle   = document.getElementById('demflag');             //완료여부
               var ls_demflag = '0'; 
               
               if(!ll_insumqt || ll_insumqt == 0){      //최초입력시 누적수량은 완료수량이다. 
                   ll_insumqt = ll_inwqcqt;
               }else{ 
                    ll_insumqt =  parseInt(ll_insumqt) + parseInt(ll_inwotqt) ; //누적수량 + 완료수량
                    if(ll_inwqcqt == ll_inboxsu1){
                            ls_demflag = "1" 
                    }else{
                            
                    } 
               }    
               
               if(ll_inboxsu1 < ll_inwqcqt ){
                    alert("박스수량을 초과했습니다. 확인하세요");
                    return ;
                }  

            //    if(!ll_insumqt || ll_insumqt == 0){      //최초입력시 누적수량은 완료수량이다. 
            //        ll_insumqt = ll_inwqcqt;
            //    }else{ 
            //     if(ll_insumqt == ll_inboxsu1){
            //             ls_demflag = "1"
            //             ll_inwqcqt = ll_insumqt
            //     }else{
            //             ll_insumqt =  parseInt(ll_insumqt) + parseInt(ll_inwqcqt); //누적수량 + 완료수량
            //     } 
            //    }   
 
            //    if(ll_inboxsu1 < ll_insumqt ){
            //         alert("박스수량을 초과했습니다. 확인하세요");
            //         return ;
            //     }  

               if(!ls_inlotno){
                   ls_inlotno = "";
               } 
               if(!ll_inwqcqt){
                    ll_inwqcqt = 0;
               } 
               if(!ll_inwbdqt){
                   ll_inwbdqt = 0;
               }                                       
               if(!ll_inwotqt){
                   ll_inwotqt = 0;
               }else{ 
                   if(isNaN(ll_inwotqt)){
                       ll_inwotqt = 0;
                   }else{
                       ll_inwotqt = Number(ll_inwotqt);
                   } 
               }    
                const is_checked = ls_demflagEle.checked;  
                if (is_checked){
                    ls_demflag = "1"
                }else{ 
                    if(parseInt(ll_inboxsu1)  == parseInt(ll_insumqt) ){
                       ls_demflag = "1" 
                    }else{
                        ls_demflag = "0" 
                    }
                }  
               if (!confirm("저장하시겠습니까?")) {
                       return ; 
               }     
            //    var ls_plan_no = []; 
            //    var ll_prdqty = []; 
            //    var ll_obqty = []; 
            //    var ls_wono = []; 
            //    var ls_salotno = []; 
            //    if(chkTabA_row > 0){
            //        var gridrow = chkTabA.length ; 
            //        for( i=0; i < gridrow; i++){ 
            //            ls_plan_no[i] =  chkTabA[i]._data.plan_no;  
            //            ls_wono[i]   =  chkTabA[i]._data.wono;  
            //            //ls_salotno[i]   =  chkTabA[i]._data.lotno;  
            //            ll_prdqty[i]   =  parseInt(chkTabA[i]._data.prod_qty);  //사출량 
            //            ll_obqty[i]    =  parseInt(chkTabA[i]._data.obqty);  //검사량
            //            if(!ll_obqty[i] ){ 
            //                alert("수량을 등록하세요") 
            //                return                                           
            //            }  
            //        }     
   
            //    }else{ 
            //        ls_plan_no[0] =  '0000';
            //        ls_wono[0]   =  '0000';
            //        ls_salotno[0]   =  '0000';
            //        ll_prdqty[0]  = 0; 
            //        ll_obqty[0]  = 0; 
            //         "winqt"     : ll_prdqty
            //         "wotqt"     : ll_obqty     , 
            //    }
               switch(ls_tab){
                   case 'A': 
                       if(ls_inputdate == null || ls_inputdate.length == 0 || ls_inputdate == ""){ 
                           alert("작업일자를 등록하세요")  
                           return ;               
                       }  
                       if(ls_inlotno == null || ls_inlotno.length == 0 || ls_inlotno == ""){ 
                            if(ll_inwotqt == null || ll_inwotqt == 0 ){ 
                                alert("검사수량을를 등록하세요")  
                                return ;               
                            }   
                       }
                       
 
                        
                       $.ajax({
                           url: '/input02/w020upd',   
                           type:"POST", 
                           data: {
                               "custcd"    : ls_custcd ,
                               "spjangcd"  : ls_spjangcd, 
                               "inputdate" : ls_inputdate , 
                               "pcode"     : ls_inpcode , 
                               "plan_no"   : ls_plan_no,  
                               "lotno"     : ls_inlotno ,  
                               "winqt"     : ll_inwinqt     , 
                               "wotqt"     : ll_inwotqt     , 
                               "wqcqt"     : ll_inwqcqt     , 
                               "wboxsu"     : ll_inboxsu1     , 
                               "wsumqt"     : ll_insumqt     ,  
                               "wflag"     : ls_inwflag     ,
                               "wremark"   : ls_inwremark   ,  
                               "wrps"      : ls_inwinps     ,
                               "wono"      : ls_wono     ,
                               "salotno"   : ls_insalotno  , 
                               "inwcode" : ls_inwcode ,
                               "inwbdqt" : ll_inwbdqt ,
                               "demflag"   : ls_demflag,
                               "lotnoarr"   : lotnoArr,
                               "gqtyArr"   : gqtyArr ,
                               "planArr"   : planArr ,                               
                           },
                           async:false,
                           success:function(data){   
                               if(data == "success"){
                                   alert("저장되었습니다.") 
                                   searchList_rtn(ls_tab);  
                                   clear_rtn(ls_tab);             
                               }else{                       
                                   alert("저장중 오류가 발생했습니다. 관리자에게 문의하세요.")
                                   // listUp();
                                   console.log(data);  
                               }
                              
                           },error:function(e){
                               console.log("error"); 
                           }
                       }).done(function(fragment){           
   
                       })  
                       break;
                   case 'B':  
                       break;                
                   default:    
                       break;                
               } 
   
           } 
   
           function delete_btn(){
               var ls_tab = document.getElementById('tabvalue').value; 
               var ls_inlotno   = document.getElementById('inlotno').value; 
               var ls_inplan_no   = document.getElementById('inplan_no').value; 
                   ls_inlotno = ls_inlotno.trim(); 
   
               if(ls_inlotno == null || ls_inlotno.length == 0 || ls_inlotno == ""){ 
                       alert("삭제할 자료를 선택하세요")  
                       return ;               
                   }  
       
               if (!confirm("삭제하시겠습니까?")) {
                       return ; 
               }   
               
               switch(ls_tab){
                   case 'A': 
                       $.ajax({
                           url: '/input02/w020del',   
                           type:"POST", 
                           data: {
                               "lotno"    : ls_inlotno  ,
                               "planno"    : ls_inplan_no  
                           },
                           async:false,
                           success:function(data){
                               searchList_rtn(ls_tab);  
                               clear_rtn(ls_tab);      
                               // console.log("등록OK", data); 
                               
                           },error:function(e){
                               console.log('error',e);
                           }
                       }).done(function(fragment){           
   
                       })  
                       break; 
                           $.ajax({
                               url: '/app03/p001tab03',  
                               type:"POST",
                               data: { 
                                   "frdate"      : arg2,  
                                   "todate"      : arg3 ,  
                                   "actcdz"      : arg4 ,  
                                   "actcontcdz"  : arg5  
                               }, 
                               async:false,
                               success:function(data){   
                                   tabC_grid(data);
                               },error:function(e){
                                   console.log("error");
                                   // alert(data.code);
                                   // alert(data.message);
                               }
                           }).done(function(fragment){           
   
                           })  
                       break;                
                   default:    
                       break;                
               } 
   
           }         
           function clear_rtn(){ 
               document.getElementById('insalotno01').value = "";
               document.getElementById('inlotno').value = "";
               document.getElementById('inplan_no').value = "";
               document.getElementById('inpname').value = "";
               document.getElementById('inpsize').value = "";
               document.getElementById('inpcode').value = "";
               document.getElementById('inwinqt').value = 0;
               document.getElementById('inwokqt').value = 0;
               document.getElementById('insumqt').value = 0; 
               document.getElementById('inwotqt').value = 0;
               document.getElementById('inboxsu1').value = 0;
               document.getElementById('inwinqt').value = 0;
               document.getElementById('inwbdqt').value = 0;
               document.getElementById('insumqt').value = 0;
               document.getElementById('inwokqt').value = 0;
               document.getElementById('inwqcqt').value = 0;
               document.getElementById('inwrpsnm').value = "";
               document.getElementById('inwinps').value = ""; 
               document.getElementById('inwremark').value = ""; 
               document.getElementById('inwcodenm').value = ""; 
               document.getElementById('inwcode').value = ""; 
               document.getElementById('demflag').checked = false;
               
               var result = new Date();
               result.setHours(result.getHours() + 9); 
               var ls_date = result.toISOString().substring(0,10);  
               console.log(ls_date)
               winputdate.value = ls_date;  
               searchList_sachul ("")         
   
           }
           //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
                                        
           // tab01 검색   
           document.getElementById("searchTabABtn").addEventListener("click",function(){ 
               
               var ls_tab = document.getElementById('tabvalue').value;   
               searchList_rtn(ls_tab);
           })          
           document.getElementById("searchTabBBtn").addEventListener("click",function(){ 
               
               var ls_tab = document.getElementById('tabvalue').value;   
               searchList_rtn(ls_tab);
           })        
                         
           // Modal 검색   
           document.getElementById("searchBtn").addEventListener("click",function(){ 
               var ls_searchOrdDate = document.getElementById('searchOrdDate01').value;  
               searchList_rtn_barcode("B", ls_searchOrdDate);  //팝업에서 조회
           })   
    

           function barcode_enter(e){  
                if (e.key === 'Enter') {
                    event.preventDefault();  // Prevent the default action of the Enter key
                    var ls_insalotno01 = document.getElementById('insalotno01').value; 
                        searchList_rtn_barcode("A", ls_insalotno01);  // 바코드 스캔
                        document.getElementById('insalotno01').value = "";
                        return ;
                }
                //   if(e.keyCode == 13){
                //    var ls_insalotno01 = document.getElementById('insalotno01').value; 
                //    alert(ls_insalotno01)  
                //      searchList_rtn_barcode("A", ls_insalotno01);  // 바코드 스캔
                //      return ;
                //   }
           }
           function searchList_sachul(arg){ 
               var ls_searchdate = arg;   
                $.ajax({
                    url: '/input02/w020salist',  
                    type:"POST",
                    data: { 
                        "lotno"      : arg  
                    }, 
                    async:false,
                    success:function(data){ 
                        var ListDto = data;  
                        var dataArr = [];
                        var cnt = 1; 
                        var ll_obqty = 0; 
                        //console.log(ListDto)
                        for (var i = 0; i < ListDto.length; i++) {
                            var psdate = ListDto[i]["prod_sdate"];
                            psdate = psdate.substr(0,4) + '-' + psdate.substr(4,2)+ '-' + psdate.substr(6,2);
                            ll_obqty = 0;
                            ll_obqty = ListDto[i]["prod_qty"] - ListDto[i]["otqty"];   //잔여수량
                            var date_format = new Date(psdate);  //wijmo.DateTime.addDays(date_format, 0),
                            dataArr.push({
                                id: i, 
                                index: cnt,                                                                
                                prod_sdate: psdate, 
                                wono: ListDto[i]["wono"], 
                                lotno: ListDto[i]["lotno"]  ,       
                                plan_no: ListDto[i]["plan_no"] ,   
                                cltcd: ListDto[i]["cltcd"] , 
                                cltnm: ListDto[i]["cltnm"], 
                                pcode: ListDto[i]["pcode"] , 
                                pname: ListDto[i]["pname"], 
                                psize: ListDto[i]["psize"], 
                                prod_qty: ListDto[i]["prod_qty"], 
                                otqty: ListDto[i]["otqty"] ,   
                                wbdqt: ListDto[i]["wbdqt"] ,   
                                wqcqt: ListDto[i]["wqcqt"] ,   
                                jboxsu1: ListDto[i]["jboxsu1"] ,  
                                gqty: ListDto[i]["gqty01"] ,  
                                obqty: ll_obqty  
                            });
                            cnt++;
                        }   
                        sachul_searchlist(dataArr)  
                    },error:function(e){
                        console.log("error");
                        // alert(data.code);
                        // alert(data.message);
                    }
                }).done(function(fragment){           

                })    
   
           }    
   
           function sachul_searchlist(dataArr){ 
               wtab05Grid.columns.clear();  
               wtab05Grid.autoGenerateColumns = false; 
               view_p01tab05page.sourceCollection  = dataArr;
               var cols = new wijmo.grid.Column(); 
               cols.binding = 'lotno';
               cols.header = 'LotNo';
               cols.align = "center";
               cols.width = 200 ;  
               wtab05Grid.columns.push(cols);   
               cols = new wijmo.grid.Column(); 
               cols.binding = 'otqty';
               cols.header = '검사투입양';
               cols.align = "center";
               cols.width = 90 ; 
               wtab05Grid.columns.push(cols);  
               cols = new wijmo.grid.Column(); 
               cols.binding = 'wbdqt';
               cols.header = '불량수량';
               cols.align = "center";
               cols.width = 90 ; 
               wtab05Grid.columns.push(cols); 
               cols = new wijmo.grid.Column(); 
               cols.binding = 'wqcqt';
               cols.header = '총검사량';
               cols.align = "center";
               cols.width = 90 ; 
               cols.isReadOnly = false ; 
               wtab05Grid.columns.push(cols);   
           }                   
           function searchList_rtn_barcode(gubun, arg){ 
               var ls_searchdate = arg;  
               var ls_flag = "0" ; 
               if(gubun == "B"){
                ls_flag = "2"  
               }else{
                ls_flag = "1"  
               }
               //if(ls_searchdate == null || ls_searchdate.length == 0 || ls_searchdate == ""){  
               if(ls_flag == "2"){ 
                   if(ls_searchdate == null || ls_searchdate.length == 0 || ls_searchdate == ""){
                       ls_searchdate = "%";
                   }   
                   addlotno.push(ls_searchdate);
                   $.ajax({
                   url: '/input02/w020ordlist',  
                   type:"POST",
                   data: { 
                       "lotno"      : addlotno, 
                       "flag"      : ls_flag, 
                   }, 
                   async:false,
                   success:function(data){ 
                           var ListDto = data;  
                           var dataArr = [];
                           var cnt = 1; 
                           var ll_obqty = 0; 
                           //console.log(ListDto)
                           for (var i = 0; i < ListDto.length; i++) {
                               var psdate = ListDto[i]["prod_sdate"];
                               psdate = psdate.substr(0,4) + '-' + psdate.substr(4,2)+ '-' + psdate.substr(6,2);
                               ll_obqty = 0;
                               ll_obqty = ListDto[i]["prod_qty"] - ListDto[i]["otqty"];   //잔여수량
                               var date_format = new Date(psdate);  //wijmo.DateTime.addDays(date_format, 0),
                               dataArr.push({
                                   id: i, 
                                   index: cnt,                                                                
                                   prod_sdate: psdate, 
                                   wono: ListDto[i]["wono"], 
                                   lotno: ListDto[i]["lotno"]  ,       
                                   plan_no: ListDto[i]["plan_no"] ,   
                                   cltcd: ListDto[i]["cltcd"] , 
                                   cltnm: ListDto[i]["cltnm"], 
                                   pcode: ListDto[i]["pcode"] , 
                                   pname: ListDto[i]["pname"], 
                                   psize: ListDto[i]["psize"], 
                                   prod_qty: ListDto[i]["prod_qty"], 
                                   otqty: ListDto[i]["otqty"] ,   
                                   jboxsu1: ListDto[i]["jboxsu1"] ,   
                                   obqty: ll_obqty  
                               });
                               cnt++;
                           }  
                           if(gubun =="B"){ 
                            sachul_list(dataArr)
                           }else{ 
                            sachulBar_list(dataArr) 
                           }
   
                       },error:function(e){
                           console.log("error");
                           // alert(data.code);
                           // alert(data.message);
                       }
                   }).done(function(fragment){           
   
                   })                                  
               }else{ 
                    addlotno.push(ls_searchdate); 
                   $.ajax({
                   url: '/input02/w020ordlist',  
                   type:"POST",
                   data: { 
                       "lotno"      : addlotno,   
                       "flag"      : ls_flag, 
                   }, 
                   async:false,
                   success:function(data){ 
                           var ListDto = data;  
                           var dataArr = [];
                           var cnt = 1; 
                            var _ls_qty = 0;   
                            var _ls_owqty = 0; 
                            var _ls_prod_qty = 0 
                            var _ls_jboxsu_qty = 0 
                            var _ls_pcode = "";
                            var _ls_pname = "";
                            var _ls_psize = "";
                            var _ls_cltnm = "";
                            var _ls_cltcd = "";
                            var _ls_lotno = "";
                            var _ls_plan_no = "";
                           for (var i = 0; i < ListDto.length; i++) {
                               var psdate = ListDto[i]["prod_sdate"];
                               psdate = psdate.substr(0,4) + '-' + psdate.substr(4,2)+ '-' + psdate.substr(6,2);
                               var date_format = new Date(psdate);  //wijmo.DateTime.addDays(date_format, 0),
                               var ll_gqty = 0;
                               if(ListDto[i]["prod_qty"] - ListDto[i]["otqty"] > 0){
                                 ll_gqty = ListDto[i]["prod_qty"] - ListDto[i]["otqty"];
                               }else if(ListDto[i]["prod_qty"] - ListDto[i]["otqty"] <= 0){
                                    continue;
                               }else{
                                 ll_gqty = ListDto[i]["prod_qty"]; 
                               }
                               dataArr.push({
                                   id: i, 
                                   index: cnt,                                                                
                                   prod_sdate: psdate, 
                                   wono: ListDto[i]["wono"], 
                                   cltnm: ListDto[i]["cltnm"], 
                                   pname: ListDto[i]["pname"], 
                                   psize: ListDto[i]["psize"], 
                                   prod_qty: ListDto[i]["prod_qty"],
                                   winqt: ListDto[i]["winqt"] , 
                                   wotqt: ListDto[i]["wotqt"] ,     
                                   decision: ListDto[i]["decision"] ,    
                                   plan_no: ListDto[i]["plan_no"] ,
                                   ostore: ListDto[i]["ostore"] ,
                                   custcd: ListDto[i]["custcd"] ,
                                   spjangcd: ListDto[i]["spjangcd"] ,
                                   cltcd: ListDto[i]["cltcd"] ,
                                   wseq: ListDto[i]["wseq"]  ,
                                   pcode: ListDto[i]["pcode"] ,
                                   wflag: ListDto[i]["wflag"] ,
                                   wremark: ListDto[i]["wremark"] ,
                                   phmmdoc: ListDto[i]["phmmdoc"]  ,
                                   owqty: ListDto[i]["owqty"] ,
                                   obqty: ListDto[i]["obqty"] ,
                                   otqty: ListDto[i]["otqty"] ,
                                   wrpsnm: ListDto[i]["wrpsnm"]  ,
                                   winps: ListDto[i]["winps"]  ,
                                   wrps: ListDto[i]["wrps"]  ,
                                   lotno: ListDto[i]["lotno"] ,
                                   jboxsu1: ListDto[i]["jboxsu1"] , 
                                   active: false,
                                   gqty: ll_gqty
                               });
                               cnt++;


                                _ls_prod_qty = 0
                                _ls_prod_qty=  ListDto[i]["prod_qty"]; //사출완료량
                                _ls_owqty   =  ListDto[i]["owqty"]; //기검사량
                                _ls_pname   =  ListDto[i]["pname"]; //품목
                                _ls_pcode   =  ListDto[i]["pcode"]; //품목
                                _ls_psize   =  ListDto[i]["psize"]; //품목
                                _ls_cltnm   =  ListDto[i]["cltnm"]; //거래처
                                _ls_cltcd   =  ListDto[i]["cltcd"]; //거래처 
                                _ls_lotno   =  ListDto[i]["lotno"]; //거래처 
                                _ls_jboxsu_qty  =  ListDto[i]["jboxsu1"]; //거래처 
                                _ls_plan_no  =  ListDto[i]["plan_no"]; //거래처 
                                _ls_prod_qty = _ls_prod_qty - _ls_owqty     //검사가능수량 완료량-기검사량
                                
                                if(_ls_prod_qty < ListDto[i]["obqty"]){      //검사량이 가능수량보다 클경우 
                                    _ls_qty   = _ls_qty + _ls_prod_qty; 
                                }else{
                                    _ls_qty   = _ls_qty + ListDto[i]["obqty"]; 
                                } 
 
                                document.getElementById('inpcode').value= _ls_pcode;  
                                document.getElementById('inpname').value= _ls_pname; 
                                document.getElementById('inwotqt').value= 0; 
                                document.getElementById('incltnm').value= _ls_cltnm;  
                                document.getElementById('incltcd').value= _ls_cltcd;   
                                document.getElementById('inboxsu1').value= _ls_jboxsu_qty; 
                                document.getElementById('inpsize').value= _ls_psize; 
                                document.getElementById('insalotno01').value= _ls_lotno;  
                                document.getElementById('inplan_no').value= _ls_plan_no; 
                                document.getElementById('inwqcqt').value= 0;

                           }  
                            

                           if(gubun =="B"){ 
                            sachul_list(dataArr)
                           }else{ 
                            sachulBar_list(dataArr) 
                           } 
                           document.getElementById('insalotno01').value = "";
                       },error:function(e){
                           console.log("error");
                           // alert(data.code);
                           // alert(data.message);
                       }
                   }).done(function(fragment){           
   
                   })                   
               }    
   
           }        
   
           function sachul_list(dataArr){ 
               wtab03Grid.columns.clear();  
               wtab03Grid.autoGenerateColumns = false; 
               view_p01tab03page.sourceCollection  = dataArr;
               var cols = new wijmo.grid.Column(); 
               cols.binding = 'prod_sdate';
               cols.header = '생산시작일';
               cols.align = "center";
               cols.width = 130 ; 
               wtab03Grid.columns.push(cols);   
               cols = new wijmo.grid.Column(); 
               cols.binding = 'lotno';
               cols.header = 'LotNo';
               cols.align = "center"; 
               cols.width = 200 ; 
               wtab03Grid.columns.push(cols);   
               cols = new wijmo.grid.Column(); 
               cols.binding = 'pname';
               cols.header = '품목명';
               cols.align = "center";
               cols.width = 130 ; 
               wtab03Grid.columns.push(cols);   
               cols = new wijmo.grid.Column(); 
               cols.binding = 'psize';
               cols.header = '규격';
               cols.align = "center";
               cols.width = 130 ; 
               wtab03Grid.columns.push(cols);  
               cols = new wijmo.grid.Column(); 
               cols.binding = 'prod_qty';
               cols.header = '사출완료량';
               cols.align = "center";
               cols.width = 130 ; 
               wtab03Grid.columns.push(cols);  
               cols = new wijmo.grid.Column(); 
               cols.binding = 'otqty';
               cols.header = '기검사량';
               cols.align = "center";
               cols.width = 90 ; 
               wtab03Grid.columns.push(cols);  
               cols = new wijmo.grid.Column(); 
               cols.binding = 'obqty';
               cols.header = '잔여량';
               cols.align = "center";
               cols.width = 90 ; 
               cols.isReadOnly = false ; 
               wtab03Grid.columns.push(cols);  
               cols = new wijmo.grid.Column(); 
               cols.binding = 'jboxsu1';
               cols.header = '박스수량';
               cols.align = "center";
               cols.width = 130 ; 
               cols.isReadOnly = false ; 
               wtab03Grid.columns.push(cols);  
               cols = new wijmo.grid.Column(); 
               cols.binding = 'plan_no';
               cols.header = '작지번호';
               cols.align = "center";
               cols.width = 150 ; 
               cols.isReadOnly = false ; 
               wtab03Grid.columns.push(cols); 
           } 
           function sachulBar_list(dataArr){ 
               
                wtab04Grid.removeEventListener("click");
                wtab04Grid.collectionView.clearChanges(); 
                wtab04Grid.hostElement.addEventListener("click",function(e){
                    // console.log(e); 
                    var ht = wtab04Grid.hitTest(e);
                    if(ht.cellType === wijmo.grid.CellType.Cell){
                        if(wtab04Grid.rows[ht.row].isSelected === true){
                        console.log("kk");
                        } else { 
                            let ls_lotno = wtab04Grid.getCellData(ht.row,0); 
                            if(ls_lotno == null || ls_lotno.length == 0 || ls_lotno == ""){  
                                return ;               
                            }     
                            ll_delgetrow = ht.row
                            ls_delgetlot = ls_lotno
                        }  
                    }
                })

               wtab04Grid.columns.clear();  
               wtab04Grid.autoGenerateColumns = false; 
               view_p01tab04page.sourceCollection  = dataArr;
               var  cols = new wijmo.grid.Column(); 
               cols.binding = 'lotno';
               cols.header = 'LotNo';
               cols.align = "center";  
               cols.width = 150 ; 
               wtab04Grid.columns.push(cols);  
               cols = new wijmo.grid.Column(); 
               cols.binding = 'prod_qty';
               cols.header = '사출완료';
               cols.align = "center";
               cols.width = 80 ; 
               wtab04Grid.columns.push(cols);    
            //    cols = new wijmo.grid.Column(); 
            //    cols.binding = 'active';
            //    cols.header = '완료';
            //    cols.align = "center"; 
            //    cols.width = 80 ; 
            //    wtab04Grid.columns.push(cols);   
               cols = new wijmo.grid.Column(); 
               cols.binding = 'obqty';
               cols.header = '잔여량';
               cols.align = "center";
               cols.width = 90 ; 
               cols.isReadOnly = false ; 
               wtab04Grid.columns.push(cols);   
               cols = new wijmo.grid.Column(); 
               cols.binding = 'otqty';
               cols.header = '기검사량';
               cols.align = "center";
               cols.width = 90 ; 
               wtab04Grid.columns.push(cols);  
               cols = new wijmo.grid.Column(); 
               cols.binding = 'gqty';
               cols.header = '검사수량';
               cols.align = "center";
               cols.width = 90 ; 
               cols.isReadOnly = false ;  
               wtab04Grid.columns.push(cols);   
               cols = new wijmo.grid.Column(); 
               cols.binding = 'jboxsu1';
               cols.header = '박스수량';
               cols.align = "center";
               cols.width = 90 ; 
               cols.isReadOnly = false ;  
               wtab04Grid.columns.push(cols);  
               cols = new wijmo.grid.Column(); 
               cols.binding = 'plan_no';
               cols.header = '작지번호';
               cols.align = "center";
               cols.width = 150 ; 
               cols.isReadOnly = false ; 
               wtab04Grid.columns.push(cols); 
                
           }
           //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
           //검사량 조회 
           function searchList_rtn(ls_tab){ 
   
               var ls_frdate     =  convert_date(wfrdate.value);                    
               var ls_todate     =  convert_date(wtodate.value);  
               //var ls_searchtxt = document.getElementById('searchtxt').value; 
               if(ls_searchtxt == null || ls_searchtxt.length == 0 || ls_searchtxt == ""){  
                  ls_searchtxt = "%";
               }   
               switch(ls_tab){
                   case 'A':
                       $.ajax({
                           url: '/input02/w020',  
                           type:"POST",
                           data: { 
                               "frdate"      : ls_frdate, 
                               "todate"      : ls_todate, 
                           }, 
                           async:false,
                           success:function(data){   
                               tabA_grid(data); 
                           },error:function(e){
                               console.log("error");
                               // alert(data.code);
                               // alert(data.message);
                           }
                       }).done(function(fragment){           
   
                       })  
                       break;
                   case 'B': 
                       var ls_searchtxt = document.getElementById('jpumname').value; 
                       if(ls_searchtxt == null || ls_searchtxt.length == 0 || ls_searchtxt == ""){  
                           ls_searchtxt = "%";
                       }   
                       $.ajax({
                           url: '/input02/w020his',  
                           type:"POST",
                           data: { 
                               "searchtxt" : ls_searchtxt, 
                           }, 
                           async:false,
                           success:function(data){  
                               tabB_grid(data);
                           },error:function(e){
                               console.log("error");                            
                           }
                       }).done(function(fragment){           
   
                       })  
                       break;
                   case 'C':    
                   default:    
                       break;                
               }
           
   
           }        
           function tabA_grid(data){ 
               var wtab01Dto  = data;    
               var wtab01_data = [];
               var cnt = 1;    
               for (var i = 0; i < wtab01Dto.length; i++) { 
                       var psdate = wtab01Dto[i]["prod_sdate"];
                           psdate = psdate.substr(0,4) + '-' + psdate.substr(4,2)+ '-' + psdate.substr(6,2);
                           var ls_qcdate = wtab01Dto[i]["qcdate"];
                           if(ls_qcdate.length > 0){
                               ls_qcdate = ls_qcdate.substr(0,4) + '-' + ls_qcdate.substr(4,2)+ '-' + ls_qcdate.substr(6,2);
                           }else{
                               ls_qcdate = "";
                           }
                           if(wtab01Dto[i]["demflag"] == "1"){
                                bdemflag = true;
                            }else{
                                bdemflag = false;
                            }   
                            console.log(wtab01Dto[i]["wqcqt"])
                       wtab01_data.push({
                           id: i, 
                           index: cnt,                                                                
                           prod_sdate: psdate,
                           cltcd: wtab01Dto[i]["cltcd"] ,
                           spjangcd: wtab01Dto[i]["spjangcd"] ,
                           lotno: wtab01Dto[i]["lotno"]  ,  
                           plan_no: wtab01Dto[i]["plan_no"] ,
                           cltnm: wtab01Dto[i]["cltnm"], 
                           pcode: wtab01Dto[i]["pcode"] ,
                           pname: wtab01Dto[i]["pname"], 
                           psize: wtab01Dto[i]["psize"], 
                           wono: wtab01Dto[i]["wono"], 
                           prod_qty: wtab01Dto[i]["prod_qty"],
                           end_qty: wtab01Dto[i]["end_qty"], 
                           obqty: wtab01Dto[i]["obqty"],    
                           otqty: wtab01Dto[i]["otqty"] ,   
                           wqcqt: wtab01Dto[i]["wqcqt"] , 
                           winps: wtab01Dto[i]["winps"]  ,
                           wrps: wtab01Dto[i]["wrps"]  ,
                           wrpsnm: wtab01Dto[i]["wrpsnm"],  
                           wremark: wtab01Dto[i]["wremark"] , 
                           wboxsu: wtab01Dto[i]["wboxsu"] , 
                           wsumqt: wtab01Dto[i]["wsumqt"] , 
                           wbdqt: wtab01Dto[i]["wbdqt"] , 
                           wcode: wtab01Dto[i]["wcode"] , 
                           wcodenm: wtab01Dto[i]["wcodenm"] , 
                           demflag: bdemflag , 
                           
                           qcdate: ls_qcdate 
                           
                       });
                       cnt++;
                   }    
    
               wtab01Grid.columns.clear();  
               wtab01Grid.autoGenerateColumns = false; 
               view_p01tab01page.sourceCollection  = wtab01_data;   
               var cols = new wijmo.grid.Column(); 
               cols.binding = 'demflag';
               cols.header = '완료';
               cols.align = "center";
               cols.width = 80;   
               cols.cssClass = 'switch'
               wtab01Grid.columns.push(cols);  
               cols = new wijmo.grid.Column(); 
               cols.binding = 'qcdate';
               cols.header = '검사일';
               cols.align = "center";
               cols.width = 120; 
               wtab01Grid.columns.push(cols);   
               // cols = new wijmo.grid.Column(); 
               // cols.binding = 'prod_sdate';
               // cols.header = '생산시작일';
               // cols.align = "center";
               // cols.width = 130; 
               // cols.format = 'yyyy-MM-dd'; 
               // wtab01Grid.columns.push(cols);    
               cols = new wijmo.grid.Column(); 
               cols.binding = 'lotno';
               cols.header = '검사코드';
               cols.align = "center";
               cols.width = 150;  
               cols.cellTemplate = wijmo.grid.cellmaker.CellMaker.makeLink({ 
                   text: '<b>${item.lotno}</b>',
                   click: (e, ctx) => {
                       selectChk( "A", ctx.item.custcd, ctx.item.spjangcd, ctx.item.wono, ctx.item.cltnm, ctx.item.pname, ctx.item.ostore, ctx.item.plan_no, ctx.item.cltcd, ctx.item.pcode, ctx.item.wseq, ctx.item.wflag, ctx.item.lotno, ctx.item.prod_qty, ctx.item.otqty, ctx.item.otqty , ctx.item.qcdate, ctx.item.winps , ctx.item.wrpsnm, ctx.item.wremark, ctx.item.psize, ctx.item.wboxsu, ctx.item.wsumqt, ctx.item.demflag, ctx.item.wbdqt, ctx.item.wcode, ctx.item.wcodenm, ctx.item.wqcqt );
                   }
               });
               wtab01Grid.columns.push(cols);       
               cols = new wijmo.grid.Column(); 
               cols.binding = 'pname';
               cols.header = '품목명';
               cols.align = "center";
               cols.width = 150;   
               wtab01Grid.columns.push(cols);  
               cols = new wijmo.grid.Column(); 
               cols.binding = 'psize';
               cols.header = '규격';
               cols.align = "center";
               cols.width = 130;  
               wtab01Grid.columns.push(cols);    
               cols = new wijmo.grid.Column(); 
               cols.binding = 'wrpsnm';
               cols.header = '검사자';
               cols.align = "center";
               cols.width = 130; 
               cols.format = 'yyyy-MM-dd'; 
               wtab01Grid.columns.push(cols);    
               cols = new wijmo.grid.Column(); 
               cols.binding = 'otqty';
               cols.header = '검사량';
               cols.align = "center";
               cols.width = 90;  
               wtab01Grid.columns.push(cols);     
               cols = new wijmo.grid.Column(); 
               cols.binding = 'plan_no';
               cols.header = '작지번호';
               cols.align = "center";
               cols.width = 150;   
               wtab01Grid.columns.push(cols);    
    
           }
   
           function tabB_grid(data){
               var wtab02Dto  = data;    
               var wtab02_data = [];
               var cnt = 1;    
               var glotno = "";
               var ls_qcdate = "";
               var ls_glotno = "";
               var ls_otqty = 0;    
   
               for (var i = 0; i < wtab02Dto.length; i++) { 
                       var psdate = wtab02Dto[i]["prod_sdate"];
                           psdate = psdate.substr(0,4) + '-' + psdate.substr(4,2)+ '-' + psdate.substr(6,2);
                           var ls_qcdate = wtab02Dto[i]["qcdate"];
                           if(ls_qcdate.length > 0){
                               ls_qcdate = ls_qcdate.substr(0,4) + '-' + ls_qcdate.substr(4,2)+ '-' + ls_qcdate.substr(6,2);
                           }else{
                               ls_qcdate = "";
                           }
                       if( glotno == wtab02Dto[i]["glotnono"] ){
                           ls_otqty = 0;
                           ls_qcdate = "";
                           ls_glotno = "";
                       }else{
                           ls_otqty = wtab02Dto[i]["wqcqt"];    
                           ls_qcdate = wtab02Dto[i]["qcdate"];    
                           ls_glotno = wtab02Dto[i]["glotnono"];  
                       }
                       glotno = wtab02Dto[i]["glotnono"];
                       wtab02_data.push({
                           id: i, 
                           index: cnt,                                                                
                           prod_sdate: psdate,
                           cltcd: wtab02Dto[i]["cltcd"] ,
                           end_qty: wtab02Dto[i]["end_qty"] ,
                           cltnm: wtab02Dto[i]["cltnm"] ,
                           lotno: wtab02Dto[i]["lotno"]  ,    
                           pcode: wtab02Dto[i]["pcode"] ,
                           pname: wtab02Dto[i]["pname"], 
                           psize: wtab02Dto[i]["psize"],  
                           wfrdt: wtab02Dto[i]["wfrdt"],
                           wtrdt: wtab02Dto[i]["wtrdt"],
                           prod_qty: wtab02Dto[i]["prod_qty"] , 
                           wrpsnm01: wtab02Dto[i]["wrpsnm01"],   
                           lotno: wtab02Dto[i]["lotno"]  ,
                           qcdate: ls_qcdate  ,
                           glotnono: ls_glotno,  
                           otqty: ls_otqty , 
                           wrpsnm02: wtab02Dto[i]["wrpsnm02"] , 
                           qcdate: ls_qcdate 
                           
                       });
                       cnt++;
                   }    
    
               wtab02Grid.columns.clear();  
               wtab02Grid.autoGenerateColumns = false; 
               view_p01tab02page.sourceCollection  = wtab02_data; 
               var cols = new wijmo.grid.Column(); 
               cols.binding = 'qcdate';
               cols.header = '검사일';
               cols.align = "center";
               cols.format = 'yyyy-MM-dd'; 
               cols.width = 120;   
               wtab02Grid.columns.push(cols);     
   
               cols = new wijmo.grid.Column(); 
               cols.binding = 'glotnono';
               cols.header = '검사코드';
               cols.align = "center";
               cols.width = 150;  
               wtab02Grid.columns.push(cols);     
   
               cols = new wijmo.grid.Column(); 
               cols.binding = 'otqty';
               cols.header = '검사수량';
               cols.align = "right";
               cols.width = 90;  
               wtab02Grid.columns.push(cols);    
   
               cols = new wijmo.grid.Column(); 
               cols.binding = 'wrpsnm02';
               cols.header = '검사담당자';
               cols.align = "center";
               cols.width = 120;  
               wtab02Grid.columns.push(cols);   

               cols = new wijmo.grid.Column(); 
               cols.binding = 'end_qty';
               cols.header = '검사수량';
               cols.align = "right";
               cols.width = 130;  
               wtab02Grid.columns.push(cols);     

               cols = new wijmo.grid.Column(); 
               cols.binding = 'lotno';
               cols.header = '사출바코드';
               cols.align = "center";
               cols.width = 150;  
               wtab02Grid.columns.push(cols);   
   
               cols = new wijmo.grid.Column();  
               cols.binding = 'cltnm';
               cols.header = '거래처';
               cols.align = "center";
               cols.width = 150;  
               wtab02Grid.columns.push(cols);      
               cols = new wijmo.grid.Column(); 
               cols.binding = 'pname';
               cols.header = '품목명';
               cols.align = "left";
               cols.width = 250;  
               wtab02Grid.columns.push(cols);  
               cols = new wijmo.grid.Column(); 
               cols.binding = 'psize';
               cols.header = '규격';
               cols.align = "left";
               cols.width = 150;  
               wtab02Grid.columns.push(cols); 
               cols = new wijmo.grid.Column(); 
               cols.binding = 'wfrdt';
               cols.header = '사출시작일';
               cols.align = "center";
               cols.width = 130;  
               cols.format = 'yyyy-MM-dd'; 
               wtab02Grid.columns.push(cols);   
               cols = new wijmo.grid.Column(); 
               cols.binding = 'wtrdt';
               cols.header = '사출종료일';
               cols.align = "center";
               cols.width = 130;  
               cols.format = 'yyyy-MM-dd'; 
               wtab02Grid.columns.push(cols);   
               cols = new wijmo.grid.Column(); 
               cols.binding = 'prod_qty';
               cols.header = '사출수량';
               cols.align = "right";
               cols.width = 130;  
               wtab02Grid.columns.push(cols);    
               cols = new wijmo.grid.Column(); 
               cols.binding = 'wrpsnm01';
               cols.header = '사출담당자';
               cols.align = "center";
               cols.width = 120;  
               wtab02Grid.columns.push(cols);     
           } 
     
   //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
   
   
           $(document).ready(function() {  
               init()          
               getToday()
               fn_egov_init_date()  
           })
       
           function init(){ 
                        wfrdate = new wijmo.input.InputDate('#frdate', {
                            isRequired: false,
                            value: null,
                            placeholder: '',
                            format: 'yyyy-MM-dd', 
                        });
                        wtodate = new wijmo.input.InputDate('#todate', {
                            isRequired: false,
                            value: null,
                            placeholder: '',
                            format: 'yyyy-MM-dd', 
                        }); 
                        winputdate = new wijmo.input.InputDate('#inputdate', {
                            isRequired: false,
                            value: null, 
                            placeholder: '',
                            format: 'yyyy-MM-dd', 
                        }); 
  
                        var result = new Date();
                        result.setHours(result.getHours() + 9); 
                        var ls_date = result.toISOString().substring(0,10); 
                        wfrdate.value = ls_date;   
                        wtodate.value = ls_date;     
                        winputdate.value = ls_date;
                          
           }  
           function convert_date(arg_date){ 
                var ls_arg_date = String(arg_date); 
                if(ls_arg_date == null || ls_arg_date.length == 0 || ls_arg_date == ""|| ls_arg_date == "null"){  
                    return "";
                }  
                // Date 객체로 변환
                const dateObj = new Date(arg_date);

                // 년, 월, 일 추출 (월은 0부터 시작하므로 +1 필요)
                const year = dateObj.getFullYear();
                const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                const day = String(dateObj.getDate()).padStart(2, '0');

                // "YYYY-MM-DD" 형식으로 변환
                const formattedDate = `${year}${month}${day}`;
                arg_date = formattedDate; 
                return arg_date; 
            }
           function test_rtn(arg1){
               console.log(arg1);
               const disHtml = `
                   <div class="tab-pane fade show active" id=${arg1} role="tabpanel" aria-labelledby="profile-tab">${arg1}</div>`
               $('#btnDiv02').before(disHtml);
           }
   
   
           function getToday(){
               let today = new Date();   
   
               let year = today.getFullYear(); // 년도
               let month = today.getMonth() + 1;  // 월
               let date = today.getDate();  // 날짜
               let day = today.getDay();  // 요일
               if(month > 0 && month < 10) {month = "0" + month};
               if(date > 0 && date < 10) {date = "0" + date};
               let ls_frday = year + '-' + month + '-01' 
               let ls_today = year + '-' + month + '-' + date 
               // document.getElementById('inputdate').value = ls_today;
               // document.getElementById('todate').value = ls_today;
           }
   
           function convert_time(timestamp){ 
               //현재시간
               var date = new Date(timestamp); 
               var year = date.getFullYear();
               var month = ("0" + (1 + date.getMonth())).slice(-2);
               var day = ("0" + date.getDate()).slice(-2); 
               var hh = date.getHours();  
               var min = ('0' + date.getMinutes()).slice(-2) 
               time = year +  month +  day   ;
               return time;  
           }
   
           function fn_egov_init_date(){
                
           }
    
           class FlexGridContextMenu {
               constructor(grid) {
                   let host = grid.hostElement, menu = this._buildMenu(grid);
                   host.addEventListener('contextmenu', (e) => {
                       // 클릭된 셀/열 선택
                       let sel = grid.selection, ht = grid.hitTest(e), row = ht.getRow();
                       ll_delgetrow = ht.getRow(); 
                       switch (ht.panel) {
                           case grid.cells:
                           let colIndex = ht.col;
                           // 만약 그룹 헤더이면, 그룹 열 선택
                           if (row instanceof wijmo.grid.GroupRow && row.dataItem instanceof wijmo.collections.CollectionViewGroup) {
                               let gd = row.dataItem.groupDescription;
                               if (gd instanceof wijmo.collections.PropertyGroupDescription) {
                               let col = grid.getColumn(gd.propertyName);
                               if (col && col.index > -1) {
                                   colIndex = col.index;
                               }
                               }
                           }
                           grid.select(ht.row, colIndex);
                           break;
                           case grid.columnHeaders:
                           grid.select(sel.row, ht.col);
                           break;
                           case grid.rowHeaders:
                           grid.select(ht.row, sel.col);
                           break;
                           default:
                           return; // 유효하지 않는 패널
                       }
                       // 현재 열에 대한 메뉴 표시
                       if (grid.selection.col > -1) {
                           e.preventDefault(); // 브라우저의 기본 메뉴 취소
                           menu.show(e); // Wijmo 메뉴 표시
                       }
                   }, true);
               }
               _buildMenu(grid) {
                   let menu = new wijmo.input.Menu(document.createElement('div'), {
                   owner: grid.hostElement,
                   displayMemberPath: 'header',
                   subItemsPath: 'items',
                   commandParameterPath: 'cmd',
                   dropDownCssClass: 'ctx-menu',
                   openOnHover: true,
                   closeOnLeave: true,
                   itemsSource: [
                       {
                       header: '정렬', items: [
                           { header: 'Ascending', cmd: 'SRT_ASC' },
                           { header: 'Descending', cmd: 'SRT_DESC' },
                           { header: 'No Sort', cmd: 'SRT_NONE' },
                           { header: '-' },
                           { header: 'Clear All Sorts', cmd: 'SRT_CLR' }
                       ]
                       },
                       { header: '-' },
                       { header: 'Pin/Unpin', cmd: 'PIN' },
                       { header: '-' },
                       { header: 'AutoSize', cmd: 'ASZ' },
                       { header: 'AutoSize All', cmd: 'ASZ_ALL' },
                       { header: '-' },
                       { header: 'Group/Ungroup', cmd: 'GRP' },
                       { header: 'Clear All Groups', cmd: 'GRP_CLR' },
                       { header: '-' },
                       {
                       header: '내려받기', items: [
                           { header: 'CSV', cmd: 'X_CSV' },
                           { header: 'XLSX', cmd: 'X_XLSX' },
                           { header: 'PDF', cmd: 'X_PDF' },
                       ]
                       }
                   ],
                   command: {
                       // 메뉴 명령 활성화/비활성화
                       canExecuteCommand: (cmd) => {
                       let view = grid.collectionView, col = grid.columns[grid.selection.col];
                       switch (cmd) {
                           case 'SRT_ASC':
                           return col.currentSort != '+';
                           case 'SRT_DESC':
                           return col.currentSort != '-';
                           case 'SRT_NONE':
                           return col.currentSort != null;
                           case 'SRT_CLR':
                           return view.sortDescriptions.length > 0;
                           case 'PIN':
                           return true; // toggle pin
                           case 'ASZ':
                           case 'ASZ_ALL':
                           return true;
                           case 'GRP':
                           return col.dataType != wijmo.DataType.Number; // don't group numbers
                           case 'GRP_CLR':
                           return view.groupDescriptions.length > 0;
                       }
                       return true;
                       },
                       // 메뉴 명령 실행
                       executeCommand: (cmd) => {
                           let view = grid.collectionView, cols = grid.columns, col = cols[grid.selection.col], sd = view.sortDescriptions, gd = view.groupDescriptions;
                           switch (cmd) {
                               case 'SRT_ASC':
                               case 'SRT_DESC':
                               case 'SRT_NONE':
                               if (grid.allowSorting != wijmo.grid.AllowSorting.MultiColumn) {
                                   sd.clear();
                               }
                               else {
                                   for (let i = 0; i < sd.length; i++) {
                                   if (sd[i].property == col.binding) {
                                       sd.removeAt(i);
                                       break;
                                   }
                                   }
                               }
                               if (cmd != 'SRT_NONE') {
                                   sd.push(new wijmo.collections.SortDescription(col.binding, cmd == 'SRT_ASC'));
                               }
                                   break;
                               case 'SRT_CLR':
                                   sd.clear();
                                   break;
                               case 'PIN':
                                   let fCols = grid.frozenColumns;
                                   if (col.index >= fCols) { // pinning
                                       cols.moveElement(col.index, fCols, false);
                                       cols.frozen++;
                                   }
                                   else { // unpinning
                                       cols.moveElement(col.index, fCols - 1, false);
                                       cols.frozen--;
                                   }
                                   break;
                               case 'ASZ':
                                   grid.autoSizeColumn(col.index);
                                   break;
                               case 'ASZ_ALL':
                                   grid.autoSizeColumns(0, grid.columns.length - 1);
                                   break;
                               case 'GRP':
                               // 그룹 삭제
                                   for (let i = 0; i < gd.length; i++) {
                                       if (gd[i].propertyName == col.binding) {
                                       gd.removeAt(i);
                                       return; // we're done
                                       }
                                   }
                                   // 그룹 추가
                                   gd.push(new wijmo.collections.PropertyGroupDescription(col.binding));
                                   break;
                               case 'GRP_CLR':
                                   gd.clear();
                                   break;
                               // 내보내기
                               case 'X_CSV':
                                   let rng = new wijmo.grid.CellRange(0, 0, grid.rows.length - 1, grid.columns.length - 1), csv = grid.getClipString(rng, wijmo.grid.ClipStringOptions.CSV, true, false);
                                   wijmo.saveFile(csv, 'FlexGrid.csv');
                                   break;
                               case 'X_XLSX':
                                   const gridView = grid.collectionView;
                                   let oldPgSize = gridView.pageSize, oldPgIndex = gridView.pageIndex;
   
                                   grid.beginUpdate();
                                   gridView.pageSize = 0;
   
                                   wijmo.grid.xlsx.FlexGridXlsxConverter.saveAsync(grid, {includeCellStyles: true, includeColumnHeaders: true}, 'FlexGrid.xlsx',
                                   saved => {
                                   gridView.pageSize = oldPgSize;
                                   gridView.moveToPage(oldPgIndex);
                                   grid.endUpdate();
                                   }, null
                                   ); 
                                   break;
                               case 'X_PDF':
                                   wijmo.grid.pdf.FlexGridPdfConverter.export(grid, 'FlexGrid.pdf', {
                                       maxPages: 10,
                                       scaleMode: wijmo.grid.pdf.ScaleMode.PageWidth,
                                       documentOptions: {
                                       compress: true,
                                       header: { declarative: { text: '\t&[Page] of &[Pages]' } },
                                       footer: { declarative: { text: '\t&[Page] of &[Pages]' } },
                                       info: { author: 'GrapeCity', title: 'FlexGrid' }
                                       },
                                       styles: {
                                       cellStyle: { backgroundColor: '#ffffff', borderColor: '#c6c6c6' },
                                       altCellStyle: { backgroundColor: '#f9f9f9' },
                                       groupCellStyle: { backgroundColor: '#dddddd' },
                                       headerCellStyle: { backgroundColor: '#eaeaea' }
                                       }
                                   });
                                   break;
                           }
                           // 활성화 그리드 셀에 포커스 복원
                           grid.refresh();
                           let sel = grid.selection, cell = grid.cells.getCellElement(sel.row, sel.col);
                           if (cell) {
                               cell.focus();
                           }
                       }
                   }
                   });
                   // 완료
                   return menu;
               }
           }        
   
   
       </script>
     

</div>   

                            
                    <!-- ######################### ######################### ######################### ######################### ######################### ######################### -->
                    
                </div>
                    <!------footer ------>
                    <!-- <footer th:replace="layouts/XDashBoard/XDashBoard_footer :: XDashBoard_footer"></footer> -->
                    <!--------------------->  
            </div>
        </main>
    </div>
</header>