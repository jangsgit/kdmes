<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<header th:fragment="headerFragment">
    <!-- py-md-2 px-1 py-1 -->
    <div class="card-body d-flex align-items-center py-md-2 px-auto py-auto ">
        <main class="main" id="top"> 
            <div class="container-fluid"> 
                <script>
                    var isFluid = JSON.parse(localStorage.getItem('isFluid'));
                    if (isFluid) {
                        var container = document.querySelector('[data-layout]');
                        container.classList.remove('container');
                        container.classList.add('container-fluid');
                    }
                </script>

                <nav class="navbar navbar-light navbar-vertical navbar-expand-xl">
                    <script>
                        var navbarStyle = localStorage.getItem("navbarStyle");
                        if (navbarStyle && navbarStyle !== 'transparent') {
                            document.querySelector('.navbar-vertical').classList.add(`navbar-${navbarStyle}`);
                        }
                    </script>
                    <div class="d-flex align-items-center">
                        <div class="toggle-icon-wrapper">

                            <button class="btn navbar-toggler-humburger-icon navbar-vertical-toggle"
                                data-bs-toggle="tooltip" data-bs-placement="left" title="Toggle Navigation"><span
                                    class="navbar-toggle-icon"><span class="toggle-line"></span></span></button>

                        </div><a class="navbar-brand" href="@{/user}">
                            <!-- <div class="d-flex align-items-center py-3"><img class="me-2"
                                    th:src="@{assets/img/icons/spot-illustrations/falcon.png}" alt="" width="40" /><span
                                    class="font-sans-serif">ActasErp</span>
                            </div> -->
                        </a>
                    </div> 
                    <!------navbar vertical------>     
                    <div th:replace="layouts/layout01/navbarMemWeb :: navbar"></div>  
                </nav>
                <div class="content" id="index02"> 
                    <!------nav ------>
                    <!-- <div th:replace="layouts/layout01/headerNavWeb :: headerNav"></div>   -->

                    <body layout:fragment="index02"> 
                    <!-- ######################### ######################### ######################### ######################### ######################### ######################### -->

<!-- contents body 시작--> 
<!-- form 또는 action 으로 받아오기  --> 
<div class="con">  
    <div class="card-body bg-light">
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active" data-toggle="tab" href="#step01" onclick="tabchk_rtn('A')">설비등록</a>
            </li>
            <!-- <li class="nav-item">
                <a class="nav-link" data-toggle="tab" href="#step02"  onclick="tabchk_rtn('B')">설비이력등록</a>
            </li>  -->
            <!-- <li class="nav-item">
                <a class="nav-link" data-toggle="tab" href="#step03"   onclick="tabchk_rtn('C')">수리내역카드인쇄</a>
            </li> -->
                <input type="hidden" id="tabvalue" value="A">
        </ul>
        <div class="tab-content">
            <div class="tab-pane fade show active" id="step01">  

                <div class="section regist"> 
                    <div class="sec_con" style="width: 45%; ">  
                        <div class="box_wrap">
                            <div class="box_input" >
                                <div class="date_wrap">
                                    <div class="dropdown-container"> 
                                            <input type="text"  id="searchtxt" placeholder="설비명/모델명" style="width: 300px; padding: 10px; font-size: 16px;">
                                            <button type="button" id="retrieveBtn" >검색</button> 
                                    </div>
                                    <!-- <input type="text"  id="searchtxt" placeholder="거래처명">  -->
                                    <!-- <button type="button" id="retrieveBtn" >검색</button>       -->
                                </div>                              
                                <!-- //여기서부터 그래프 -->
                                <div class="table table_style2"> 
                                    <div class="container-fluid" id="op1" >
                                        <div id="wtab04Grid_div"  style="overflow:scroll;   height:400px;  width: 580px;  margin:0 auto; "></div>
                                    </div>  
                                </div>  
                                
                                <div class="table table_style1"  >
                                    <table>
                                        <tbody> 
                                            <tr>
                                                <td id="cell1"></td>
                                                <td id="cell2"></td>
                                            </tr>   
                                            <tr>
                                                <td id="cell3"></td>
                                                <td id="cell4"></td>
                                            </tr>  
                                            <tr>
                                                <td id="cell5"></td>
                                                <td id="cell6"></td>
                                            </tr>  
                                        </tbody>
                                    </table>
                                </div>        

                            </div>  <!---  <div class="box_input" >  -->
                        </div>    <!--  <div class="box_wrap"> -->  
                    </div>
        
                    <!-- 우측 전체 테이블 --> 
                    <div class="sec_con" style="width: 50%;"> 
                            <div class="table table_style1"  >
                                <table>
                                    <tbody  >     
                                        <tr>  
                                            <th>설비구분<h5 style="color:rgb(255, 166, 0); float:right;">★</h5></th>
                                            <td colspan="2"> 
                                                <div class="input_wrap">                          
                                                    <select id="infacflag" onchange="updateTable(this.value)">
                                                        <option value="01">사출기</option>
                                                        <option value="02">로봇</option>
                                                        <option value="03">열풍기</option>
                                                        <option value="04">자동화기</option>
                                                        <option value="05">슬리브검사</option>
                                                    </select> 
                                                </div>                                                                    
                                            </td>                                            
                                            <th>관리번호<h5 style="color:rgb(255, 166, 0); float:right;">★</h5></th> 
                                            <td colspan="2"> 
                                                <div class="input_wrap">                                               
                                                    <input class="form-control form-control-sm" id="infacno" type="text"    autocomplete="off"  placeholder=""> 
                                                    <input class="form-control form-control-sm" id="infaccd" type="hidden"    autocomplete="off"  placeholder=""> 
                                                    
                                                </div>        
                                            </td> 
                                        </tr>
                                        <tr>  
                                            <th>등록일</th>
                                            <td colspan="2"> 
                                                    <input type="text"  class="form-control datetimepicker" id="infacdate" autocomplete="off"  placeholder="Y-m-d"     >                                                              
                                            </td>                                            
                                            <th>설비명<h5 style="color:rgb(255, 166, 0); float:right;">★</h5></th> 
                                            <td colspan="2"> 
                                                <div class="input_wrap">                                               
                                                    <input class="form-control form-control-sm" id="infacname" type="text"    autocomplete="off"  placeholder=""> 
                                                </div>        
                                            </td> 
                                        </tr>
                                        <tr>                                            
                                            <th>모델명<h5 style="color:rgb(255, 166, 0); float:right;">★</h5></th> 
                                            <td  colspan="2">
                                                <div class="input_wrap">                                               
                                                    <input class="form-control form-control-sm" id="infacmodel" type="text"    autocomplete="off"  placeholder=""> 
                                                </div>                                                
                                            </td>
                                            <th>제조사</th>
                                            <td colspan="2">
                                                <div class="input_wrap">                                               
                                                    <input type="text"  id="infacjaejo" autocomplete="off"   > 
                                                </div>       
                                            </td>    
                                        </tr>
                                        <tr>                                                                                              
                                            <th>제조번호</th> 
                                            <td  colspan="2">
                                                <div class="input_wrap">     
                                                    <input type="text" id="infacjaejono" placeholder=""  >
                                                </div>
                                            </td>
                                            <th>제조일</th>
                                            <td colspan="2">
                                                <input type="text"  class="form-control datetimepicker" id="infacstdate" autocomplete="off"  placeholder="Y-m-d"     >                                                                                                                                                               
                                            </td>                                                                                   
                                        </tr>  
                                        <tr>      
                                            <th>구매회사</th>
                                            <td colspan="2">
                                                <div class="input_wrap">            
                                                    <input type="text" id="infacbycltnm" placeholder=""  >
                                                </div>       
                                            </td>                                                 
                                            <th>구매일</th> 
                                            <td colspan="2">
                                                <div class="input_wrap">
                                                    <input type="text"  class="form-control datetimepicker" id="infaceddate" autocomplete="off"  placeholder="Y-m-d"     >
                                                </div>
                                            </td>                                      
                                        </tr>      
                                        <tr>    
                                            <th>구매담당자</th>
                                            <td colspan="2">
                                                <div class="input_wrap">
                                                    <input type="text" id="infacbypernm" placeholder=""  >
                                                </div>
                                            </td>                                      
                                            <th>연락처</th>
                                            <td colspan="2">
                                                <div class="input_wrap">
                                                    <input type="text" id="infactelno" placeholder=""  >
                                                </div>
                                            </td>  
                                        </tr>
                                        <tr>                                 
                                            <th>구분</th>
                                            <td colspan="2"> 
                                                <div class="input_wrap">
                                                    <input type="text"  id="infacgubun" autocomplete="off"  placeholder="" >                                        
                                                </div>
                                            </td>  
                                            <th>구매가</th>
                                            <td colspan="2">
                                                <div class="input_wrap">                                               
                                                    <input type="number"  id="infacamt" autocomplete="off"  placeholder="" >  
                                                </div>
                                            </td>                                               
                                        </tr>  
                                        <tr> 
                                            <th>전원</th>
                                            <td colspan="2">
                                                <div class="input_wrap">                                               
                                                    <input type="text"  id="infacjunwon" autocomplete="off"  placeholder="" >  
                                                </div>
                                            </td>                                        
                                            <th>사용부서</th> 
                                            <td  colspan="2">
                                                <div class="input_wrap">                                               
                                                    <input type="text"  id="infacdivnm" autocomplete="off"   > 
                                                </div>
                                            </td> 
                                        </tr>   
                                        <tr> 
                                            <th>기타내용</th>
                                            <td colspan="5">
                                                <div class="input_wrap">                                               
                                                    <input type="text"  id="infacgita" autocomplete="off"  placeholder="" >  
                                                </div>
                                            </td>         
                                        </tr> 
                                        <div data-name="fileDiv" class="form-group filebox bs3-primary">
                                            <tr>
                                                <th>첨부사진 #0</th>
                                                <td colspan="5">
                                                    <!-- <label for="file_0" class="col-sm-2 control-label">파일1</label> -->
                                                    <div class="col-sm-15">
                                                        <input type="text" class="upload-name" value="파일 찾기" readonly />
                                                        <label for="file_0" class="control-label">.</label>
                                                        <input type="file" name="files_0" id="file_0" multiple='multiple'  class="upload-hidden" onchange="changeFilename(this)" />

                                                        <button type="button" onclick="addFile()" class="btn btn-bordered btn-xs visible-xs-inline visible-sm-inline visible-md-inline visible-lg-inline">
                                                            <i class="fa fa-plus" aria-hidden="true"></i>
                                                        </button>
                                                        <button type="button" onclick="removeFile(this)" class="btn btn-bordered btn-xs visible-xs-inline visible-sm-inline visible-md-inline visible-lg-inline">
                                                            <i class="fa fa-minus" aria-hidden="true"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </div>
                                    </tbody>
                                </table>
        
                                <div data-name="addDiv" id="dynamicTable" class="form-group filebox bs3-primary" >

                                </div>
                                <div id="btnDiv" class="btn_wrap" style="float: right; margin-bottom: 10px;">
                                    <div class="btns" >                                                        
                                        <button class="btn btn-outline-danger me-1 mb-1"  style="display:inline; color:#dc3545; " type="button" id="delete" onclick="delete_btn()"><span class="fas fa-trash ms-1" data-fa-transform="shrink-3"></span><span style="color: #084661;">삭제</span></button>
                                        <button class="btn btn-outline-info me-1 mb-1"  type="button" style="color: #27bcfd;" onclick="clear_rtn()"><span class="fas fa-plus me-1" data-fa-transform="shrink-3"></span><span style="color: #084661;">신규</span></button>                                                                                                
                                        <button class="btn btn-outline-warning me-1 mb-1 " type="button" style="color: #f5803e;" id="save" onclick="save_btn()"><span style="color: #084661;">저장</span></button>                                    
                                        <button class="btn btn-outline-primary me-1 mb-1 " type="button" style="color: #2506d1;" id="save" onclick="prtprocess_rtn()"><span style="color: #084661;">설비카드</span></button>                                    
                                    </div>                                     
                                </div> <!-- btn_wrap -->                             
                            </div> <!-- table style-->   
                    </div>        <!-- sec con-->        
                </div>            <!-- section regist -->       




            </div> 
            <div class="tab-pane fade show" id="step02"> 
                <div class="table-responsive">
                    <table class="table table-borderless" style="height: 100px;" >
                        <tbody>
                        <tr>  
                            <td class="align-top"> 
                                <div class="row gx-3" style="  margin: 10px 10px 10px;">
                                    <div class="col-auto">
                                        <div class="input-group input-group-sm mb-3"><span class="input-group-text" id="inputGroup-sizing-sm">품번</span> 
                                            <input type="text" class="form-control form-control-sm" id="infixmachcd" autocomplete="off" disabled    > 
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <div class="input-group input-group-sm mb-3"><span class="input-group-text" id="inputGroup-sizing-sm">품명</span> 
                                            <input type="text" class="form-control form-control-sm" id="infixmachname" autocomplete="off" disabled    > 
                                        </div>
                                    </div>                                                    
                                    <div class="col-auto">
                                        <div class="input-group input-group-sm mb-3"><span class="input-group-text" id="inputGroup-sizing-sm">금형번호</span> 
                                            <input type="text" class="form-control form-control-sm" id="infixmachno" autocomplete="off" disabled    > 
                                        </div>
                                    </div>   
                                </div>           
                                <div class="row gx-3" style="  margin: 10px 10px 10px;">
                                    <div class="col-auto">
                                        <div class="input-group input-group-sm mb-3"><span class="input-group-text" id="inputGroup-sizing-sm">의뢰일</span> 
                                            <input type="text"  class="form-control datetimepicker" id="inreqdate" autocomplete="off"  placeholder="Y-m-d"     > 
                                            <input type="hidden"  id="infixid" autocomplete="off"   >  
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <div class="input-group input-group-sm mb-3"><span class="input-group-text" id="inputGroup-sizing-sm">완료일</span> 
                                            <input type="text"  class="form-control datetimepicker" id="inrespdate" autocomplete="off"  placeholder="Y-m-d"     > 
                                        </div>
                                    </div>                                                    
                                    <div class="col-auto">
                                        <div class="input-group input-group-sm mb-3"><span class="input-group-text" id="inputGroup-sizing-sm">수리내용</span> 
                                            <input class="form-control form-control-sm" id="infixtext" type="text"    autocomplete="off" style="width: 400px;">  
                                        </div>
                                    </div>   
                                </div>           
                                <div class="row gx-3" style="  margin: 10px 10px 10px;">                                                      
                                    <div class="col-auto">
                                        <div class="input-group input-group-sm mb-3"><span class="input-group-text" id="inputGroup-sizing-sm">수리업체</span> 
                                            <input class="form-control form-control-sm" id="infixcltnm" type="text"    autocomplete="off" style="width: 250px;">  
                                        </div>
                                    </div>        
                                    <div class="col-auto">
                                        <div class="input-group input-group-sm mb-3"><span class="input-group-text" id="inputGroup-sizing-sm">비고</span> 
                                            <input class="form-control form-control-sm" id="inremark" type="text"    autocomplete="off" style="width: 350px;">  
                                        </div>
                                    </div>    
                                    <!-- <div class="col-auto">  
                                        <button class="btn btn-falcon-danger me-1 mb-1 btn-sm" id="retrieveBtn"  type="button" onclick="retrieve_rtn()">조회
                                        </button>
                                    </div>   -->
                                    <div class="col-auto">  
                                        <button class="btn btn-falcon-danger me-1 mb-1 btn-sm" type="button" onclick="new_btn()">신규
                                        </button>
                                    </div>  
                                    <div class="col-auto">  
                                        <button class="btn btn-falcon-danger me-1 mb-1 btn-sm" type="button" onclick="save_btn()">저장
                                        </button>
                                    </div>  
                                    <div class="col-auto">  
                                        <button class="btn btn-falcon-danger me-1 mb-1 btn-sm" type="button" onclick="delete_btn()">삭제
                                        </button>
                                    </div>   
                                </div>                                                    
                                <div class="container-fluid"  >                                                         
                                    <div id="wtab02Grid_div"  style="overflow:scroll;   height:485px;   margin:0 auto; "></div>  
                                </div>  
                            </td> 
                        </tr>
                        </tbody>
                    </table>
                </div> 
            </div> 
            <div class="tab-pane fade show" id="step03"> 
                <div class="table-responsive">
                    <div class="container-fluid"  >                                                         
                        <div id="wtab01Grid_div"  style="overflow:scroll;   height:485px;   margin:0 auto; "></div> 
                        <div id="flexGridFooter" class="gridFooter"></div> 
                    </div>  
                </div> 
            </div> 
        </div>
    </div>  

</div>    
 
<!--------------------------------------------------------------------------------------->     


<script type="text/javascript" th:inline="javascript">
    var view_p01tab01page;
    var view_p01tab02page;
    var view_p01tab03page; 
    var view_p01tab04page; 
    var view_innamepage
    var wtab01Grid;
    var wtab02Grid;
    var wtab03Grid; 
    var wtab04Grid; 
    var typeMenu;  
    var treemap;   
    let wmachdate;
    let wmachstdate;
    let wmacheddate;
    let wreqdate;
    let wrespdate;
    var gs_today;
   var wseries_data = [0];
   
    let fileIdx = 0; /*[- 파일 인덱스 처리용 전역 변수 -]*/
    let formData = new FormData();  

    window.onload = function() {   
        document.getElementById('infacflag').value = "01";
        updateTable("01");
        view_p01tab04page = new wijmo.collections.CollectionView(getData_tab04(), {
                    pageSize: 21
                }); 
        wtab04Grid = new wijmo.grid.FlexGrid('#wtab04Grid_div', {  
            autoGenerateColumns: false,
            showMarquee: true,
            isReadOnly: false, 
            // selectionMode: 'RowRange',
            allowSorting: 'MultiColumn',
            alternatingRowStep: 0,
            columns: [    
                { binding: 'flagnm', header: '설비구분', align: "center", width: 150 }, 
                { binding: 'facname', 
                    header: '설비명', 
                    align: "center", 
                    width: 150,
                    cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                        text: '<b>${item.facname}</b>',
                        click: (e, ctx) => {
                            wcifChk_a( ctx.item.faccd,  ctx.item.facflag, ctx.item.facno, 
                                    ctx.item.facname, ctx.item.facmodel, ctx.item.facjaejo, 
                                    ctx.item.facjaejono ,ctx.item.facdate, ctx.item.facstdate, 
                                    ctx.item.faceddate, ctx.item.facbycltnm, ctx.item.facbypernm, 
                                    ctx.item.factelno,  ctx.item.facgubun, ctx.item.facamt, 
                                    ctx.item.facjunwon,ctx.item.facdivnm, ctx.item.facgita, 
                                    ctx.item.facsize, ctx.item.facweight, ctx.item.fachyung, 
                                    ctx.item.factype, ctx.item.facvolumn, ctx.item.facgunondo, 
                                    ctx.item.facgunpung, ctx.item.facscrew );  
                        }
                    }) 
                },      
                { binding: 'facmodel', header: '모델명', align: "center", width: 120 },
                { binding: 'facjaejo', header: '제조사', align: "left", width: 200 },
                { binding: 'facjaejono', header: '제조번호', align: "left", width: 90 }, 
                { binding: 'facstdate', header: '제조일', align: "left", width: 100 }, 
                { binding: 'facbycltnm', header: '구매회사', align: "left", width: 180 }, 
                { binding: 'faceddate', header: '구매일', align: "right", width: 150 },        
                { binding: 'facbypernm', header: '구매담당', align: "center", width: 120 },        
            ], 
            itemsSource: view_p01tab04page
        });        

        new FlexGridContextMenu(wtab04Grid);  
        // 헤더 열 전환
        setHeaderColumn04(false);
        function setHeaderColumn04(headerOn) {
            wtab04Grid.headersVisibility = headerOn
            ? wijmo.grid.HeadersVisibility.All
            : wijmo.grid.HeadersVisibility.Column;
            // selector.column = headerOn
            // ? wtab04Grid.rowHeaders.columns[0]
            // : wtab04Grid.columns[0];
        } 
        wtab04Grid.showMarquee = true;
        wtab04Grid.focus();
        wijmo.toggleClass(wtab04Grid.hostElement, 'highlightActive', true);
        wtab04Grid.focus();

 
        // tab01검색 데이터 수집
        function getData_tab04(){    
                    var wtab01Dto = [[${Index22List}]];   
                    var wactnm_data = [];   
                    var cnt = 1;   
                    var ls_facflag = "";
                    var ls_flagnm = "";
                    if(wtab01Dto == null){
                        return wactnm_data
                    }
                    for (var i = 0; i < wtab01Dto.length; i++) {
                        
                        ls_facflag = wtab01Dto[i]["facflag"]
                        switch(ls_facflag){
                            case '01': 
                                ls_flagnm  = "사출기" 
                                break;        
                            case '02': 
                                ls_flagnm  = "로봇"
                                break;        
                            case '03': 
                                ls_flagnm  = "열풍기"
                                break;             
                            case '04': 
                                ls_flagnm  = "자동화기"
                                break;             
                            case '05': 
                                ls_flagnm  = "슬리브검사"
                                break;           
                            default:    
                                break;                
                        }  
                        wactnm_data.push({
                            id: i, 
                            index: cnt,
                            faccd: wtab01Dto[i]["faccd"],
                            facflag: wtab01Dto[i]["facflag"], 
                            flagnm: ls_flagnm,
                            facno: wtab01Dto[i]["facno"], 
                            facname: wtab01Dto[i]["facname"], 
                            facdate: wtab01Dto[i]["facdate"], 
                            facstdate: wtab01Dto[i]["facstdate"], 
                            faceddate: wtab01Dto[i]["faceddate"], 
                            facmodel: wtab01Dto[i]["facmodel"], 
                            facjaejo: wtab01Dto[i]["facjaejo"], 
                            facjaejono: wtab01Dto[i]["facjaejono"], 
                            facbycltnm: wtab01Dto[i]["facbycltnm"], 
                            facbypernm: wtab01Dto[i]["facbypernm"], 
                            factelno: wtab01Dto[i]["factelno"], 
                            facgubun: wtab01Dto[i]["facgubun"], 
                            facamt: wtab01Dto[i]["facamt"], 
                            facjunwon: wtab01Dto[i]["facjunwon"], 
                            facdivnm: wtab01Dto[i]["facdivnm"], 
                            facgita: wtab01Dto[i]["facgita"],
                            facsize: wtab01Dto[i]["facsize"],  
                            facweight: wtab01Dto[i]["facweight"], 
                            fachyung: wtab01Dto[i]["fachyung"], 
                            facscrew: wtab01Dto[i]["facscrew"], 
                            factype: wtab01Dto[i]["factype"],   
                            facvolumn: wtab01Dto[i]["facvolumn"],   
                            facgunondo: wtab01Dto[i]["facgunondo"],   
                            facgunpung: wtab01Dto[i]["facgunpung"],   
                            
                        });
                        cnt++;
                    }      
                    return wactnm_data; 
            
        }

    
        view_p01tab02page = new wijmo.collections.CollectionView(getData_tab02(), {
            pageSize: 100
        }); 
        wtab02Grid = new wijmo.grid.FlexGrid('#wtab02Grid_div', {  
            autoGenerateColumns: false,
            showMarquee: true,
            isReadOnly: false, 
            // selectionMode: 'RowRange',
            allowSorting: 'MultiColumn',
            alternatingRowStep: 0,
            columns: [       
                { binding: 'rownum', header: '순번', align: "center", width: 150 }, 
                { binding: 'reqdate', header: '의뢰일', align: "center", width: 150 }, 
                { binding: 'respdate', header: '완료일', align: "center", width: 150 }, 
                { binding: 'fixtext', header: '수리내용', align: "center", width: 400 }, 
                { binding: 'fixcltnm', header: '수리업체', align: "center", width: 200 }, 
                { binding: 'remark', header: '비고', align: "center", width: 150 }, 
            ], 
                
            itemsSource: view_p01tab02page
            
        });   
        // 첫번째 항목(정렬/그룹화한 후)을 선택
        wtab02Grid.select(new wijmo.grid.CellRange(0, 0), true); 
        setHeaderColumn02(false);
        function setHeaderColumn02(headerOn) {
            wtab02Grid.headersVisibility = headerOn
            ? wijmo.grid.HeadersVisibility.All
            : wijmo.grid.HeadersVisibility.Column; 
        } 
            // tab01검색 데이터 수집
        function getData_tab02(){        
            var wactnm_data = [];
            var cnt = 1;
            for (var i = 0; i < 20; i++) {
                wactnm_data.push({
                    id: i, 
                    index: cnt,
                    wrmc: '', 
                    wrmcnm: '', 
                    wperid: '', 
                    wpernm: '', 
                });
                cnt++;
            }     
            return wactnm_data;                                              
        }  



        view_p01tab01page = new wijmo.collections.CollectionView(getData_tab02(), {
            pageSize: 100
        }); 
        wtab01Grid = new wijmo.grid.FlexGrid('#wtab01Grid_div', {  
            autoGenerateColumns: false,
            showMarquee: true,
            isReadOnly: false, 
            // selectionMode: 'RowRange',
            allowSorting: 'MultiColumn',
            alternatingRowStep: 0,
            columns: [       
                { binding: 'rownum', header: '순번', align: "center", width: 150 }, 
                { binding: 'reqdate', header: '의뢰일', align: "center", width: 150 }, 
                { binding: 'respdate', header: '완료일', align: "center", width: 150 }, 
                { binding: 'fixtext', header: '수리내용', align: "center", width: 400 }, 
                { binding: 'fixcltnm', header: '수리업체', align: "center", width: 200 }, 
                { binding: 'remark', header: '비고', align: "center", width: 150 }, 
            ], 
                
            itemsSource: view_p01tab01page
            
        });   
        // 첫번째 항목(정렬/그룹화한 후)을 선택
        wtab01Grid.select(new wijmo.grid.CellRange(0, 0), true); 
        setHeaderColumn01(false);
        function setHeaderColumn01(headerOn) {
            wtab01Grid.headersVisibility = headerOn
            ? wijmo.grid.HeadersVisibility.All
            : wijmo.grid.HeadersVisibility.Column; 
        }     

        
}     
   
 

   //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
   //선택한 탭 체크 
    function tabchk_rtn(arg){
       document.getElementById('tabvalue').value = arg; 
   } 
  

   function new_btn(arg){  
       document.getElementById('infixid').value = "";
       document.getElementById('infixtext').value = "";
       document.getElementById('infixcltnm').value = "";
       document.getElementById('inremark').value = "";
   }
   function save_btn(arg){
       var ls_tab = document.getElementById('tabvalue').value;  
   
       if (!confirm("저장하시겠습니까?")) {
               return ; 
       }   
       
       switch(ls_tab){
           case 'A': 
           
                var ls_infaccd = document.getElementById('infaccd').value;              //설비코드
                var ls_infacflag = document.getElementById('infacflag').value;          //01 사출 02 로봇 03 열풍
                var ls_infacno = document.getElementById('infacno').value;              //관리번호
                var ls_infacname = document.getElementById('infacname').value;          //설비명
                var ls_infacdate   =  convert_date(wmachdate.value);                    //등록일        
                var ls_infacstdate =  convert_date(wmachstdate.value);                  //제조일
                var ls_infaceddate =  convert_date(wmacheddate.value);                  //구매일
                //    var ls_infacdate = document.getElementById('infacdate').value;
                //    var ls_infacstdate = document.getElementById('infacstdate').value;
                //    var ls_infaceddate = document.getElementById('infaceddate').value;
                var ls_infacmodel = document.getElementById('infacmodel').value;        //모델명

                var ls_infacjaejo = document.getElementById('infacjaejo').value;        //제조사
                var ls_infacjaejono = document.getElementById('infacjaejono').value;    //제조번호
                var ls_infacbycltnm = document.getElementById('infacbycltnm').value;    //구매회사
                var ls_infacbypernm = document.getElementById('infacbypernm').value;    //구매담당자
                var ls_infactelno = document.getElementById('infactelno').value;        //연락처
                var ls_infacgubun = document.getElementById('infacgubun').value;        //구분
                var ls_infacamt = document.getElementById('infacamt').value;            //구매가

                var ls_infacjunwon = document.getElementById('infacjunwon').value;      //전원
                var ls_infacdivnm = document.getElementById('infacdivnm').value;        //사용부서
                var ls_infacgita  = document.getElementById('infacgita').value;         //기타내용
 
                var ls_infacsize = "";
                var ls_infacweight = "";
                var ls_infachyung = "";
                var ls_infacscrew = "";
                var ls_infactype = "";
                var ls_infacvolumn = "";
                var ls_infacgunondo = "";
                var ls_infacgunpung = "";

                switch(ls_infacflag){
                    case '01': 
                        ls_infacsize  = document.getElementById('infacsize').value;         //SIZE
                        ls_infacweight  = document.getElementById('infacweight').value;     //중량
                        ls_infachyung  = document.getElementById('infachyung').value;         //형체결력
                        ls_infacscrew  = document.getElementById('infacscrew').value;         //스크류
                        break;        
                    case '02': 
                        ls_infactype  = document.getElementById('infactype').value;         //TYPE
                        break;        
                    case '03': 
                        ls_infacsize  = document.getElementById('infacsize').value;         //SIZE
                        ls_infacvolumn  = document.getElementById('infacvolumn').value;     //용량
                        ls_infacgunondo  = document.getElementById('infacgunondo').value;         //건조온도
                        ls_infacgunpung  = document.getElementById('infacgunpung').value;         //건조풍량
                        break;           
                    default:    
                        break;                
                }  

               if(ls_infacflag == null || ls_infacflag.length == 0 || ls_infacflag == ""){ 
                   alert("설비구분을 등록하세요") 
                   document.getElementById("infacflag").focus(); 
                   return ;               
               }  
               if(ls_infacno == null || ls_infacno.length == 0 || ls_infacno == ""){ 
                   alert("관리번호를 등록하세요") 
                   document.getElementById("infacno").focus(); 
                   return ;               
               }  
               if(ls_infacname == null || ls_infacname.length == 0 || ls_infacname == ""){ 
                   alert("설비명을 등록하세요") 
                   document.getElementById("infacname").focus(); 
                   return ;               
               } 
               if(ls_infacmodel == null || ls_infacmodel.length == 0 || ls_infacmodel == ""){ 
                   alert("모델명을 등록하세요") 
                   document.getElementById("infacmodel").focus(); 
                   return ;               
               } 
               if(ls_infacdate == null || ls_infacdate.length == 0 || ls_infacdate == ""){ 
                   alert("등록일을 등록하세요") 
                   document.getElementById("infacdate").focus(); 
                   return ;               
               }  
               if(ls_infacstdate == null || ls_infacstdate.length == 0 || ls_infacstdate == ""){ 
                   alert("제조일을 등록하세요") 
                   document.getElementById("infaceddate").focus(); 
                   return ;               
               }  
               if(ls_infaceddate == null || ls_infaceddate.length == 0 || ls_infaceddate == ""){
                   alert("구매일을 등록하세요") 
                   document.getElementById("infaceddate").focus(); 
                   return ;               
               }    
               if(ls_infaccd == null || ls_infaccd.length == 0  ){
                    ls_infaccd = "";
               }   
               if(ls_infacjaejo == null || ls_infacjaejo.length == 0  ){
                    ls_infacjaejo = "";
               }    
               if(ls_infacjaejono == null || ls_infacjaejono.length == 0  ){
                    ls_infacjaejono = "";
               }     
               if(ls_infacbycltnm == null || ls_infacbycltnm.length == 0  ){
                    ls_infacbycltnm = "";
               }       
               if(ls_infacbypernm == null || ls_infacbypernm.length == 0  ){
                    ls_infacbypernm = "";
               }      
               if(ls_infactelno == null || ls_infactelno.length == 0  ){
                    ls_infactelno = "";
               }     
               if(ls_infacgubun == null || ls_infacgubun.length == 0  ){
                    ls_infacgubun = "";
               }     
               if(ls_infacamt == null || ls_infacamt.length == 0  ){
                    ls_infacamt = "0";
               }     
               if(ls_infacjunwon == null || ls_infacjunwon.length == 0  ){
                    ls_infacjunwon = "";
               }     
               if(ls_infacdivnm == null || ls_infacdivnm.length == 0  ){
                    ls_infacdivnm = "";
               }     
               if(ls_infacgita == null || ls_infacgita.length == 0  ){
                    ls_infacgita = "";
               }    
               if(ls_infacweight == null || ls_infacweight.length == 0  ){
                    ls_infacweight = "";
               }      
               if(ls_infachyung == null || ls_infachyung.length == 0  ){
                    ls_infachyung = "";
               }    
               if(ls_infacscrew == null || ls_infacscrew.length == 0  ){
                    ls_infacscrew = "";
               }    
               if(ls_infactype == null || ls_infactype.length == 0  ){
                    ls_infactype = "";
               }    
               if(ls_infacvolumn == null || ls_infacvolumn.length == 0  ){
                    ls_infacvolumn = "";
               }    
               if(ls_infacgunondo == null || ls_infacgunondo.length == 0  ){
                    ls_infacgunondo = "";
               }    
               if(ls_infacgunpung == null || ls_infacgunpung.length == 0  ){
                    ls_infacgunpung = "";
               }   
     
               for (h = 0; h <= fileIdx; h++ ){
                    ls_fileid = 'file_' + h;

                    const fileInput = document.getElementById(ls_fileid);
                    // const selectedFile = fileInput.files[0];
                    const selectedFile = [...fileInput.files];
                    for (s = 0; s <= selectedFile.length - 1; s++){
                        formData.append("file", selectedFile[s]);
                        // console.log(selectedFile[s]);
                    }

                }

               var inputdata = {  
                    "infaccd"       : ls_infaccd,
                    "infacflag"       : ls_infacflag,
                    "infacno"        : ls_infacno,
                    "infacname"    : ls_infacname , 
                    "infacdate"    : ls_infacdate, 
                    "infacstdate"         : ls_infacstdate , 
                    "infaceddate"         : ls_infaceddate,  
                    "infacmodel"         : ls_infacmodel,
                    "infacjaejo"        : ls_infacjaejo,
                    "infacjaejono"        : ls_infacjaejono , 
                    "infacbycltnm"         : ls_infacbycltnm,
                    "infacbypernm"      : ls_infacbypernm,
                    "infactelno"      : ls_infactelno,
                    "infacgubun"      : ls_infacgubun,
                    "infacamt"        : ls_infacamt, 
                    "infacjunwon"        : ls_infacjunwon,
                    "infacdivnm"        : ls_infacdivnm,
                    "infacgita"        : ls_infacgita,  
                    "infacsize"        : ls_infacsize,  
                    "infacweight"        : ls_infacweight,  
                    "infachyung"        : ls_infachyung,  
                    "infacscrew"        : ls_infacscrew,  
                    "infactype"        : ls_infactype,  
                    "infacvolumn"        : ls_infacvolumn,  
                    "infacgunondo"        : ls_infacgunondo,  
                    "infacgunpung"        : ls_infacgunpung,  
                    
                } 
                //직전 데이타가 메모리에 남아 폼데이타 키를 삭제후 다시 데이타를 전송해야함. 
                formData.delete("key");    
                formData.append("key", new Blob([ JSON.stringify(inputdata) ], {type : "application/json"}));
        
               $.ajax({
                   url: '/app01m/index22/save',  
                    type: "POST",   
                    processData : false,                //  processData : false로 선언 시 formData를 string으로 변환하지 않음
                    contentType : false,                // contentType : false 로 선언 시 content-type 헤더가 multipart/form-data로 전송되게     
                    data: formData,                   
                    async:false,
                    success:function(data){
                        if(data == "success"){
                            alert("저장되었습니다.")
                            // console.log(formData);
                            // searchList_rtn(ls_tab);
                            // clear_rtn();       
                            listUp01()       
                        }else if(data == "dupulchk"){
                            alert("이미 등록된 품번입니다.")  
                        }else{                       
                            alert("저장중 오류가 발생했습니다. 관리자에게 문의하세요.") 
                            console.log(data);  
                        }
                    },error:function(e){
                        console.log('error',e);
                    }
               }).done(function(fragment){           

               })  
               break;   
           case 'B': 
           
                var ls_infixid = document.getElementById('infixid').value;
                var ls_infixmachcd = document.getElementById('infixmachcd').value;
                var ls_infixtext   = document.getElementById('infixtext').value;
                var ls_infixcltnm = document.getElementById('infixcltnm').value;
                var ls_inremark   = document.getElementById('inremark').value; 
                var ls_inreqdate   =  convert_date(wreqdate.value);                 
                var ls_inrespdate =  convert_date(wrespdate.value);     

               if(ls_infixmachcd == null || ls_infixmachcd.length == 0 || ls_infixmachcd == ""){ 
                   alert("품번을 선택하세요")  
                   return ;               
               }  
               if(ls_infixtext == null || ls_infixtext.length == 0 || ls_infixtext == ""){ 
                   alert("수리내용을 등록하세요") 
                   document.getElementById("infixtext").focus(); 
                   return ;               
               }  
               if(ls_inreqdate == null || ls_inreqdate.length == 0 || ls_inreqdate == ""){ 
                   alert("의뢰일을 등록하세요")  
                   return ;               
               } 
               if(ls_inrespdate == null || ls_inrespdate.length == 0 || ls_inrespdate == ""){ 
                   alert("완료일을 등록하세요")  
                   return ;               
               }   
               if(ls_infixcltnm == null || ls_infixcltnm.length == 0  ){
                    ls_infixcltnm = "";
               }    
               if(ls_inremark == null || ls_inremark.length == 0  ){
                    ls_inremark = "";
               }      
               if(ls_infixid == null || ls_infixid.length == 0  ){
                    ls_infixid = "0";
               }   
     

               var inputdata = {  
                    "infixid"           : ls_infixid,
                    "infixmachcd"       : ls_infixmachcd,
                    "infixtext"         : ls_infixtext,
                    "infixcltnm"        : ls_infixcltnm , 
                    "inremark"          : ls_inremark, 
                    "inreqdate"         : ls_inreqdate , 
                    "inrespdate"        : ls_inrespdate,  
                    
                } 
                //직전 데이타가 메모리에 남아 폼데이타 키를 삭제후 다시 데이타를 전송해야함. 
                formData.delete("key");    
                formData.append("key", new Blob([ JSON.stringify(inputdata) ], {type : "application/json"}));
        
               $.ajax({
                   url: '/app01m/index22/fixsave',  
                    type: "POST",   
                    processData : false,                //  processData : false로 선언 시 formData를 string으로 변환하지 않음
                    contentType : false,                // contentType : false 로 선언 시 content-type 헤더가 multipart/form-data로 전송되게     
                    data: formData,                   
                    async:false,
                    success:function(data){
                        if(data == "success"){
                            alert("저장되었습니다.")
                            // console.log(formData);
                            searchList_rtn(ls_tab);    
                        }else{                       
                            alert("저장중 오류가 발생했습니다. 관리자에게 문의하세요.") 
                            console.log(data);  
                        }
                    },error:function(e){
                        console.log('error',e);
                    }
               }).done(function(fragment){           

               })  
               break;           
           default:    
               break;                
       } 

   } 

   function delete_btn(){ 
   
        var ls_tab = document.getElementById('tabvalue').value;  
       if (!confirm("삭제하시겠습니까?")) {
               return ; 
       }   
       
       switch(ls_tab){
           case 'A': 
                var ls_infaccd = document.getElementById('infaccd').value;              //설비코드
                if(ls_infaccd == null || ls_infaccd.length == 0 || ls_infaccd == ""){ 
                    alert("설비를 선택하세요") 
                    document.getElementById("infaccd").focus(); 
                    return ;               
                }    

               $.ajax({
                   url: '/app01m/index22/del',  
                   type:"POST",
                   data: { 
                       "infaccd"      : ls_infaccd,  
                   }, 
                   async:false,
                   success:function(data){   
                       if(data == "success"){
                           alert("삭제되었습니다.")  
                           searchList_rtn(ls_tab);  
                           clear_rtn(ls_tab);             
                       }else{                       
                           alert("삭제중 오류가 발생했습니다. 관리자에게 문의하세요.")  
                       }
                      
                   },error:function(e){
                       console.log("error"); 
                   }
               }).done(function(fragment){           

               })  
               break;
           case 'B': 
              var ls_infixid = document.getElementById('infixid').value;
                if(ls_infixid == null || ls_infixid.length == 0 || ls_infixid == ""){ 
                    alert("삭제할 자료를 선택하세요")  
                    return ;               
                }    
               $.ajax({
                   url: '/app01m/index22/delfix',   
                   type:"POST",
                   data: { 
                       "infixid"      : ls_infixid 
                   }, 
                   async:false,
                   success:function(data){   
                       if(data == "success"){
                           alert("삭제되었습니다.") 
                           searchList_rtn(ls_tab);  
                           clear_rtn();             
                       }else{                       
                           alert("삭제중 오류가 발생했습니다. 관리자에게 문의하세요.")  
                       }
                      
                   },error:function(e){
                       console.log("error"); 
                   }
               }).done(function(fragment){           

               })  
               break;
           case 'C':
               break;                
           default:    
               break;                
       } 

   }         
   function clear_rtn(){ 
        var ls_tab = document.getElementById('tabvalue').value;  
       switch(ls_tab){
           case 'A':  
           
                document.getElementById('infaccd').value = "";
                document.getElementById('infacflag').value = "01";
                document.getElementById('infacno').value = "";
                document.getElementById('infacname').value = "";
                document.getElementById('infixmachno').value = "";
                document.getElementById('infacmodel').value = "";
                document.getElementById('infacjaejo').value = "";
                document.getElementById('infacjaejono').value = "";
                
                document.getElementById('infacbycltnm').value = "";
                document.getElementById('infacbypernm').value = "";
                document.getElementById('infactelno').value = "";
                document.getElementById('infacgubun').value = "";
                document.getElementById('infacamt').value = 0;
                document.getElementById('infacjunwon').value = "";
                document.getElementById('infacdivnm').value = "";
                document.getElementById('infacgita').value = "";

                document.getElementById('infacsize').value = "";
                document.getElementById('infacweight').value = "";
                document.getElementById('infachyung').value = "";
                document.getElementById('infacscrew').value = ""; 
               break;
           case 'B':   
               break;                
           default:    
               break;                
       } 

   }
   
   
   
   
   function updateTable(comboValue) {
            let tableContent = "";
            if (comboValue === "01") {
                tableContent = `
                <table>
                    <tr> 
                        <th>SIZE</th>
                        <td colspan="2">
                            <div class="input_wrap">                                 
                                <input type="text" id="infacsize" autocomplete="off" placeholder="">  
                            </div>
                        </td>                                        
                        <th>중량</th> 
                        <td colspan="2">
                            <div class="input_wrap">                                 
                                <input type="text" id="infacweight" autocomplete="off"> 
                            </div>
                        </td> 
                    </tr>   
                    <tr> 
                        <th>형체결력</th>
                        <td colspan="2">
                            <div class="input_wrap">                                 
                                <input type="text" id="infachyung" autocomplete="off" placeholder="">  
                            </div>
                        </td>                                        
                        <th>스크류</th> 
                        <td colspan="2">
                            <div class="input_wrap">                                 
                                <input type="text" id="infacscrew" autocomplete="off"> 
                            </div>
                        </td> 
                    </tr>
                </table>    `;
            } else if (comboValue === "02") {
                tableContent = `
                <table>
                    <tr> 
                        <th>TYPE</th>
                        <td colspan="5">
                            <div class="input_wrap">                                 
                                <input type="text" id="infactype" autocomplete="off" placeholder="">  
                            </div>
                        </td>
                    </tr>
                </table>    `;
            } else if (comboValue === "03") {
                tableContent =`
                <table>
                    <tr> 
                        <th>SIZE</th>
                        <td colspan="2">
                            <div class="input_wrap">                                 
                                <input type="text" id="infacsize" autocomplete="off" placeholder="">  
                            </div>
                        </td>                                        
                        <th>용량</th> 
                        <td colspan="2">
                            <div class="input_wrap">                                 
                                <input type="text" id="infacvolumn" autocomplete="off"> 
                            </div>
                        </td> 
                    </tr>   
                    <tr> 
                        <th>건조온도</th>
                        <td colspan="2">
                            <div class="input_wrap">                                 
                                <input type="text" id="infacgunondo" autocomplete="off" placeholder="">  
                            </div>
                        </td>                                        
                        <th>건조풍량</th> 
                        <td colspan="2">
                            <div class="input_wrap">                                 
                                <input type="text" id="infacgunpung" autocomplete="off"> 
                            </div>
                        </td> 
                    </tr>
                </table>    `;
            }
            
            // $('#dynamicTable').before(tableContent);
            document.getElementById('dynamicTable').innerHTML = tableContent;
            
        }

   
   //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
    
   function prtprocess_rtn(){    
        var ls_tab = document.getElementById('tabvalue').value;  

        switch(ls_tab){
            case 'A': 
                    var ls_infacname = document.getElementById('infacname').value;  
                    //선택된 매출그룹조회     
                    $.ajax({
                        url: '/app01m/index22/printview',  
                        type:"POST",
                        data: { 
                            "infacname"  : ls_infacname 
                        }, 
                        async:false,
                        success:function(data){  
                            print_rtn(data)
                            // misdateArr.pop() 
                        },error:function(e){
                            console.log("error");
                            // alert(data.code);
                            // alert(data.message);
                        }
                    }).done(function(fragment){           

                    })  

                    break;           
            default:    
                break;  

        }


        //@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ 인쇄 @@@@@@@@@@@@@@@@@@@@@@@@@@@
        //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
     function print_rtn(getData){ 
            var ls_infaccd = document.getElementById('infaccd').value; 
            var ls_infacmodel = document.getElementById('infacmodel').value; 
            
            var doc = new wijmo.pdf.PdfDocument({   
                compress: true,
                pageSettings: {
                    layout: wijmo.pdf.PdfPageOrientation.Portrait,
                    size: wijmo.pdf.PdfPageSize.Letter,
                    margins: {
                        left: 36,
                        right: 36,
                        top: 40,
                        bottom: 16
                    }
                },
                footer: {
                    declarative: {
                        text: 'mes.c-kd.com \t&[Page]\\&[Pages]',                             //text: 'EEAN Optic\t&[Page]\\&[Pages]',
                        font: new wijmo.pdf.PdfFont('times', 12),
                        brush: '#bfc1c2'
                    }
                },
                ended: (sender, args) => wijmo.pdf.saveBlob(args.blob, ls_infacmodel + '_설비카드.pdf')
            }) 
            
            doc.registerFont({
                source: "https://assets.codepen.io/975719/UnDotum.ttf",
                name: "BMHANNAPro",
                style: "normal",
                weight: "normal",
                sansSerif: true
            }); 

            var ls_image01 = ""
            var ls_image02 = ""
            var ls_image03 = ""
            var ls_image04 = ""
            var ls_image05 = ""
            var ls_image06 = ""
            //이력조회     
            $.ajax({
                url: '/app01m/index08/printimg',  
                type:"POST",
                data: { 
                    "inmachcd" : ls_infaccd, 
                }, 
                async:false,
                success:function(data){  
                    if(data.length > 0){
                        ls_image01 = data[0].save_name;
                        ls_image02 = data[1].save_name;
                        ls_image03 = data[2].save_name;
                        ls_image04 = data[3].save_name;
                        ls_image05 = data[4].save_name;
                        ls_image06 = data[5].save_name; 
                    }
                },error:function(e){
                    console.log("error");                            
                }
            }).done(function(fragment){           

            })  

            const addImageToPDF = async () => {
                
                if(ls_image01 == null || ls_image01.length == 0 || ls_image01 == ""){  
                    return ;               
                }    
                const ls_imgstr =
                    'assets/upload/' + ls_infaccd + '/' + ls_image01;
                 
                const imageUrl = `http://mes.c-kd.com:8500/${ls_imgstr}`;
 
                console.log(imageUrl)
                try {
                    const response = await fetch(imageUrl);
                    if (!response.ok) {
                        throw new Error('이미지 로드 실패');
                    }
                    const blob = await response.blob();
                    const reader = new FileReader();

                    return new Promise((resolve) => {
                        reader.onloadend = function () {
                            const base64EncodedImage = reader.result; // Base64 데이터
                             
                            doc.drawImage(base64EncodedImage, 36, 190, {
                                width: 250,
                                height: 150,
                            });
                            resolve();
                        };
                        reader.readAsDataURL(blob); // Blob을 Base64로 변환
                    });
                } catch (error) {
                    console.error('이미지 로드 중 오류 발생:', error);
                }
            };

            const addImageToPDF02 = async () => {
                if(ls_image02 == null || ls_image02.length == 0 || ls_image02 == ""){  
                    return ;               
                }   
                const ls_imgstr =
                    'assets/upload/' + ls_infaccd + '/' + ls_image02;
                 
                const imageUrl = `http://mes.c-kd.com:8500/${ls_imgstr}`;

                console.log(imageUrl)
                try {
                    const response = await fetch(imageUrl);
                    if (!response.ok) {
                        throw new Error('이미지 로드 실패');
                    }
                    const blob = await response.blob();
                    const reader = new FileReader();

                    return new Promise((resolve) => {
                        reader.onloadend = function () {
                            const base64EncodedImage = reader.result; // Base64 데이터
                             
                            doc.drawImage(base64EncodedImage, 300, 190, {
                                width: 250,
                                height: 150,
                            });
                            resolve();
                        };
                        reader.readAsDataURL(blob); // Blob을 Base64로 변환
                    });
                } catch (error) {
                    console.error('이미지 로드 중 오류 발생:', error);
                }
            };
            
            
            const addImageToPDF03 = async () => {
                if(ls_image03 == null || ls_image03.length == 0 || ls_image03 == ""){  
                    return ;               
                }   
                const ls_imgstr =
                    'assets/upload/' + ls_infaccd + '/' + ls_image03;
                 
                const imageUrl = `http://mes.c-kd.com:8500/${ls_imgstr}`;

                console.log(imageUrl)
                try {
                    const response = await fetch(imageUrl);
                    if (!response.ok) {
                        throw new Error('이미지 로드 실패');
                    }
                    const blob = await response.blob();
                    const reader = new FileReader();

                    return new Promise((resolve) => {
                        reader.onloadend = function () {
                            const base64EncodedImage = reader.result; // Base64 데이터
                             
                            doc.drawImage(base64EncodedImage, 36, 380, {
                                width: 250,
                                height: 150,
                            });
                            resolve();
                        };
                        reader.readAsDataURL(blob); // Blob을 Base64로 변환
                    });
                } catch (error) {
                    console.error('이미지 로드 중 오류 발생:', error);
                }
            };
            
            
            const addImageToPDF04 = async () => {
                if(ls_image04 == null || ls_image04.length == 0 || ls_image04 == ""){  
                    return ;               
                }   
                const ls_imgstr =
                    'assets/upload/' + ls_infaccd + '/' + ls_image04;
                 
                const imageUrl = `http://mes.c-kd.com:8500/${ls_imgstr}`;

                console.log(imageUrl)
                try {
                    const response = await fetch(imageUrl);
                    if (!response.ok) {
                        throw new Error('이미지 로드 실패');
                    }
                    const blob = await response.blob();
                    const reader = new FileReader();

                    return new Promise((resolve) => {
                        reader.onloadend = function () {
                            const base64EncodedImage = reader.result; // Base64 데이터
                             
                            doc.drawImage(base64EncodedImage, 300, 380, {
                                width: 250,
                                height: 150,
                            });
                            resolve();
                        };
                        reader.readAsDataURL(blob); // Blob을 Base64로 변환
                    });
                } catch (error) {
                    console.error('이미지 로드 중 오류 발생:', error);
                }
            };
            
            
            const addImageToPDF05 = async () => {
                if(ls_image05 == null || ls_image05.length == 0 || ls_image05 == ""){  
                    return ;               
                }   
                const ls_imgstr =
                    'assets/upload/' + ls_infaccd + '/' + ls_image05;
                 
                const imageUrl = `http://mes.c-kd.com:8500/${ls_imgstr}`;

                console.log(imageUrl)
                try {
                    const response = await fetch(imageUrl);
                    if (!response.ok) {
                        throw new Error('이미지 로드 실패');
                    }
                    const blob = await response.blob();
                    const reader = new FileReader();

                    return new Promise((resolve) => {
                        reader.onloadend = function () {
                            const base64EncodedImage = reader.result; // Base64 데이터
                             
                            doc.drawImage(base64EncodedImage, 36, 500, {
                                width: 250,
                                height: 150,
                            });
                            resolve();
                        };
                        reader.readAsDataURL(blob); // Blob을 Base64로 변환
                    });
                } catch (error) {
                    console.error('이미지 로드 중 오류 발생:', error);
                }
            };
            
            
            const addImageToPDF06 = async () => {
                if(ls_image06 == null || ls_image06.length == 0 || ls_image06 == ""){  
                    return ;               
                }   
                const ls_imgstr =
                    'assets/upload/' + ls_infaccd + '/' + ls_image06;
                 
                const imageUrl = `http://mes.c-kd.com:8500/${ls_imgstr}`;

                console.log(imageUrl)
                try {
                    const response = await fetch(imageUrl);
                    if (!response.ok) {
                        throw new Error('이미지 로드 실패');
                    }
                    const blob = await response.blob();
                    const reader = new FileReader();

                    return new Promise((resolve) => {
                        reader.onloadend = function () {
                            const base64EncodedImage = reader.result; // Base64 데이터
                             
                            doc.drawImage(base64EncodedImage, 300, 500, {
                                width: 250,
                                height: 150,
                            });
                            resolve();
                        };
                        reader.readAsDataURL(blob); // Blob을 Base64로 변환
                    });
                } catch (error) {
                    console.error('이미지 로드 중 오류 발생:', error);
                }
            };
            
            
            
            const processPDF = async () => {

                //getData.forEach((saledata, i, arr) => {
                    drawHeader(doc, getData);
                    
                    await addImageToPDF();
                    await addImageToPDF02();
                    await addImageToPDF03();
                    await addImageToPDF04();
                    await addImageToPDF05();
                    await addImageToPDF06();

                    //drawSales(doc, getData);
                     
               // });

                doc.end(); // PDF 생성 완료
            };

            processPDF(); // 비동기 작업 호출 
      }

        function drawHeader(doc, salesdata) {
            var ls_faccd = document.getElementById('infaccd').value;
            var ls_facname = document.getElementById('infacname').value;  
            let tot = 0; //salesdata.expenses.totals;  

            try {  
                
            var ls_facno = salesdata[0].facno    
            var ls_facflag = salesdata[0].facflag   
            var ls_facname = salesdata[0].facname  
            var ls_facdate = salesdata[0].facdate  
            var ls_facstdate = salesdata[0].facstdate  
            var ls_faceddate = salesdata[0].faceddate  
            var ls_facmodel = salesdata[0].facmodel  
            var ls_facjaejo = salesdata[0].facjaejo  
            var ls_facjaejono = salesdata[0].facjaejono  
            var ls_facbycltnm = salesdata[0].facbycltnm  
            var ls_facbypernm = salesdata[0].facbypernm  
            var ls_factelno = salesdata[0].factelno  
            var ls_facgubun = salesdata[0].facgubun 
            var ls_facjunwon = salesdata[0].facjunwon 
            var ls_facdivnm = salesdata[0].facdivnm 
            var ls_facsize = salesdata[0].facsize 
            var ls_fachyung = salesdata[0].fachyung 
            var ls_facweight = salesdata[0].facweight 
            var ls_facscrew = salesdata[0].facscrew 
            var ls_factype = salesdata[0].factype 
            var ls_facgunondo = salesdata[0].facgunondo 
            var ls_facvolumn = salesdata[0].facvolumn 
            var ls_facgunpung = salesdata[0].facgunpung 
            var ls_facgita = salesdata[0].facgita   
            var ls_facamt = String(salesdata[0].facamt)
                let y = doc.y;
                doc.header.drawText("설 비 카 드", null, null, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 25), align: 1, baseline: 5, underline: false});   //align 1 center baseline 5 bottom
                    
                // doc.moveDown(1);
                // * draw captions *
                //doc.drawText('작  성   일  자 : ' + ls_misdatetxt + ' [' + ls_misnum + ']', 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11), align: 0, underline:false});
                 
                y = doc.y; 
                doc.drawText('관리번호 ' + ls_facno  , 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11), underline:true}); 
                doc.drawText(gs_today  , 420, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11), align: 0, underline:true}); 
                y = doc.y; 
                doc.drawText(ls_facname  , 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 30),  align: 1, underline:true});  
                //
                //doc.drawText('등록번호 : ' + ls_eeasano, 320, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),  underline:false});                     
                //
                doc.moveDown(1);
                //  
                y = doc.y; 
                doc.drawText('[모   델   명] '  , 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11), underline:false});
                doc.drawText(  ls_facmodel   , 100, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});  
                doc.drawText('[제   조   사] '  , 300, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false}); 
                doc.drawText(  ls_facjaejo   , 400, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});     
                //
                //doc.moveDown(1);
                //
                y = doc.y;
                doc.drawText('[제 조 번 호] '  , 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11), underline:false}); 
                doc.drawText(  ls_facjaejono   , 100, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});
                doc.drawText('[제   조   일] '  , 300, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false}); 
                doc.drawText(  ls_facstdate   , 400, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});    
                //
                //doc.moveDown(1); 
                //
                y = doc.y;
                doc.drawText('[구  매  회  사]'  , 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11), underline:false}); 
                doc.drawText(  ls_facbycltnm   , 100, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});
                doc.drawText('[구   매   일]'  , 300, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false}); 
                doc.drawText(  ls_faceddate   , 400, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});    
                //
                //doc.moveDown(1);
                // 
                y = doc.y;
                doc.drawText('[구 매 담 당 자]'  , 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11), underline:false}); 
                doc.drawText(  ls_facbypernm   , 100, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});
                doc.drawText('[연   락   처] '  , 300, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false}); 
                doc.drawText(  ls_factelno   , 400, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});    
                //
                //doc.moveDown(1);
                // 
                y = doc.y;
                doc.drawText('[구         분]'  , 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11), underline:false}); 
                doc.drawText(  ls_facgubun   , 100, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});
                doc.drawText('[구    매   가] '  , 300, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false}); 
                doc.drawText(  ls_facamt  , 400, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});   

                y = doc.y;
                doc.drawText('[전         원]'  , 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11), underline:false}); 
                doc.drawText(  ls_facjunwon   , 100, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});
                doc.drawText('[사  용  부  서] '  , 300, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false}); 
                doc.drawText(  ls_facdivnm   , 400, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});   
                console.log(ls_facflag) 
                if (ls_facflag == "01") { 
                    y = doc.y;
                    doc.drawText('[S  I  Z  E]'  , 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11), underline:false}); 
                    doc.drawText(  ls_facsize   , 100, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});
                    doc.drawText('[중       량] '  , 300, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false}); 
                    doc.drawText(  ls_facweight   , 400, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});   
                    y = doc.y;
                    doc.drawText('[형  체  결  력]'  , 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11), underline:false}); 
                    doc.drawText(  ls_fachyung   , 100, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});
                    doc.drawText('[스   크   류] '  , 300, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false}); 
                    doc.drawText(  ls_facscrew   , 400, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});   
                }else if(ls_facflag == "02"){
                    y = doc.y;
                    doc.drawText('[T  Y  P  E]'  , 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11), underline:false}); 
                    doc.drawText(  ls_factype   , 100, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});
                    
                }else if(ls_facflag == "03"){
                    y = doc.y;
                    doc.drawText('[S  I  Z  E]'  , 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11), underline:false}); 
                    doc.drawText(  ls_facsize   , 100, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});
                    doc.drawText('[용       량] '  , 300, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false}); 
                    doc.drawText(  ls_facvolumn   , 400, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});   
                    y = doc.y;
                    doc.drawText('[건  조  온  도]'  , 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11), underline:false}); 
                    doc.drawText(  ls_facgunondo   , 100, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});
                    doc.drawText('[건  조  풍  량] '  , 300, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false}); 
                    doc.drawText(  ls_facgunpung   , 400, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});   

                }else{

                }

                // 
                y = doc.y;
                doc.drawText('==============================================================================='  , 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11), underline:false});                 
                y = doc.y;
                doc.drawText(  ls_facgita   , 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false}); 
                doc.moveDown(3);                  
                y = doc.y;
                doc.drawText('사진 및 위치', 10, y, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:true}); 
                doc.moveDown(10);   
                doc.moveDown(5);                   

            }
            finally {  
            }
        }
        
      function drawSales(doc, salesdata) {
        var ls_faccd = document.getElementById('infaccd').value; 
            let tot = 0; //salesdata.expenses.totals; 
            //컬럼 수정시 footer.cells 수정할것.
            let expenses = salesdata;
            let font_url = "https://assets.codepen.io/975719/UnDotum.ttf"; 
            let minDate = expenses.machno, maxDate = salesdata.machname, columns = [
                { header: '순번', binding: 'rownum', width: 60 , align : "center"},
                { header: '의뢰일', binding: 'reqdate', format: 'c', width: 150, align : "center" },
                { header: '완료일', binding: 'respdate', format: 'c', width: 150, align : "center" }, 
                { header: '수리내용', binding: 'fixtext', format: 'c', width: 400 , align : "left"},
                { header: '수리업체', binding: 'fixcltnm', format: 'c', width: 200, align : "center" }, 
                { header: '비고', binding: 'remark', format: 'c', width: 100, align : "left" } 
            ], bold = new wijmo.pdf.PdfFont('BMHANNAPro', 10, 'normal', 'bold'), thinPen = new wijmo.pdf.PdfPen('#000000', 0.5);
            
            let flexGrid, footer;  
            //이력조회     
            $.ajax({
                url: '/app01m/index08/listtotfix',  
                type:"POST",
                data: { 
                    "searchtxt" : ls_faccd, 
                }, 
                async:false,
                success:function(data){  
                    tabB_grid(data);
                },error:function(e){
                    console.log("error");                            
                }
            }).done(function(fragment){           

            })  

            try { 
                footer = new wijmo.grid.FlexGrid('#flexGridFooter');
                wtab01Grid.initialize({
                    autoGenerateColumns: false,
                    allowMerging: wijmo.grid.AllowMerging.All,
                    columns: columns,
                    headersVisibility: wijmo.grid.HeadersVisibility.Column,
                    itemsSource: view_p01tab01page
                });
                //
                footer.initialize({
                    allowMerging: wijmo.grid.AllowMerging.All,
                    autoGenerateColumns: false,
                    headersVisibility: wijmo.grid.HeadersVisibility.None,
                    columns: columns,
                    itemsSource: [{
                        rownum: null,
                        reqdate: null,
                        respdate: null,
                        fixtext: null,
                        fixcltnm: null,
                        remark: null,  
                    }]
                });
                //
                footer.cells.setCellData(0, 'rownum', '', false);
                footer.cells.setCellData(0, 'reqdate', '', false);
                footer.cells.setCellData(0, 'respdate', '', false);
                footer.cells.setCellData(0, 'fixtext', '', false);
                footer.cells.setCellData(0, 'fixcltnm', '', false);
                footer.cells.setCellData(0, 'remark', '', false);   
                footer.cells.rows[0].allowMerging = true;  
                let y = doc.y;
                doc.moveDown(5);
                y = doc.y; 
                doc.drawText("금형 수리 내역", null, null, {font: new wijmo.pdf.PdfFont("BMHANNAPro", 18), align: 1, baseline: 5, underline: false});   //align 1 center baseline 5 bottom
                 
                // draw FlexGrid 
                 
                wijmo.grid.pdf.FlexGridPdfConverter.draw(wtab01Grid, doc, doc.width, null, { 
                    //내장된 폰트 정보
                    embeddedFonts: [
                        {
                        source: "https://assets.codepen.io/975719/BMHANNAPro.ttf",
                        name: "BMHANNAPro",
                        style: "normal",
                        weight: "normal",
                        sansSerif: true
                        }
                    ],
                    styles: {
                        cellStyle: { backgroundColor: '#ffffff', borderColor: '#c6c6c6', font: {family: "BMHANNAPro"} },
                        altCellStyle: { backgroundColor: '#f9f9f9' },
                        groupCellStyle: { backgroundColor: '#dddddd' },
                        headerCellStyle: { backgroundColor: '#eaeaea' }
                    } , 
                });
                
                // draw footer
                wijmo.grid.pdf.FlexGridPdfConverter.draw(footer, doc, doc.width, null, {
                    styles: {
                        cellStyle: {
                        font: { weight: 'bold', size : 13 },
                        backgroundColor: '#dddddd',
                        borderColor: '#c6c6c6'
                        }
                    }
                }); 

                doc.moveDown(1);
                y = doc.y; 
                // * draw captions *
                doc.drawText('양식QP-0903-01(0) '  , 10,  y , {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false}); 
                doc.drawText(' 주식회사 경덕산업'  , 250,  y , {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false}); 
                doc.drawText('A4(210×297mm) '  , 420,  y , {font: new wijmo.pdf.PdfFont("BMHANNAPro", 11),   underline:false});  
            }
            finally { 
                if (footer) {
                      footer.dispose();
                }
            }
        }
        


   }



//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
   // tab01 검색   
   document.getElementById("retrieveBtn").addEventListener("click",function(){ 
       
       var ls_tab = document.getElementById('tabvalue').value;   
       searchList_rtn(ls_tab);
   })   

   function searchList_rtn(arg1){ 
        
       switch(arg1){
           case 'A':
            var ls_searchtxt = document.getElementById('searchtxt').value; 
           $.ajax({
                   url: '/app01m/index22/listtot',  
                   type:"POST",
                   data: { 
                       "searchtxt" : ls_searchtxt, 
                   }, 
                   async:false,
                   success:function(data){ 
                       tabC_grid(data);
                   },error:function(e){
                       console.log("error");                            
                   }
               }).done(function(fragment){           

               })  
               break;
           case 'B': 
               var ls_infixmachcd = document.getElementById('infixmachcd').value;
               $.ajax({
                   url: '/app01m/index08/listtotfix',  
                   type:"POST",
                   data: { 
                       "searchtxt" : ls_infixmachcd, 
                   }, 
                   async:false,
                   success:function(data){  
                        tabA_grid(data);
                   },error:function(e){
                       console.log("error");                            
                   }
               }).done(function(fragment){           

               })  
               break;               
           default:    
               break;                
       }
   

   }        
   function tabA_grid(data){
       var wtab02Dto  = data;    
       var wtab02_data = [];
       var cnt = 1;
       for (var i = 0; i < wtab02Dto.length; i++) {
           wtab02_data.push({
               id: i, 
               index: cnt,
               rownum: wtab02Dto[i]["rownum"],
               fixid: wtab02Dto[i]["fixid"],
               fixmachcd: wtab02Dto[i]["fixmachcd"],   
               reqdate: wtab02Dto[i]["reqdate"], 
               respdate: wtab02Dto[i]["respdate"], 
               fixtext: wtab02Dto[i]["fixtext"], 
               fixcltnm: wtab02Dto[i]["fixcltnm"], 
               remark: wtab02Dto[i]["remark"]                               
           });
           cnt++;
       }    
       wtab02Grid.columns.clear();  
       wtab02Grid.autoGenerateColumns = false; 
       view_p01tab02page.sourceCollection  = wtab02_data;

    var cols = new wijmo.grid.Column(); 
        cols.binding = 'rownum';
        cols.header = '순번';
        cols.align = "center";
        cols.width = 80;  
        wtab02Grid.columns.push(cols);    


       cols = new wijmo.grid.Column(); 
       cols.binding = 'reqdate';
       cols.header = '의뢰일';
       cols.align = "center";
       cols.width = 150; 
       cols.cellTemplate = wijmo.grid.cellmaker.CellMaker.makeLink({ 
           text: '<b>${item.reqdate}</b>',
           click: (e, ctx) => {
            wcifChk_b(ctx.item.fixid, ctx.item.fixmachcd, ctx.item.reqdate, ctx.item.respdate, ctx.item.fixtext, ctx.item.fixcltnm, ctx.item.remark );
           }
       });
       wtab02Grid.columns.push(cols);    

       cols = new wijmo.grid.Column(); 
       cols.binding = 'respdate';
       cols.header = '완료일';
       cols.align = "center";
       cols.width = 150;  
       wtab02Grid.columns.push(cols);     

        cols = new wijmo.grid.Column(); 
        cols.binding = 'fixtext';
        cols.header = '수리내용';
        cols.align = "left";
        cols.width = 400;  
        wtab02Grid.columns.push(cols);     

        cols = new wijmo.grid.Column(); 
        cols.binding = 'fixcltnm';
        cols.header = '수리업체';
        cols.align = "left";
        cols.width = 200;  
        wtab02Grid.columns.push(cols);     

        cols = new wijmo.grid.Column(); 
        cols.binding = 'remark';
        cols.header = '비고';
        cols.align = "left";
        cols.width = 150;  
        wtab02Grid.columns.push(cols);     

   }
       
   function tabB_grid(data){
       var wtab02Dto  = data;    
       var wtab02_data = [];
       var cnt = 1;
       for (var i = 0; i < wtab02Dto.length; i++) {
           wtab02_data.push({
               id: i, 
               index: cnt,
               rownum: wtab02Dto[i]["rownum"],
               fixid: wtab02Dto[i]["fixid"],
               fixmachcd: wtab02Dto[i]["fixmachcd"],   
               reqdate: wtab02Dto[i]["reqdate"], 
               respdate: wtab02Dto[i]["respdate"], 
               fixtext: wtab02Dto[i]["fixtext"], 
               fixcltnm: wtab02Dto[i]["fixcltnm"], 
               remark: wtab02Dto[i]["remark"]                               
           });
           cnt++;
       }    

        
       var ll_length =  wtab02Dto.length;
        var ll_num01 = 10;
        var ll_num02 = 0;


        ll_num02 = ll_num01 + 1;
        if (wtab02Dto.length <= ll_num01){ 
            for (var p = wtab02Dto.length + 1; p < ll_num02; p++) { 
                wtab02_data.push({
                    id: p, 
                    index: cnt,
                    rownum: '',
                    fixid: '',
                    fixmachcd: '', 
                    reqdate: '',
                    respdate: '',
                    fixtext: '',
                    fixcltnm: '',
                    remark: '',   
                });
            cnt++;
            }
        }  
 
       wtab01Grid.columns.clear();  
       wtab01Grid.autoGenerateColumns = false; 
       view_p01tab01page.sourceCollection  = wtab02_data;

    var cols = new wijmo.grid.Column(); 
        cols.binding = 'rownum';
        cols.header = '순번';
        cols.align = "center";
        cols.width = 80;  
        wtab01Grid.columns.push(cols);    


       cols = new wijmo.grid.Column(); 
       cols.binding = 'reqdate';
       cols.header = '의뢰일';
       cols.align = "center";
       cols.width = 150;  
       wtab01Grid.columns.push(cols);    

       cols = new wijmo.grid.Column(); 
       cols.binding = 'respdate';
       cols.header = '완료일';
       cols.align = "center";
       cols.width = 150;  
       wtab01Grid.columns.push(cols);     

        cols = new wijmo.grid.Column(); 
        cols.binding = 'fixtext';
        cols.header = '수리내용';
        cols.align = "left";
        cols.width = 400;  
        wtab01Grid.columns.push(cols);     

        cols = new wijmo.grid.Column(); 
        cols.binding = 'fixcltnm';
        cols.header = '수리업체';
        cols.align = "left";
        cols.width = 200;  
        wtab01Grid.columns.push(cols);     

        cols = new wijmo.grid.Column(); 
        cols.binding = 'remark';
        cols.header = '비고';
        cols.align = "left";
        cols.width = 150;  
        wtab01Grid.columns.push(cols);     

   }
 
   function tabC_grid(data){
       var wtab03Dto  = data;    
       var wtab03_data = [];
       var cnt = 1;
       
       for (var i = 0; i < wtab03Dto.length; i++) { 
            ls_facflag = wtab03Dto[i]["facflag"]
            switch(ls_facflag){
                case '01': 
                    ls_flagnm  = "사출기" 
                    break;        
                case '02': 
                    ls_flagnm  = "로봇"
                    break;        
                case '03': 
                    ls_flagnm  = "열풍기"
                    break;             
                case '04': 
                    ls_flagnm  = "자동화기"
                    break;             
                case '05': 
                    ls_flagnm  = "슬리브검사"
                    break;           
                default:    
                    break;                
            }  
            wtab03_data.push({
                id: i, 
                index: cnt,
                faccd: wtab03Dto[i]["faccd"],
                facflag: wtab03Dto[i]["facflag"], 
                flagnm: ls_flagnm,
                facno: wtab03Dto[i]["facno"], 
                facname: wtab03Dto[i]["facname"], 
                facdate: wtab03Dto[i]["facdate"], 
                facstdate: wtab03Dto[i]["facstdate"], 
                faceddate: wtab03Dto[i]["faceddate"], 
                facmodel: wtab03Dto[i]["facmodel"], 
                facjaejo: wtab03Dto[i]["facjaejo"], 
                facjaejono: wtab03Dto[i]["facjaejono"], 
                facbycltnm: wtab03Dto[i]["facbycltnm"], 
                facbypernm: wtab03Dto[i]["facbypernm"], 
                factelno: wtab03Dto[i]["factelno"], 
                facgubun: wtab03Dto[i]["facgubun"], 
                facamt: wtab03Dto[i]["facamt"], 
                facjunwon: wtab03Dto[i]["facjunwon"], 
                facdivnm: wtab03Dto[i]["facdivnm"], 
                facgita: wtab03Dto[i]["facgita"],
                facsize: wtab03Dto[i]["facsize"],  
                facweight: wtab03Dto[i]["facweight"], 
                fachyung: wtab03Dto[i]["fachyung"], 
                facscrew: wtab03Dto[i]["facscrew"], 
                factype: wtab03Dto[i]["factype"],   
                facvolumn: wtab03Dto[i]["facvolumn"],   
                facgunondo: wtab03Dto[i]["facgunondo"],   
                facgunpung: wtab03Dto[i]["facgunpung"],   
                
            }); 
           cnt++;
       }   
       // console.log("wtab01_data",wactnm_data) +
        console.log(wtab03_data);
       wtab04Grid.columns.clear();  
       wtab04Grid.autoGenerateColumns = false; 
       view_p01tab04page.sourceCollection  = wtab03_data;
       var cols = new wijmo.grid.Column(); 
       cols = new wijmo.grid.Column(); 
       cols.binding = 'flagnm';
       cols.header = '설비구분';
       cols.align = "center";
       cols.width = 150; 
       wtab04Grid.columns.push(cols);   

       cols = new wijmo.grid.Column(); 
       cols.binding = 'facname';
       cols.header = '설비명';
       cols.align = "center";
       cols.width = 150;  
       cols.cellTemplate = wijmo.grid.cellmaker.CellMaker.makeLink({ 
           text: '<b>${item.facname}</b>',
            click: (e, ctx) => {                
                wcifChk_a(ctx.item.faccd,  ctx.item.facflag, ctx.item.facno, ctx.item.facname, ctx.item.facmodel, ctx.item.facjaejo,ctx.item.facjaejono ,ctx.item.facdate, ctx.item.facstdate, ctx.item.faceddate, ctx.item.facbycltnm, ctx.item.facbypernm, ctx.item.factelno,  ctx.item.facgubun, ctx.item.facamt, ctx.item.facjunwon,ctx.item.facdivnm, ctx.item.facgita, ctx.item.facsize, ctx.item.facweight, ctx.item.fachyung, ctx.item.factype, ctx.item.facvolumn, ctx.item.facgunondo, ctx.item.facgunpung, ctx.item.facscrew );  
            }
        }); 
       wtab04Grid.columns.push(cols);
       
       cols = new wijmo.grid.Column(); 
       cols.binding = 'facmodel';
       cols.header = '모델명';
       cols.align = "center";
       cols.width = 120;  
       wtab04Grid.columns.push(cols);  

       cols = new wijmo.grid.Column(); 
       cols.binding = 'facjaejo';
       cols.header = '제조사';
       cols.align = "center";
       cols.width = 120;  
       wtab04Grid.columns.push(cols);

        cols = new wijmo.grid.Column(); 
        cols.binding = 'facjaejono';
        cols.header = '제조번호';
        cols.align = "center";
        cols.width = 90;  
        wtab04Grid.columns.push(cols);

        cols = new wijmo.grid.Column(); 
        cols.binding = 'facstdate';
        cols.header = '제조일';
        cols.align = "center";
        cols.width = 100;  
        wtab04Grid.columns.push(cols);

        cols = new wijmo.grid.Column(); 
        cols.binding = 'facbycltnm';
        cols.header = '구매회사';
        cols.align = "center";
        cols.width = 180;  
        wtab04Grid.columns.push(cols);

        cols = new wijmo.grid.Column(); 
        cols.binding = 'faceddate';
        cols.header = '구매일';
        cols.align = "center";
        cols.width = 150;  
        wtab04Grid.columns.push(cols);

        cols = new wijmo.grid.Column(); 
        cols.binding = 'facbypernm';
        cols.header = '구매담당';
        cols.align = "center";
        cols.width = 120;  
        wtab04Grid.columns.push(cols); 
   }



   
   function wcifChk_a(arg0, arg1,arg2,arg3,arg4,arg5,arg6,arg7,arg8,arg9,arg10,arg11,arg12,arg13,arg14,arg15,arg16,arg17,arg18,arg19,arg20,arg21,arg22,arg23,arg24,arg25){   
        // faccd,  facflag, facno, facname, facmodel,   0-4
        //  facjaejo,facjaejono ,facdate, facstdate, faceddate, 5-9
        //  facbycltnm, facbypernm, factelno,  facgubun, facamt, 10-14
        // facjunwon,facdivnm, facgita, facsize, facweight, 15-19
        // fachyung, factype, facvolumn, facgunondo, facgunpung  20-24
        //  facscrew ); 25
       var ls_tab = document.getElementById('tabvalue').value; 
       updateTable(arg1)
       document.getElementById('infaccd').value = arg0;
       document.getElementById('infacflag').value = arg1;
       document.getElementById('infacno').value = arg2;
       document.getElementById('infacname').value = arg3;
       document.getElementById('infacmodel').value = arg4;
       document.getElementById('infacjaejo').value = arg5;       
       document.getElementById('infacjaejono').value = arg6;
       wmachdate.value   = arg7;
       wmachstdate.value = arg8;
       wmacheddate.value = arg9;
    //    document.getElementById('infacdate').value = arg3;
    //    document.getElementById('infacstdate').value = arg4;
    //    document.getElementById('infaceddate').value = arg5;
       document.getElementById('infacbycltnm').value = arg10;

       document.getElementById('infacbypernm').value = arg11;
       document.getElementById('infactelno').value = arg12;
       document.getElementById('infacgubun').value = arg13;
       document.getElementById('infacamt').value = arg14;
       document.getElementById('infacjunwon').value = arg15;
       document.getElementById('infacdivnm').value = arg16; 
       document.getElementById('infacgita').value = arg17;
 


        switch(arg1){
            case '01': 
                document.getElementById('infacsize').value = arg18;          //SIZE
                document.getElementById('infacweight').value = arg19;      //중량
                document.getElementById('infachyung').value = arg20;          //형체결력
                document.getElementById('infacscrew').value = arg25;         //스크류
                break;        
            case '02': 
                document.getElementById('infactype').value = arg21;         //TYPE
                break;        
            case '03': 
                document.getElementById('infacsize').value = arg18;         //SIZE
                document.getElementById('infacvolumn').value = arg22;     //용량
                document.getElementById('infacgunondo').value = arg23;          //건조온도
                document.getElementById('infacgunpung').value = arg24;         //건조풍량
                break;           
            default:    
                break;                
        }  

       var ls_image01 = "" ;
       var ls_image02 = "" ;
       var ls_image03 = "" ;
       var ls_image04 = "" ;
       var ls_image05 = "" ;
       var ls_image06 = "" ;
        //이미지조회     
        $.ajax({
            url: '/app01m/index08/printimg',  
            type:"POST",
            data: { 
                "inmachcd" : arg0, 
            }, 
            async:false,
            success:function(data){  
                for (var i = 0; i < data.length; i++) { 
                    if (i == 0){ls_image01 = data[0].save_name;}
                    if (i == 1){ls_image02 = data[1].save_name;}
                    if (i == 2){ls_image03 = data[2].save_name;}
                    if (i == 3){ls_image04 = data[3].save_name;}
                    if (i == 4){ls_image05 = data[4].save_name;}
                    if (i == 5){ls_image06 = data[5].save_name;}
                }
            },error:function(e){
                console.log("error");                            
            }
        }).done(function(fragment){           

        })  

        // th:src="@{assets/img/icons/spot-illustrations/falcon.png}"
        // 캐싱 방지를 위해 timestamp 추가
        const timestamp = new Date().getTime();

        // var ls_src01 = `assets/upload/${arg0}/${ls_image01}`;
        // var ls_src02 = `assets/upload/${arg0}/${ls_image02}`;
        // var ls_src03 = `assets/upload/${arg0}/${ls_image03}`;
        // var ls_src04 = `assets/upload/${arg0}/${ls_image04}`;
        // var ls_src05 = `assets/upload/${arg0}/${ls_image05}`;
        // var ls_src06 = `assets/upload/${arg0}/${ls_image06}`;


        // // 이미지를 갱신하여 즉시 반영
        // document.getElementById('cell1').innerHTML = `<img src="${ls_src01}" alt="Image 1" style="max-width:100%; max-height:100%;" onclick="confirmDeletion(this, '${ls_image01}')">`;
        // document.getElementById('cell2').innerHTML = `<img src="${ls_src02}" alt="Image 2" style="max-width:100%; max-height:100%;" onclick="confirmDeletion(this, '${ls_image02}')">`;
        // document.getElementById('cell3').innerHTML = `<img src="${ls_src03}" alt="Image 3" style="max-width:100%; max-height:100%;" onclick="confirmDeletion(this, '${ls_image03}')">`;
        // document.getElementById('cell4').innerHTML = `<img src="${ls_src04}" alt="Image 4" style="max-width:100%; max-height:100%;" onclick="confirmDeletion(this, '${ls_image04}')">`;
        // document.getElementById('cell5').innerHTML = `<img src="${ls_src05}" alt="Image 5" style="max-width:100%; max-height:100%;" onclick="confirmDeletion(this, '${ls_image05}')">`;
        // document.getElementById('cell6').innerHTML = `<img src="${ls_src06}" alt="Image 6" style="max-width:100%; max-height:100%;" onclick="confirmDeletion(this, '${ls_image06}')">`;



        var ls_src01 = "assets/upload/" + arg0 + "/" + ls_image01;
        var ls_src02 = "assets/upload/" + arg0 + "/" + ls_image02; 
        var ls_src03 = "assets/upload/" + arg0 + "/" + ls_image03; 
        var ls_src04 = "assets/upload/" + arg0 + "/" + ls_image04; 
        var ls_src05 = "assets/upload/" + arg0 + "/" + ls_image05; 
        var ls_src06 = "assets/upload/" + arg0 + "/" + ls_image06; 
        const imageUrl01 = `http://mes.c-kd.com:8500/${ls_src01}`;
        const imageUrl02 = `http://mes.c-kd.com:8500/${ls_src02}`;
        const imageUrl03 = `http://mes.c-kd.com:8500/${ls_src03}`;
        const imageUrl04 = `http://mes.c-kd.com:8500/${ls_src04}`;
        const imageUrl05 = `http://mes.c-kd.com:8500/${ls_src05}`;
        const imageUrl06 = `http://mes.c-kd.com:8500/${ls_src06}`;
        document.getElementById('cell1').innerHTML = '<img src="' + imageUrl01 + '" alt="Image 1" style="max-width:100%; max-height:100%;" onclick="confirmDeletion(this,"' + ls_image01 + '")">';
        document.getElementById('cell2').innerHTML = '<img src="' + imageUrl02 + '" alt="Image 2" style="max-width:100%; max-height:100%;" onclick="confirmDeletion(this,"' + ls_image02 +'")">';
        document.getElementById('cell3').innerHTML = '<img src="' + imageUrl03 + '" alt="Image 2" style="max-width:100%; max-height:100%;" onclick="confirmDeletion(this,"' + ls_image03 +'")">';
        document.getElementById('cell4').innerHTML = '<img src="' + imageUrl04 + '" alt="Image 2" style="max-width:100%; max-height:100%;" onclick="confirmDeletion(this,"' + ls_image04 +'")">';
        document.getElementById('cell5').innerHTML = '<img src="' + imageUrl05 + '" alt="Image 2" style="max-width:100%; max-height:100%;" onclick="confirmDeletion(this,"' + ls_image05 +'")">';
        document.getElementById('cell6').innerHTML = '<img src="' + imageUrl06 + '" alt="Image 2" style="max-width:100%; max-height:100%;" onclick="confirmDeletion(this,"' + ls_image06 +'")">';
 
        
       searchList_rtn("B");  

   }   
 
   
   function confirmDeletion(imgElement, arg){
        if (confirm("이미지를 삭제하시겠습니까?")) {
                //이미지삭제     
                $.ajax({
                    url: '/app01m/index08/printimgdel',  
                    type:"POST",
                    data: { 
                        "savename" : arg, 
                    }, 
                    async:false,
                    success:function(data){  
                           alert("삭제되었습니다.") 
                    },error:function(e){
                        console.log("error");                            
                    }
                }).done(function(fragment){           

                })  

                imgElement.parentElement.innerHTML = "";
         }    
   }
   function wcifChk_b(arg1,arg2,arg3,arg4,arg5,arg6,arg7  ){   
        // fixid, fixmachcd, reqdate, respdate, fixtext, fixcltnm, remark  
       var ls_tab = document.getElementById('tabvalue').value; 
          
       document.getElementById('infixid').value = arg1; 
       document.getElementById('infixtext').value = arg5;
       document.getElementById('infixcltnm').value = arg6;
       document.getElementById('inremark').value = arg7;    
       wreqdate.value   = arg3;
       wrespdate.value = arg4; 
       

   }   


function addFile() {

    const fileDivs = $('div[data-name="fileDiv"]');
    if (fileDivs.length > 2) {
        alert('파일은 최대 세 개까지 업로드 할 수 있습니다.');
        return false;
    } 
    fileIdx++;
    const fileHtml = `
    <div data-name="fileDiv" class="form-group filebox bs3-primary">
        <div class="table table_style3">
            <table>
                <tr>
                    <th>첨부사진 #${fileIdx}</th>
                    <td colspan="5">
                        <!-- <label for="file_${fileIdx}" class="col-sm-2 control-label">파일1</label> -->
                        <div class="col-sm-15">
                            <input type="text" class="upload-name" value="파일 찾기" readonly />
                            <label for="file_${fileIdx}" class="control-label">찾아보기</label>
                            <input type="file" name="files_${fileIdx}" id="file_${fileIdx}" multiple='multiple'  class="upload-hidden" onchange="changeFilename(this)" />

                            <button type="button" onclick="removeFile(this)" class="btn btn-bordered btn-xs visible-xs-inline visible-sm-inline visible-md-inline visible-lg-inline">
                                <i class="fa fa-minus" aria-hidden="true"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    `;


    $('#btnDiv').before(fileHtml);
}

function removeFile(elem) {

    const prevTag = $(elem).prev().prop('tagName');
    if (prevTag === 'BUTTON') {
        const file = $(elem).prevAll('input[type="file"]');
        const filename = $(elem).prevAll('input[type="text"]');
        file.val('');
        filename.val('파일 찾기');
        return false;
    }

    const target = $(elem).parents('div[data-name="fileDiv"]');
    fileIdx = fileIdx - 1;
    target.remove();
}


function deleteFile(elem, arg1, arg2) {

    if (!confirm("파일을 삭제하시겠습니까?")) {
        return ;
    }

    //도면 파일 삭제
    $.ajax({
        url: '/appadmod/filedel',
        type:"POST",
        data: {
            "actidxz"     : arg1 ,
            "actnseqz"    : arg2 ,
            "actnflagz"    : "NN"
        },
        async:false,
        success:function(data){
            if(data == "success"){
                // console.log("deletefile", data);
                const target = $(elem).parents('div[data-name="fileDiv"]');
                target.remove();
            }else{
                alert("삭제중 오류가 발생했습니다. 관리자에게 문의하세요.")
            }
        },error:function(e){
            console.log('error',e);
        }
    }).done(function(fragment){

    })


} 
function changeFilename(file) { 
    file = $(file);
    const filename = file[0].files[0].name;
    const target = file.prevAll('input');
    target.val(filename);
}

function listUp01(){
    window.location.href = '/app01/index22';
}; 

//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$


   $(document).ready(function() {   
       init()          
       getToday()
       //fn_egov_init_date() 
       $("#frdate").change(function(e){ 
           // console.log("달력클릭");
           // console.log(convert_time(e.timestamp));
       })
       $("#todate").change(function(e){ 
           // console.log("달력클릭");
           // console.log(convert_time(e.timestamp));
       })
   })
 
   function init(){
        // 일반 입력 날짜
        wmachdate = new wijmo.input.InputDate('#infacdate', {
            isRequired: false,
            value: null,
            placeholder: '',
            format: 'yyyy-MM-dd', 
        });
        
        wmachstdate = new wijmo.input.InputDate('#infacstdate', {
            isRequired: false,
            value: null,
            placeholder: '',
            format: 'yyyy-MM-dd', 
        });
        
        wmacheddate = new wijmo.input.InputDate('#infaceddate', {
            isRequired: false,
            value: null,
            placeholder: '',
            format: 'yyyy-MM-dd', 
        });
        
        
        wreqdate = new wijmo.input.InputDate('#inreqdate', {
            isRequired: false,
            value: null,
            placeholder: '',
            format: 'yyyy-MM-dd', 
        });
        
        
        wrespdate = new wijmo.input.InputDate('#inrespdate', {
            isRequired: false,
            value: null,
            placeholder: '',
            format: 'yyyy-MM-dd', 
        });

        var result = new Date();
        result.setHours(result.getHours() + 9);
        var ls_date = result.toISOString().substring(0,10);
        wmachdate.value = ls_date; 
        wmachstdate.value = ls_date;  
        wmacheddate.value = ls_date;   
        wreqdate.value = ls_date;  
        wrespdate.value = ls_date; 
        gs_today = ls_date;
    } 


   function getToday(){
       let today = new Date();   

       let year = today.getFullYear(); // 년도
       let month = today.getMonth() + 1;  // 월
       let date = today.getDate();  // 날짜
       let day = today.getDay();  // 요일
       if(month > 0 && month < 10) {month = "0" + month};
       if(date > 0 && date < 10) {date = "0" + date};
       let ls_frday = year + '-' + month + '-01' 
       let ls_today = year + '-' + month + '-' + date 
       // document.getElementById('frdate').value = ls_frday;
       // document.getElementById('todate').value = ls_today;
   }

   function convert_date(arg_date){  
        var ls_arg_date = String(arg_date); 
        if(ls_arg_date == null || ls_arg_date.length == 0 || ls_arg_date == ""|| ls_arg_date == "null"){  
            return "";
        }  
        // Date 객체로 변환
        const dateObj = new Date(arg_date);

        // 년, 월, 일 추출 (월은 0부터 시작하므로 +1 필요)
        const year = dateObj.getFullYear();
        const month = String(dateObj.getMonth() + 1).padStart(2, '0');
        const day = String(dateObj.getDate()).padStart(2, '0');

        // "YYYY-MM-DD" 형식으로 변환
        const formattedDate = `${year}${month}${day}`;
        arg_date = formattedDate; 
        return arg_date;  
    }
   function convert_time(timestamp){ 
       //현재시간
       var date = new Date(timestamp); 
       var year = date.getFullYear();
       var month = ("0" + (1 + date.getMonth())).slice(-2);
       var day = ("0" + date.getDate()).slice(-2); 
       var hh = date.getHours();  
       var min = ('0' + date.getMinutes()).slice(-2) 
       time = year +  month +  day   ;
       return time;  
   }
 

   class FlexGridContextMenu {
       constructor(grid) {
           let host = grid.hostElement, menu = this._buildMenu(grid);
           host.addEventListener('contextmenu', (e) => {
               // 클릭된 셀/열 선택
               let sel = grid.selection, ht = grid.hitTest(e), row = ht.getRow();

               switch (ht.panel) {
                   case grid.cells:
                   let colIndex = ht.col;
                   // 만약 그룹 헤더이면, 그룹 열 선택
                   if (row instanceof wijmo.grid.GroupRow && row.dataItem instanceof wijmo.collections.CollectionViewGroup) {
                       let gd = row.dataItem.groupDescription;
                       if (gd instanceof wijmo.collections.PropertyGroupDescription) {
                       let col = grid.getColumn(gd.propertyName);
                       if (col && col.index > -1) {
                           colIndex = col.index;
                       }
                       }
                   }
                   grid.select(ht.row, colIndex);
                   break;
                   case grid.columnHeaders:
                   grid.select(sel.row, ht.col);
                   break;
                   case grid.rowHeaders:
                   grid.select(ht.row, sel.col);
                   break;
                   default:
                   return; // 유효하지 않는 패널
               }
               // 현재 열에 대한 메뉴 표시
               if (grid.selection.col > -1) {
                   e.preventDefault(); // 브라우저의 기본 메뉴 취소
                   menu.show(e); // Wijmo 메뉴 표시
               }
           }, true);
       }
       _buildMenu(grid) {
           let menu = new wijmo.input.Menu(document.createElement('div'), {
           owner: grid.hostElement,
           displayMemberPath: 'header',
           subItemsPath: 'items',
           commandParameterPath: 'cmd',
           dropDownCssClass: 'ctx-menu',
           openOnHover: true,
           closeOnLeave: true,
           itemsSource: [
               {
               header: '정렬', items: [
                   { header: 'Ascending', cmd: 'SRT_ASC' },
                   { header: 'Descending', cmd: 'SRT_DESC' },
                   { header: 'No Sort', cmd: 'SRT_NONE' },
                   { header: '-' },
                   { header: 'Clear All Sorts', cmd: 'SRT_CLR' }
               ]
               },
               { header: '-' },
               { header: 'Pin/Unpin', cmd: 'PIN' },
               { header: '-' },
               { header: 'AutoSize', cmd: 'ASZ' },
               { header: 'AutoSize All', cmd: 'ASZ_ALL' },
               { header: '-' },
               { header: 'Group/Ungroup', cmd: 'GRP' },
               { header: 'Clear All Groups', cmd: 'GRP_CLR' },
               { header: '-' },
               {
               header: '내려받기', items: [
                   { header: 'CSV', cmd: 'X_CSV' },
                   { header: 'XLSX', cmd: 'X_XLSX' },
                   { header: 'PDF', cmd: 'X_PDF' },
               ]
               }
           ],
           command: {
               // 메뉴 명령 활성화/비활성화
               canExecuteCommand: (cmd) => {
               let view = grid.collectionView, col = grid.columns[grid.selection.col];
               switch (cmd) {
                   case 'SRT_ASC':
                   return col.currentSort != '+';
                   case 'SRT_DESC':
                   return col.currentSort != '-';
                   case 'SRT_NONE':
                   return col.currentSort != null;
                   case 'SRT_CLR':
                   return view.sortDescriptions.length > 0;
                   case 'PIN':
                   return true; // toggle pin
                   case 'ASZ':
                   case 'ASZ_ALL':
                   return true;
                   case 'GRP':
                   return col.dataType != wijmo.DataType.Number; // don't group numbers
                   case 'GRP_CLR':
                   return view.groupDescriptions.length > 0;
               }
               return true;
               },
               // 메뉴 명령 실행
               executeCommand: (cmd) => {
                   let view = grid.collectionView, cols = grid.columns, col = cols[grid.selection.col], sd = view.sortDescriptions, gd = view.groupDescriptions;
                   switch (cmd) {
                       case 'SRT_ASC':
                       case 'SRT_DESC':
                       case 'SRT_NONE':
                       if (grid.allowSorting != wijmo.grid.AllowSorting.MultiColumn) {
                           sd.clear();
                       }
                       else {
                           for (let i = 0; i < sd.length; i++) {
                           if (sd[i].property == col.binding) {
                               sd.removeAt(i);
                               break;
                           }
                           }
                       }
                       if (cmd != 'SRT_NONE') {
                           sd.push(new wijmo.collections.SortDescription(col.binding, cmd == 'SRT_ASC'));
                       }
                           break;
                       case 'SRT_CLR':
                           sd.clear();
                           break;
                       case 'PIN':
                           let fCols = grid.frozenColumns;
                           if (col.index >= fCols) { // pinning
                               cols.moveElement(col.index, fCols, false);
                               cols.frozen++;
                           }
                           else { // unpinning
                               cols.moveElement(col.index, fCols - 1, false);
                               cols.frozen--;
                           }
                           break;
                       case 'ASZ':
                           grid.autoSizeColumn(col.index);
                           break;
                       case 'ASZ_ALL':
                           grid.autoSizeColumns(0, grid.columns.length - 1);
                           break;
                       case 'GRP':
                       // 그룹 삭제
                           for (let i = 0; i < gd.length; i++) {
                               if (gd[i].propertyName == col.binding) {
                               gd.removeAt(i);
                               return; // we're done
                               }
                           }
                           // 그룹 추가
                           gd.push(new wijmo.collections.PropertyGroupDescription(col.binding));
                           break;
                       case 'GRP_CLR':
                           gd.clear();
                           break;
                       // 내보내기
                       case 'X_CSV':
                           let rng = new wijmo.grid.CellRange(0, 0, grid.rows.length - 1, grid.columns.length - 1), csv = grid.getClipString(rng, wijmo.grid.ClipStringOptions.CSV, true, false);
                           wijmo.saveFile(csv, 'FlexGrid.csv');
                           break;
                       case 'X_XLSX':
                           const gridView = grid.collectionView;
                           let oldPgSize = gridView.pageSize, oldPgIndex = gridView.pageIndex;

                           grid.beginUpdate();
                           gridView.pageSize = 0;

                           wijmo.grid.xlsx.FlexGridXlsxConverter.saveAsync(grid, {includeCellStyles: true, includeColumnHeaders: true}, 'FlexGrid.xlsx',
                           saved => {
                           gridView.pageSize = oldPgSize;
                           gridView.moveToPage(oldPgIndex);
                           grid.endUpdate();
                           }, null
                           ); 
                           break;
                       case 'X_PDF':
                           wijmo.grid.pdf.FlexGridPdfConverter.export(grid, 'FlexGrid.pdf', {
                               maxPages: 10,
                               scaleMode: wijmo.grid.pdf.ScaleMode.PageWidth,
                               documentOptions: {
                               compress: true,
                               header: { declarative: { text: '\t&[Page] of &[Pages]' } },
                               footer: { declarative: { text: '\t&[Page] of &[Pages]' } },
                               info: { author: 'GrapeCity', title: 'FlexGrid' }
                               },
                               styles: {
                               cellStyle: { backgroundColor: '#ffffff', borderColor: '#c6c6c6' },
                               altCellStyle: { backgroundColor: '#f9f9f9' },
                               groupCellStyle: { backgroundColor: '#dddddd' },
                               headerCellStyle: { backgroundColor: '#eaeaea' }
                               }
                           });
                           break;
                   }
                   // 활성화 그리드 셀에 포커스 복원
                   grid.refresh();
                   let sel = grid.selection, cell = grid.cells.getCellElement(sel.row, sel.col);
                   if (cell) {
                       cell.focus();
                   }
               }
           }
           });
           // 완료
           return menu;
       }
   }        


</script>


                            
                    <!-- ######################### ######################### ######################### ######################### ######################### ######################### -->
                    </body> 
                </div>
                    <!------footer ------>
                    <!-- <footer th:replace="layouts/XDashBoard/XDashBoard_footer :: XDashBoard_footer"></footer> -->
                    <!--------------------->  
            </div>
        </main>
    </div>
</header>